"use strict";(globalThis.webpackChunk_dashlane_leeloo=globalThis.webpackChunk_dashlane_leeloo||[]).push([[4079],{774079:(e,t,a)=>{a.r(t),a.d(t,{CredentialAddPanel:()=>O}),a(461238);var i=a(526849),r=a(616274),s=a(704841),n=a(611792),o=a(696832),l=a(453576),d=a(511494),c=a(24836),u=a(216530),m=a(987364),p=a(190481),C=a(762863),w=a(244846),g=a(75032),h=a(599943),S=a(665968),y=a(259522),P=a(585921),I=a(383849),v=a.n(I),b=a(446389),f=a(178948);const k=()=>{const{translate:e}=(0,b.Z)();return(0,P.tZ)(C.V9,{icon:(0,P.tZ)("div",{className:v()(f.Z.icon,f.Z.dummyIcon)}),title:e("webapp_credential_addition_website")})};var q;const T=["name","website"],V={name:"title",website:"url"};var E=a(927761);const U=()=>({filterToken:{filterCriteria:[]},sortToken:{sortCriteria:[],uniqField:"id"}}),A={live:r.C.liveCredentialsCount,liveParam:(0,i.compose)(btoa,JSON.stringify,U),query:r.C.getCredentialsCount,queryParam:U},_={query:r.C.getActiveSpaces},N={live:r.C.livePremiumStatus,query:r.C.getPremiumStatus},D={activeSpaces:_,credentialCategories:{query:r.C.getCredentialCategories},credentialsCount:A,shouldShowRequireMasterPassword:{query:r.C.getShouldShowRequireMasterPassword},premiumStatus:N},M={strategies:D},L=(0,E.DP)((({activeSpaces:e,lee:t,premiumStatus:a,credentialCategories:i,shouldShowRequireMasterPassword:s,onClose:n,protectedItemsUnlockerShown:P,openProtectedItemsUnlocker:I,areProtectedItemsUnlocked:v})=>{const b=(0,o.createRef)(),{routes:f}=(0,p.Xo)(),{currentSpaceId:E}=(0,h.fV)(),U=(0,o.useRef)(!1),{createCollection:A,updateCollection:_}=(0,c.u7)(u.vaultOrganizationApi),[N,D]=(0,o.useState)(!1),[M,L]=(0,o.useState)(!1),[O,R]=(0,o.useState)(""),B=(0,o.useContext)(w.l),F=()=>{const{capabilities:e}=a;return Boolean(e?.passwordsLimit?.info?.limit)},W=async()=>{const e=await r.C.getCredentialsCount({filterToken:{filterCriteria:[]},sortToken:{sortCriteria:[],uniqField:"id"}}),t=(e=>{var t;return null!=(t=e?.capabilities?.passwordsLimit?.info?.limit)?t:0})(a);return t-e},Z=()=>{(0,m.N)(d.PageView.ItemCredentialList),n?n():(0,p.uX)(f.userCredentials)};o.useEffect((()=>{r.C.getIsForcedDomainsEnabled().then((e=>U.current=e)),F()&&(async()=>{await W()<=0&&L(!0)})(),B.password&&(R(B.password),D(!0)),(0,m.N)(d.PageView.ItemCredentialCreate)}),[]);const K={...(()=>{const e=(0,p.CN)();return T.reduce(((t,a)=>(t[V[a]||a]=e.get(a),t)),{})})(),password:O},x={...(e=>({autoLogin:!0,autoProtected:!1,category:"",email:"",id:"",limitedPermissions:!1,login:"",note:"",onlyForThisSubdomain:!1,otpSecret:"",otpUrl:"",password:"",protectWithMasterPassword:!1,secondaryLogin:"",spaceId:e,subdomainOnly:!1,title:"",type:"KWAuthentifiant",url:"",redirectUrl:"",linkedWebsites:{addedByDashlane:[],addedByUser:[]}}))(E),...K};return o.createElement(C.zI,{isViewingExistingItem:!1,itemHasBeenEdited:N,onSubmit:async()=>{const e=b.current?.getValues();Boolean(b.current?.isFormValid())&&e&&(await(async e=>{const t=b.current?.getVaultItemCollections(),a={kwType:"KWAuthentifiant",origin:l.SaveOrigin.MANUAL,content:e},i=await r.C.savePersonalDataItem(a);i.success&&t?.length&&((e,t)=>{const a=t.map((t=>(t.vaultItems=[{id:e,type:l.DataModelType.KWAuthentifiant}],t.id?_({id:t.id,collection:t,operationType:u.OperationType.APPEND}):A({content:t}))));Promise.allSettled(a)})(i.itemId,t)})(e),(0,g.au)(),F()&&await W()<=0?L(!0):Z())},onNavigateOut:Z,formId:"add_credential_panel",header:q||(q=o.createElement(k,null))},o.createElement(S.S,{ref:b,currentValues:x,lee:t,newItemType:"credential",signalEditedValues:()=>D(!0),additionalProps:{activeSpaces:e,credentialCategories:i.items,areProtectedItemsUnlocked:v,openProtectedItemsUnlocker:I,protectedItemsUnlockerShown:P,shouldShowRequireMasterPassword:s}}),M&&o.createElement(y.e,{isVisible:M,handleDismiss:()=>Z()}))})),O=(0,s.$)((0,n.i)(L,M),D)}}]);