/*! For license information please see background-5d3f7ed2.js.LICENSE.txt */
(self.webpackChunk_dashlane_amphora=self.webpackChunk_dashlane_amphora||[]).push([[433],{32750:(e,t,r)=>{"use strict";var n;r.d(t,{O:()=>n}),function(e){e.PopupCarbon="Popup",e.PopupCarbonLoader="PopupCarbonLoader",e.OptionsCarbon="OptionsCarbon",e.WebappCarbon="leeloo"}(n||(n={}))},18001:(e,t,r)=>{"use strict";r.d(t,{P:()=>u,y:()=>c});r(86847),r(4473),r(68126),r(41437),r(24814),r(71632),r(75815),r(73636),r(55566),r(72029),r(2165),r(83746),r(37944),r(55402),r(22250),r(92665),r(88737);function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,o=s(e);if(t){var a=s(this).constructor;r=Reflect.construct(o,arguments,a)}else r=o.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(c,e);var t,r,n,s=i(c);function c(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=s.call.apply(s,[this].concat(r))).isConnected=!1,e.onMessage=null,e}return t=c,(r=[{key:"connect",value:function(e){this.onMessage=function(t){e.receive(t)},this.isConnected=!0,this._connected()}},{key:"receive",value:function(e){this._messageReceived(e)}},{key:"send",value:function(e){if(!this.isConnected)throw new Error("Channel not connected");if(!this.onMessage)throw new Error("onMessage handler not set");this.onMessage(e)}}])&&o(t.prototype,r),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(r(71796).GenericChannel),u=function(e,t){e.connect(t),t.connect(e)}},81199:(e,t,r)=>{"use strict";r.d(t,{Y:()=>d});r(37391),r(38298),r(4473),r(68126),r(22250),r(26589),r(75815),r(92665),r(88737),r(2191),r(75986),r(41437),r(24814),r(71632),r(73636),r(55566),r(72029),r(2165),r(83746),r(37944),r(55402);var n=r(71796),o=r(95582),a=r(20500);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=l(e);if(t){var o=l(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(l,e);var t,r,n,i=u(l);function l(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this,r)).name=void 0,t.currentPorts=void 0,t.onConnectListener=function(e){if(e.name.startsWith(t.name)){if(t.currentPorts.has(e.name))throw new Error("Port already connected");if(!(0,o.k)(e))throw new Error("Sender origin not trusted");t.setup(e)}},t.onDisconnectListener=function(e){a.b.removeListener(t.onConnectListener);var r=t.currentPorts.get(e.name);if(r&&(r.onMessage.removeListener(t.onMessageListener),r.onDisconnect.removeListener(t.onDisconnectListener),t.currentPorts.delete(e.name)),t._disconnected(),chrome.runtime.lastError){var n,o=null!=(n=chrome.runtime.lastError.message)?n:"Unknown chrome.runtime.lastError";throw new Error(o)}},t.onMessageListener=function(e){t._messageReceived(e)},t.name=e,t.currentPorts=new Map,t}return t=l,(r=[{key:"connect",value:function(){a.b.addListener(this.onConnectListener)}},{key:"autoReconnect",value:function(){this.connect()}},{key:"send",value:function(e){if(!this.currentPorts.size)throw new Error("No port to send message");this.currentPorts.forEach((function(t){return t.postMessage(e)}))}},{key:"setup",value:function(e){var t=this.currentPorts.get(e.name);t&&(t.disconnect(),this.onDisconnectListener(t)),e.onMessage.addListener(this.onMessageListener),e.onDisconnect.addListener(this.onDisconnectListener),this.currentPorts.set(e.name,e),this._connected()}}])&&s(t.prototype,r),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),l}(n.GenericChannel)},31729:(e,t,r)=>{"use strict";r.d(t,{s:()=>d});r(37391),r(4473),r(68126),r(41437),r(24814),r(71632),r(75815),r(73636),r(55566),r(72029),r(2165),r(83746),r(37944),r(55402),r(22250),r(92665),r(88737);var n=r(71796),o=r(95582),a=r(20500);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=l(e);if(t){var o=l(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(l,e);var t,r,n,i=u(l);function l(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this,r)).name=void 0,t.port=void 0,t.onConnectListener=function(e){if(e.name===t.name){if(!(0,o.k)(e))throw new Error("Sender origin not trusted");t.setup(e)}},t.onDisconnectListener=function(){if(a.b.removeListener(t.onConnectListener),t.port&&(t.port.onMessage.removeListener(t.onMessageListener),t.port.onDisconnect.removeListener(t.onDisconnectListener),t.port=void 0),t._disconnected(),chrome.runtime.lastError){var e,r=null!=(e=chrome.runtime.lastError.message)?e:"Unknown chrome.runtime.lastError";throw new Error(r)}},t.onMessageListener=function(e){t._messageReceived(e)},t.name=e,t}return t=l,(r=[{key:"connect",value:function(){this.port&&(this.port.disconnect(),this.onDisconnectListener()),a.b.addListener(this.onConnectListener)}},{key:"autoReconnect",value:function(){this.connect()}},{key:"send",value:function(e){if(!this.port)throw new Error("No port to send message");this.port.postMessage(e)}},{key:"setup",value:function(e){this.port=e,this.port.onMessage.addListener(this.onMessageListener),this.port.onDisconnect.addListener(this.onDisconnectListener),this._connected()}}])&&s(t.prototype,r),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),l}(n.GenericChannel)},95582:(e,t,r)=>{"use strict";r.d(t,{k:()=>i});r(22250),r(75815),r(92665),r(88737),r(23389),r(21675),r(37853),r(35758),r(82312);var n=r(92204),o=["safari-mv2-converted","5P72E3GC48"];function a(e){var t=function(e){var t,r,n,o,a,i,s;return null!=(t=null===(r=e.sender)||void 0===r?void 0:r.origin)?t:new URL(null!=(n=null!=(o=null===(a=e.sender)||void 0===a?void 0:a.url)?o:null===(i=e.sender)||void 0===i||null===(s=i.tab)||void 0===s?void 0:s.url)?n:"").origin}(e);return new URL((0,n.A)("")).origin===t}function i(e){return!!function(e){var t,r,n=null!=(t=null===(r=e.sender)||void 0===r?void 0:r.id)?t:"";return o.some((function(e){return n.includes(e)}))}(e)||!!a(e)}},16103:(e,t,r)=>{"use strict";r.d(t,{D:()=>y});r(75815),r(45749),r(23041),r(22250),r(92665),r(88737),r(83746),r(37944),r(55402),r(97979),r(38509),r(95665),r(41533),r(2165),r(72029),r(4473),r(68126),r(71632),r(2191),r(75986),r(37391),r(41437),r(5744),r(18549),r(15442);var n=r(30754),o=r(82324),a=r(81805);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function s(){s=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,a=Object.create(o.prototype),i=new C(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return A()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=S(i,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,i),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var p={};function f(){}function h(){}function y(){}var m={};u(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(P([])));v&&v!==t&&r.call(v,o)&&(m=v);var b=y.prototype=f.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function n(o,a,s,c){var u=d(e[o],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==i(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=y,u(b,"constructor",y),u(y,"constructor",h),h.displayName=u(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(R.prototype),u(R.prototype,a,(function(){return this})),e.AsyncIterator=R,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new R(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(b),u(b,c,"Generator"),u(b,o,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function c(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}var u=" ";function l(e,t){return d.apply(this,arguments)}function d(){var e;return e=s().mark((function e(t,r){var i,c,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,n.U)(t);case 3:if(i=e.sent,"controllable_by_this_extension"===(c=i.levelOfControl)||"controlled_by_this_extension"===c){e.next=8;break}throw l=["Impossible to change browser setting: ".concat(t,"."),"Extension prevented from changing: ".concat(c)].join(u),new Error(l);case 8:e.next=18;break;case 10:if(e.prev=10,e.t0=e.catch(0),!(0,o.b)(e.t0)){e.next=15;break}throw d="Browser setting not supported: ".concat(t),new Error(d);case 15:if(!(0,o.I)(e.t0)){e.next=17;break}throw e.t0.runtimeError;case 17:throw e.t0;case 18:return e.prev=18,e.next=21,(0,a.t)(t,r);case 21:e.next=27;break;case 23:throw e.prev=23,e.t1=e.catch(18),(0,o.I)(e.t1)?e.t1.runtimeError:e.t1;case 27:case"end":return e.stop()}}),e,null,[[0,10],[18,23]])})),d=function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){c(a,n,o,i,s,"next",e)}function s(e){c(a,n,o,i,s,"throw",e)}i(void 0)}))},d.apply(this,arguments)}function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function f(){f=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof d?t:d,a=Object.create(o.prototype),i=new C(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return A()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=S(i,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,i),a}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function d(){}function h(){}function y(){}var m={};s(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(P([])));v&&v!==t&&r.call(v,o)&&(m=v);var b=y.prototype=d.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function n(o,a,i,s){var c=u(e[o],e,a);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==p(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(d).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,s)}))}s(c.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=y,s(b,"constructor",y),s(y,"constructor",h),h.displayName=s(y,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,s(e,i,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(R.prototype),s(R.prototype,a,(function(){return this})),e.AsyncIterator=R,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new R(c(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(b),s(b,i,"Generator"),s(b,o,(function(){return this})),s(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function h(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function y(){return m.apply(this,arguments)}function m(){var e;return e=f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=["autofillAddressEnabled","autofillCreditCardEnabled","passwordSavingEnabled"].map((function(e){return l(e,!1)})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e)})),m=function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){h(a,n,o,i,s,"next",e)}function s(e){h(a,n,o,i,s,"throw",e)}i(void 0)}))},m.apply(this,arguments)}},73384:(e,t,r)=>{"use strict";r.d(t,{F:()=>l});r(35758),r(82312),r(37391),r(75815),r(45749),r(83746),r(37944),r(55402),r(22250),r(92665),r(88737),r(97979),r(38509),r(95665),r(41533),r(2165),r(72029),r(4473),r(68126),r(71632),r(2191),r(75986),r(41437),r(5744),r(18549);var n=r(84318),o=r(16241);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(){i=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,a=Object.create(o.prototype),i=new C(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return A()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=S(i,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,i),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var p={};function f(){}function h(){}function y(){}var m={};u(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(P([])));v&&v!==t&&r.call(v,o)&&(m=v);var b=y.prototype=f.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function n(o,i,s,c){var u=d(e[o],e,i);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==a(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=y,u(b,"constructor",y),u(y,"constructor",h),h.displayName=u(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(R.prototype),u(R.prototype,s,(function(){return this})),e.AsyncIterator=R,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new R(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(b),u(b,c,"Generator"),u(b,o,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function s(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}var c={nightly:"icon_nightly_auth",mv2:"icon_auth",mv3:"icon_mv3_auth"},u="icon_not_auth";function l(e){return d.apply(this,arguments)}function d(){var e;return e=i().mark((function e(t){var r,a,s,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.isUserAuthenticated,a=r?(i=void 0,(i=(0,n.W)()).name.includes("Nightly")?c.nightly:i.name.includes("Beta")||3===i.manifest_version?c.mv3:c.mv2):u,s="icons/action/".concat(a),l={16:"".concat(s,".png"),32:"".concat(s,"@2x.png")},e.next=6,(0,o.B)(l);case 6:case"end":return e.stop()}var i}),e)})),d=function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){s(a,n,o,i,c,"next",e)}function c(e){s(a,n,o,i,c,"throw",e)}i(void 0)}))},d.apply(this,arguments)}},89962:(e,t,r)=>{"use strict";r.d(t,{$:()=>u});r(38298),r(86847),r(22250),r(75815),r(45749),r(92665),r(88737),r(23041),r(37391),r(83746),r(37944),r(55402),r(97979),r(38509),r(95665),r(41533),r(2165),r(72029),r(4473),r(68126),r(71632),r(2191),r(75986),r(41437),r(5744),r(18549);var n=r(329),o=r(98641);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(){i=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,a=Object.create(o.prototype),i=new C(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return A()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=S(i,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,i),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var p={};function f(){}function h(){}function y(){}var m={};u(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(P([])));v&&v!==t&&r.call(v,o)&&(m=v);var b=y.prototype=f.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function n(o,i,s,c){var u=d(e[o],e,i);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==a(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=y,u(b,"constructor",y),u(y,"constructor",h),h.displayName=u(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(R.prototype),u(R.prototype,s,(function(){return this})),e.AsyncIterator=R,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new R(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(b),u(b,c,"Generator"),u(b,o,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function s(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function c(e){var t="http".concat(e.secure?"s":""),r=e.domain.startsWith(".")?e.domain.substring(1):e.domain;return"".concat(t,"://").concat(r).concat(e.path)}function u(e){return l.apply(this,arguments)}function l(){var e;return e=i().mark((function e(t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,n.g)({domain:t});case 2:return r=e.sent,e.abrupt("return",Promise.all(r.map((function(e){return(0,o.O)({url:c(e),name:e.name})}))));case 4:case"end":return e.stop()}}),e)})),l=function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){s(a,n,o,i,c,"next",e)}function c(e){s(a,n,o,i,c,"throw",e)}i(void 0)}))},l.apply(this,arguments)}},41305:(e,t,r)=>{"use strict";r.d(t,{j:()=>c});r(75815),r(45749),r(83746),r(37944),r(55402),r(22250),r(92665),r(88737),r(97979),r(38509),r(95665),r(41533),r(2165),r(72029),r(4473),r(68126),r(71632),r(2191),r(75986),r(37391),r(41437),r(5744),r(18549);var n=r(39680),o=r(41808);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(){i=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,a=Object.create(o.prototype),i=new C(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return A()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=S(i,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,i),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var p={};function f(){}function h(){}function y(){}var m={};u(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(P([])));v&&v!==t&&r.call(v,o)&&(m=v);var b=y.prototype=f.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function n(o,i,s,c){var u=d(e[o],e,i);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==a(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=y,u(b,"constructor",y),u(y,"constructor",h),h.displayName=u(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(R.prototype),u(R.prototype,s,(function(){return this})),e.AsyncIterator=R,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new R(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(b),u(b,c,"Generator"),u(b,o,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function s(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function c(e){return u.apply(this,arguments)}function u(){var e;return e=i().mark((function e(t){var r,a,s,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,n.G)()){e.next=5;break}return e.next=3,(0,n.y)(t);case 3:return r=e.sent,e.abrupt("return",r>0);case 5:return e.next=7,(0,o.U)(t);case 7:return a=e.sent,s=void 0===a[t],c=null===a[t],e.abrupt("return",!s&&!c);case 11:case"end":return e.stop()}}),e)})),u=function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){s(a,n,o,i,c,"next",e)}function c(e){s(a,n,o,i,c,"throw",e)}i(void 0)}))},u.apply(this,arguments)}},79159:(e,t,r)=>{"use strict";r.d(t,{b:()=>_});r(86847),r(72424),r(23041),r(15442),r(37391),r(32202),r(75815),r(68585),r(45749),r(83746),r(37944),r(55402),r(22250),r(92665),r(88737),r(97979),r(38509),r(95665),r(41533),r(2165),r(72029),r(4473),r(68126),r(71632),r(2191),r(75986),r(41437),r(5744),r(18549),r(7541),r(22440),r(94973);var n=r(92204),o=r(24715),a=r(72733),i=r(57306),s=r(31460),c=(r(38298),r(61222));function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(){l=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,a=Object.create(o.prototype),i=new C(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return A()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=S(i,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,i),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var p={};function f(){}function h(){}function y(){}var m={};s(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(P([])));v&&v!==t&&r.call(v,o)&&(m=v);var b=y.prototype=f.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function n(o,a,i,s){var c=d(e[o],e,a);if("throw"!==c.type){var l=c.arg,p=l.value;return p&&"object"==u(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(p).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,s)}))}s(c.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=y,s(b,"constructor",y),s(y,"constructor",h),h.displayName=s(y,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,s(e,i,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(R.prototype),s(R.prototype,a,(function(){return this})),e.AsyncIterator=R,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new R(c(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(b),s(b,i,"Generator"),s(b,o,(function(){return this})),s(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function d(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function p(){return f.apply(this,arguments)}function f(){var e;return e=l().mark((function e(){var t,r,o,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.I)({});case 2:return t=e.sent,r=(0,n.A)(""),o=function(e){return"string"==typeof e.url&&e.url.startsWith(r)},a=function(e){return""!==e.url},e.abrupt("return",t.filter(o).filter(a));case 7:case"end":return e.stop()}}),e)})),f=function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){d(a,n,o,i,s,"next",e)}function s(e){d(a,n,o,i,s,"throw",e)}i(void 0)}))},f.apply(this,arguments)}function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function v(){v=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof d?t:d,a=Object.create(o.prototype),i=new C(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return A()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=S(i,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,i),a}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function d(){}function p(){}function f(){}var y={};s(y,o,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(P([])));g&&g!==t&&r.call(g,o)&&(y=g);var b=f.prototype=d.prototype=Object.create(y);function w(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function n(o,a,i,s){var c=u(e[o],e,a);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==h(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(d).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,s)}))}s(c.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}return p.prototype=f,s(b,"constructor",f),s(f,"constructor",p),p.displayName=s(f,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,i,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(R.prototype),s(R.prototype,a,(function(){return this})),e.AsyncIterator=R,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new R(c(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(b),s(b,i,"Generator"),s(b,o,(function(){return this})),s(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function b(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function w(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){b(a,n,o,i,s,"next",e)}function s(e){b(a,n,o,i,s,"throw",e)}i(void 0)}))}}var R="index.html";function S(){var e=(0,n.A)("");return"".concat(e).concat(R)}function E(e){var t=e.identifier,r=e.queryInfo,n=e.name,o=S();if(!n)return o;var a=t?"#".concat(n,"/").concat(t):"#".concat(n),i=r?"?".concat(function(e){return Object.keys(e).map((function(t){return"".concat(t,"=").concat(e[t])})).join("&")}(r)):"";return encodeURI("".concat(o).concat(a).concat(i))}function O(e){return C.apply(this,arguments)}function C(){return(C=w(v().mark((function e(t){var r;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={url:t},e.next=3,(0,o.U)(r);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){var t,r=e.existingTabs,n=e.focusedWindow,o=r.filter((function(e){return e.active})),a=o.find((function(e){return e.windowId===n.id})),i=o.pop(),s=r.pop();return null!=(t=null!=a?a:i)?t:s}function A(e){return j.apply(this,arguments)}function j(){return(j=w(v().mark((function e(t){var r,n,o,c,u,l;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.path,n=t.tabs,e.next=3,(0,a.T)();case 3:if(o=e.sent,c=P({existingTabs:n,focusedWindow:o})){e.next=7;break}return e.abrupt("return");case 7:if(c.windowId!==o.id&&(0,i.V)(c.windowId,{focused:!0}),c.id){e.next=10;break}return e.abrupt("return");case 10:return u=r===S()?{}:{url:r},l=m({active:!0},u),e.next=14,(0,s.V)(c.id,l);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return T.apply(this,arguments)}function T(){return T=w(v().mark((function e(t){var r,n,o,a,i;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,n=t.query,o=t.route,a=E({identifier:r,queryInfo:n,name:o}),e.next=4,p();case 4:if(!(i=e.sent).length){e.next=9;break}return e.next=8,A({path:a,tabs:i});case 8:return e.abrupt("return");case 9:return e.next=11,O(a);case 11:case"end":return e.stop()}}),e)}))),T.apply(this,arguments)}},35818:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(91478),t)},41342:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.permissionsApi=void 0;const n=r(68224),o=r(37392),a=r(35174);t.permissionsApi=(0,n.defineModuleApi)({name:"permissions",commands:{addGroupManager:o.AddGroupManager,removeGroupManager:o.RemoveGroupManager},events:{},queries:{userPermissions:a.UserPermissionsQuery}})},41015:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AddGroupManager=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.AddGroupManager=o},37392:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(41015),t),o(r(42763),t)},42763:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoveGroupManager=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.RemoveGroupManager=o},91478:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(41342),t),o(r(37392),t),o(r(35174),t),o(r(45073),t)},35174:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(71367),t)},71367:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserPermissionsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.Device})){}t.UserPermissionsQuery=o},45073:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PermissionSchema=void 0;const n=r(10295);t.PermissionSchema=n.z.enum(["GROUP_CREATE","GROUP_DELETE","GROUP_EDIT","GROUP_READ"])},89858:(e,t,r)=>{"use strict";r.d(t,{B:()=>A});var n,o=r(32839),a=r(35818),i=r(17530),s=r(60399),c=r(53576),u=r(87279),l=r(48844),d=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},p=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(e){e[e.GroupManager=0]="GroupManager"}(n||(n={}));let f=class{constructor(e,t){this.serverApiClient=e,this.client=t}async addRole({role:e,params:t}){if(e===n.GroupManager)return await this.addGroupManager(t)}async removeRole({role:e,params:t}){if(e===n.GroupManager)return await this.removeGroupManager(t)}async getSpecialUserGroupRevision(e){const{commands:{carbon:t}}=this.client.getClient(c.carbonLegacyApi),r=await t({name:"getSpecialUserGroupRevision",args:[{teamId:e}]});let n;if(!(0,u.d6)(r))throw r.error.error;{const{carbonResult:e}=r.data,{specialUserGroupRevision:t}=e;n=t}return n}async removeGroupManager({memberLogin:e,teamId:t}){const r=await this.getSpecialUserGroupRevision(t);return await(0,s.z)(this.serverApiClient.v1.teams.removeGroupManager({memberLogin:e,userGroupRevision:r}).pipe((0,l.DZ)((e=>{throw new Error(e.message)})),(0,l.lk)((e=>{if(e.data)return(0,u.Vp)(void 0);throw new Error("Unknown server error occurred while attempting to remove group manager")}))))}async addGroupManager({memberLogin:e,teamId:t}){const r=await this.getSpecialUserGroupRevision(t),{commands:{carbon:n}}=this.client.getClient(c.carbonLegacyApi),o=await n({name:"getSpecialUserGroupInviteValuesForMemberInTeam",args:[{memberLogin:e,teamId:t}]});let a="",i="";if(!(0,u.d6)(o))throw o.error.error;{const{carbonResult:e}=o.data,{groupKey:t,proposeSignature:r}=e;a=t,i=r}return await(0,s.z)(this.serverApiClient.v1.teams.addGroupManager({memberLogin:e,groupKey:a,proposeSignature:i,userGroupRevision:r}).pipe((0,l.DZ)((e=>{throw new Error(e.message)})),(0,l.lk)((e=>{if(e.data)return(0,u.Vp)(void 0);throw new Error("Unknown server error occurred while attempting to add group manager")}))))}};f=d([(0,o.Injectable)(),p("design:paramtypes",[i.lX,o.CqrsClient])],f);var h=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let m=class{constructor(e){this.roleService=e}async execute({body:e}){return await this.roleService.addRole({role:n.GroupManager,params:e})}};m=h([(0,o.CommandHandler)(a.AddGroupManager),y("design:paramtypes",[f])],m);var g=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},v=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let b=class{constructor(e){this.roleService=e}async execute({body:e}){return await this.roleService.removeRole({role:n.GroupManager,params:e})}};b=g([(0,o.CommandHandler)(a.RemoveGroupManager),v("design:paramtypes",[f])],b);var w=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},R=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let S=class{constructor(e){this.serverApiClient=e}getActiveUserPermissions(){return this.serverApiClient.v1.teams.getUserPermissions().pipe((0,l.DZ)((e=>{throw new Error(`getUserPermissions failed with error: ${e}`)})),(0,l.lk)((e=>(0,u.Vp)(this.serverToDomainPermissionsMapper(e.data.permissions)))))}serverToDomainPermissionsMapper(e){return e.filter((e=>a.PermissionSchema.safeParse(e).success))}};S=w([(0,o.Injectable)(),R("design:paramtypes",[i.lX])],S);var E=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},O=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let C=class{constructor(e){this.permissionsService=e}execute(){return this.permissionsService.getActiveUserPermissions()}};C=E([(0,o.QueryHandler)(a.UserPermissionsQuery),O("design:paramtypes",[S])],C);var P=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let A=class{};A=P([(0,o.Module)({api:a.permissionsApi,imports:[i.nr],providers:[S,f],handlers:{commands:{addGroupManager:m,removeGroupManager:b},events:{},queries:{userPermissions:C}}})],A)},70430:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.accountRecoveryKeyApi=void 0;const n=r(68224),o=r(83550),a=r(88522);t.accountRecoveryKeyApi=(0,n.defineModuleApi)({name:"accountRecoveryKey",commands:{goToActivationNextStep:o.GoToActivationNextStepCommand,goToActivationPrevStep:o.GoToActivationPrevStepCommand,requestActivation:o.RequestActivationCommand,cancelActivation:o.CancelActivationCommand,cancelGeneration:o.CancelGenerationCommand,confirmActivation:o.ConfirmActivationCommand,deactivate:o.DeactivateCommand,goToRecoveryNextStep:o.GoToRecoveryNextStepCommand,goToRecoveryPrevStep:o.GoToRecoveryPrevStepCommand},queries:{activationFlowStatus:a.ActivationFlowStatusQuery,accountRecoveryKeyStatus:a.AccountRecoveryKeyStatusQuery,recoveryFlowStatus:a.RecoveryFlowStatusQuery,recoveryMethodsInfo:a.RecoveryMethodsInfoQuery},events:{}})},78589:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancelActivationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.CancelActivationCommand=o},20130:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancelGenerationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.CancelGenerationCommand=o},58661:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfirmActivationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.ConfirmActivationCommand=o},89289:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeactivateCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DeactivateCommand=o},75006:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoToActivationNextStepCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.GoToActivationNextStepCommand=o},26927:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoToActivationPrevStepCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.GoToActivationPrevStepCommand=o},72133:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoToRecoveryNextStepCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.GoToRecoveryNextStepCommand=o},39621:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoToRecoveryPrevStepCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.GoToRecoveryPrevStepCommand=o},83550:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(75006),t),o(r(26927),t),o(r(39621),t),o(r(72133),t),o(r(31614),t),o(r(58661),t),o(r(78589),t),o(r(89289),t),o(r(20130),t)},31614:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestActivationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.RequestActivationCommand=o},8532:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(70430),t),o(r(83550),t),o(r(88522),t),o(r(16143),t)},30530:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AccountRecoveryKeyStatusQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.AccountRecoveryKeyStatusQuery=o},76870:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActivationFlowStatusQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.ActivationFlowStatusQuery=o},88522:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(30530),t),o(r(76870),t),o(r(900),t),o(r(24771),t)},24771:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecoveryFlowStatusQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.Device})){}t.RecoveryFlowStatusQuery=o},900:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecoveryMethodsInfoQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.RecoveryMethodsInfoQuery=o},16143:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecoveryFlowViewStep=t.ActivationFlowViewStep=void 0,function(e){e[e.InitActivation=0]="InitActivation",e[e.DisplayKey=1]="DisplayKey",e[e.ConfirmKey=2]="ConfirmKey",e[e.ActivationDone=3]="ActivationDone",e[e.ShowError=4]="ShowError",e[e.GenerateNewKey=5]="GenerateNewKey",e[e.CancelGenerateNewKey=6]="CancelGenerateNewKey"}(t.ActivationFlowViewStep||(t.ActivationFlowViewStep={})),function(e){e[e.InitRecovery=0]="InitRecovery",e[e.TwoFactorAuthentication=1]="TwoFactorAuthentication",e[e.EnterRecoveryKey=2]="EnterRecoveryKey"}(t.RecoveryFlowViewStep||(t.RecoveryFlowViewStep={}))},31628:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(8532),t)},80566:(e,t,r)=>{"use strict";r.d(t,{D:()=>dt});var n=r(32839),o=r(17530),a=r(31628),i=r(87279),s=r(31948),c=r(5331),u=r(60399),l=r(87065),d=r(30523),p=r(48844),f=r(53576),h=r(68224);const y=e=>!(!e||"object"!=typeof e)&&"isEnabled"in e;class m extends((0,n.defineStore)({initialValue:{isEnabled:!1},persist:!1,scope:h.UseCaseScope.Device,storeName:"account-recovery-key",storeTypeGuard:y,capacity:n.StoreCapacity._001KB})){}const g="Something went wrong. Check your connection and retry, contact support if you still have issue";var v=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let w=class{constructor(e,t,r,n){this.store=e,this.serverApiClient=t,this.cqrsClient=r,this.context=n}getCurrentUserLogin(){return this.context.userName}async getCurrentPersonalSettings(){const{carbonStateList:e}=this.cqrsClient.getClient(f.carbonLegacyApi).queries;return await(0,u.z)(e({paths:["userSession.personalSettings.AccountRecoveryKey","userSession.personalSettings.AccountRecoveryKeyId"]}).pipe((0,p.nb)({success:([e,t])=>({AccountRecoveryKey:e,AccountRecoveryKeyId:t}),failure:()=>{throw new Error("Failure getting state list")}})))}getStatus(){return this.store.state$.pipe((0,l.U)((e=>e.isEnabled)))}updateStatus(){const e=this.getCurrentUserLogin();if(!e)throw new Error("No user login provided");return this.serverApiClient.v1.accountrecovery.getStatus({login:e}).pipe((0,d.h)(i.d6),(0,p.Qn)((e=>{this.store.set({isEnabled:e.data.enabled})})),(0,p.DZ)((e=>{throw e})))}async generateRecoveryKey(){const{carbon:e}=this.cqrsClient.getClient(f.carbonLegacyApi).commands,t={length:28,digits:!0,letters:!0,avoidAmbiguous:!0,symbols:!1};return await e({name:"generatePassword",args:[{settings:t}]})}async setPersonalSettings(e){const{carbon:t}=this.cqrsClient.getClient(f.carbonLegacyApi).commands;return await t({name:"updateAccountRecoveryKeyPersonalSettings",args:[e]})}async requestActivation(e){try{return await(0,u.z)(this.serverApiClient.v1.accountrecovery.requestActivation({encryptedVaultKey:e}).pipe((0,p.DZ)((e=>{throw new Error(e.message)})),(0,p.lk)((e=>{if(e.data.recoveryId)return(0,i.Vp)(e.data.recoveryId);throw new Error(g)}))))}catch(e){return(0,i.Rn)({tag:"failure",error:g})}}async confirmActivation(e){try{return await(0,u.z)(this.serverApiClient.v1.accountrecovery.confirmActivation({recoveryId:e}).pipe((0,p.DZ)((e=>{throw new Error(e.message)})),(0,p.lk)((()=>(0,i.Vp)(void 0)))))}catch(e){return(0,i.Rn)({tag:"failure",error:g})}}async deactivate(e){try{return await(0,u.z)(this.serverApiClient.v1.accountrecovery.deactivate({reason:e}).pipe((0,p.DZ)((e=>{throw new Error(e.message)})),(0,p.lk)((()=>(0,i.Vp)(void 0)))))}catch(e){return(0,i.Rn)({tag:"failure",error:g})}}};w=v([(0,n.Injectable)(),b("design:paramtypes",[m,o.lX,n.CqrsClient,n.RequestContext])],w);var R=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},S=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let E=class{constructor(e){this.recoveryKeyService=e}async execute(){try{const e=await(0,u.z)(this.recoveryKeyService.getStatus());return Promise.resolve({isFeatureEnabled:e,recoveryKey:"",recoveryId:"",encryptedVaultKey:""})}catch(e){return Promise.reject(new Error("Unable to retrieve initialization data"))}}};E=R([(0,n.Injectable)(),S("design:paramtypes",[w])],E);var O=r(54066),C=r(89685),P=r(44396),A=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},j=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let _=class{constructor(e,t){this.cqrsClient=e,this.flexibleEncryptor=t}makeDerivationConfig(e){const[,,t]=e.split("$");return"pbkdf2"===t?P.E1:P.mr}async getUserCryptoConfig(){const{carbonStateList:e}=this.cqrsClient.getClient(f.carbonLegacyApi).queries;return await(0,u.z)(e({paths:["userSession.personalSettings.CryptoFixedSalt","userSession.personalSettings.CryptoUserPayload"]}).pipe((0,p.nb)({success:([e,t])=>{if("string"!=typeof e)throw new Error("Fixed salt is not a string");if("string"!=typeof t)throw new Error("Marker is not a string");return{fixedSalt:e,derivationConfig:this.makeDerivationConfig(t)}},failure:()=>{throw new Error("Failure getting state list")}})))}async getUserMasterPassword(){const{carbonState:e}=this.cqrsClient.getClient(f.carbonLegacyApi).queries;return await(0,u.z)(e({path:"userSession.session.masterPassword"}).pipe((0,l.U)((e=>{if(!(0,i.d6)(e))throw new Error("Error when fetching master password from session");const t=e.data;if("string"!=typeof t)throw new Error("Result data is not a string");return(0,O.u)(t)}))))}async encrypt(e){const t=await this.getUserMasterPassword(),{derivationConfig:r,fixedSalt:n}=await this.getUserCryptoConfig();return await this.flexibleEncryptor.encrypt(e,t,r,P.Nw,{salt:(0,O.u)(n)})}};_=A([(0,n.Injectable)(),j("design:paramtypes",[n.CqrsClient,o._M])],_);var T=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},I=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let x=class{constructor(e,t){this.accountRecoveryKeyService=e,this.recoveryKeyEncryptor=t}async executeWithParams(e){if(e.recoveryKey)return{recoveryKey:e.recoveryKey,encryptedVaultKey:e.encryptedVaultKey,recoveryId:e.recoveryId};const t=await this.accountRecoveryKeyService.generateRecoveryKey();if((0,i.hx)(t))throw new Error("Failed to generate a recovery key");const r=(0,O.u)(t.data.carbonResult.password.toUpperCase()),n=await this.recoveryKeyEncryptor.encrypt(r),o=(0,C.v)(n),a=await this.accountRecoveryKeyService.requestActivation(o);if((0,i.hx)(a))throw new Error(`${a.error.error}`);return{recoveryKey:(0,C.v)(r),encryptedVaultKey:o,recoveryId:a.data}}};x=T([(0,n.Injectable)(),I("design:paramtypes",[w,_])],x);var D=r(11494),U=r(66179),M=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},N=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let k=class{constructor(e,t){this.accountRecoveryKeyService=e,this.cqrsClient=t}async sync(e){let t=!1;try{const e=await this.cqrsClient.getClient(U.syncApi).commands.sync({trigger:D.Trigger.Save});if((0,i.hx)(e))throw new Error("Could not sync after activating ARK");t=!0}finally{t||await this.accountRecoveryKeyService.setPersonalSettings(e)}}async executeWithParams(e,t){const r=await this.accountRecoveryKeyService.getCurrentPersonalSettings(),n={AccountRecoveryKey:e,AccountRecoveryKeyId:t};await this.accountRecoveryKeyService.setPersonalSettings(n),this.sync(r);const o=await this.accountRecoveryKeyService.confirmActivation(t);if((0,i.hx)(o))throw this.accountRecoveryKeyService.setPersonalSettings(r),this.sync(r),new Error("Could not confirm ARK activation");return this.accountRecoveryKeyService.updateStatus().subscribe(),Promise.resolve()}};k=M([(0,n.Injectable)(),N("design:paramtypes",[w,n.CqrsClient])],k);var L=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},F=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let q=class{constructor(e,t,r){this.initializeMachineService=e,this.requestActivationService=t,this.confirmActivationService=r}create(){return(0,s.C)({predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"ActivationFlowMachine",context:{isFeatureEnabled:!1,recoveryKey:"",recoveryId:"",encryptedVaultKey:""},states:{Starting:{invoke:{src:"initializeMachine",onDone:[{actions:["assignInitialContext"],target:"InitAccountRecoveryKeyActivation",cond:"isActivationFlow"},{actions:["assignInitialContext"],target:"GenerateNewAccountRecoveryKey"}]}},InitAccountRecoveryKeyActivation:{on:{REQUEST_ACTIVATION:{target:"DisplayAccountRecoveryKey"}}},DisplayAccountRecoveryKey:{invoke:{src:"requestActivation",onDone:{actions:["assignKeys"]},onError:{actions:["assignError"],target:"AccountRecoveryKeyActivationError"}},on:{GO_TO_NEXT_STEP:{target:"ConfirmAccountRecoveryKey"}}},ConfirmAccountRecoveryKey:{on:{GO_TO_NEXT_STEP:{target:"AccountRecoveryKeyActivationDone"},GO_TO_PREV_STEP:{target:"DisplayAccountRecoveryKey"}}},AccountRecoveryKeyActivationDone:{invoke:{src:"confirmActivation",onError:{actions:["assignError"],target:"AccountRecoveryKeyActivationError"}}},GenerateNewAccountRecoveryKey:{on:{REQUEST_ACTIVATION:{target:"DisplayAccountRecoveryKey"},CANCEL_GENERATION:{target:"CancelNewAccountRecoveryKey"}}},CancelNewAccountRecoveryKey:{on:{GO_TO_PREV_STEP:{target:"GenerateNewAccountRecoveryKey"}}},AccountRecoveryKeyActivationError:{type:"final"}},on:{CLEAR_ERROR:{actions:["clearError"]},RESET_FLOW:{actions:["clearContext"],target:"Starting"}}},{actions:{assignInitialContext:(0,c.f0)({encryptedVaultKey:(e,t)=>t.data.encryptedVaultKey,recoveryKey:(e,t)=>t.data.recoveryKey,recoveryId:(e,t)=>t.data.recoveryId,isFeatureEnabled:(e,t)=>t.data.isFeatureEnabled}),assignKeys:(0,c.f0)({recoveryKey:(e,t)=>t.data.recoveryKey,encryptedVaultKey:(e,t)=>t.data.encryptedVaultKey,recoveryId:(e,t)=>t.data.recoveryId}),assignError:(0,c.f0)({error:(e,t)=>t.data}),clearContext:(0,c.f0)({encryptedVaultKey:()=>"",recoveryKey:()=>"",recoveryId:()=>"",error:()=>{}}),clearError:(0,c.f0)({error:()=>{}})},services:{initializeMachine:()=>this.initializeMachineService.execute(),requestActivation:e=>this.requestActivationService.executeWithParams(e),confirmActivation:e=>this.confirmActivationService.executeWithParams(e.recoveryKey,e.recoveryId)},guards:{isActivationFlow:(e,t)=>!t.data.isFeatureEnabled}})}};q=L([(0,n.Injectable)(),F("design:paramtypes",[E,x,k])],q);var V=r(64472),G=r(24966),H=r(26290);const B=e=>!0;class K extends((0,n.defineStore)({initialValue:void 0,persist:!1,scope:h.UseCaseScope.Device,storeName:"activation-flow-machine",storeTypeGuard:B})){}var W=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},z=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let $=class{constructor(e,t,r){this.activationMachineStore=t,this.cqrsClient=r;const n=e.create();this.interpreter=V.kJ(n).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[ARK Activation] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.activationMachineStore,e)}catch(e){console.warn("[ARK Activation] Unable to get snapshot",e)}})),this.prepare()}async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?H.ZM.create(JSON.parse(t)):void 0})(this.activationMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[ARK Activation] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[ARK Activation] Unable to start machine",e)}}ready(){return new G.X(!0)}continue(e){if(!this.interpreter)throw new Error("Activation flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};$=W([(0,n.Injectable)(),z("design:paramtypes",[q,K,n.CqrsClient])],$);var Q,Y=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},X=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let J=Q=class{constructor(e,t,r,n){this.machine=e,this.store=t,this.cqrsClient=r,this.logger=n}getInstance(){return Q.instance||(Q.instance=new $(this.machine,this.store,this.cqrsClient)),Q.instance}};J=Q=Y([(0,n.Injectable)(),X("design:paramtypes",[q,K,n.CqrsClient,n.AppLogger])],J);var Z=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ee=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let te=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.getInstance().continue({type:"GO_TO_NEXT_STEP"}),Promise.resolve((0,i.Vp)(void 0))}};te=Z([(0,n.CommandHandler)(a.GoToActivationNextStepCommand),ee("design:paramtypes",[J])],te);var re=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ne=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let oe=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.getInstance().continue({type:"GO_TO_PREV_STEP"}),Promise.resolve((0,i.Vp)(void 0))}};oe=re([(0,n.CommandHandler)(a.GoToActivationPrevStepCommand),ne("design:paramtypes",[J])],oe);var ae=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ie=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let se=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.getInstance().continue({type:"REQUEST_ACTIVATION"}),Promise.resolve((0,i.Vp)(void 0))}};se=ae([(0,n.CommandHandler)(a.RequestActivationCommand),ie("design:paramtypes",[J])],se);var ce=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ue=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let le=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.getInstance().continue({type:"RESET_FLOW"}),Promise.resolve((0,i.Vp)(void 0))}};le=ce([(0,n.CommandHandler)(a.CancelActivationCommand),ue("design:paramtypes",[J])],le);var de=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},pe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let fe=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.getInstance().continue({type:"CANCEL_GENERATION"}),Promise.resolve((0,i.Vp)(void 0))}};fe=de([(0,n.CommandHandler)(a.CancelGenerationCommand),pe("design:paramtypes",[J])],fe);var he=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ye=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let me=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.getInstance().continue({type:"GO_TO_NEXT_STEP"}),Promise.resolve((0,i.Vp)(void 0))}};me=he([(0,n.CommandHandler)(a.ConfirmActivationCommand),ye("design:paramtypes",[J])],me);var ge=r(82567),ve=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},be=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let we=class{constructor(e,t){this.accountRecoveryKeyService=e,this.activationFlow=t}async execute(e){const{reason:t}=e.body,r=await this.accountRecoveryKeyService.deactivate(t);if((0,i.hx)(r))throw new Error("Something wrong happened with Account Recovery Key deactivation.");return this.accountRecoveryKeyService.updateStatus().pipe((0,ge.b)((()=>{this.activationFlow.getInstance().continue({type:"RESET_FLOW"})}))).subscribe(),Promise.resolve((0,i.Vp)(void 0))}};we=ve([(0,n.CommandHandler)(a.DeactivateCommand),be("design:paramtypes",[w,J])],we);var Re=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Se=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ee=class{constructor(e){this.recoveryKeyService=e}execute(){try{return Promise.resolve({authTicket:""})}catch(e){return Promise.reject(new Error("Unable to retrieve initialization data"))}}};Ee=Re([(0,n.Injectable)(),Se("design:paramtypes",[w])],Ee);var Oe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ce=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Pe=class{constructor(e){this.initializeMachineService=e}create(){return(0,s.C)({predictableActionArguments:!0,schema:{events:{},context:{authTicket:""}},initial:"Starting",id:"RecoveryFlowMachine",context:{authTicket:""},states:{Starting:{invoke:{src:"initializeMachine",onDone:[{actions:["assignInitialContext"],target:"TwoFactorAuthentication",cond:"isAuthTicketNeeded"},{actions:["assignInitialContext"],target:"EnterRecoveryKey"}]}},TwoFactorAuthentication:{},EnterRecoveryKey:{}},on:{CLEAR_ERROR:{actions:["clearError"]}}},{actions:{assignInitialContext:(0,c.f0)({authTicket:(e,t)=>t.data.authTicket}),assignError:(0,c.f0)({error:(e,t)=>t.data}),clearError:(0,c.f0)({error:()=>{}})},services:{initializeMachine:()=>this.initializeMachineService.execute()},guards:{isAuthTicketNeeded:(e,t)=>!t.data.authTicket}})}};Pe=Oe([(0,n.Injectable)(),Ce("design:paramtypes",[Ee])],Pe);const Ae=e=>!0;class je extends((0,n.defineStore)({initialValue:void 0,persist:!1,scope:h.UseCaseScope.Device,storeName:"recovery-flow-machine",storeTypeGuard:Ae})){}var _e=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Te=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ie=class{constructor(e,t,r){this.recoveryMachineStore=t,this.cqrsClient=r;const n=e.create();this.interpreter=V.kJ(n).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[ARK Recovery] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.recoveryMachineStore,e)}catch(e){console.warn("[ARK Recovery] Unable to get snapshot",e)}})),this.prepare()}async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?H.ZM.create(JSON.parse(t)):void 0})(this.recoveryMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[ARK Recovery] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[ARK Recovery] Unable to start machine",e)}}ready(){return new G.X(!0)}continue(e){if(!this.interpreter)throw new Error("Recovery flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};Ie=_e([(0,n.Injectable)(),Te("design:paramtypes",[Pe,je,n.CqrsClient])],Ie);var xe,De=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ue=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Me=xe=class{constructor(e,t,r,n){this.machine=e,this.store=t,this.cqrsClient=r,this.logger=n}getInstance(){return xe.instance||(xe.instance=new Ie(this.machine,this.store,this.cqrsClient)),xe.instance}};Me=xe=De([(0,n.Injectable)(),Ue("design:paramtypes",[Pe,je,n.CqrsClient,n.AppLogger])],Me);var Ne=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ke=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Le=class{constructor(e){this.recoveryFlow=e}execute(){return this.recoveryFlow.getInstance().continue({type:"GO_TO_NEXT_STEP"}),Promise.resolve((0,i.Vp)(void 0))}};Le=Ne([(0,n.CommandHandler)(a.GoToRecoveryNextStepCommand),ke("design:paramtypes",[Me])],Le);var Fe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},qe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ve=class{constructor(e){this.recoveryFlow=e}execute(){return this.recoveryFlow.getInstance().continue({type:"GO_TO_PREV_STEP"}),Promise.resolve((0,i.Vp)(void 0))}};Ve=Fe([(0,n.CommandHandler)(a.GoToRecoveryPrevStepCommand),qe("design:paramtypes",[Me])],Ve);var Ge=r(85390),He=r(6136),Be=r(69885),Ke=r(6220);const We=e=>(0,Be.of)((0,i.Vp)(function(e){return e.matches("Starting")||e.matches("InitAccountRecoveryKeyActivation")?{step:a.ActivationFlowViewStep.InitActivation}:e.matches("DisplayAccountRecoveryKey")?{step:a.ActivationFlowViewStep.DisplayKey,recoveryKey:e.context.recoveryKey}:e.matches("ConfirmAccountRecoveryKey")?{step:a.ActivationFlowViewStep.ConfirmKey,recoveryKey:e.context.recoveryKey}:e.matches("AccountRecoveryKeyActivationDone")?{step:a.ActivationFlowViewStep.ActivationDone}:e.matches("AccountRecoveryKeyActivationError")?{step:a.ActivationFlowViewStep.ShowError}:e.matches("GenerateNewAccountRecoveryKey")?{step:a.ActivationFlowViewStep.GenerateNewKey}:e.matches("CancelNewAccountRecoveryKey")?{step:a.ActivationFlowViewStep.CancelGenerateNewKey}:void console.warn("[ARK Activation] - No view associated to state ",e.value)}(e))),ze=e=>e.pipe((0,Ke.z)(We));var $e=r(52800);const Qe=(e,t)=>{const r=t.matches(e.value),n=(0,$e.Z)(e.context,t.context);return r&&n};var Ye=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Xe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Je=class{constructor(e,t){this.activationFlow=e,this.activationFlowMachineStore=t}execute(){return(0,Ge.a)([(e=this.activationFlowMachineStore,e.state$.pipe((0,l.U)((e=>e?H.ZM.create(JSON.parse(e)):void 0)))),this.activationFlow.getInstance().ready()],((e,t)=>{if(e&&t)return e})).pipe((0,d.h)(Boolean),(0,He.x)(((e,t)=>Qe(e,t))),ze);var e}};Je=Ye([(0,n.QueryHandler)(a.ActivationFlowStatusQuery),Xe("design:paramtypes",[J,K])],Je);var Ze=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},et=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let tt=class{constructor(e){this.accountRecoveryKeyService=e}execute(){return this.accountRecoveryKeyService.getStatus().pipe((0,l.U)((e=>(0,i.Vp)({isEnabled:e}))))}};tt=Ze([(0,n.QueryHandler)(a.AccountRecoveryKeyStatusQuery),et("design:paramtypes",[w])],tt);var rt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},nt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ot=class{constructor(e,t){this.accountRecoveryKeyService=e,this.client=t}execute(){this.accountRecoveryKeyService.updateStatus().subscribe();const e=this.client.getClient(f.carbonLegacyApi).queries.carbonState({path:"userSession.personalSettings.RecoveryOptIn"}).pipe((0,d.h)(i.d6),(0,l.U)((e=>"boolean"==typeof e.data&&e.data))),t=this.accountRecoveryKeyService.getStatus().pipe((0,l.U)((e=>e)));return(0,Ge.a)([e,t]).pipe((0,l.U)((([e,t])=>(0,i.Vp)({adminAssistedRecovery:e,accountRecoveryKey:t}))))}};ot=rt([(0,n.QueryHandler)(a.RecoveryMethodsInfoQuery),nt("design:paramtypes",[w,n.CqrsClient])],ot);const at=e=>(0,Be.of)((0,i.Vp)(function(e){return e.matches("Starting")?{step:a.RecoveryFlowViewStep.InitRecovery}:e.matches("TwoFactorAuthentication")?{step:a.RecoveryFlowViewStep.TwoFactorAuthentication}:void console.warn("[ARK Recovery] - No view associated to state ",e.value)}(e))),it=e=>e.pipe((0,Ke.z)(at));var st=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ct=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ut=class{constructor(e,t){this.recoveryFlow=e,this.recoveryFlowMachineStore=t}execute(){return(0,Ge.a)([(e=this.recoveryFlowMachineStore,e.state$.pipe((0,l.U)((e=>e?H.ZM.create(JSON.parse(e)):void 0)))),this.recoveryFlow.getInstance().ready()],((e,t)=>{if(e&&t)return e})).pipe((0,d.h)(Boolean),(0,He.x)(((e,t)=>Qe(e,t))),it);var e}};ut=st([(0,n.QueryHandler)(a.RecoveryFlowStatusQuery),ct("design:paramtypes",[Me,je])],ut);var lt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let dt=class{};dt=lt([(0,n.Module)({api:a.accountRecoveryKeyApi,stores:[K,je,m],imports:[o.nr,o.Dq],handlers:{commands:{goToActivationNextStep:te,goToActivationPrevStep:oe,requestActivation:se,cancelActivation:le,cancelGeneration:fe,confirmActivation:me,deactivate:we,goToRecoveryNextStep:Le,goToRecoveryPrevStep:Ve},events:{},queries:{activationFlowStatus:Je,accountRecoveryKeyStatus:tt,recoveryMethodsInfo:ot,recoveryFlowStatus:ut}},providers:[J,Me,q,Pe,E,Ee,w,x,k,_]})],dt)},23293:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(46942),t)},38835:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.overridesApi=void 0;const n=r(68224),o=r(98329);t.overridesApi=(0,n.defineModuleApi)({name:"overrides",commands:{},events:{},queries:{OverridesQuery:o.OverridesQuery}})},46942:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(38835),t),o(r(98329),t),o(r(58321),t)},57848:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OverridesQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.Device})){}t.OverridesQuery=o},98329:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(57848),t)},58321:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOverridesFileFormat=void 0;t.isOverridesFileFormat=e=>null!=e&&"object"==typeof e&&Object.values(e).every((e=>Array.isArray(e)&&e.every((e=>(e=>{if(!e||"object"!=typeof e)return!1;const t="type"in e&&void 0!==e.type&&("startsWith"===e.type||"regexp"===e.type),r="value"in e&&void 0!==e.value&&(Array.isArray(e.value)&&e.value.every((e=>"string"==typeof e))||"string"==typeof e.value),n="conditions"in e&&void 0!==e.conditions&&Array.isArray(e.conditions)&&e.conditions.every((e=>(e=>{const t="type"in e&&void 0!==e.type&&("css"===e.type||"xpath"===e.type),r="selector"in e&&void 0!==e.selector&&"string"==typeof e.selector;return t&&r})(e))),o="actions"in e&&void 0!==e.actions&&Array.isArray(e.actions)&&e.actions.every((e=>(e=>{const t="type"in e&&void 0!==e.type&&("set"===e.type||"ignore"===e.type),r="cssSelector"in e&&void 0!==e.cssSelector&&"string"==typeof e.cssSelector;return t&&r})(e)));return t&&r&&n&&o})(e)))))},26287:(e,t,r)=>{"use strict";r.d(t,{x:()=>f});var n=r(32839),o=r(23293),a=r(17530),i=r(87279),s=r(87065),c=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let l=class{constructor(e){this.rfuClient=e}execute(){return this.rfuClient.streamFileUpdate().pipe((0,s.U)((e=>(0,i.Vp)({overrides:e}))))}};l=c([(0,n.QueryHandler)(o.OverridesQuery),u("design:paramtypes",[a.wB])],l);var d=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};const p=(0,a.QI)("overrides.json",o.isOverridesFileFormat);let f=class{};f=d([(0,n.Module)({api:o.overridesApi,composes:[p],handlers:{commands:{},events:{},queries:{overrides:l}}})],f)},22829:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.authenticationFlowApi=void 0;const n=r(68224),o=r(23493),a=r(65433);t.authenticationFlowApi=(0,n.defineModuleApi)({name:"authenticationFlow",commands:{changeLogin:a.ChangeAccountEmailCommand,changeTwoFactorAuthenticationOtpType:a.ChangeTwoFactorAuthenticationOtpTypeCommand,clearError:a.ClearErrorCommand,resendEmailToken:a.ResendEmailTokenCommand,resendPushNotification:a.ResendPushNotificationCommand,sendAccountEmail:a.SendAccountEmailCommand,sendMasterPassword:a.SendMasterPasswordCommand,submitBackupCode:a.SubmitBackupCodeCommand,submitEmailToken:a.SubmitEmailTokenCommand,submitTotp:a.SubmitTotpCommand,switchToDashlaneAuthenticator:a.SwitchToDashlaneAuthenticatorCommand,switchToEmailToken:a.SwitchToEmailTokenCommand,retryWebAuthnAuthentication:a.RetryWebAuthnAuthenticationCommand,useMasterPassword:a.UseMasterPasswordCommand,webAuthnAuthenticationFail:a.WebAuthnAuthenticationFailCommand,logout:a.LogoutCommand,lockSession:a.LockCommand,loginViaSSO:a.LoginViaSSOCommand,initiateLoginWithSSO:a.InitiateLoginWithSSOCommand,initiateAutologinWithSSOCommand:a.InitiateAutologinWithSSOCommand},queries:{authenticationFlowStatus:o.AuthenticationFlowStatusQuery,getSsoInfoQuery:o.GetSsoInfoQuery},events:{}})},65433:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InitiateAutologinWithSSOCommand=t.InitiateLoginWithSSOCommand=t.LoginViaSSOCommand=t.LockCommand=t.LogoutCommand=t.WebAuthnAuthenticationFailCommand=t.UseMasterPasswordCommand=t.RetryWebAuthnAuthenticationCommand=t.ClearErrorCommand=t.SwitchToEmailTokenCommand=t.ResendPushNotificationCommand=t.SendMasterPasswordCommand=t.ResendEmailTokenCommand=t.ChangeTwoFactorAuthenticationOtpTypeCommand=t.SubmitBackupCodeCommand=t.SubmitTotpCommand=t.SubmitEmailTokenCommand=t.SwitchToDashlaneAuthenticatorCommand=t.ChangeAccountEmailCommand=t.SendAccountEmailCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SendAccountEmailCommand=o;class a extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.ChangeAccountEmailCommand=a;class i extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SwitchToDashlaneAuthenticatorCommand=i;class s extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SubmitEmailTokenCommand=s;class c extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SubmitTotpCommand=c;class u extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SubmitBackupCodeCommand=u;class l extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.ChangeTwoFactorAuthenticationOtpTypeCommand=l;class d extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.ResendEmailTokenCommand=d;class p extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SendMasterPasswordCommand=p;class f extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.ResendPushNotificationCommand=f;class h extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SwitchToEmailTokenCommand=h;class y extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.ClearErrorCommand=y;class m extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.RetryWebAuthnAuthenticationCommand=m;class g extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.UseMasterPasswordCommand=g;class v extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.WebAuthnAuthenticationFailCommand=v;class b extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.LogoutCommand=b;class w extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.LockCommand=w;class R extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.LoginViaSSOCommand=R;class S extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.InitiateLoginWithSSOCommand=S;class E extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.InitiateAutologinWithSSOCommand=E},23493:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetSsoInfoQuery=t.AuthenticationFlowStatusQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.Device})){}t.AuthenticationFlowStatusQuery=o;class a extends((0,n.defineQuery)({scope:n.UseCaseScope.Device})){}t.GetSsoInfoQuery=a},71329:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SSOMigrationType=t.SsoMigrationServerMethod=void 0,function(e){e.SSO="sso",e.MP="master_password"}(t.SsoMigrationServerMethod||(t.SsoMigrationServerMethod={})),function(e){e[e.MP_TO_SSO=0]="MP_TO_SSO",e[e.MP_TO_SSO_WITH_INFO=1]="MP_TO_SSO_WITH_INFO",e[e.SSO_TO_MP=2]="SSO_TO_MP"}(t.SSOMigrationType||(t.SSOMigrationType={}))},63674:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(22829),t),o(r(65433),t),o(r(23493),t),o(r(71329),t)},35105:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(63674),t)},78979:(e,t,r)=>{"use strict";r.d(t,{cl:()=>Er,Qo:()=>d});var n=r(32839),o=r(60399),a=r(87065),i=r(53576),s=r(28489),c=r(87279),u=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let d=class{constructor(e){this.cqrsClient=e}getDeviceCredentialsForUser(e){const{queries:{carbonStateList:t}}=this.cqrsClient.getClient(i.carbonLegacyApi);return(0,o.z)(t({paths:["authentication.currentUser.deviceKeys","userSession.localSettings.uki","userSession.account.login"]}).pipe((0,a.U)((e=>{if((0,c.hx)(e))throw new Error("Failed to get credentials from carbon");return(0,c.db)(e)})),(0,a.U)(this.carbonStateToRequestUserDeviceCredentials(e))))}carbonStateToRequestUserDeviceCredentials(e){return([t,r,n])=>{if(!t&&!r||n!==e)throw new Error("No user device credentials available for active user");let o;if(r){if("string"!=typeof r)throw new Error("Unexpected UKI state shape received from carbon");o=function(e){const t=e.split("-");if(t.length>0){const[r]=t;return{accessKey:r,secretKey:e}}throw new Error("Invalid UKI format")}(r)}else{if(!function(e){return!!(e&&"object"==typeof e&&(0,s.l$)(e,"accessKey")&&(0,s.l$)(e,"secretKey"))&&"string"==typeof e.accessKey&&"string"==typeof e.secretKey}(t))throw new Error("Unexpected user device state shape received from carbon");o=t}return{login:e,deviceAccessKey:o.accessKey,deviceSecretKey:o.secretKey}}}};d=u([(0,n.Injectable)(),l("design:paramtypes",[n.CqrsClient])],d);var p=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let f=class{};f=p([(0,n.Module)({sharedModuleName:"authentication",providers:[d],exports:[d]})],f);var h=r(35105),y=r(17530),m=r(5331),g=r(31948),v=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let w=class{constructor(e){this.carbonLegacy=e.getClient(i.carbonLegacyApi)}async executeWithParams({login:e,masterPassword:t,isRememberMeEnabled:r}){try{return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithMasterPassword",arg:[{login:e,password:t,rememberPassword:r,requiredPermissions:void 0}]}),Promise.resolve()}catch(e){}}};w=v([(0,n.Injectable)(),b("design:paramtypes",[n.CqrsClient])],w);var R=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},S=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let E=class{constructor(e){this.carbonLegacy=e.getClient(i.carbonLegacyApi)}async execute(){try{const e=await this.carbonLegacy.commands.carbon({name:"checkDoesLocalRecoveryKeyExist",args:[]});if(!(0,c.d6)(e))throw new Error("Carbon command failed");return{isAccountRecoveryAvailable:e.data.carbonResult.doesExist}}catch(e){return{isAccountRecoveryAvailable:!1}}}};E=R([(0,n.Injectable)(),S("design:paramtypes",[n.CqrsClient])],E);var O=r(30523),C=r(62013),P=r(85669),A=r(26290),j=r(68224);const _=e=>!0;class T extends((0,n.defineStore)({initialValue:void 0,persist:!1,scope:j.UseCaseScope.Device,storeName:"authentication-flow-machine",storeTypeGuard:_})){}var I=r(44396);const x=e=>!(!e||"object"!=typeof e)&&"rememberMeForSSOPreference"in e;class D extends((0,n.defineStore)({codec:I.Eu,persist:!0,storage:{initialValue:{rememberMeForSSOPreference:!0},schemaVersion:1,typeGuard:x},scope:j.UseCaseScope.Device,storeName:"sso-info",storeTypeGuard:x,capacity:n.StoreCapacity._001KB})){}class U{}var M=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},N=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const k=e=>!!e&&"object"==typeof e&&(0,s.l$)(e,"ssoUser")&&(0,s.l$)(e,"serviceProviderUrl");let L=class{constructor(e,t,r){this.ssoInfoStore=t,this.client=e,this.authenticationFlowInfraContext=r}async retrieveSSOInfo(){const e=await(0,o.z)(this.client.getClient(i.carbonLegacyApi).queries.carbonState({path:"userSession.ssoSettings"}).pipe((0,a.U)((e=>{if(!(0,c.d6)(e)||!k(e.data))throw new Error("SsoSettings is not of the expected type");return e.data}))));return{isNitroProvider:e.isNitroProvider??!1,serviceProviderUrl:e.serviceProviderUrl}}async execute(e){const{loginUserWithEnclaveSSO:t}=this.client.getClient(P.enclaveSdkApi).commands,r=await this.retrieveSSOInfo(),{login:n,rememberMeForSSOPreference:o}=e.body;return await this.ssoInfoStore.set({rememberMeForSSOPreference:o}),r.isNitroProvider?await t({userEmailAddress:n}):this.authenticationFlowInfraContext.redirectUserToExternalUrl({externalUrl:r.serviceProviderUrl,tabFocus:!0}),Promise.resolve((0,c.Vp)(void 0))}};L=M([(0,n.CommandHandler)(h.InitiateLoginWithSSOCommand),N("design:paramtypes",[n.CqrsClient,D,U])],L);var F=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let V=class{constructor(e){this.carbonLegacy=e.getClient(i.carbonLegacyApi)}async retrieveSSOSettings(){return await(0,o.z)(this.carbonLegacy.queries.carbonStateList({paths:["userSession.ssoSettings","userSession.account.isAuthenticated"]}).pipe((0,a.U)((e=>{if(!((t=e)&&"object"==typeof t&&(0,s.l$)(t,"data")&&(0,C.isArray)(t.data)&&k(t.data[0])&&"boolean"==typeof t.data[1]))throw new Error("LoginStatus is not of the expected type");if(e.data[1])return e.data[0];var t})),(0,O.h)((e=>void 0!==e))))}async execute(){try{const e=await this.retrieveSSOSettings();if(k(e))return{serviceProviderRedirectUrl:e.serviceProviderUrl,isNitroProvider:e.isNitroProvider,migration:e.migration};throw new Error("ssoSettings is not of the expected type")}catch(e){return{serviceProviderRedirectUrl:void 0,isNitroProvider:void 0,migration:void 0}}}};V=F([(0,n.Injectable)(),q("design:paramtypes",[n.CqrsClient])],V);var G=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},H=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let B=class{constructor(e,t,r){this.masterPasswordService=t,this.accountRecoveryStatusService=e,this.checkForLoginStatusUpdateService=r}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"CheckingAccountRecoveryStatus",id:"MasterPasswordFlowMachine",context:{isRememberMeEnabled:!1,isAccountRecoveryAvailable:!1},states:{CheckingAccountRecoveryStatus:{invoke:{src:"checkAccountRecoveryStatus",onDone:{target:"WaitingForMasterPassword",actions:["assignAccountRecoveryStatus"]}}},WaitingForMasterPassword:{on:{INPUT_MASTER_PASSWORD:{target:"ValidatingMasterPassword",actions:["assignMasterPassword"]}}},ValidatingMasterPassword:{entry:["authenticateWithMasterPassword"],on:{CARBON_LEGACY_LOGIN_STATUS_CHANGED:[{target:"MigrationNeeded",cond:"shouldTriggerMigration"},{target:"MasterPasswordDone",cond:"isLoggedIn"}],CARBON_LEGACY_ERROR:{target:"WaitingForMasterPassword",actions:["assignError"]},DEVICE_LIMIT_ABORTED:{target:"DeviceLimitAborted"}}},MigrationNeeded:{invoke:{src:"checkForLoginStatusUpdate",onDone:{target:"MPToSSOMigration",actions:["assignSSOMigrationStatus"]}}},MPToSSOMigration:{},DeviceLimitAborted:{type:"final",data:{shouldResetAuthenticationFlow:!0}},MasterPasswordDone:{type:"final",data:{shouldResetAuthenticationFlow:!1}}}},options:{actions:{assignMasterPassword:(0,m.f0)({masterPassword:(e,t)=>t.masterPassword,isRememberMeEnabled:(e,t)=>t.rememberMe}),assignAccountRecoveryStatus:(0,m.f0)({isAccountRecoveryAvailable:(e,t)=>t.data.isAccountRecoveryAvailable}),assignError:(0,m.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignSSOMigrationStatus:(0,m.f0)({migration:(e,t)=>t.data.migration,serviceProviderRedirectUrl:(e,t)=>t.data.serviceProviderRedirectUrl,isNitroProvider:(e,t)=>t.data.isNitroProvider}),authenticateWithMasterPassword:e=>{const{login:t,masterPassword:r,isRememberMeEnabled:n}=e;return this.masterPasswordService.executeWithParams({login:t??"",masterPassword:r??"",isRememberMeEnabled:n})}},services:{checkAccountRecoveryStatus:()=>this.accountRecoveryStatusService.execute(),checkForLoginStatusUpdate:()=>this.checkForLoginStatusUpdateService.execute()},guards:{shouldTriggerMigration:(e,t)=>t.needsSSOMigration??!1,isLoggedIn:(e,t)=>t.loggedIn}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};B=G([(0,n.Injectable)(),H("design:paramtypes",[E,w,V])],B);var K=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},W=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let z=class{constructor(e){this.carbonLegacy=e.getClient(i.carbonLegacyApi)}async execute(e){try{return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionResendToken",arg:[{login:e.login??""}]}),Promise.resolve()}catch(e){}}};z=K([(0,n.Injectable)(),W("design:paramtypes",[n.CqrsClient])],z);var $=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Y=class{constructor(e){this.carbonLegacy=e.getClient(i.carbonLegacyApi)}async execute(e){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithToken",arg:[{login:e.login??"",password:null,token:e.emailToken??"",persistData:!0,deviceName:e.deviceName}]})}catch(e){}}};Y=$([(0,n.Injectable)(),Q("design:paramtypes",[n.CqrsClient])],Y);var X=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},J=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Z=class{constructor(e){this.carbonLegacy=e.getClient(i.carbonLegacyApi)}async requestCodeAgainstServer(){}async execute({login:e}){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithDashlaneAuthenticator",arg:[{login:e,password:null,persistData:!0,deviceName:""}]}),Promise.resolve()}async cancel(){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"cancelDashlaneAuthenticatorRegistration",arg:[]}),Promise.resolve()}};Z=X([(0,n.Injectable)(),J("design:paramtypes",[n.CqrsClient])],Z);var ee=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},te=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let re=class{constructor(e,t){this.dashlaneAuthenticatorService=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"AuthenticatorMachine",context:{isDashlaneAuthenticatorAvailable:!1},initial:"RequestingServerPush",states:{RequestingServerPush:{entry:["updateDashlaneAuthenticatorAvailability"],invoke:{src:"authenticateWithDashlaneAuthenticator"},on:{CARBON_LEGACY_ERROR:{actions:["assignError","updateDashlaneAuthenticatorAvailability"]},RESEND_PUSH_NOTIFICATION:{target:"RequestingServerPush",actions:["clearError"]},SWITCH_TO_EMAIL_TOKEN:{actions:["cancelDashlaneAuthenticator","clearError"],target:"EmailTokenRequested"}}},AuthenticatorPushValidated:{type:"final",data:{switchToEmailToken:!1}},EmailTokenRequested:{entry:["sendEmailToken"],type:"final",data:{switchToEmailToken:!0}}}},options:{actions:{clearError:(0,m.f0)({error:()=>{}}),assignError:(0,m.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),switchToEmailToken:(0,m.f0)({switchToEmailToken:()=>!0}),updateDashlaneAuthenticatorAvailability:(0,m.f0)({isDashlaneAuthenticatorAvailable:!0}),cancelDashlaneAuthenticator:()=>{this.dashlaneAuthenticatorService.cancel()},sendEmailToken:e=>{const{login:t}=e;this.sendEmailToken.execute({login:t})}},services:{authenticateWithDashlaneAuthenticator:e=>{const{login:t}=e;return this.dashlaneAuthenticatorService.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};re=ee([(0,n.Injectable)(),te("design:paramtypes",[Z,z])],re);var ne=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ae=class{constructor(e,t){this.authenticateWithEmailToken=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"EmailTokenMachine",context:{login:"",emailToken:"",deviceName:""},initial:"WaitingForEmailToken",states:{SendEmailToken:{invoke:{src:"sendEmailToken",onError:{target:"WaitingForEmailToken"},onDone:{target:"WaitingForEmailToken"}}},WaitingForEmailToken:{on:{INPUT_EMAIL_TOKEN:{target:"ValidatingEmailToken",actions:["assignEmailToken"]},RESEND_EMAIL_TOKEN:{target:"SendEmailToken",actions:["clearError"]}}},ValidatingEmailToken:{entry:["authenticateWithEmailToken"],on:{CARBON_LEGACY_ERROR:{target:"WaitingForEmailToken",actions:["assignError"]}}},FinishingEmailToken:{type:"final",data:{switchToDashlaneAuthenticator:!1}},DashlaneAuthenticatorRequested:{type:"final",data:{switchToDashlaneAuthenticator:!0}}},on:{SWITCH_TO_DASHLANE_AUTHENTICATOR:{target:".DashlaneAuthenticatorRequested",internal:!0,actions:["clearError"]}}},options:{actions:{clearError:(0,m.f0)({error:()=>{}}),assignError:(0,m.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignEmailToken:(0,m.f0)({emailToken:(e,t)=>t.emailToken}),authenticateWithEmailToken:e=>{const{deviceName:t,emailToken:r,login:n}=e;return this.authenticateWithEmailToken.execute({deviceName:t,emailToken:r,login:n})}},services:{sendEmailToken:e=>{const{login:t}=e;return this.sendEmailToken.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};ae=ne([(0,n.Injectable)(),oe("design:paramtypes",[Y,z])],ae);const ie=e=>({initial:e.initial,states:e.states,on:e.on??{}});var se=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ce=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ue=class{constructor(e,t){this.authenticatorMachine=e,this.emailTokenMachine=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{},guards:{}},id:"DeviceRegistrationMachine",context:{...this.authenticatorMachine.desc().config.context,...this.emailTokenMachine.desc().config.context,registrationMethod:void 0},initial:"StartDeviceRegistration",states:{StartDeviceRegistration:{always:[{target:"EmailToken",cond:"isRegistrationMethodEmailToken"},{target:"DashlaneAuthenticator",cond:"isRegistrationMethodAuthenticator"},{target:"TwoFactorAuthentication",cond:"isRegistrationMethodOTP"}]},DashlaneAuthenticator:{...ie(this.authenticatorMachine.desc().config),onDone:[{target:"EmailToken",cond:"shouldSwitchToEmailToken"},{target:"DeviceRegistrationDone"}]},EmailToken:{...ie(this.emailTokenMachine.desc().config),onDone:[{target:"DashlaneAuthenticator",cond:"shouldSwitchToAuthenticator"},{target:"DeviceRegistrationDone"}]},TwoFactorAuthentication:{onDone:{target:"DeviceRegistrationDone"}},DeviceRegistrationDone:{type:"final"}}},options:{actions:{...this.authenticatorMachine.desc().options.actions,...this.emailTokenMachine.desc().options.actions,assignUnknownDeviceRegistrationError:(0,m.f0)({error:()=>({code:"unknown_error",data:{message:"Unknown device registration error"}})})},services:{...this.authenticatorMachine.desc().options.services,...this.emailTokenMachine.desc().options.services},guards:{...this.authenticatorMachine.desc().options.guards,...this.emailTokenMachine.desc().options.guards,isRegistrationMethodEmailToken:e=>"email_token"===e.registrationMethod,isRegistrationMethodOTP:e=>"otp"===e.registrationMethod,isRegistrationMethodAuthenticator:e=>"dashlane_authenticator"===e.registrationMethod,shouldSwitchToEmailToken:(e,t)=>t.data.switchToEmailToken,shouldSwitchToAuthenticator:(e,t)=>t.data.switchToDashlaneAuthenticator}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};ue=se([(0,n.Injectable)(),ce("design:paramtypes",[re,ae])],ue);var le=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let de=class{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"WebAuthnMachine",context:{},initial:"InitWebAuthnAuthentication",states:{InitWebAuthnAuthentication:{on:{WEBAUTHN_AUTHENTICATION_FAIL:{target:"WebAuthnAuthenticationFailed",actions:["assignWebAuthnError"]}}},WebAuthnAuthenticationFailed:{on:{RETRY_WEBAUTHN_AUTHENTICATION:{target:"InitWebAuthnAuthentication",actions:["clearError"]}}},WebAuthnAuthenticationDone:{type:"final",data:{switchToMasterPassword:!1}},MasterPasswordRequested:{type:"final",data:{switchToMasterPassword:!0}}},on:{USE_MASTER_PASSWORD:{actions:["clearError"],target:".MasterPasswordRequested",internal:!0}}},options:{actions:{clearError:(0,m.f0)({error:()=>{}}),assignWebAuthnError:(0,m.f0)({error:(e,t)=>t.error})},services:{},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};de=le([(0,n.Injectable)()],de);var pe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},fe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let he=class{constructor(e){this.carbonLegacy=e.getClient(i.carbonLegacyApi)}executeWithParams({login:e,masterPassword:t,otp:r,twoFactorAuthenticationOtpType:n,otpVerificationMode:o,deviceName:a}){const i={login:e,password:t??null,otp:r,withBackupCode:"backupCode"===n,persistData:!0};try{"otp2"===o?this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithOTP",arg:[{...i,deviceName:a}]}):"otp1"===o&&this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithOTPForNewDevice",arg:[i]})}catch(e){}return Promise.resolve()}};he=pe([(0,n.Injectable)(),fe("design:paramtypes",[n.CqrsClient])],he);var ye=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},me=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ge=class{constructor(e){this.twoFactorAuthenticationService=e}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"WebAuthnMachine",context:{twoFactorAuthenticationOtpType:"totp"},initial:"WaitingForTotp",states:{WaitingForTotp:{on:{INPUT_TOTP:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForBackupCode",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},WaitingForBackupCode:{on:{INPUT_BACKUP_CODE:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForTotp",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},ValidatingTwoFactorAuthenticationOtp:{entry:["authenticateWithTwoFactorAuthentication"],on:{CARBON_LEGACY_ERROR:[{target:"WaitingForBackupCode",cond:"isBackupCode",actions:["assignError"]},{target:"WaitingForTotp",actions:["assignError"]}]}},TwoFactorAuthenticationDone:{type:"final"}}},options:{actions:{assignError:(0,m.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),clearError:(0,m.f0)({error:()=>{}}),assignTwoFactorAuthenticationOtpValue:(0,m.f0)({twoFactorAuthenticationOtpValue:(e,t)=>t.twoFactorAuthenticationOtpValue}),assignTwoFactorAuthenticationOtpType:(0,m.f0)({twoFactorAuthenticationOtpType:(e,t)=>t.twoFactorAuthenticationOtpType}),authenticateWithTwoFactorAuthentication:e=>{const t={login:e.login??"",masterPassword:e.masterPassword??null,otp:e.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.twoFactorAuthenticationOtpType,persistData:!0,otpVerificationMode:e.otpVerificationMode,deviceName:e.deviceName};this.twoFactorAuthenticationService.executeWithParams(t)}},services:{},guards:{isBackupCode:e=>"backupCode"===e.twoFactorAuthenticationOtpType}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};ge=ye([(0,n.Injectable)(),me("design:paramtypes",[he])],ge);var ve=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let be=class{desc(){return{config:{predictableActionArguments:!0,schema:{context:{}},id:"PasswordLessMachine",initial:"PasswordLessUnavailable",states:{PasswordLessUnavailable:{on:{CARBON_LEGACY_ERROR:{actions:["assignError"]}}}}},options:{actions:{assignError:(0,m.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})})},services:{},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};be=ve([(0,n.Injectable)()],be);var we=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Re=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Se=class{constructor(e){this.carbonLegacy=e.getClient(i.carbonLegacyApi)}retrieveLocalAccounts(e){return(0,o.z)(e.queries.carbonState({path:"authentication.localAccounts"}).pipe((0,O.h)(c.d6),(0,O.h)((e=>e.data.accountsListInitialized)),(0,a.U)((e=>e.data.accountsList))))}async execute(){try{const e=await this.retrieveLocalAccounts(this.carbonLegacy),t=e?.find((e=>e.isLastSuccessfulLogin));return{localAccounts:e??[],lastUsedLogin:t?.login??"",shouldAskMasterPassword:t?.shouldAskMasterPassword??!1,shouldAskOTP:t?.hasLoginOtp??!1,rememberMeType:t?.rememberMeType??"disabled"}}catch(e){return Promise.reject(new Error("Unable to retrieve initialization data"))}}};Se=we([(0,n.Injectable)(),Re("design:paramtypes",[n.CqrsClient])],Se);var Ee=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ce=class{constructor(e){this.carbonLegacy=e.getClient(i.carbonLegacyApi)}async execute(e){try{await this.carbonLegacy.commands.carbon({name:"loginViaSSO",args:[e]})}catch(e){}}};Ce=Ee([(0,n.Injectable)(),Oe("design:paramtypes",[n.CqrsClient])],Ce);var Pe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ae=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let je=class{constructor(e){this.carbonLegacy=e.getClient(i.carbonLegacyApi)}async execute({login:e}){try{return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSession",arg:[{login:e??""}]}),Promise.resolve()}catch(e){}return Promise.resolve()}};je=Pe([(0,n.Injectable)(),Ae("design:paramtypes",[n.CqrsClient])],je);var _e=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Te=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ie=class{constructor(e,t,r,n,o,a,i,s){this.passwordLessMachine=e,this.deviceRegistrationMachine=t,this.masterPasswordFlowMachine=r,this.initializeMachineService=a,this.loginViaSSOService=i,this.webAuthnMachine=o,this.twoFactorAuthenticationMachine=n,this.requestAuthenticationMethodForLogin=s}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"AuthenticationFlowMachine",context:{...this.deviceRegistrationMachine.desc().config.context,...this.masterPasswordFlowMachine.desc().config.context,...this.twoFactorAuthenticationMachine.desc().config.context,...this.webAuthnMachine.desc().config.context,ready:!1,shouldAskMasterPassword:!1,shouldAskOTP:!1},states:{Starting:{invoke:{src:"initializeMachine",onDone:{actions:["assignInitializationResults"],target:"RememberMeRedirection"}}},RememberMeRedirection:{always:[{target:"MasterPassword",cond:"shouldAskMasterPassword"},{target:"CheckSessionForOtp2",cond:"shouldAskOTP"},{target:"WebAuthn",cond:"rememberMeIsWebAuthn"},{target:"WaitingForEmail"}]},CheckSessionForOtp2:{entry:["requestAuthenticationMethodForLogin"]},WaitingForEmail:{on:{INPUT_ACCOUNT_EMAIL:{target:"ValidatingEmail",actions:["assignAccountEmail","clearError"]}}},ValidatingEmail:{entry:["requestAuthenticationMethodForLogin"],on:{CARBON_LEGACY_ERROR:{target:"WaitingForEmail",actions:["assignError"]}}},PasswordLess:{...ie(this.passwordLessMachine.desc().config)},DeviceRegistration:{...ie(this.deviceRegistrationMachine.desc().config)},WebAuthn:{...ie(this.webAuthnMachine.desc().config),onDone:[{target:"MasterPassword",cond:"shouldSwitchToMasterPassword"},{target:"AuthenticationDone"}]},TwoFactorAuthentication:{...ie(this.twoFactorAuthenticationMachine.desc().config),onDone:{target:"AuthenticationDone"}},SSORedirectionToIdp:{entry:["assignServiceProviderInfo"]},SSOAuthentication:{entry:["loginViaSSO"]},MasterPassword:{...ie(this.masterPasswordFlowMachine.desc().config),onDone:[{target:"WaitingForEmail",cond:"shouldResetAuthenticationFlow"},{target:"AuthenticationDone"}]},AuthenticationDone:{type:"final"}},on:{CHANGE_ACCOUNT_EMAIL:[{target:"ValidatingEmail",actions:["clearError","assignAccountEmail"],cond:"isAccountLoginAvailable"},{target:"WaitingForEmail",actions:["clearError","clearEmail"]}],CARBON_LEGACY_ASK_MASTER_PASSWORD:{target:"MasterPassword",actions:["clearError"]},CARBON_LEGACY_OPEN_SESSION_TOKEN_SENT:[{target:"DeviceRegistration.EmailToken",actions:["clearError"],cond:"isGrapheneDeviceRegistrationFlow"},{target:"DeviceRegistration.EmailToken",actions:["clearError"]}],CARBON_LEGACY_OPEN_SESSION_DASHLANE_AUTHENTICATOR:{target:"DeviceRegistration.DashlaneAuthenticator",actions:["clearError"]},CARBON_LEGACY_OPEN_SESSION_SSO_REDIRECTION_TO_IDP_REQUIRED:{target:"SSORedirectionToIdp",actions:["clearError"]},CARBON_LEGACY_SSO_LOGIN_BYPASS:{target:"SSOAuthentication",actions:["assignSsoData"]},CARBON_LEGACY_OPEN_SESSION_OTP_SENT:{target:"TwoFactorAuthentication",actions:["assignOtpVerificationMode","clearError"]},CARBON_LEGACY_OPEN_SESSION_MASTER_PASSWORD_LESS:{target:"PasswordLess"},CLEAR_ERROR:{actions:["clearError"]}}},options:{actions:{...this.deviceRegistrationMachine.desc().options.actions,...this.masterPasswordFlowMachine.desc().options.actions,...this.twoFactorAuthenticationMachine.desc().options.actions,...this.webAuthnMachine.desc().options.actions,assignInitializationResults:(0,m.f0)({login:(e,t)=>t.data.lastUsedLogin,localAccounts:(e,t)=>t.data.localAccounts,shouldAskMasterPassword:(e,t)=>t.data.shouldAskMasterPassword,shouldAskOTP:(e,t)=>t.data.shouldAskOTP,rememberMeType:(e,t)=>t.data.rememberMeType,ready:()=>!0}),assignAccountEmail:(0,m.f0)({login:(e,t)=>t.login}),assignError:(0,m.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignOtpVerificationMode:(0,m.f0)({otpVerificationMode:(e,t)=>t.otpVerificationMode}),assignSsoData:(0,m.f0)({ssoData:(e,t)=>t}),assignServiceProviderInfo:(0,m.f0)({serviceProviderRedirectUrl:(e,t)=>t.serviceProviderRedirectUrl,isNitroProvider:(e,t)=>t.isNitroProvider}),clearEmail:(0,m.f0)({login:void 0}),clearError:(0,m.f0)({error:()=>{}}),loginViaSSO:(e,t)=>this.loginViaSSOService.execute(t),requestAuthenticationMethodForLogin:e=>this.requestAuthenticationMethodForLogin.execute(e)},services:{...this.deviceRegistrationMachine.desc().options.services,...this.masterPasswordFlowMachine.desc().options.services,...this.twoFactorAuthenticationMachine.desc().options.services,...this.webAuthnMachine.desc().options.services,initializeMachine:()=>this.initializeMachineService.execute()},guards:{...this.deviceRegistrationMachine.desc().options.guards,...this.masterPasswordFlowMachine.desc().options.guards,...this.twoFactorAuthenticationMachine.desc().options.guards,...this.webAuthnMachine.desc().options.guards,isAccountLoginAvailable:(e,t)=>Boolean(t.login),shouldAskMasterPassword:e=>!!e.shouldAskMasterPassword&&e.shouldAskMasterPassword,shouldAskOTP:e=>!!e.shouldAskOTP&&e.shouldAskOTP,shouldSwitchToMasterPassword:(e,t)=>t.data.switchToMasterPassword,shouldResetAuthenticationFlow:(e,t)=>t.data.shouldResetAuthenticationFlow,rememberMeIsWebAuthn:e=>void 0!==e.rememberMeType&&"webauthn"===e.rememberMeType,isGrapheneDeviceRegistrationFlow:e=>!!e.login&&e.login.includes("kw_test_newdevice")}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};Ie=_e([(0,n.Injectable)(),Te("design:paramtypes",[be,ue,B,ge,de,Se,Ce,je])],Ie);var xe=r(64472),De=r(11746),Ue=r(24966);class Me{constructor(e,t){this.interpreter=e,this.cqrsClient=t}execute(){try{const{carbonState:e}=this.cqrsClient.getClient(i.carbonLegacyApi).queries;e({path:"userSession.loginDeviceLimitFlow.flow"}).pipe((0,a.U)((e=>{if("success"===e.tag)return e.data}))).subscribe((e=>{Boolean(this.lastDeviceLimitFlowValue)&&!e&&this.interpreter.send({type:"DEVICE_LIMIT_ABORTED"}),this.lastDeviceLimitFlowValue=e}))}catch(e){return Promise.reject(new Error("Unable to subscribe to loginDeviceLimitFlow state"))}}}var Ne=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ke=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Le=class{constructor(e,t,r){this.loginMachineStore=t,this.cqrsClient=r,this.initFlag=new Ue.X(!1);const n=e.create();this.delayedEvents=[],this.interpreter=xe.kJ(n).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[Auth] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.loginMachineStore,e)}catch(e){console.warn("[Auth] Unable to get snapshot",e)}})),this.abortDeviceLimitEventHandler=new Me(this.interpreter,this.cqrsClient),this.prepare()}async prepare(){if(this.interpreter)try{this.abortDeviceLimitEventHandler.execute();const e=await(async e=>{const t=await e.getState();return t?A.ZM.create(JSON.parse(t)):void 0})(this.loginMachineStore);let t;try{t=this.interpreter.start(e)}catch(e){console.error("[Auth] Unable to reuse the stored state: ",e),t=this.interpreter.start()}await(0,De.x)(t,(e=>e.context.ready)),this.interpreter.send(this.delayedEvents),this.delayedEvents=[],this.initFlag.next(!0)}catch(e){console.error("[Auth] Unable to start machine",e)}}ready(){return this.initFlag}continue(e){if(!this.interpreter)throw new Error("Authentication flow not started");this.interpreter.getSnapshot().context.ready?this.interpreter.send(e):this.delayedEvents.push(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};Le=Ne([(0,n.Injectable)(),ke("design:paramtypes",[Ie,T,n.CqrsClient])],Le);var Fe,qe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ve=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ge=Fe=class{constructor(e,t,r,n){this.machine=e,this.store=t,this.cqrsClient=r,this.logger=n}getInstance(){return Fe.instance||(Fe.instance=new Le(this.machine,this.store,this.cqrsClient)),Fe.instance}};Ge=Fe=qe([(0,n.Injectable)(),Ve("design:paramtypes",[Ie,T,n.CqrsClient,n.AppLogger])],Ge);var He=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Be=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ke=class{constructor(e){this.authenticationFlow=e}execute(e){const{login:t}=e.body;return this.authenticationFlow.getInstance().continue({type:"CHANGE_ACCOUNT_EMAIL",login:t}),Promise.resolve((0,c.Vp)(void 0))}};Ke=He([(0,n.CommandHandler)(h.ChangeAccountEmailCommand),Be("design:paramtypes",[Ge])],Ke);var We=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ze=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let $e=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpType:t}=e.body;return this.authenticationFlow.getInstance().continue({type:"SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE",twoFactorAuthenticationOtpType:t}),Promise.resolve((0,c.Vp)(void 0))}};$e=We([(0,n.CommandHandler)(h.ChangeTwoFactorAuthenticationOtpTypeCommand),ze("design:paramtypes",[Ge])],$e);var Qe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ye=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Xe=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.getInstance().continue({type:"CLEAR_ERROR"}),Promise.resolve((0,c.Vp)(void 0))}};Xe=Qe([(0,n.CommandHandler)(h.ClearErrorCommand),Ye("design:paramtypes",[Ge])],Xe);var Je=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ze=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let et=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.getInstance().continue({type:"RESEND_EMAIL_TOKEN"}),Promise.resolve((0,c.Vp)(void 0))}};et=Je([(0,n.CommandHandler)(h.ResendEmailTokenCommand),Ze("design:paramtypes",[Ge])],et);var tt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},rt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let nt=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.getInstance().continue({type:"RESEND_PUSH_NOTIFICATION"}),Promise.resolve((0,c.Vp)(void 0))}};nt=tt([(0,n.CommandHandler)(h.ResendPushNotificationCommand),rt("design:paramtypes",[Ge])],nt);var ot=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},at=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let it=class{constructor(e){this.authenticationFlow=e}execute(e){const{login:t}=e.body;return this.authenticationFlow.getInstance().continue({type:"INPUT_ACCOUNT_EMAIL",login:t}),Promise.resolve((0,c.Vp)(void 0))}};it=ot([(0,n.CommandHandler)(h.SendAccountEmailCommand),at("design:paramtypes",[Ge])],it);var st=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ct=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ut=class{constructor(e){this.authenticationFlow=e}execute(e){const{masterPassword:t,rememberMe:r}=e.body;return this.authenticationFlow.getInstance().continue({type:"INPUT_MASTER_PASSWORD",masterPassword:t,rememberMe:r}),Promise.resolve((0,c.Vp)(void 0))}};ut=st([(0,n.CommandHandler)(h.SendMasterPasswordCommand),ct("design:paramtypes",[Ge])],ut);var lt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},dt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let pt=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.authenticationFlow.getInstance().continue({type:"INPUT_BACKUP_CODE",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,c.Vp)(void 0))}};pt=lt([(0,n.CommandHandler)(h.SubmitBackupCodeCommand),dt("design:paramtypes",[Ge])],pt);var ft=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ht=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let yt=class{constructor(e){this.authenticationFlow=e}execute(e){const{emailToken:t,deviceName:r}=e.body;return this.authenticationFlow.getInstance().continue({type:"INPUT_EMAIL_TOKEN",emailToken:t,deviceName:r}),Promise.resolve((0,c.Vp)(void 0))}};yt=ft([(0,n.CommandHandler)(h.SubmitEmailTokenCommand),ht("design:paramtypes",[Ge])],yt);var mt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},gt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let vt=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.authenticationFlow.getInstance().continue({type:"INPUT_TOTP",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,c.Vp)(void 0))}};vt=mt([(0,n.CommandHandler)(h.SubmitTotpCommand),gt("design:paramtypes",[Ge])],vt);var bt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},wt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Rt=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.getInstance().continue({type:"SWITCH_TO_DASHLANE_AUTHENTICATOR"}),Promise.resolve((0,c.Vp)(void 0))}};Rt=bt([(0,n.CommandHandler)(h.SwitchToDashlaneAuthenticatorCommand),wt("design:paramtypes",[Ge])],Rt);var St=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Et=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ot=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.getInstance().continue({type:"SWITCH_TO_EMAIL_TOKEN"}),Promise.resolve((0,c.Vp)(void 0))}};Ot=St([(0,n.CommandHandler)(h.SwitchToEmailTokenCommand),Et("design:paramtypes",[Ge])],Ot);var Ct=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Pt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let At=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.getInstance().continue({type:"RETRY_WEBAUTHN_AUTHENTICATION"}),Promise.resolve((0,c.Vp)(void 0))}};At=Ct([(0,n.CommandHandler)(h.RetryWebAuthnAuthenticationCommand),Pt("design:paramtypes",[Ge])],At);var jt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},_t=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Tt=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.getInstance().continue({type:"USE_MASTER_PASSWORD"}),Promise.resolve((0,c.Vp)(void 0))}};Tt=jt([(0,n.CommandHandler)(h.UseMasterPasswordCommand),_t("design:paramtypes",[Ge])],Tt);var It=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},xt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Dt=class{constructor(e){this.authenticationFlow=e}execute(e){const{webAuthnError:t}=e.body;return this.authenticationFlow.getInstance().continue({type:"WEBAUTHN_AUTHENTICATION_FAIL",error:t}),Promise.resolve((0,c.Vp)(void 0))}};Dt=It([(0,n.CommandHandler)(h.WebAuthnAuthenticationFailCommand),xt("design:paramtypes",[Ge])],Dt);var Ut=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Mt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Nt=class{constructor(e,t){this.carbonLegacy=e.getClient(i.carbonLegacyApi),this.logger=t}async execute(){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"closeSession",arg:[{}]})}catch(e){this.logger.trace("Logout Command error :"+e)}return Promise.resolve((0,c.Vp)(void 0))}};Nt=Ut([(0,n.CommandHandler)(h.LogoutCommand),Mt("design:paramtypes",[n.CqrsClient,n.AppLogger])],Nt);var kt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Lt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ft=class{constructor(e){this.authenticationFlow=e}execute(e){return this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_SSO_LOGIN_BYPASS",...e.body}),Promise.resolve((0,c.Vp)(void 0))}};Ft=kt([(0,n.CommandHandler)(h.LoginViaSSOCommand),Lt("design:paramtypes",[Ge])],Ft);var qt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Vt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Gt=class{constructor(e,t){this.carbonLegacy=e.getClient(i.carbonLegacyApi),this.logger=t}async execute(){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"lockSession",arg:[{}]})}catch(e){this.logger.trace("LockSession command handler: "+e)}return Promise.resolve((0,c.Vp)(void 0))}};Gt=qt([(0,n.CommandHandler)(h.LockCommand),Vt("design:paramtypes",[n.CqrsClient,n.AppLogger])],Gt);var Ht=r(74081),Bt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Kt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const Wt=e=>!!e&&"object"==typeof e&&(0,s.l$)(e,"type")&&"sso"===e.type;let zt=class{constructor(e,t,r){this.client=e,this.authenticationFlowInfraContext=t,this.serverApiClient=r}getDeviceAccessKeys(e){return this.client.getClient(i.carbonLegacyApi).queries.carbonState({path:"authentication.localUsers"}).pipe((0,O.h)(c.d6),(0,a.U)((t=>t.data[e])))}async checkSSOInfo(e){const t=(await(0,o.z)(this.getDeviceAccessKeys(e).pipe((0,a.U)((t=>this.serverApiClient.v1.authentication.getAuthenticationMethodsForLogin({login:e,deviceAccessKey:t.deviceAccessKey,methods:["email_token","totp","duo_push","dashlane_authenticator"]}))),(0,Ht.J)(),(0,O.h)(c.d6),(0,a.U)((e=>e.data.data))))).verifications.find(Wt);if(t){const e=t.ssoInfo;return{isNitroProvider:e.isNitroProvider,serviceProviderUrl:e.serviceProviderUrl}}throw new Error("No SSO authentication available for the user")}async execute(e){const{login:t}=e.body,{loginUserWithEnclaveSSO:r}=this.client.getClient(P.enclaveSdkApi).commands;try{const e=await this.checkSSOInfo(t);e.isNitroProvider?await r({userEmailAddress:t}):this.authenticationFlowInfraContext.redirectUserToExternalUrl({externalUrl:e.serviceProviderUrl,tabFocus:!1})}catch(e){}return Promise.resolve((0,c.Vp)(void 0))}};zt=Bt([(0,n.CommandHandler)(h.InitiateAutologinWithSSOCommand),Kt("design:paramtypes",[n.CqrsClient,U,y.lX])],zt);var $t=r(82991),Qt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Yt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Xt=class{constructor(e,t,r){this.authenticationFlow=e,this.logger=t,this.ssoInfoStore=r}async handle(e){if(!(0,$t.isMv3Environment)())return Promise.resolve();switch(e.body.eventName){case"openSessionMasterPasswordLess":this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_OPEN_SESSION_MASTER_PASSWORD_LESS"});break;case"openSessionTokenSent":this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_OPEN_SESSION_TOKEN_SENT"});break;case"openSessionAskMasterPassword":this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_ASK_MASTER_PASSWORD"});break;case"openSessionDashlaneAuthenticator":this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_OPEN_SESSION_DASHLANE_AUTHENTICATOR"});break;case"openSessionOTPSent":case"openSessionOTPForNewDeviceRequired":this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_OPEN_SESSION_OTP_SENT",otpVerificationMode:"openSessionOTPSent"===e.body.eventName?"otp2":"otp1"});break;case"openSessionSsoRedirectionToIdpRequired":{const t=e.body.eventData,{rememberMeForSSOPreference:r}=await this.ssoInfoStore.getState();this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_OPEN_SESSION_SSO_REDIRECTION_TO_IDP_REQUIRED",serviceProviderRedirectUrl:t.serviceProviderRedirectUrl,isNitroProvider:t.isNitroProvider,rememberMeForSSOPreference:r})}break;case"openSessionFailed":{const t=e.body.eventData;this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_ERROR",error:t.errorCode})}break;case"loginStatusChanged":{const t=e.body.eventData;this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_LOGIN_STATUS_CHANGED",loggedIn:t.loggedIn,needsSSOMigration:t.needsSSOMigration})}}return Promise.resolve()}};Xt=Qt([(0,n.EventHandler)(i.CarbonLegacyEvent),Yt("design:paramtypes",[Ge,n.AppLogger,D])],Xt);var Jt=r(85390),Zt=r(6136),er=r(69885),tr=r(6220);const rr=e=>({step:"EmailStep",loginEmail:e.context.login,localAccounts:e.context.localAccounts??[],isLoading:e.matches("ValidatingEmail")&&!e.context.error,error:e.context.error?.data?.message}),nr=e=>({step:"PasswordLessStep",localAccounts:e.context.localAccounts??[],error:e.context.error?.data?.message}),or=e=>({step:"EmailTokenStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})&&!e.context.error,error:e.context.error?.data?.message,emailToken:e.context.emailToken,isDashlaneAuthenticatorAvailable:e.context.isDashlaneAuthenticatorAvailable}),ar=e=>({step:"DashlaneAuthenticatorStep",localAccounts:e.context.localAccounts??[],isLoading:e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})&&!e.context.error,error:e.context.error?.data?.message}),ir=e=>({step:"TwoFactorAuthenticationOtpStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})&&!e.context.error,error:e.context.error?.data?.message,twoFactorAuthenticationOtpValue:e.context.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.context.twoFactorAuthenticationOtpType}),sr=e=>({step:"WebAuthnStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({WebAuthn:"InitWebAuthnAuthentication"})&&!e.context.error,error:e.context.error?.data?.message}),cr=e=>({step:"SSORedirectionToIdpStep",loginEmail:e.context.login,serviceProviderRedirectUrl:e.context.serviceProviderRedirectUrl??"",isNitroProvider:e.context.isNitroProvider??!1,rememberMeForSSOPreference:e.context.rememberMeForSSOPreference,isLoading:e.matches({SSORedirectionToIdp:"InitSSOAuthentication"})&&!e.context.error,error:e.context.error?.data?.message,localAccounts:e.context.localAccounts??[]}),ur=e=>({step:"MasterPasswordStep",loginEmail:e.context.login??"",localAccounts:e.context.localAccounts??[],isLoading:(e.matches({MasterPassword:"ValidatingMasterPassword"})||e.matches({MasterPassword:"MigrationNeeded"})||e.matches({MasterPassword:"MPToSSOMigration"})||e.matches("AuthenticationDone"))&&!e.context.error,isAccountRecoveryAvailable:e.context.isAccountRecoveryAvailable,error:e.context.error?.data?.message,serviceProviderRedirectUrl:e.context.serviceProviderRedirectUrl,isNitroProvider:e.context.isNitroProvider??!1,migration:e.context.migration}),lr=e=>({step:"StartingStep",localAccounts:e.context.localAccounts??[]});const dr=e=>(0,er.of)((0,c.Vp)(function(e){return e.matches("Starting")?lr(e):e.matches("WaitingForEmail")||e.matches("ValidatingEmail")?rr(e):e.matches({PasswordLess:"PasswordLessUnavailable"})?nr(e):e.matches({DeviceRegistration:{EmailToken:"SendEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"WaitingForEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"FinishingEmailToken"}})?or(e):e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushFailed"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushValidated"}})?ar(e):e.matches({TwoFactorAuthentication:"WaitingForTotp"})||e.matches({TwoFactorAuthentication:"WaitingForBackupCode"})||e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})||e.matches({TwoFactorAuthentication:"FinishingTwoFactorAuthenticationOtp"})?ir(e):e.matches({WebAuthn:"InitWebAuthnAuthentication"})||e.matches({WebAuthn:"WebAuthnAuthenticationFailed"})||e.matches({WebAuthn:"WebAuthnAuthenticationValidated"})?sr(e):e.matches("SSORedirectionToIdp")?cr(e):e.matches({MasterPassword:"CheckingAccountRecoveryStatus"})||e.matches({MasterPassword:"WaitingForMasterPassword"})||e.matches({MasterPassword:"ValidatingMasterPassword"})||e.matches({MasterPassword:"MigrationNeeded"})||e.matches({MasterPassword:"MPToSSOMigration"})||e.matches("AuthenticationDone")?ur(e):void console.warn("[Auth] - No view associated to state ",JSON.stringify(e.value))}(e))),pr=e=>e.pipe((0,tr.z)(dr));var fr=r(30045);var hr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},yr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let mr=class{constructor(e,t){this.authenticationFlow=e,this.loginMachineStore=t}execute(){return(0,Jt.a)([(e=this.loginMachineStore,e.state$.pipe((0,a.U)((e=>e?A.ZM.create(JSON.parse(e)):void 0)))),this.authenticationFlow.getInstance().ready()],((e,t)=>{if(e&&t)return e})).pipe((0,O.h)(Boolean),(0,Zt.x)(((e,t)=>((e,t)=>{const r=t.matches(e.value),n=(0,fr.Z)(e.context,t.context);return r&&n})(e,t))),pr);var e}};mr=hr([(0,n.QueryHandler)(h.AuthenticationFlowStatusQuery),yr("design:paramtypes",[Ge,T])],mr);var gr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},vr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let br=class{constructor(e){this.ssoInfoStore=e}execute(){return this.ssoInfoStore.state$.pipe((0,a.U)((e=>(0,c.Vp)({rememberMeForSSOPreference:e.rememberMeForSSOPreference}))))}};br=gr([(0,n.QueryHandler)(h.GetSsoInfoQuery),vr("design:paramtypes",[D])],br);const wr=e=>!0;class Rr extends((0,n.defineStore)({initialValue:void 0,persist:!1,scope:j.UseCaseScope.Device,storeName:"device-registration-flow-store",storeTypeGuard:wr})){}var Sr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Er=class{};Er=Sr([(0,n.Module)({api:h.authenticationFlowApi,handlers:{commands:{changeLogin:Ke,changeTwoFactorAuthenticationOtpType:$e,clearError:Xe,resendEmailToken:et,resendPushNotification:nt,sendAccountEmail:it,sendMasterPassword:ut,submitBackupCode:pt,submitEmailToken:yt,submitTotp:vt,switchToDashlaneAuthenticator:Rt,switchToEmailToken:Ot,retryWebAuthnAuthentication:At,useMasterPassword:Tt,webAuthnAuthenticationFail:Dt,logout:Nt,lockSession:Gt,loginViaSSO:Ft,initiateLoginWithSSO:L,initiateAutologinWithSSO:zt},events:{...(0,n.useEventsOfModule)(i.carbonLegacyApi,{carbonLegacy:Xt})},queries:{authenticationFlowStatus:mr,getSsoInfo:br}},configurations:{authenticationFlowContextInfrastructure:{token:U}},providers:[be,re,ue,ae,de,B,ge,Ge,Ie,Se,Ce,E,V,Z,Y,w,he,je,z],stores:[T,Rr,D],imports:[y.nr,y.iT]})],Er)},17556:(e,t,r)=>{"use strict";r.d(t,{e:()=>n});class n{redirectUserToExternalUrl(e){chrome.tabs.create({url:e.externalUrl,active:e.tabFocus})}}},80552:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.autofillDataApi=void 0;const n=r(68224);t.autofillDataApi=(0,n.defineModuleApi)({name:"autofillData",commands:{},events:{},queries:{}})},34947:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(80552),t)},96709:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.autofillTrackingApi=void 0;const n=r(68224),o=r(68006),a=r(15995);t.autofillTrackingApi=(0,n.defineModuleApi)({name:"autofillTracking",commands:{temporaryEmitPasswordAutofillPerformedEvent:a.TemporaryEmitPasswordAutofillPerformedEventCommand},events:{passwordAutofillPerformedEvent:o.PasswordAutofillPerformedEvent},queries:{}})},15995:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(31979),t)},31979:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TemporaryEmitPasswordAutofillPerformedEventCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.TemporaryEmitPasswordAutofillPerformedEventCommand=o},68006:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(85707),t)},85707:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordAutofillPerformedEvent=void 0;const n=r(68224);class o extends((0,n.defineEvent)({scope:n.UseCaseScope.User})){}t.PasswordAutofillPerformedEvent=o},61211:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(96709),t),o(r(68006),t),o(r(15995),t)},62301:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isArrayOfAutofillableDataModel=t.isAutofillableDataModel=t.CREDENTIAL_DATA_MODELS=t.FORM_DATA_MODELS=void 0,t.FORM_DATA_MODELS=["KWAddress","KWBankStatement","KWCompany","KWDriverLicence","KWEmail","KWFiscalStatement","KWIDCard","KWIdentity","KWMerchand","KWPassport","KWPaymentMean_creditCard","KWPaymentMean_paypal","KWPersonalWebsite","KWPhone","KWSecureNote","KWSecureNoteCategory","KWSocialSecurityStatement"],t.CREDENTIAL_DATA_MODELS=["KWAuthentifiant","KWGeneratedPassword","KWPasskey"];const r=[...t.FORM_DATA_MODELS,...t.CREDENTIAL_DATA_MODELS];t.isAutofillableDataModel=e=>!!e&&"string"==typeof e&&r.includes(e);t.isArrayOfAutofillableDataModel=e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every(t.isAutofillableDataModel)},53354:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(391),t),o(r(53644),t),o(r(19215),t),o(r(62301),t),o(r(86302),t)},86302:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDashlaneDisabledPermanently=t.isArrayOfUserAutofillCorrections=void 0;t.isArrayOfUserAutofillCorrections=e=>e instanceof Array&&!e.find((e=>{return!("object"==typeof(t=e)&&null!==t&&"id"in t&&"fieldIdentifier"in t&&"domain"in t);var t}));t.isDashlaneDisabledPermanently=e=>"none"===e.correctedDataSource},391:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},53644:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVaultSourceType=t.isOtherSourceType=t.OtherSourceType=void 0;const n=r(19215);var o;!function(e){e.NewPassword="newPassword",e.SubmitButton="submitButton",e.WebauthnConditionalUI="WebauthnConditionalUI"}(o=t.OtherSourceType||(t.OtherSourceType={}));t.isOtherSourceType=e=>Object.values(o).includes(e);t.isVaultSourceType=e=>e in n.VaultSourceType},19215:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VaultSourceType=void 0,function(e){e.Address="Address",e.BankAccount="BankAccount",e.Company="Company",e.Credential="Credential",e.CredentialCategory="CredentialCategory",e.DriverLicense="DriverLicense",e.Email="Email",e.FiscalId="FiscalId",e.GeneratedPassword="GeneratedPassword",e.IdCard="IdCard",e.Identity="Identity",e.NoteCategory="NoteCategory",e.Note="Note",e.Passport="Passport",e.Passkey="Passkey",e.PaymentCard="PaymentCard",e.PersonalWebsite="PersonalWebsite",e.Phone="Phone",e.SocialSecurityId="SocialSecurityId"}(t.VaultSourceType||(t.VaultSourceType={}))},24979:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(88709),t),o(r(53354),t),o(r(34947),t),o(r(61211),t),o(r(67822),t)},15481:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.autofillSecurityApi=void 0;const n=r(68224);t.autofillSecurityApi=(0,n.defineModuleApi)({name:"autofillSecurity",commands:{},events:{},queries:{}})},67822:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(15481),t)},37513:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.autofillSettingsApi=void 0;const n=r(68224),o=r(61375),a=r(54345),i=r(11639),s=r(34),c=r(50030);t.autofillSettingsApi=(0,n.defineModuleApi)({name:"autofillSettings",commands:{toggleDashlane:i.ToggleDashlaneCommand,enableAnalysis:c.EnableAnalysisCommand,enableAutofillOnForms:c.EnableAutofillOnFormsCommand,enableAutofillOnLogins:c.EnableAutofillOnLoginsCommand,enableFollowUpNotification:c.EnableFollowUpNotificationCommand,disableAnalysis:c.DisableAnalysisCommand,disableAutofillOnForms:c.DisableAutofillOnFormsCommand,disableAutofillOnLogins:c.DisableAutofillOnLoginsCommand,disableFollowUpNotification:c.DisableFollowUpNotificationCommand,addDisabledSourceTypes:a.AddDisabledSourceTypesCommand,removeDisabledSourceTypes:o.RemoveDisabledSourceTypesCommand,setUserAutofillCorrections:c.SetUserAutofillCorrectionsCommand},events:{},queries:{getAnalysisStatusOnUrl:s.GetAnalysisStatusOnUrlQuery,getAutofillSettings:s.GetAutofillSettingsQuery,getUserAutofillCorrections:s.GetUserAutofillCorrectionsQuery}})},54345:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AddDisabledSourceTypesCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.AddDisabledSourceTypesCommand=o},55943:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisableAnalysisCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DisableAnalysisCommand=o},22351:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisableAutofillOnFormsCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DisableAutofillOnFormsCommand=o},71113:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisableAutofillOnLoginsCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DisableAutofillOnLoginsCommand=o},16037:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisableFollowUpNotificationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DisableFollowUpNotificationCommand=o},88735:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnableAnalysisCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.EnableAnalysisCommand=o},35332:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnableAutofillOnFormsCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.EnableAutofillOnFormsCommand=o},32956:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnableAutofillOnLoginsCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.EnableAutofillOnLoginsCommand=o},68762:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnableFollowUpNotificationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.EnableFollowUpNotificationCommand=o},50030:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(54345),t),o(r(55943),t),o(r(22351),t),o(r(71113),t),o(r(16037),t),o(r(88735),t),o(r(35332),t),o(r(32956),t),o(r(68762),t),o(r(61375),t),o(r(11639),t),o(r(64231),t)},61375:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoveDisabledSourceTypesCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.RemoveDisabledSourceTypesCommand=o},64231:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetUserAutofillCorrectionsCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.SetUserAutofillCorrectionsCommand=o},11639:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToggleDashlaneCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.ToggleDashlaneCommand=o},88709:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(37513),t),o(r(34),t),o(r(50030),t)},67258:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetAnalysisStatusOnUrlQuery=t.AnalysisStatus=void 0;const n=r(68224);!function(e){e.ANALYSIS_ENABLED="ANALYSIS_ENABLED",e.ANALYSIS_DISABLED_BY_USER="ANALYSIS_DISABLED_BY_USER",e.ANALYSIS_DISABLED_BY_B2B_ADMIN="ANALYSIS_DISABLED_BY_B2B_ADMIN",e.ANALYSIS_DISABLED_BY_KILLSWITCH="ANALYSIS_DISABLED_BY_KILLSWITCH",e.ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT="ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT"}(t.AnalysisStatus||(t.AnalysisStatus={}));class o extends((0,n.defineQuery)({scope:n.UseCaseScope.Device})){}t.GetAnalysisStatusOnUrlQuery=o},31270:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetAutofillSettingsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.GetAutofillSettingsQuery=o},31027:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetUserAutofillCorrectionsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.GetUserAutofillCorrectionsQuery=o},34:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(67258),t),o(r(31270),t),o(r(31027),t)},36912:(e,t,r)=>{"use strict";r.d(t,{UF:()=>Pe,kQ:()=>Me,Pd:()=>Oe,V1:()=>De});var n,o=r(32839),a=r(24979);!function(e){e.NewUrlParserDev="platform_web_new_url_parser_dev",e.NewUrlParser="platform_web_new_url_parser",e.AdminSubdomainsDev="autofill_web_tac_subdomains_dev",e.AdminSubdomains="autofill_web_tac_subdomains"}(n||(n={}));var i=r(87279),s=r(53576),c=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let l=class{constructor(e){this.cqrsClient=e}async execute({body:e}){const{isAutofillEnabled:t,url:r}=e,{carbon:n}=this.cqrsClient.getClient(s.carbonLegacyApi).commands,o=await n({name:"toggleDashlane",args:[{where:"site",autofill:t,autologin:t,url:r}]});if((0,i.hx)(o))throw new Error("Toggle Dashlane command from core-autofill failed");return(0,i.Vp)(void 0)}};l=c([(0,o.CommandHandler)(a.ToggleDashlaneCommand),u("design:paramtypes",[o.CqrsClient])],l);var d=r(87065),p=r(85390),f=r(43978),h=r(92210),y=r(17509),m=r(28489);var g,v,b;!function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR"}(g||(g={})),function(e){e.EMAIL_TOKEN="email_token",e.DEVICE_REGISTRATION="totp_device_registration",e.LOGIN="totp_login",e.SSO="sso"}(v||(v={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.PENDING=1]="PENDING",e[e.ERROR=2]="ERROR",e[e.READY=3]="READY"}(b||(b={}));const w=e=>{if(!(t=e)||"object"!=typeof t||!(0,m.l$)(t,"status")||"number"!=typeof t.status)throw new Error("twoFactorAuthentication is not of the expected type");var t;return e.status===b.READY&&e.shouldEnforceTwoFactorAuthentication},R=e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every((e=>"string"==typeof e));var S=r(60399),E=r(68224);const O=async(e,t)=>{const{userFeatureFlips:r}=e.getClient(E.requestContextApi).queries,n=await(0,S.z)(r({requiredFeatureFlips:t})).catch(i.Rn);return(0,i.d6)(n)&&t.some((e=>n.data[e]))};var C=r(97280);var P=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},A=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let j=class{constructor(e){this.cqrsClient=e}get isAutofillDisabled(){return{get$:this._getIsAutofillDisabled$,set:this._setIsAutofillDisabled.bind(this)}}get disabledDomains(){return{get$:this._getDisabledDomains$,set:this._setDisabledDomains.bind(this),add:this._addDisabledDomains.bind(this),remove:this._removeDisabledDomains.bind(this)}}get disabledSourceTypes(){return{get$:this._getDisabledSourceTypes$,set:this._setDisabledSourceTypes.bind(this),add:this._addDisabledSourceTypes.bind(this),remove:this._removeDisabledSourceTypes.bind(this)}}get isFollowUpNotificationEnabled(){return{get$:this._getIsFollowUpNotificationEnabled$,set:this._setIsFollowUpNotificationEnabled.bind(this)}}async _updateSettings(e){const t=e.isAutofillDisabled??await(0,S.z)(this._getIsAutofillDisabled$),r=e.disabledDomains??await(0,S.z)(this._getDisabledDomains$),n=e.disabledSourceTypes??await(0,S.z)(this._getDisabledSourceTypes$),o=e.isFollowUpNotificationEnabled??await(0,S.z)(this._getIsFollowUpNotificationEnabled$),a=await this.cqrsClient.getClient(s.carbonLegacyApi).commands.carbon({name:"updateAutofillSettings",args:[{AutofillSettings:{disabledDomains:r,disabledSourceTypes:n,isAutofillDisabled:t,isFollowUpNotificationEnabled:o}}]});if((0,i.hx)(a))throw new Error("Error when updating autofill settings using updateAutofillSettings query from Carbon")}get _getAutofillSettings$(){const{carbonState:e}=this.cqrsClient.getClient(s.carbonLegacyApi).queries;return e({path:"userSession.personalSettings.AutofillSettings"}).pipe((0,d.U)((e=>{if(!(0,i.d6)(e)||!(e=>!!e&&"object"==typeof e&&(0,m.l$)(e,"isAutofillDisabled")&&"boolean"==typeof e.isAutofillDisabled&&(0,m.l$)(e,"disabledSourceTypes")&&(0,a.isArrayOfAutofillableDataModel)(e.disabledSourceTypes)&&(0,m.l$)(e,"disabledDomains")&&Array.isArray(e.disabledDomains)&&e.disabledDomains.every((e=>"string"==typeof e))&&(0,m.l$)(e,"isFollowUpNotificationEnabled")&&"boolean"==typeof e.isFollowUpNotificationEnabled)(e.data))throw new Error("AutofillSettings is not of the expected type");return e.data})),(0,C.d)(1))}get _getIsAutofillDisabled$(){return this._getAutofillSettings$.pipe((0,d.U)((({isAutofillDisabled:e})=>e)))}_setIsAutofillDisabled(e){return this._updateSettings({isAutofillDisabled:e})}_setIsFollowUpNotificationEnabled(e){return this._updateSettings({isFollowUpNotificationEnabled:e})}get _getDisabledDomains$(){return this._getAutofillSettings$.pipe((0,d.U)((({disabledDomains:e})=>e)))}_setDisabledDomains(e){return this._updateSettings({disabledDomains:e})}async _addDisabledDomains(e){const t=await(0,S.z)(this._getDisabledDomains$);return this._setDisabledDomains([...new Set([...t,...e])])}async _removeDisabledDomains(e){const t=await(0,S.z)(this._getDisabledDomains$);return this._setDisabledDomains(t.filter((t=>!e.includes(t))))}get _getDisabledSourceTypes$(){return this._getAutofillSettings$.pipe((0,d.U)((({disabledSourceTypes:e})=>e)))}_setDisabledSourceTypes(e){return this._updateSettings({disabledSourceTypes:e})}async _addDisabledSourceTypes(e){const t=await(0,S.z)(this._getDisabledSourceTypes$);return this._setDisabledSourceTypes([...new Set([...t,...e])])}async _removeDisabledSourceTypes(e){const t=await(0,S.z)(this._getDisabledSourceTypes$);return this._setDisabledSourceTypes(t.filter((t=>!e.includes(t))))}get _getIsFollowUpNotificationEnabled$(){return this._getAutofillSettings$.pipe((0,d.U)((({isFollowUpNotificationEnabled:e})=>e)))}};j=P([(0,o.Injectable)(),A("design:paramtypes",[o.CqrsClient])],j);var _=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},T=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let I=class{constructor(e,t){this.cqrsClient=e,this.settings=t}execute({body:{url:e}}){const{carbonState:t}=this.cqrsClient.getClient(s.carbonLegacyApi).queries,r=()=>O(this.cqrsClient,[n.NewUrlParser,n.NewUrlParserDev]),o=()=>O(this.cqrsClient,[n.AdminSubdomains,n.AdminSubdomainsDev]),c=r().then((t=>t?new h.ParsedURL(e).getRootDomain():(0,y.extractRootDomain)(e))),u=r().then((t=>t?new h.ParsedURL(e).getHostname():(0,y.extractFullDomain)(e))),l=t({path:"userSession.killswitch.disableAutofill"}).pipe((0,d.U)((e=>{if(!(0,i.d6)(e)||!(e=>"boolean"==typeof e)(e.data))throw new Error("Error when fetching killswitch.disableAutofill");return e.data}))),g=(0,p.a)({isAutofillDisabled:this.settings.isAutofillDisabled.get$,disabledDomains:this.settings.disabledDomains.get$}).pipe((0,f.w)((async({isAutofillDisabled:e,disabledDomains:t})=>e||t.includes(await c)))),v=t({path:"userSession.spaceData.spaces"}).pipe((0,f.w)((async e=>{if(!(0,i.d6)(e)||!(e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every((e=>(0,m.l$)(e,"details")&&(0,m.l$)(e.details,"info"))))(e.data))throw new Error("Error when fetching spaceData.spaces");const t=e.data.reduce(((e,t)=>{const r=t.details.info.autologinDomainDisabledArray;return[...e,...R(r)?r:[]]}),[]),r=await c,n=await u;return await o()?t.some((e=>e===r||e===n||n.endsWith(`.${e}`))):t.includes(r)}))),b=t({path:"authentication.twoFactorAuthentication"}).pipe((0,d.U)((e=>{if(!(0,i.d6)(e))throw new Error("Error when fetching authentication.twoFactorAuthentication");return w(e.data)})));return(0,p.a)({isAutofillDisabledByB2BAdmin:v,isAutofillDisabledByKillswitch:l,isAutofillDisabledByUser:g,isAutofillDisabledBy2FAEnforcement:b}).pipe((0,d.U)((({isAutofillDisabledBy2FAEnforcement:e,isAutofillDisabledByB2BAdmin:t,isAutofillDisabledByKillswitch:r,isAutofillDisabledByUser:n})=>{let o=a.AnalysisStatus.ANALYSIS_ENABLED;return r?o=a.AnalysisStatus.ANALYSIS_DISABLED_BY_KILLSWITCH:t?o=a.AnalysisStatus.ANALYSIS_DISABLED_BY_B2B_ADMIN:n?o=a.AnalysisStatus.ANALYSIS_DISABLED_BY_USER:e&&(o=a.AnalysisStatus.ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT),(0,i.Vp)({analysisStatus:o})})))}};I=_([(0,o.QueryHandler)(a.GetAnalysisStatusOnUrlQuery),T("design:paramtypes",[o.CqrsClient,j])],I);var x=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},D=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let U=class{constructor(e){this.settings=e}execute(){return(0,p.a)({disabledDomains:this.settings.disabledDomains.get$,disabledSourceTypes:this.settings.disabledSourceTypes.get$,isAutofillDisabled:this.settings.isAutofillDisabled.get$,isFollowUpNotificationEnabled:this.settings.isFollowUpNotificationEnabled.get$}).pipe((0,d.U)(i.Vp))}};U=x([(0,o.QueryHandler)(a.GetAutofillSettingsQuery),D("design:paramtypes",[j])],U);var M=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},N=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let k=class{constructor(e){this.settings=e}async execute({body:{sourceTypes:e}}){return await this.settings.disabledSourceTypes.add(e),(0,i.Vp)(void 0)}};k=M([(0,o.CommandHandler)(a.AddDisabledSourceTypesCommand),N("design:paramtypes",[j])],k);var L=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},F=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let q=class{constructor(e){this.settings=e}async execute({body:{sourceTypes:e}}){return await this.settings.disabledSourceTypes.remove(e),(0,i.Vp)(void 0)}};q=L([(0,o.CommandHandler)(a.RemoveDisabledSourceTypesCommand),F("design:paramtypes",[j])],q);var V=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},G=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let H=class{constructor(e){this.settings=e}async execute(){return await this.settings.isAutofillDisabled.set(!1),(0,i.Vp)(void 0)}};H=V([(0,o.CommandHandler)(a.EnableAnalysisCommand),G("design:paramtypes",[j])],H);var B=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},K=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let W=class{constructor(e){this.settings=e}async execute(){return await this.settings.isAutofillDisabled.set(!0),(0,i.Vp)(void 0)}};W=B([(0,o.CommandHandler)(a.DisableAnalysisCommand),K("design:paramtypes",[j])],W);var z=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},$=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Q=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.remove([...a.FORM_DATA_MODELS]),(0,i.Vp)(void 0)}};Q=z([(0,o.CommandHandler)(a.EnableAutofillOnFormsCommand),$("design:paramtypes",[j])],Q);var Y=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},X=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let J=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.remove([...a.CREDENTIAL_DATA_MODELS]),(0,i.Vp)(void 0)}};J=Y([(0,o.CommandHandler)(a.EnableAutofillOnLoginsCommand),X("design:paramtypes",[j])],J);var Z=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ee=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let te=class{constructor(e){this.settings=e}async execute(){return await this.settings.isFollowUpNotificationEnabled.set(!0),(0,i.Vp)(void 0)}};te=Z([(0,o.CommandHandler)(a.EnableFollowUpNotificationCommand),ee("design:paramtypes",[j])],te);var re=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ne=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let oe=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.add([...a.FORM_DATA_MODELS]),(0,i.Vp)(void 0)}};oe=re([(0,o.CommandHandler)(a.DisableAutofillOnFormsCommand),ne("design:paramtypes",[j])],oe);var ae=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ie=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let se=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.add([...a.CREDENTIAL_DATA_MODELS]),(0,i.Vp)(void 0)}};se=ae([(0,o.CommandHandler)(a.DisableAutofillOnLoginsCommand),ie("design:paramtypes",[j])],se);var ce=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ue=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let le=class{constructor(e){this.settings=e}async execute(){return await this.settings.isFollowUpNotificationEnabled.set(!1),(0,i.Vp)(void 0)}};le=ce([(0,o.CommandHandler)(a.DisableFollowUpNotificationCommand),ue("design:paramtypes",[j])],le);var de=r(44396);const pe=e=>!!e&&(0,a.isArrayOfUserAutofillCorrections)(e);class fe extends((0,o.defineStore)({persist:!0,storage:{initialValue:[],typeGuard:pe,schemaVersion:1},scope:E.UseCaseScope.Device,storeName:"user-autofill-corrections",capacity:o.StoreCapacity._100KB,codec:de.Eu})){}var he=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ye=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let me=class{constructor(e){this.store=e}get userAutofillCorrections(){return{get$:this._getUserAutofillCorrections$,set:this._setUserAutofillCorrections.bind(this)}}get _getUserAutofillCorrections$(){return this.store.state$}async _setUserAutofillCorrections(e){try{await this.store.set(e)}catch{throw new Error("SetUserAutofillCorrections command from core-autofill failed")}}};me=he([(0,o.Injectable)(),ye("design:paramtypes",[fe])],me);var ge=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ve=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let be=class{constructor(e){this.settings=e}execute(){return this.settings.userAutofillCorrections.get$.pipe((0,d.U)(i.Vp))}};be=ge([(0,o.QueryHandler)(a.GetUserAutofillCorrectionsQuery),ve("design:paramtypes",[me])],be);var we=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Re=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Se=class{constructor(e){this.correctionsRepository=e}async execute({body:e}){const{corrections:t}=e;return await this.correctionsRepository.userAutofillCorrections.set(t),(0,i.Vp)(void 0)}};Se=we([(0,o.CommandHandler)(a.SetUserAutofillCorrectionsCommand),Re("design:paramtypes",[me])],Se);var Ee=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Oe=class{};Oe=Ee([(0,o.Module)({api:a.autofillSettingsApi,handlers:{commands:{toggleDashlane:l,enableAnalysis:H,enableAutofillOnForms:Q,enableAutofillOnLogins:J,enableFollowUpNotification:te,disableAnalysis:W,disableAutofillOnForms:oe,disableAutofillOnLogins:se,disableFollowUpNotification:le,addDisabledSourceTypes:k,removeDisabledSourceTypes:q,setUserAutofillCorrections:Se},events:{},queries:{getAnalysisStatusOnUrl:I,getAutofillSettings:U,getUserAutofillCorrections:be}},stores:[fe],providers:[j,me],requiredFeatureFlips:Object.values(n)})],Oe);var Ce=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Pe=class{};Pe=Ce([(0,o.Module)({api:a.autofillDataApi,handlers:{commands:{},events:{},queries:{}},providers:[]})],Pe);var Ae=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let je=class extends o.BaseEventEmitter{};je=Ae([(0,o.Injectable)()],je);var _e=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Te=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ie=class{constructor(e){this.autofillTrackingEventsEmitter=e}execute({body:e}){const{credentialId:t}=e;return t&&this.autofillTrackingEventsEmitter.sendEvent("passwordAutofillPerformed",{credentialId:t}),Promise.resolve((0,i.Vp)(void 0))}};Ie=_e([(0,o.CommandHandler)(a.TemporaryEmitPasswordAutofillPerformedEventCommand),Te("design:paramtypes",[je])],Ie);var xe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let De=class{};De=xe([(0,o.Module)({api:a.autofillTrackingApi,handlers:{commands:{temporaryEmitPasswordAutofillPerformedEvent:Ie},events:{},queries:{}},providers:[je]})],De);var Ue=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Me=class{};Me=Ue([(0,o.Module)({api:a.autofillSecurityApi,handlers:{commands:{},events:{},queries:{}}})],Me)},82983:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=(e="World")=>`Hello ${e}!`},95031:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});(0,a(r(82983)).default)(),o(r(77270),t)},11886:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notificationsApi=void 0;const n=r(68224),o=r(9637);t.notificationsApi=(0,n.defineModuleApi)({name:"notifications",commands:{},events:{},queries:{GetPlanPricingQuery:o.GetPlanPricingQuery}})},77270:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(11886),t),o(r(9637),t)},88160:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetPlanPricingQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.GetPlanPricingQuery=o},9637:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(88160),t)},51317:(e,t,r)=>{"use strict";r.d(t,{F:()=>b});var n=r(32839),o=r(95031),a=r(30523),i=r(87065),s=r(43978),c=r(53576),u=r(17530),l=r(48844),d=r(87279),p=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let h=class{constructor(e){this.serverApiClient=e}getPlanPricing({login:e,userKey:t,couponCode:r,language:n,hasEssentials:o}){return this.serverApiClient.v1.payments.getAccessibleWebOffers({login:e,userKey:t,couponCode:r,language:n,forceFamily:!0,hasEssentials:o}).pipe((0,l.DZ)((e=>{throw new Error(`GetPlanPricing failed with error: ${e}`)})),(0,l.lk)((e=>{const{plans:t,currency:r}=e.data,{family:n}=t,{offers:o,...a}=n,i={plans:{family:{offers:o.map((({duration:e,...t})=>({billingPeriod:e,...t}))),...a}},currency:r};return(0,d.Vp)(i)})))}};h=p([(0,n.Injectable)(),f("design:paramtypes",[u.lX])],h);var y=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},m=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let g=class{constructor(e,t){this.cqrsClient=e,this.webOffersService=t}execute(){const{carbonState:e}=this.cqrsClient.getClient(c.carbonLegacyApi).queries;return e({path:"userSession.account.login"}).pipe((0,a.h)(d.d6),(0,i.U)((e=>e.data)),(0,s.w)((e=>this.webOffersService.getPlanPricing({login:e}))))}};g=y([(0,n.QueryHandler)(o.GetPlanPricingQuery),m("design:paramtypes",[n.CqrsClient,h])],g);var v=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let b=class{};b=v([(0,n.Module)({api:o.notificationsApi,handlers:{commands:{},events:{},queries:{getPlanPricing:g}},imports:[u.nr],providers:[h]})],b)},34246:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.antiphishingApi=void 0;const n=r(68224),o=r(28106),a=r(24150);t.antiphishingApi=(0,n.defineModuleApi)({name:"antiphishing",commands:{addAutoRedirectedDomain:a.AddAutoRedirectedDomainCommand},events:{},queries:{isAutoRedirectedDomain:o.IsAutoRedirectedDomainQuery}})},18756:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AddAutoRedirectedDomainCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.AddAutoRedirectedDomainCommand=o},24150:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(18756),t)},52803:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(34246),t),o(r(28106),t),o(r(24150),t)},28106:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(46515),t)},46515:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IsAutoRedirectedDomainQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)()){}t.IsAutoRedirectedDomainQuery=o},47524:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.breachesApi=void 0;const n=r(68224),o=r(13516),a=r(7659);t.breachesApi=(0,n.defineModuleApi)({name:"breaches",commands:{dismissBreach:o.DismissBreachCommand,markBreachAsSeen:o.MarkBreachAsSeenCommand},events:{},queries:{breach:a.BreachQuery,unreadBreachesCount:a.UnreadBreachesCountQuery}})},12263:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BreachLeakedDataType=t.BreachState=void 0,function(e){e.PENDING="PENDING",e.VIEWED="VIEWED",e.ACKNOWLEDGED="ACKNOWLEDGED"}(t.BreachState||(t.BreachState={})),function(e){e.Username="username",e.Password="password",e.Email="email",e.CreditCard="creditcard",e.Phone="phone",e.Address="address",e.SSN="ssn",e.IP="ip",e.Location="geolocation",e.PersonalInfo="personalinfo",e.SocialNetwork="social"}(t.BreachLeakedDataType||(t.BreachLeakedDataType={}))},81142:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DismissBreachCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DismissBreachCommand=o},13516:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(81142),t),o(r(7694),t)},7694:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MarkBreachAsSeenCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.MarkBreachAsSeenCommand=o},98640:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(47524),t),o(r(13516),t),o(r(7659),t),o(r(12263),t)},4743:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BreachQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.BreachQuery=o},7659:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(4743),t),o(r(25107),t)},25107:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnreadBreachesCountQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.UnreadBreachesCountQuery=o},13658:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.emailMonitoringApi=void 0;const n=r(68224),o=r(61155),a=r(1677);t.emailMonitoringApi=(0,n.defineModuleApi)({name:"emailMonitoring",commands:{dismissOnboardingNotification:o.DismissOnboardingNotificationCommand,optinEmail:o.OptinEmailCommand,optoutEmail:o.OptoutEmailCommand},events:{},queries:{emailList:a.EmailsListQuery,onboardingNotificationState:a.OnboardingNotificationStateQuery,domainIcon:a.DomainIconQuery}})},77880:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DismissOnboardingNotificationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DismissOnboardingNotificationCommand=o},61155:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(77880),t),o(r(23042),t),o(r(35881),t)},23042:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OptinEmailCommand=t.OptinGenericError=t.OptinTooManySubscriptionsError=t.OptinAlreadySubscribedError=t.OptinInvalidEmailError=t.OptinDataLeaksResultErrorCode=t.OptinDataLeaksResultOkCode=void 0;const n=r(68224),o=r(61475);var a;t.OptinDataLeaksResultOkCode="OK",function(e){e.INVALID_EMAIL="EMAIL_IS_INVALID",e.ALREADY_SUBSCRIBED="USER_HAS_ALREADY_AN_ACTIVE_SUBSCRIPTION",e.TOO_MANY_SUBSCRIPTIONS="USER_HAS_TOO_MANY_SUBSCRIPTIONS",e.GENERIC_ERROR="GENERIC_ERROR"}(a=t.OptinDataLeaksResultErrorCode||(t.OptinDataLeaksResultErrorCode={}));class i extends((0,o.FunctionalError)(a.INVALID_EMAIL,"")){}t.OptinInvalidEmailError=i;class s extends((0,o.FunctionalError)(a.ALREADY_SUBSCRIBED,"")){}t.OptinAlreadySubscribedError=s;class c extends((0,o.FunctionalError)(a.TOO_MANY_SUBSCRIPTIONS,"")){}t.OptinTooManySubscriptionsError=c;class u extends((0,o.FunctionalError)(a.GENERIC_ERROR,"")){}t.OptinGenericError=u;class l extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.OptinEmailCommand=l},35881:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OptoutEmailCommand=t.OptoutGenericError=t.OptoutNoSubscriptionError=t.OptoutInvalidEmailError=t.OptoutDataLeaksResultErrorCode=t.OptoutDataLeaksResultOkCode=void 0;const n=r(68224),o=r(61475);var a;t.OptoutDataLeaksResultOkCode="OK",function(e){e.INVALID_EMAIL="EMAIL_IS_INVALID",e.NO_SUBSCRIPTION="USER_HAS_NO_SUBSCRIPTION",e.GENERIC_ERROR="GENERIC_ERROR"}(a=t.OptoutDataLeaksResultErrorCode||(t.OptoutDataLeaksResultErrorCode={}));class i extends((0,o.FunctionalError)(a.INVALID_EMAIL,"")){}t.OptoutInvalidEmailError=i;class s extends((0,o.FunctionalError)(a.NO_SUBSCRIPTION,"")){}t.OptoutNoSubscriptionError=s;class c extends((0,o.FunctionalError)(a.GENERIC_ERROR,"")){}t.OptoutGenericError=c;class u extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.OptoutEmailCommand=u},47668:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconMapSchema=t.IconSchema=void 0;const n=r(10295),o=["crawled","xs","sm","sm@2x","md","md.tiff","xmd","xmd@2x","l","l@2x","xl","xl@2x","46x30","46x30@2x","50x33","50x33@2x","56x56","56x56@2x","118x98","118x98@2x","160x106","160x106@2x"],a=(n.z.enum(o),o.reduce(((e,t)=>e.setKey(t,n.z.string().optional().nullable())),n.z.object({})));t.IconSchema=n.z.object({backgroundColor:n.z.string(),mainColor:n.z.string(),urls:a}),t.IconMapSchema=n.z.map(n.z.string(),t.IconSchema)},36234:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDarkWebOnboardingState=t.DarkWebOnboardingState=void 0,function(e){e.UNKNOWN="UNKNOWN",e.SEEN="SEEN",e.NOT_SEEN="NOT_SEEN"}(t.DarkWebOnboardingState||(t.DarkWebOnboardingState={})),t.isDarkWebOnboardingState=function(e){return"UNKNOWN"===e||"SEEN"===e||"NOT_SEEN"===e}},95954:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(13658),t),o(r(61155),t),o(r(1677),t),o(r(36234),t),o(r(47668),t)},55117:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DomainIconQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.DomainIconQuery=o},91293:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmailsListQuery=t.isDataLeaksEmailStatus=t.DataLeaksEmailStatus=void 0;const n=r(68224);!function(e){e.PENDING="pending",e.ACTIVE="active",e.DISABLED="disabled"}(t.DataLeaksEmailStatus||(t.DataLeaksEmailStatus={})),t.isDataLeaksEmailStatus=function(e){return"pending"===e||"active"===e||"disabled"===e};class o extends((0,n.defineQuery)()){}t.EmailsListQuery=o},1677:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(91293),t),o(r(66419),t),o(r(55117),t)},66419:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OnboardingNotificationStateQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.OnboardingNotificationStateQuery=o},54539:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(95954),t),o(r(98640),t),o(r(45263),t),o(r(54121),t),o(r(52803),t),o(r(37933),t),o(r(3783),t)},65310:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.masterPasswordSecurityApi=void 0;const n=r(68224),o=r(66329),a=r(80664);t.masterPasswordSecurityApi=(0,n.defineModuleApi)({name:"masterPasswordSecurity",commands:{dismissMasterPasswordLeakedNotification:o.DismissMasterPasswordLeakedNotificationCommand,temporaryCheckMasterPassword:o.TemporaryCheckMasterPasswordCommand,temporaryResetMasterPasswordLeaked:o.TemporaryResetMasterPasswordLeakedCommand,temporaryCheckMasterPasswordWeak:o.TemporaryCheckMasterPasswordWeakCommand,temporaryResetMasterPasswordWeak:o.TemporaryResetMasterPasswordWeakCommand},events:{},queries:{isMasterPasswordLeaked:a.IsMasterPasswordLeakedQuery,isMasterPasswordWeak:a.IsMasterPasswordWeakQuery,isMasterPasswordLeakedNotificationDismissed:a.IsMasterPasswordLeakedNotificationDismissedQuery}})},53219:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DismissMasterPasswordLeakedNotificationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DismissMasterPasswordLeakedNotificationCommand=o},66329:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(53219),t),o(r(27095),t),o(r(22635),t),o(r(27343),t),o(r(88192),t)},27343:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TemporaryCheckMasterPasswordWeakCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.TemporaryCheckMasterPasswordWeakCommand=o},27095:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TemporaryCheckMasterPasswordCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.TemporaryCheckMasterPasswordCommand=o},22635:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TemporaryResetMasterPasswordLeakedCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.TemporaryResetMasterPasswordLeakedCommand=o},88192:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TemporaryResetMasterPasswordWeakCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.TemporaryResetMasterPasswordWeakCommand=o},3783:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(65310),t),o(r(80664),t),o(r(66329),t)},80664:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(44858),t),o(r(68082),t),o(r(57276),t)},68082:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IsMasterPasswordLeakedNotificationDismissedQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)()){}t.IsMasterPasswordLeakedNotificationDismissedQuery=o},44858:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IsMasterPasswordLeakedQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)()){}t.IsMasterPasswordLeakedQuery=o},57276:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IsMasterPasswordWeakQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)()){}t.IsMasterPasswordWeakQuery=o},39566:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.otpApi=void 0;const n=r(68224),o=r(81220);t.otpApi=(0,n.defineModuleApi)({name:"otp",commands:{},events:{},queries:{otpCode:o.OtpCodeQuery}})},37933:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(39566),t),o(r(81220),t)},81220:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(21522),t)},21522:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OtpCodeQuery=t.OtpCodeGenerationError=void 0;const n=r(68224),o=r(61475);class a extends((0,o.FunctionalError)("Cannot generate OTP code due to no OtpSecret or OtpUrl found","")){}t.OtpCodeGenerationError=a;class i extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.OtpCodeQuery=i},65341:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.passwordHealthApi=void 0;const n=r(68224),o=r(61798),a=r(3568),i=r(94486);t.passwordHealthApi=(0,n.defineModuleApi)({name:"passwordHealth",commands:{updateIsCredentialExcluded:o.UpdateIsCredentialExcludedCommand,recalculatePasswordHealth:o.RecalculatePasswordHealthCommand},events:{passwordHealthComputationFinished:a.PasswordHealthComputationFinishedEvent},queries:{credentialHealthData:i.CredentialHealthDataQuery,filterCredentials:i.FilterCredentialsQuery,score:i.ScoreQuery,compromisedCredentials:i.CompromisedCredentialsQuery,passwordHealthReport:i.PasswordHealthReportQuery}})},16441:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateIsCredentialExcludedCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.UpdateIsCredentialExcludedCommand=o},61798:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(16441),t),o(r(33276),t)},33276:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecalculatePasswordHealthCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.RecalculatePasswordHealthCommand=o},3568:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(97189),t)},97189:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordHealthComputationFinishedEvent=void 0;const n=r(68224);class o extends((0,n.defineEvent)({scope:n.UseCaseScope.User})){}t.PasswordHealthComputationFinishedEvent=o},45263:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(65341),t),o(r(94486),t),o(r(61798),t),o(r(3568),t),o(r(50687),t)},50687:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CorruptionDataSeverity=t.CorruptionDataStrength=t.HealthFilter=t.RiskType=void 0,function(e){e.Weak="weak",e.Reused="reused",e.Compromised="compromised",e.Excluded="excluded"}(t.RiskType||(t.RiskType={})),function(e){e.All="all",e.Weak="weak",e.Reused="reused",e.Compromised="compromised",e.Excluded="excluded"}(t.HealthFilter||(t.HealthFilter={})),function(e){e.WEAK="weak",e.EXTREMELY_WEAK="extremely_weak"}(t.CorruptionDataStrength||(t.CorruptionDataStrength={})),function(e){e.COMMON="common",e.STRONG="strong"}(t.CorruptionDataSeverity||(t.CorruptionDataSeverity={}))},54929:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CompromisedCredentialsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.CompromisedCredentialsQuery=o},2479:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CredentialHealthDataQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.CredentialHealthDataQuery=o},62683:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterCredentialsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.FilterCredentialsQuery=o},94486:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(2479),t),o(r(80750),t),o(r(62683),t),o(r(54929),t),o(r(51526),t)},51526:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordHealthReportQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.PasswordHealthReportQuery=o},80750:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScoreQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.ScoreQuery=o},63811:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vaultReportApi=void 0;const n=r(68224);t.vaultReportApi=(0,n.defineModuleApi)({name:"vaultReport",commands:{},events:{},queries:{}})},54121:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(63811),t)},12483:(e,t,r)=>{"use strict";r.d(t,{v5:()=>vn,tQ:()=>Oe,Ss:()=>X,fI:()=>ko,fj:()=>Wn,Cg:()=>qr,E0:()=>sn});var n=r(32839),o=r(54539),a=r(87065),i=r(6136),s=r(43978),c=r(90171),u=r(69885),l=r(87279);function d(e){return{...e,onboardingStatus:o.DarkWebOnboardingState.SEEN}}var p=r(68224),f=r(44396);const h=e=>(e=>!(!e||"object"!=typeof e)&&"onboardingStatus"in e&&"emails"in e)(e)&&(0,o.isDarkWebOnboardingState)(e.onboardingStatus)&&Array.isArray(e.emails);class y extends((0,n.defineStore)({persist:!0,storage:{schemaVersion:1,initialValue:{onboardingStatus:o.DarkWebOnboardingState.NOT_SEEN,emails:[]},typeGuard:h},scope:p.UseCaseScope.User,storeName:"email-monitoring-state",storeTypeGuard:h,codec:f.Eu})){}var m=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let v=class{constructor(e){this.store=e}async execute(){await this.store.update(d)}};v=m([(0,n.Injectable)(),g("design:paramtypes",[y])],v);var b=r(48844),w=r(17530),R=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},S=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let E=class{constructor(e,t){this.serverApiClient=e,this.store=t,this.execute=()=>{this.serverApiClient.v1.darkwebmonitoring.listRegistrations({}).pipe((0,b.Qn)((({data:e})=>e.emails.map((e=>({email:e.email,state:(0,o.isDataLeaksEmailStatus)(e.state)?e.state:o.DataLeaksEmailStatus.PENDING}))))),(0,b.Qn)((e=>{this.store.update((t=>({...t,emails:e})))})),(0,b.DZ)((e=>{throw e}))).subscribe()}}};E=R([(0,n.Injectable)(),S("design:paramtypes",[w.lX,y])],E);var O=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},C=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let P=class{constructor(e,t){this.syncMonitoredEmails=e,this.store=t}execute(){this.syncMonitoredEmails.execute();return this.store.state$.pipe((0,a.U)((e=>e.emails)),(0,i.x)(((e,t)=>JSON.stringify(e)===JSON.stringify(t))),(0,a.U)((e=>(0,l.Vp)(e)))).pipe((0,s.w)((e=>{const t=()=>(this.syncMonitoredEmails.execute(),e),r=e=>(0,c.H)(0,e).pipe((0,s.w)((()=>(0,u.of)(t()))));return(0,l.hx)(e)||e.data.some((e=>e.state===o.DataLeaksEmailStatus.PENDING))?r(3e4):(0,u.of)(e)})))}};P=O([(0,n.QueryHandler)(o.EmailsListQuery),C("design:paramtypes",[E,y])],P);var A=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},j=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let _=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,a.U)((e=>(0,l.Vp)(e.onboardingStatus))))}};_=A([(0,n.QueryHandler)(o.OnboardingNotificationStateQuery),j("design:paramtypes",[y])],_);var T=r(96303),I=r(54066),x=r(53576);var D=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},U=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let M=class{constructor(e){this.client=e}get(){const{queries:{carbonState:e}}=this.client.getClient(x.carbonLegacyApi);return e({path:"userSession.iconsCache.domains"}).pipe((0,b.Qn)((e=>{if(!(e=>o.IconMapSchema.safeParse(e).success)(e))throw new Error("Bad domain icons cache format ");return e})))}};M=D([(0,n.Injectable)(),U("design:paramtypes",[n.CqrsClient])],M);var N=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},k=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let L=class{constructor(e,t){this.domainIconsGetter=e,this.md5Hasher=t}execute({body:{domain:e}}){return this.domainIconsGetter.get().pipe((0,b.Qn)((t=>t.get((0,T.k)(this.md5Hasher.compute((0,I.u)(e)))))))}};L=N([(0,n.QueryHandler)(o.DomainIconQuery),k("design:paramtypes",[M,w.ft])],L);var F=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let V=class{constructor(e){this.dismissOnboardingNotificationService=e}async execute(){return await this.dismissOnboardingNotificationService.execute(),Promise.resolve((0,l.Vp)(void 0))}};V=F([(0,n.CommandHandler)(o.DismissOnboardingNotificationCommand),q("design:paramtypes",[v])],V);var G=r(60399),H=r(82567),B=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},K=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let W=class{constructor(e,t){this.serverApiClient=e,this.store=t}async execute({body:{email:e}}){return await(0,G.z)(this.serverApiClient.v1.darkwebmonitoring.registerEmail({email:e}).pipe((0,b.DZ)((e=>{throw new Error(e.message)})),(0,b.lk)((e=>e.data.result===o.OptinDataLeaksResultOkCode?(0,l.Vp)(void 0):(0,l.Rn)((e=>{switch(e){case o.OptinDataLeaksResultErrorCode.INVALID_EMAIL:return new o.OptinInvalidEmailError;case o.OptinDataLeaksResultErrorCode.ALREADY_SUBSCRIBED:return new o.OptinAlreadySubscribedError;case o.OptinDataLeaksResultErrorCode.TOO_MANY_SUBSCRIPTIONS:return new o.OptinTooManySubscriptionsError;default:return new o.OptinGenericError}})(e.data.result)))),(0,H.b)((async t=>{(0,l.d6)(t)&&await this.store.update((t=>({...t,emails:[...t.emails,{email:e,state:o.DataLeaksEmailStatus.PENDING}]})))}))))}};W=B([(0,n.CommandHandler)(o.OptinEmailCommand),K("design:paramtypes",[w.lX,y])],W);var z=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},$=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Q=class{constructor(e,t){this.serverApiClient=e,this.store=t,this.getFunctionalError=e=>{switch(e){case o.OptoutDataLeaksResultErrorCode.NO_SUBSCRIPTION:return new o.OptoutNoSubscriptionError;case o.OptoutDataLeaksResultErrorCode.INVALID_EMAIL:return new o.OptoutInvalidEmailError;case o.OptoutDataLeaksResultErrorCode.GENERIC_ERROR:default:return new o.OptoutGenericError}}}async execute({body:{email:e}}){return await(0,G.z)(this.serverApiClient.v1.darkwebmonitoring.deregisterEmail({email:e}).pipe((0,b.DZ)((e=>{throw new Error(e.message)})),(0,b.lk)((e=>e.data.result===o.OptoutDataLeaksResultOkCode?(0,l.Vp)(void 0):(0,l.Rn)(this.getFunctionalError(e.data.result)))),(0,H.b)((async t=>{(0,l.d6)(t)&&await this.store.update((t=>({...t,emails:[...t.emails.filter((t=>t.email!==e))]})))}))))}};Q=z([(0,n.CommandHandler)(o.OptoutEmailCommand),$("design:paramtypes",[w.lX,y])],Q);var Y=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let X=class{};X=Y([(0,n.Module)({api:o.emailMonitoringApi,stores:[y],handlers:{commands:{dismissOnboardingNotification:V,optinEmail:W,optoutEmail:Q},events:{},queries:{emailList:P,onboardingNotificationState:_,domainIcon:L}},imports:[w.nr,w.Dq],providers:[v,E,M]})],X);var J=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Z=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ee=class{constructor(e){this.client=e}async execute({body:e}){const{commands:{carbon:t}}=this.client.getClient(x.carbonLegacyApi);return await t({name:"updateBreachStatus",args:[{id:e.id,status:o.BreachState.ACKNOWLEDGED}]}),Promise.resolve((0,l.Vp)(void 0))}};ee=J([(0,n.CommandHandler)(o.DismissBreachCommand),Z("design:paramtypes",[n.CqrsClient])],ee);var te=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},re=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ne=class{constructor(e){this.client=e}async execute({body:e}){const{commands:{carbon:t}}=this.client.getClient(x.carbonLegacyApi);return await t({name:"updateBreachStatus",args:[{id:e.id,status:o.BreachState.VIEWED}]}),Promise.resolve((0,l.Vp)(void 0))}};ne=te([(0,n.CommandHandler)(o.MarkBreachAsSeenCommand),re("design:paramtypes",[n.CqrsClient])],ne);var oe=r(61076);const ae=e=>"object"==typeof e,ie=e=>(e=>ae(e)&&"breachModelVersion"in e&&"number"==typeof e.breachModelVersion)(e)&&1===e.breachModelVersion&&"domains"in e&&Array.isArray(e.domains)&&"eventDate"in e&&"string"==typeof e.eventDate&&"id"in e&&"string"==typeof e.id,se=e=>{return ae(t=e)&&"kwType"in t&&"string"==typeof t.kwType&&"KWSecurityBreach"===t.kwType&&ie(e.Content);var t},ce=e=>(e=>{const t=e;return"impactedEmails"in t&&Array.isArray(t.impactedEmails)})(e)&&e.impactedEmails.length>0,ue=e=>se(e)&&ce(e.Content),le=({name:e,domains:t})=>{if(e)return e;if(t.length>0){const[e]=t;return e}return""},de=e=>ue(e)?"private":"public",pe=e=>[...e.reduce(((e,t)=>{const r=e.get(t.BreachId);return(!r||r.LastBackupTime&&t.LastBackupTime&&r.LastBackupTime<t.LastBackupTime)&&e.set(t.BreachId,t),e}),new Map).values()],fe=(e,t,r)=>{const n=pe(e.filter(se)).find((e=>e.Id===t));if(!n)throw new Error("Breach not found");return(0,l.Vp)(((e,t)=>{const r=e.Content,n=ue(e)?e.Content.impactedEmails:[],a=new Set;for(const r in t.credentialsHealth)t.credentialsHealth[r].credentialBreachIds.includes(e.BreachId)&&a.add(r);return{anonId:e.AnonId??"",breachId:e.BreachId,breachType:de(e),domains:r.domains,eventDate:r.eventDate,id:e.Id,impactedEmails:n,kwType:e.kwType??"KWSecurityBreach",leakedData:r.leakedData??[],leakedPasswords:e.LeakedPasswords??[],name:le(r),status:e.Status??o.BreachState.PENDING,compromisedCredentialIds:[...a]}})(n,r))},he=e=>void 0===e||"string"==typeof e,ye=e=>void 0===e||"number"==typeof e,me=e=>{if(!e||!Array.isArray(e))return!1;if(0===e.length)return!0;const t=e[0];return"string"==typeof t.Id&&ye(t.LastBackupTime)&&he(t.kwType)&&he(t.AnonId)&&he(t.BreachId)&&ye(t.ContentRevision)};var ge=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ve=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let be=class{constructor(e){this.client=e}execute({body:e}){const{id:t}=e,{queries:{carbonState:r}}=this.client.getClient(x.carbonLegacyApi),n=r({path:"userSession.health"}).pipe((0,b.Qn)((e=>{if(!(e=>{if("object"!=typeof e||null===e)return!1;const t=e;return!!t.breachedPasswords&&!!t.credentialsHealth&&!!t.similarPasswords})(e))throw new Error("Bad health format");return e})));return r({path:"userSession.personalData.securityBreaches"}).pipe((0,b.Qn)((e=>{if(!me(e))throw new Error("Bad Breaches format");return e})),(0,oe.V)(n),(0,a.U)((([e,r])=>{if((0,l.hx)(e)||(0,l.hx)(r))throw new Error("Error while fetching data");return fe(e.data,t,r.data)})))}};be=ge([(0,n.QueryHandler)(o.BreachQuery),ve("design:paramtypes",[n.CqrsClient])],be);var we=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Re=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Se=class{constructor(e){this.client=e}execute(){const{queries:{carbonState:e}}=this.client.getClient(x.carbonLegacyApi);return e({path:"userSession.personalData.securityBreaches"}).pipe((0,b.Qn)((e=>{if(!me(e))throw new Error("Bad Breaches format");return e})),(0,a.U)((e=>{if((0,l.hx)(e))throw new Error("Error while fetching data");const t=pe(e.data.filter(se)).filter((e=>e.Status===o.BreachState.PENDING&&ue(e)));return(0,l.Vp)({count:t.length})})))}};Se=we([(0,n.QueryHandler)(o.UnreadBreachesCountQuery),Re("design:paramtypes",[n.CqrsClient])],Se);var Ee=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Oe=class{};Oe=Ee([(0,n.Module)({api:o.breachesApi,handlers:{commands:{dismissBreach:ee,markBreachAsSeen:ne},events:{},queries:{breach:be,unreadBreachesCount:Se}}})],Oe);var Ce=r(24979),Pe=r(16530),Ae=r(28489);const je=e=>"object"==typeof e&&null!==e&&(0,Ae.l$)(e,"credentialsAtRisk")&&(0,Ae.l$)(e,"index")&&"object"==typeof e.credentialsAtRisk&&"object"==typeof e.index;class _e extends((0,n.defineStore)({persist:!0,storage:{initialValue:{credentialsAtRisk:{},index:{}},typeGuard:je,schemaVersion:1},scope:p.UseCaseScope.User,storeName:"password-health-state",storeTypeGuard:je,codec:f.Eu,isCache:!0})){}const Te=e=>{const t={};if(!Object.keys(e).length)return t;for(const r in e){if(!e[r])continue;const n=e[r]?.spaceId??"";void 0===t[n]&&(t[n]={[o.RiskType.Reused]:[],[o.RiskType.Weak]:[],[o.RiskType.Compromised]:[],[o.RiskType.Excluded]:[],corruptedCount:0,importantCorruptedCount:0}),e[r]?.excluded?t[n][o.RiskType.Excluded].push(r):(t[n].corruptedCount++,e[r]?.isImportant&&t[n].importantCorruptedCount++,e[r]?.risks.forEach((e=>t[n][e.riskType].push(r))))}return t};var Ie=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},xe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let De=class{constructor(e,t){this.store=e,this.client=t}async execute({body:e}){const{commands:{carbon:t}}=this.client.getClient(x.carbonLegacyApi);return await t({name:"updateCredential",args:[{id:e.credentialId,update:{isExcludedFromHealth:e.excluded}}]}),this.store.update((t=>{const r={...t.credentialsAtRisk[e.credentialId],excluded:e.excluded},n={...t};return n.credentialsAtRisk[e.credentialId]=r,n.index=Te(t.credentialsAtRisk),n})),Promise.resolve((0,l.Vp)(void 0))}};De=Ie([(0,n.CommandHandler)(o.UpdateIsCredentialExcludedCommand),xe("design:paramtypes",[_e,n.CqrsClient])],De);var Ue=r(7165);const Me=Ue.z.object({isOutdated:Ue.z.literal(!0),lastUpdateTimestamp:Ue.z.number(),updatedCredentialIds:Ue.z.record(Ue.z.string()),deletedCredentialIds:Ue.z.record(Ue.z.string()),hasUpdatedBreaches:Ue.z.boolean()}),Ne=Ue.z.object({isOutdated:Ue.z.literal(!1),lastUpdateTimestamp:Ue.z.number()}),ke=Ue.z.discriminatedUnion("isOutdated",[Me,Ne]),Le=e=>ke.safeParse(e).success;class Fe extends((0,n.defineStore)({persist:!0,storage:{initialValue:{isOutdated:!1,lastUpdateTimestamp:0},typeGuard:Le,schemaVersion:1},scope:p.UseCaseScope.User,storeName:"health-cache-state",storeTypeGuard:Le,codec:f.Eu,isCache:!0})){}var qe=r(64987);var Ve=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ge=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let He=class{constructor(e){this.client=e}getSupportedBreaches(){const{queries:{carbonState:e}}=this.client.getClient(x.carbonLegacyApi);return e({path:"userSession.personalData.securityBreaches"}).pipe((0,b.Qn)((e=>{if(!me(e))throw new Error("Bad Breaches format");return e})),(0,b.Qn)((e=>e.filter(se))))}get(){const{queries:{carbonState:e}}=this.client.getClient(x.carbonLegacyApi);return e({path:"userSession.personalData.securityBreaches"}).pipe((0,b.Qn)((e=>{if(!me(e))throw new Error("Bad Breaches format");return e})),(0,b.Qn)((e=>pe(e.filter(se)))))}};He=Ve([(0,n.Injectable)(),Ge("design:paramtypes",[n.CqrsClient])],He);var Be=r(92210);const Ke=e=>void 0===e||"string"==typeof e,We=e=>void 0===e||"string"==typeof e||"boolean"==typeof e;var ze=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},$e=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Qe=class{constructor(e){this.client=e}vaultBooleanFormatter(e,t=!1){return void 0===e?t:"string"==typeof e?"true"===e.toLocaleLowerCase():e}get(){const{queries:{carbonState:e}}=this.client.getClient(x.carbonLegacyApi),t=e({path:"state.userSession.spaceData.spaces"}).pipe((0,b.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.teamId&&"object"==typeof t.details&&"string"==typeof t.details.status}))))(e))throw new Error("Bad space item format");return new Set(e.filter((e=>"accepted"===e.details.status)).map((e=>e.teamId)))}))),r=e({path:"userSession.sharingData.items"}).pipe((0,b.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.content&&"string"==typeof t.itemId&&"number"==typeof t.timestamp}))))(e))throw new Error("Bad shared items format");return e.map((e=>e.itemId))})));return e({path:"state.userSession.personalData.credentials"}).pipe((0,b.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&We(t.AutoLogin)&&We(t.AutoProtected)&&Ke(t.Email)&&Ke(t.Login)&&Ke(t.OtpSecret)&&Ke(t.OtpUrl)&&Ke(t.Password)&&Ke(t.Title)&&Ke(t.Url)&&Ke(t.SpaceId)&&We(t.Checked)}))))(e))throw new Error("Bad credential format");return e})),(0,oe.V)(r,t),(0,a.U)((([e,t,r])=>{const n={};return(0,l.hx)(e)||(0,l.hx)(r)||e.data.forEach((e=>{const o=new Be.ParsedURL(e.Url).getRootDomain();var a;e.SpaceId&&""!==e.SpaceId&&!r.data.has(e.SpaceId)||(n[e.Id]={domains:o?[o]:[],autoLogin:this.vaultBooleanFormatter(e.AutoLogin),autoProtected:this.vaultBooleanFormatter(e.AutoProtected),email:e.Email??"",excluded:this.vaultBooleanFormatter(e.Checked),id:e.Id,login:e.Login??"",otpSecret:e.OtpSecret??"",otpUrl:e.OtpUrl??"",password:e.Password??"",spaceId:e.SpaceId??"",shared:(a=e.Id,!(0,l.hx)(t)&&t.data.includes(a)),title:e.Title??""})})),(0,l.Vp)(n)})))}};Qe=ze([(0,n.Injectable)(),$e("design:paramtypes",[n.CqrsClient])],Qe);var Ye=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Xe=class extends n.BaseEventEmitter{};Xe=Ye([(0,n.Injectable)()],Xe);const Je=e=>{const t=e.risks.filter((e=>e.riskType===o.RiskType.Reused));return 1===t.length?t[0]:void 0},Ze=(e,t)=>e?.risks.find((e=>e.riskType===t)),et=(e,t)=>e.risks.filter((e=>e.riskType!==t)),tt=(e,t,r)=>[...r,{riskType:o.RiskType.Reused,credentialIds:[...t.credentialIds].filter((t=>e!==t))}],rt=(e,t)=>{const r=Je(t);return{...t,risks:et(t,o.RiskType.Reused).concat([{riskType:o.RiskType.Reused,credentialIds:r?[...r.credentialIds].concat(e.id):[e.id]}])}},nt=e=>({id:e.id,title:e.title,email:e.email,excluded:e.excluded,login:e.login,autoLogin:e.autoLogin,autoProtected:e.autoProtected,otpSecret:e.otpSecret,otpUrl:e.otpUrl,spaceId:e.spaceId,shared:e.shared,domains:e.domains}),ot=e=>({...nt(e),risks:[],isImportant:!1}),at=(e,t,r)=>{const n=et(t,o.RiskType.Reused),a=r&&r.length>0,i=n.length>0;return a||i?{...ot(e),risks:a?n.concat([{riskType:o.RiskType.Reused,credentialIds:r}]):n}:void 0},it=e=>!!Ze(e,o.RiskType.Weak),st=e=>!!Je(e),ct=e=>!!Ze(e,o.RiskType.Compromised),ut=e=>e.excluded,lt=3,dt=5;function pt(e,t,r=lt,n=dt){if(!e||!t)return!1;const o=e.length,a=t.length;if(Math.abs(o-a)>r)return!1;if(o<n||a<n)return e===t;if(e===t)return!0;let i=new Array(a+1),s=new Array(a+1),c=!1;for(let e=0;e<a+1;e++)i[e]=e;for(let n=0;n<o;n++){s[0]=n+1,c=s[0]>r;for(let o=0;o<a;o++){const a=i[o+1]+1,u=s[o]+1;let l=i[o];e[n]!==t[o]&&l++,s[o+1]=Math.min(a,Math.min(u,l)),c=c&&s[o+1]>r}const o=i;if(i=s,s=o,c)break}return i[a]<=r}const ft=(e,t,r)=>{const n=((e,t)=>Object.keys(t).reduce(((r,n)=>pt(n,e.password)?[...r,...t[n]]:r),[]))(e,r);if(!t&&0===n.length)return{};const a=(e=>{if(0!==e.length)return{riskType:o.RiskType.Compromised,breaches:e}})(n),i=t?et(t,o.RiskType.Compromised):[],s={...ot(e),risks:a?i.concat(a):i};return{[e.id]:0===s.risks.length?void 0:s}},ht=(e,t,r)=>{if(!r)return Promise.resolve({});const n=t[e.id]??ot(e),a=n.risks.length>0,i=((e,t)=>Object.keys(t).map((e=>t[e])).filter((t=>t.id!==e.id&&pt(t.password,e.password))).map((e=>e.id)))(e,r);if(0===i.length&&!a)return Promise.resolve({});const s=Je(n)?.credentialIds??[],c=((e,t,r,n)=>{const a=r.filter((e=>!t.includes(e)));if(0===a.length)return{};const i={};for(const t of a){const r=n[t];if(!r)continue;const a=Je(r);if(!a)continue;const s=et(r,o.RiskType.Reused);1===a.credentialIds.length&&0===s.length?i[t]=void 0:i[t]={...r,risks:1===a.credentialIds.length?s:tt(e,a,s)}}return i})(e.id,i,s,t),u=((e,t,r,n,a)=>{const i=t.filter((e=>!r.includes(e)));if(0===i.length)return{};const s={};for(const t of i){const r=n[t];if(r)s[t]=rt(e,r);else{const r=a[t];s[t]={...ot(r),risks:[{riskType:o.RiskType.Reused,credentialIds:[e.id]}]}}}return s})(e,i,s,t,r),l=at(e,n,i);return Promise.resolve({...c,...u,[e.id]:l})};var yt=r(85465);const mt=async e=>{if(e)return await(async e=>(await(0,yt.evaluate)(e)).score)(e)/25},gt=async(e,t)=>{const r=await mt(e.password),n=t??ot(e),a=et(n,o.RiskType.Weak),i=void 0!==r&&r<2;return i||0!==a.length?{[e.id]:{...n,...nt(e),risks:i?a.concat([{riskType:o.RiskType.Weak,strength:r}]):a}}:{[e.id]:void 0}},vt=(e,t,r)=>{if(!t)return{};const n=e.domains.some((e=>r.has(e))),o={...t,isImportant:n};return{[t.id]:o}},bt=e=>{const t={};return Object.keys(e).forEach((r=>{const n=e[r];n&&(t[r]=n)})),t},wt=async({credentialUpdates:e,allCredentials:t,breaches:r,importantDomains:n,hasUpdatedBreaches:a,healthState:i,deletedCredentialIds:s})=>{const c=(e=>{const t={};return e.forEach((e=>{e.LeakedPasswords&&e.LeakedPasswords.forEach((r=>{Object.prototype.hasOwnProperty.call(t,r)?t[r].push({breachId:e.BreachId,date:e.Content.eventDate,domains:e.Content.domains}):t[r]=[{breachId:e.BreachId,date:e.Content.eventDate,domains:e.Content.domains}]}))})),t})(r),u=0===e.length&&0===s.length&&!a,l={...i?.credentialsAtRisk??{}},d=e=>Object.keys(e).forEach((t=>l[t]=e[t]));s.length>0&&d(((e=[])=>e.reduce(((e,t)=>({...e,[t]:void 0})),{}))(s));const p={},f={};for(const e of Object.keys(t))t[e].excluded?p[e]=ot(t[e]):f[e]=t[e];const h=[],y=[];for(const t of e)t.excluded?y.push(t):s.includes(t.id)||h.push(t);d(((e,t)=>{const r={};for(const n of Object.values(t)){if(!n)continue;const t=Je(n);if(!t)continue;const a=t.credentialIds.filter((t=>!e.includes(t)));if(a.length!==t.credentialIds.length){const e=et(n,o.RiskType.Reused);0===a.length&&0===e.length?r[n.id]=void 0:r[n.id]={...n,risks:0===a.length?e:[...e,{...t,credentialIds:a}]}}}return r})([...Object.values(y).map((e=>e.id)),...s],l)),u&&d((e=>{const t={};for(let r=0;r<e.length;r++){const n=e[r],a=n.password,i=n.id,s=[];for(let c=r+1;c<e.length;c++){const r=e[c].id,u=e[c].password,l=e[c];if(pt(a,u)){const e=t[r]??ot(l),a=Ze(e,o.RiskType.Reused),c=a?.credentialIds??[];t[r]=at(n,e,c.concat(i)),s.push(r)}}const c=t[i]??ot(n),u=Ze(c,o.RiskType.Reused),l=u?.credentialIds??[];t[i]=at(n,c,s.concat(l))}return t})(Object.values(f)));const m=u?Object.values(f):h;if(a)for await(const e of Object.values(f)){d(ft(e,l[e.id],c))}for await(const e of m){if(!a){d(ft(e,l[e.id],c))}if(!u){d(await ht(e,l,f))}d(await gt(e,l[e.id])),d(vt(e,l[e.id],n))}return d(p),{credentialsAtRisk:bt(l),index:Te(l)}};var Rt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},St=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Et=class extends n.JsonApplicationResourceLoader{constructor(e){super("assets/domains/importantDomains.json",e)}loadResource(e){if(!(t=e)||!Array.isArray(t))throw new Error("Important domains file corrupted");var t;return new Set(e)}};Et=Rt([(0,n.Injectable)(),St("design:paramtypes",[n.JsonApplicationResourceFetcher])],Et);var Ot=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ct=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Pt=class{constructor(e,t,r,n,o){this.store=e,this.credentialsGetter=t,this.breachesGetter=r,this.importantDomains=n,this.eventEmitter=o}async run({updatedCredentialIds:e,deletedCredentialIds:t,hasUpdatedBreaches:r=!1}){const n=await this.store.getState(),o=await(0,G.z)(this.credentialsGetter.get()),a=await(0,G.z)(this.breachesGetter.get()),i=await this.importantDomains.get();if((0,l.hx)(o)||(0,l.hx)(a))throw new Error("Failure getting vault data");const s=e?.length??0,c=t?.length??0,u=s>0||c>0||r,d=s+c<=50,p=u&&d?n:void 0,f=u?((e,t)=>e.reduce(((e,r)=>void 0===t[r]?e:[...e,t[r]]),[]))(e??[],o.data):[],h=await wt({hasUpdatedBreaches:r,credentialUpdates:d?f:[],allCredentials:o.data,breaches:a.data,importantDomains:i,healthState:p,deletedCredentialIds:d?[...t??[]]:[]});await this.store.set({...h}),this.eventEmitter.sendEvent("passwordHealthComputationFinished",null)}};Pt=Ot([(0,n.Injectable)(),Ct("design:paramtypes",[_e,Qe,He,Et,Xe])],Pt);var At=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},jt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const _t=new qe.WU;let Tt=class{constructor(e,t){this.store=e,this.passwordHealthCalculationService=t}update(e){_t.runExclusive((async()=>{const t=await this.store.getState();this.store.set(((e,t)=>{const{isOutdated:r}=t;if(!r)return{isOutdated:!1,lastUpdateTimestamp:e.lastUpdateTimestamp};const{updatedCredentialIds:n,deletedCredentialIds:o,hasUpdatedBreaches:a}=t,i=e.isOutdated?{...e}:{isOutdated:!0,lastUpdateTimestamp:e.lastUpdateTimestamp,updatedCredentialIds:{},deletedCredentialIds:{},hasUpdatedBreaches:!1};return n&&(i.updatedCredentialIds={...i.updatedCredentialIds,...n.reduce(((e,t)=>({...e,[t]:t})),{})}),o&&(i.deletedCredentialIds={...i.deletedCredentialIds,...o.reduce(((e,t)=>({...e,[t]:t})),{})}),a&&(i.hasUpdatedBreaches=a),i})(t,e))}))}async updateHealthState(){await _t.runExclusive((async()=>{const e=await this.store.getState();(e.isOutdated||0===e.lastUpdateTimestamp||e.lastUpdateTimestamp+864e5<Date.now())&&(await this.passwordHealthCalculationService.run(this.prepCacheStateProps(e)),await this.markAsUpToDate())}))}prepCacheStateProps(e){return e.isOutdated?{updatedCredentialIds:Object.keys(e.updatedCredentialIds),deletedCredentialIds:Object.keys(e.deletedCredentialIds),hasUpdatedBreaches:e.hasUpdatedBreaches}:{}}async markAsUpToDate(){await this.store.set({isOutdated:!1,lastUpdateTimestamp:(new Date).getTime()})}};Tt=At([(0,n.Injectable)(),jt("design:paramtypes",[Fe,Pt])],Tt);var It=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},xt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Dt=class{constructor(e){this.healthCacheUpdaterService=e}execute(){return this.healthCacheUpdaterService.update({isOutdated:!0}),Promise.resolve((0,l.Vp)(void 0))}};Dt=It([(0,n.CommandHandler)(o.RecalculatePasswordHealthCommand),xt("design:paramtypes",[Tt])],Dt);const Ut=(e,t)=>{const r=((e,t)=>{if(0!==t.length)switch(e){case o.HealthFilter.All:{const e={[o.RiskType.Compromised]:3,[o.RiskType.Weak]:2,[o.RiskType.Reused]:1,[o.RiskType.Excluded]:0};return t.reduce(((t,r)=>t?e[r.riskType]>e[t.riskType]?r:t:r),void 0)}case o.HealthFilter.Compromised:return t.find((e=>e.riskType===o.RiskType.Compromised));case o.HealthFilter.Weak:return t.find((e=>e.riskType===o.RiskType.Weak));case o.HealthFilter.Reused:return t.find((e=>e.riskType===o.RiskType.Reused));default:return}})(e,t);if(!r)return;const n={severity:o.CorruptionDataSeverity.COMMON};switch(r.riskType){case o.RiskType.Compromised:{const e=[...r.breaches].sort(((e,t)=>{const r=Date.parse(e.date),n=Date.parse(t.date);return r===n?0:r<n?1:-1}))[0];return{...n,riskType:o.RiskType.Compromised,date:e.date,domain:e.domains[0]??null,severity:o.CorruptionDataSeverity.STRONG}}case o.RiskType.Weak:return{...n,riskType:o.RiskType.Weak,strength:r.strength>=1?o.CorruptionDataStrength.WEAK:o.CorruptionDataStrength.EXTREMELY_WEAK};case o.RiskType.Reused:return{...n,riskType:o.RiskType.Reused,reuseCount:r.credentialIds.length}}};var Mt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Nt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let kt=class{constructor(e,t,r){this.store=e,this.cacheStore=t,this.healthCacheUpdater=r,this.state$=this.cacheStore.state$.pipe((0,oe.V)(this.store.state$),(0,H.b)((()=>{this.healthCacheUpdater.updateHealthState()})),(0,a.U)((([e,t])=>t)))}};kt=Mt([(0,n.Injectable)(),Nt("design:paramtypes",[_e,Fe,Tt])],kt);var Lt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ft=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let qt=class{constructor(e){this.store=e}execute({body:e}){const{credentialId:t}=e;return this.store.state$.pipe((0,a.U)((e=>e.credentialsAtRisk[t]?(0,l.Vp)((e=>{const{excluded:t,risks:r}=e;return{excluded:t,corruptionData:Ut(o.HealthFilter.All,r)}})(e.credentialsAtRisk[t])):(0,l.Vp)(null))))}};qt=Lt([(0,n.QueryHandler)(o.CredentialHealthDataQuery),Ft("design:paramtypes",[kt])],qt);const Vt=5,Gt=.6,Ht=1,Bt=1,Kt=.2;function Wt(e,t,r){if(r<Vt)return null;const n=Gt*Math.pow(1-t/r,Ht),o=(1-Gt)*Math.pow(1-e/r,Bt);return Kt+(1-Kt)*(n+o)}const zt=e=>null===e?null:Math.round(100*e),$t=(e,t)=>({total:t,compromised:e.compromised.length,reused:e.reused.length,weak:e.weak.length,score:zt(Wt(e.corruptedCount,e.importantCorruptedCount,t-e.excluded.length))}),Qt=(e,t)=>{const{compromised:r,reused:n,weak:o,corruptedCount:a,excludedCount:i,importantCorruptedCount:s}=Object.keys(e).reduce(((t,r)=>({compromised:t.compromised+e[r].compromised.length,reused:t.reused+e[r].reused.length,weak:t.weak+e[r].weak.length,corruptedCount:t.corruptedCount+e[r].corruptedCount,importantCorruptedCount:t.importantCorruptedCount+e[r].importantCorruptedCount,excludedCount:t.excludedCount+e[r].excluded.length})),{compromised:0,reused:0,weak:0,corruptedCount:0,importantCorruptedCount:0,excludedCount:0}),c=Wt(a,s,t-i);return{compromised:r,reused:n,total:t,weak:o,score:zt(c)}};function Yt(e,t){return(0,l.hx)(e)?0:Object.keys(e.data).filter((r=>e.data[r].spaceId===t)).length}var Xt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Jt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Zt=class{constructor(e,t,r){this.cacheStateStore=e,this.credentialsGetter=t,this.store=r}execute({body:e}){const{spaceId:t=null}=e;return this.store.state$.pipe((0,oe.V)(this.credentialsGetter.get(),this.cacheStateStore.state$),(0,a.U)((([e,r,n])=>{if(t&&void 0===e.index[t]){const e=Yt(r,t);return(0,l.Vp)({counters:{compromised:0,reused:0,score:100,total:e,weak:0},isInitialized:n.lastUpdateTimestamp>0})}if(null===t){const t=(0,l.hx)(r)?0:Object.keys(r.data).length;return(0,l.Vp)({counters:Qt(e.index,t),isInitialized:n.lastUpdateTimestamp>0})}const o=Yt(r,t);return(0,l.Vp)({counters:$t(e.index[t],o),isInitialized:n.lastUpdateTimestamp>0})})))}};Zt=Xt([(0,n.QueryHandler)(o.ScoreQuery),Jt("design:paramtypes",[Fe,Qe,kt])],Zt);const er=(e,t)=>{const{id:r,title:n,login:o,email:a,autoProtected:i,shared:s,excluded:c,domains:u,risks:l}=e;return{id:r,title:n,login:o,email:a,autoProtected:i,shared:s,excluded:c,domainIcon:void 0,corruptionData:Ut(t,l),domain:u[0]}},tr=(e,t)=>t===o.HealthFilter.All?[...new Set([...e[o.RiskType.Compromised],...e[o.RiskType.Reused],...e[o.RiskType.Weak],...e[o.RiskType.Excluded]])]:e[t],rr={[o.RiskType.Compromised]:1,[o.RiskType.Reused]:2,[o.RiskType.Weak]:3,[o.RiskType.Excluded]:4},nr=e=>[...e].sort(((e,t)=>{const r=rr[e.corruptionData?.riskType??o.RiskType.Excluded],n=rr[t.corruptionData?.riskType??o.RiskType.Excluded];if(r===n){const r=((e,t)=>e?.riskType===o.RiskType.Compromised&&t?.riskType===o.RiskType.Compromised?Date.parse(t.date)-Date.parse(e.date):e?.riskType===o.RiskType.Reused&&t?.riskType===o.RiskType.Reused?t.reuseCount-e.reuseCount:e?.riskType===o.RiskType.Weak&&t?.riskType===o.RiskType.Weak?e.strength===t.strength?0:e.strength===o.CorruptionDataStrength.WEAK?1:-1:0)(e.corruptionData,t.corruptionData);return 0!==r?r:e.title.localeCompare(t.title)}return r-n}));var or=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ar=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ir=class{constructor(e){this.store=e}execute({body:e}){const{healthFilter:t,spaceId:r}=e;return this.store.state$.pipe((0,a.U)((e=>r&&void 0===e.index[r]?(0,l.Vp)([]):(0,l.Vp)(nr(((e,t,r,n)=>{let a;if(null!==e)a=tr(t[e],r);else{if(r===o.HealthFilter.All)return Object.values(n).map((e=>er(e,r)));a=Object.keys(t).reduce(((e,n)=>[...e,...tr(t[n],r)]),[])}return a.map((e=>er(n[e],r)))})(r,e.index,t||o.HealthFilter.All,e.credentialsAtRisk))))))}};ir=or([(0,n.QueryHandler)(o.FilterCredentialsQuery),ar("design:paramtypes",[kt])],ir);var sr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},cr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ur=class{constructor(e){this.store=e}execute({body:e}){const{credentialIds:t}=e;return this.store.state$.pipe((0,a.U)((e=>(0,l.Vp)(((e,t)=>Object.keys(e).reduce(((t,r)=>[...t,...e[r].compromised]),[]).filter((e=>t.includes(e))))(e.index,t)))))}};function lr(e){const t={};return Object.keys(e).forEach((r=>{const n=e[r].spaceId;void 0===t[n]?t[n]=1:t[n]++})),t}ur=sr([(0,n.QueryHandler)(o.CompromisedCredentialsQuery),cr("design:paramtypes",[kt])],ur);var dr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},pr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let fr=class{constructor(e,t){this.store=e,this.credentialsGetter=t}execute(){return this.store.state$.pipe((0,oe.V)(this.credentialsGetter.get()),(0,a.U)((([e,t])=>{const r={};if(!(0,l.d6)(t))throw new Error("Error while retrieving credentials");const n=lr(t.data),a=Object.keys(t.data).length,i=function(e){const t={};return Object.keys(e).forEach((r=>{const n=Ze(e[r],o.RiskType.Compromised),a=e[r].spaceId;if(void 0===n)return;void 0===t[a]&&(t[a]={breaches:new Set,compromisedByBreaches:{}});const i=n.breaches.map((e=>e.breachId));t[a].breaches=new Set([...t[a].breaches,...i]),t[a].compromisedByBreaches[r]=new Set(i)})),t}(e.credentialsAtRisk);let s=new Set([]),c={},u=0,d=0;return Object.keys(e.index).forEach((t=>{const o=e.index[t],a=$t(o,n[t]);r[t]={...a,breaches:i[t]?.breaches??new Set,compromisedByBreach:i[t]?.compromisedByBreaches??{},corrupted:o.corruptedCount,excluded:o.excluded.length},s=new Set([...s,...i[t]?.breaches??new Set]),c={...c,...i[t]?.compromisedByBreaches??{}},u+=o.corruptedCount,d+=o.excluded.length})),r.global={...Qt(e.index,a),breaches:s,compromisedByBreach:c,corrupted:u,excluded:d},(0,l.Vp)(r)})))}};fr=dr([(0,n.QueryHandler)(o.PasswordHealthReportQuery),pr("design:paramtypes",[_e,Qe])],fr);const hr=e=>!(!e||"object"!=typeof e)&&((0,Ae.l$)(e,"lastSentDate")&&"number"==typeof e.lastSentDate);class yr extends((0,n.defineStore)({persist:!0,storage:{initialValue:{lastSentDate:0},typeGuard:hr,schemaVersion:1},scope:p.UseCaseScope.User,storeName:"user-activity-state",storeTypeGuard:hr,codec:f.Eu,capacity:n.StoreCapacity._001KB})){}var mr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},gr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let vr=class{constructor(e,t){this.client=e,this.healthCacheUpdater=t}async run(){await this.healthCacheUpdater.updateHealthState()}async hasPHMV3FFEnabled(){const e="ims_web_ph_mv3_dev",t="ims_web_ph_mv3_prod",{userFeatureFlips:r}=this.client.getClient(p.requestContextApi).queries,n=await(0,G.z)(r({requiredFeatureFlips:[e,t]}));return(0,l.d6)(n)&&(n.data[e]||n.data[t])}async isRunnable(){return await this.hasPHMV3FFEnabled()}};vr=mr([(0,n.Injectable)(),gr("design:paramtypes",[n.CqrsClient,Tt])],vr);var br=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},wr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const Rr=e=>Math.floor(e/1e3);let Sr=class{constructor(e,t,r,n,o){this.serverApiClient=e,this.userActivityStore=t,this.credentialsGetter=r,this.client=n,this.store=o}async send(){const e=await this.store.getState(),t=await this.userActivityStore.getState(),r=await(0,G.z)(this.credentialsGetter.get()),n=Date.now(),o=Rr(n),a=Rr(t.lastSentDate||n);if(!(0,l.d6)(r))return Promise.reject(new Error("Error while retrieving credentials"));const i=lr(r.data),s=function(e,t){const r={};return Object.keys(e).forEach((n=>{const o=t[n]||0,a=e[n];r[n]={checkedPasswords:a.excluded.length,compromisedPasswords:a.compromised.length,nbrPasswords:o,reused:a.reused.length,safePasswords:o-a.corruptedCount,securityIndex:zt(Wt(a.corruptedCount,a.importantCorruptedCount,o-a.excluded.length))??void 0,weakPasswords:a.weak.length}})),r}(e.index,i),c=Object.keys(s).find((e=>""!==e));return await(0,G.z)(this.serverApiClient.v1.useractivity.create({userActivity:{securityIndex:0},teamActivity:c?{teamId:parseInt(c,10),activity:s[c]}:void 0,relativeEnd:o,relativeStart:a})),this.userActivityStore.set({lastSentDate:n}),Promise.resolve()}async shouldBeSent(){return(await(0,G.z)(this.userActivityStore.state$)).lastSentDate+864e5<Date.now()}};Sr=br([(0,n.Injectable)(),wr("design:paramtypes",[w.lX,yr,Qe,n.CqrsClient,_e])],Sr);var Er=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Or=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Cr=class{constructor(e){this.userActivitySender=e}async handle(){await this.userActivitySender.shouldBeSent()&&this.userActivitySender.send()}};Cr=Er([(0,n.EventHandler)(o.PasswordHealthComputationFinishedEvent),Or("design:paramtypes",[Sr])],Cr);var Pr=r(11494);var Ar=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},jr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let _r=class{constructor(e,t){this.store=e,this.cqrsClient=t}async handle({body:e}){const{credentialId:t}=e,{commands:{trackEvent:r}}=this.cqrsClient.getClient(w.Yu),n=(e=>({is_excluded:!!e&&ut(e),is_weak:!!e&&it(e),is_reused:!!e&&st(e),is_compromised:!!e&&ct(e)}))((await(0,G.z)(this.store.state$)).credentialsAtRisk[t]);return r({event:new Pr.UserCredentialHealthReportEvent({credentialSecurityStatus:n,itemId:t})}),Promise.resolve(void 0)}};_r=Ar([(0,n.EventHandler)(Ce.PasswordAutofillPerformedEvent),jr("design:paramtypes",[kt,n.CqrsClient])],_r);var Tr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ir=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let xr=class{constructor(e){this.healthCacheUpdater=e}handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===Pe.VaultItemType.Credential&&this.healthCacheUpdater.update({isOutdated:!0,updatedCredentialIds:t}),Promise.resolve(void 0)}};xr=Tr([(0,n.EventHandler)(Pe.UpdatedEvent),Ir("design:paramtypes",[Tt])],xr);var Dr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ur=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Mr=class{constructor(e){this.healthCacheUpdater=e}handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===Pe.VaultItemType.Credential&&this.healthCacheUpdater.update({isOutdated:!0,updatedCredentialIds:t}),Promise.resolve(void 0)}};Mr=Dr([(0,n.EventHandler)(Pe.CreatedEvent),Ur("design:paramtypes",[Tt])],Mr);var Nr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},kr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Lr=class{constructor(e){this.healthCacheUpdater=e}handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===Pe.VaultItemType.Credential&&this.healthCacheUpdater.update({isOutdated:!0,deletedCredentialIds:t}),Promise.resolve(void 0)}};Lr=Nr([(0,n.EventHandler)(Pe.DeletedEvent),kr("design:paramtypes",[Tt])],Lr);var Fr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let qr=class{};qr=Fr([(0,n.Module)({api:o.passwordHealthApi,crons:[{handler:vr,name:"health-cache",periodInMinutes:15,scope:p.UseCaseScope.User}],handlers:{commands:{updateIsCredentialExcluded:De,recalculatePasswordHealth:Dt},events:{...(0,n.useEventsOfModule)(o.passwordHealthApi,{passwordHealthComputationFinished:Cr}),...(0,n.useEventsOfModule)(Ce.autofillTrackingApi,{passwordAutofillPerformed:_r}),...(0,n.useEventsOfModule)(Pe.vaultItemsCrudApi,{updated:xr,created:Mr,deleted:Lr})},queries:{credentialHealthData:qt,score:Zt,filterCredentials:ir,compromisedCredentials:ur,passwordHealthReport:fr}},imports:[w.nr],stores:[_e,yr,Fe],providers:[Qe,He,Et,Pt,Tt,vr,Xe,Sr,kt]})],qr);const Vr=Ue.z.object({Id:Ue.z.string(),VaultItems:Ue.z.array(Ue.z.object({Id:Ue.z.string()}))}),Gr=Ue.z.array(Vr);var Hr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Br=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Kr=class{constructor(e){this.client=e}get(){const{queries:{carbonState:e}}=this.client.getClient(x.carbonLegacyApi);return e({path:"userSession.personalData.collections"}).pipe((0,b.Qn)((e=>{if(!(e=>Gr.safeParse(e).success)(e))throw new Error("Collection array has a wrong format");return e})))}};Kr=Hr([(0,n.Injectable)(),Br("design:paramtypes",[n.CqrsClient])],Kr);const Wr=e=>!(!e||"object"!=typeof e)&&((0,Ae.l$)(e,"lastSentDate")&&"number"==typeof e.lastSentDate);class zr extends((0,n.defineStore)({codec:f.Eu,persist:!0,storage:{initialValue:{lastSentDate:0},schemaVersion:1,typeGuard:Wr},scope:p.UseCaseScope.User,storeName:"vault-report",storeTypeGuard:Wr,capacity:n.StoreCapacity._001KB})){}const $r={collections_count:-1,collections_shared_count:-1,multiple_collections_count:-1,multiple_collections_shared_count:-1,single_collection_count:-1,single_collection_shared_count:-1,shared_count:-1,total_count:-1};function Qr(e){if(0===e.length)return 0;const t=e.flatMap((e=>e.VaultItems)),r=new Set(t.map((e=>e.Id))).size;return Math.round(t.length/r)}function Yr(e){if(0===e.length)return 0;let t=0,r=0;for(const n of e)n.VaultItems.length>0&&(r+=n.VaultItems.length,t++);return Math.round(r/t)}function Xr(e,t){let r=0,n=0;const o=e.map((e=>e.VaultItems)).reduce(((e,t)=>(t.forEach((t=>{const r=t.Id;e[r]?e[r]+=1:e[r]=1})),e)),{});return Object.values(o).forEach((e=>{e>1?r++:n++})),{collections_count:e.length,collections_shared_count:-1,multiple_collections_count:r,multiple_collections_shared_count:-1,single_collection_count:-1,single_collection_shared_count:n,shared_count:-1,total_count:t}}function Jr(e,t){return{itemsTotalCount:-1,itemsSharedCount:-1,collectionsTotalCount:e.length,collectionsSharedCount:-1,itemsPerCollectionAverageCount:Yr(e),collectionsPerItemAverageCount:Qr(e),ids:$r,passwords:Xr(e,t),payments:$r,personalInfo:$r,secureNotes:$r}}var Zr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},en=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let tn=class{constructor(e,t,r,n,o,a){this.breachesGetter=e,this.credentialGetter=t,this.vaultCollectionGetter=r,this.client=n,this.store=o,this.cqrsClient=a}getSpaceScope(e){switch(e){case"":return Pr.Scope.Personal;case"global":return Pr.Scope.Global;default:return Pr.Scope.Team}}async send(){const{queries:e}=this.client.getClient(o.passwordHealthApi),t=await(0,G.z)(e.passwordHealthReport()),r=await(0,G.z)(this.credentialGetter.get()),n=await(0,G.z)(this.vaultCollectionGetter.get()),a=await(0,G.z)(this.breachesGetter.getSupportedBreaches()),{commands:{trackEvent:i}}=this.cqrsClient.getClient(w.Yu);if(!((0,l.d6)(r)&&(0,l.d6)(a)&&(0,l.d6)(t)&&(0,l.d6)(n)))return Promise.reject(new Error("Error while retrieving credentials/breaches/health/collections"));const s=function(e){const t={global:{domainsWithoutAutofill:0,nbrPasswords:0,passwordsWithOtpCount:0,protectedPasswords:0}};return Object.keys(e).forEach((r=>{const n=e[r].spaceId;void 0===t[n]&&(t[n]={domainsWithoutAutofill:0,nbrPasswords:0,passwordsWithOtpCount:0,protectedPasswords:0}),t[n].nbrPasswords++,t.global.nbrPasswords++,e[r].autoLogin||(t[n].domainsWithoutAutofill++,t.global.domainsWithoutAutofill++),(e[r].otpSecret||e[r].otpUrl)&&(t[n].passwordsWithOtpCount++,t.global.passwordsWithOtpCount++),e[r].autoProtected&&(t[n].protectedPasswords++,t.global.protectedPasswords++)})),t}(r.data),c=function(e,t){const r=new Set,n=new Set;e.forEach((e=>{ce(e.Content)?n.add(e.BreachId):r.add(e.BreachId)}));const o=new Set,a=new Set,i={global:{activePrivateBreachAlerts:0,activePublicBreachAlerts:0,passwordsCompromisedThroughPrivateBreaches:0,privateBreachAlerts:n.size,publicBreachAlerts:r.size}};return Object.keys(t).forEach((e=>{if("global"===e)return;const s=t[e];void 0===i[e]&&(i[e]={activePrivateBreachAlerts:0,activePublicBreachAlerts:0,passwordsCompromisedThroughPrivateBreaches:0,privateBreachAlerts:n.size,publicBreachAlerts:r.size}),[...s.breaches].forEach((t=>{r.has(t)?(i[e].activePublicBreachAlerts++,o.add(t)):n.has(t)&&(i[e].activePrivateBreachAlerts++,a.add(t))})),Object.keys(s.compromisedByBreach).forEach((t=>{[...s.compromisedByBreach[t]].some((e=>n.has(e)))&&i[e].passwordsCompromisedThroughPrivateBreaches++})),i.global.passwordsCompromisedThroughPrivateBreaches+=i[e].passwordsCompromisedThroughPrivateBreaches})),i.global.activePrivateBreachAlerts=a.size,i.global.activePublicBreachAlerts=o.size,i}(a.data,t.data);return Object.keys(s).forEach((e=>{const r=t.data[e],o={scope:this.getSpaceScope(e),...Jr(n.data,s[e].nbrPasswords),...s[e],...c[e],passwordsSafeCount:s[e].nbrPasswords-r.corrupted,passwordsExcludedCount:r.excluded,passwordsCompromisedCount:r.compromised,passwordsReusedCount:r.reused,securityScore:r.score??void 0,passwordsWeakCount:r.weak};i({event:new Pr.UserVaultReportEvent(o)})})),this.store.set({lastSentDate:Date.now()}),Promise.resolve()}async shouldBeSent(){return(await(0,G.z)(this.store.state$)).lastSentDate+864e5<Date.now()}};tn=Zr([(0,n.Injectable)(),en("design:paramtypes",[He,Qe,Kr,n.CqrsClient,zr,n.CqrsClient])],tn);var rn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},nn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let on=class{constructor(e){this.vaultReportSender=e}async handle(){await this.vaultReportSender.shouldBeSent()&&this.vaultReportSender.send()}};on=rn([(0,n.EventHandler)(o.PasswordHealthComputationFinishedEvent),nn("design:paramtypes",[tn])],on);var an=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let sn=class{};sn=an([(0,n.Module)({api:o.vaultReportApi,handlers:{commands:{},events:{...(0,n.useEventsOfModule)(o.passwordHealthApi,{passwordHealthComputationFinished:on})},queries:{}},providers:[He,Qe,tn,Kr],stores:[zr]})],sn);const cn=Ue.z.object({autoredirection:Ue.z.record(Ue.z.boolean())}),un=e=>cn.safeParse(e).success;class ln extends((0,n.defineStore)({persist:!0,storage:{initialValue:{autoredirection:{}},typeGuard:un,schemaVersion:1},scope:p.UseCaseScope.Device,storeName:"antiphishing",codec:f.Eu,capacity:n.StoreCapacity._001KB})){}var dn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},pn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let fn=class{constructor(e){this.antiphishingStore=e}execute({body:e}){return this.antiphishingStore.state$.pipe((0,a.U)((t=>(0,l.Vp)(!!e.domain&&!!t.autoredirection[e.domain]))))}};fn=dn([(0,n.QueryHandler)(o.IsAutoRedirectedDomainQuery),pn("design:paramtypes",[ln])],fn);var hn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},yn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let mn=class{constructor(e){this.antiphishingStore=e}async execute({body:e}){const{domain:t}=e;if(t){const e=await this.antiphishingStore.getState();await this.antiphishingStore.set({...e,autoredirection:{...e.autoredirection,[t]:!0}})}return Promise.resolve((0,l.Vp)(void 0))}};mn=hn([(0,n.CommandHandler)(o.AddAutoRedirectedDomainCommand),yn("design:paramtypes",[ln])],mn);var gn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let vn=class{};vn=gn([(0,n.Module)({api:o.antiphishingApi,handlers:{commands:{addAutoRedirectedDomain:mn},events:{},queries:{isAutoRedirectedDomain:fn}},stores:[ln]})],vn);var bn=r(30523);const wn=e=>void 0===e||"string"==typeof e;var Rn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Sn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let En=class{constructor(e){this.client=e}getById(e){const{queries:{carbonState:t}}=this.client.getClient(x.carbonLegacyApi);return t({path:"state.userSession.personalData.credentials"}).pipe((0,b.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&wn(t.OtpSecret)&&wn(t.OtpUrl)}))))(e))throw new Error("Bad credential format");return e})),(0,a.U)((t=>{if((0,l.hx)(t))return(0,l.Vp)(null);const r=t.data.reduce(((t,r)=>r.Id===e?{Id:r.Id,OtpSecret:r.OtpSecret,OtpUrl:r.OtpUrl}:t),null);return(0,l.Vp)(r)})))}};var On;En=Rn([(0,n.Injectable)(),Sn("design:paramtypes",[n.CqrsClient])],En),function(e){e.SHA1="SHA-1",e.SHA256="SHA-256",e.SHA384="SHA-384",e.SHA512="SHA-512"}(On||(On={}));const Cn=["totp","hotp"],Pn=e=>{const t=new URL(e),r=(e=>{const t=e.hostname?e.hostname:/\/\/([th]otp)\//.exec(e.pathname)?.[1]??"";return Cn.includes(t)?t:null})(t),n=t.searchParams.get("secret")?.toUpperCase();if(!r||!n)throw new Error("Corrupted OTP url");const o=t.searchParams.get("digits"),a=t.searchParams.get("counter"),i=t.searchParams.get("period"),s=t.searchParams.get("algorithm");return{secret:n,algorithm:s?On[s]:On.SHA1,counter:a?Number.parseInt(a,10):0,digits:o?Number.parseInt(o,10):6,period:i?Number.parseInt(i,10):30}},An=e=>{const{OtpSecret:t,OtpUrl:r}=e;if(!t&&!r)throw new Error("Otp config missing for this credential");return r?Pn(r):{secret:(t??"").toUpperCase(),algorithm:On.SHA1,counter:0,digits:6,period:30}},jn="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split("").reduce(((e,t,r)=>({...e,[t]:r})),{}),_n=e=>{const t=jn[e];if(void 0===t)throw new Error("Invalid character found: "+e);return t},Tn=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9],In=async(e,t,r)=>{const n=(e=>{const t=new Uint8Array(e),r=15&t[t.length-1],n=t.slice(r,r+4).reduce(((e,t)=>e.concat(t.toString(16).toString().padStart(2,"0"))),"");return 2147483647&Number.parseInt(n,16)})(await e((e=>{const t=new ArrayBuffer(8);return new DataView(t).setBigUint64(0,BigInt(e)),t})(t)));return(n%(r<=9?Tn[r]:Math.pow(10,r))).toString().padStart(r,"0")};class xn{constructor(e,t){this.signer=e,this.getStep=t}async computeOtpCode({counter:e,digits:t,period:r}){const n=this.getStep(e,r);try{return await In(this.signer,n,t)}catch(e){return""}}}class Dn{constructor(e){this.hmacSigner=e}createCodeGenerator({secret:e,algorithm:t}){try{const r=(e=>{const t=e.replaceAll("=","").trim().length;let r=0,n=0,o=0;const a=new Uint8Array(5*t/8|0);for(let i=0;i<t;i++)n=n<<5|_n(e[i]),r+=5,r>=8&&(a[o++]=n>>>r-8&255,r-=8);return a.buffer})(e);return new xn((e=>this.hmacSigner.sign(r,e,t)),this.getStep)}catch(e){return null}}getNextOtpRefreshTimestamp(e,t){if(e){const e=1e3*t,r=Math.floor(Date.now()/e)*e;return new Date(r+e).getTime()}throw new Error("Not supported for non time based OTP type")}}var Un=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Mn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Nn=class extends Dn{constructor(e){super(e)}getStep(e,t){return((e,t)=>Math.floor(e/t))(e||(new Date).getTime(),1e3*t)}};Nn=Un([(0,n.Injectable)(),Mn("design:paramtypes",[w.qn])],Nn);var kn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ln=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Fn=class{constructor(e,t){this.credentialOTPGetter=e,this.otpGeneratorService=t}async withGeneratedCodeAndValidity(e,t){const r=await(t?.computeOtpCode(e))??"",n=this.otpGeneratorService.getNextOtpRefreshTimestamp(!0,e.period);return(0,l.Vp)({code:r,validityEndDate:n,validityTime:1e3*e.period})}withCodeGenerator(e){return{codeGenerator:this.otpGeneratorService.createCodeGenerator(e),params:e}}execute({body:e}){const{credentialId:t}=e;return this.credentialOTPGetter.getById(t).pipe((0,a.U)((e=>{if((0,l.hx)(e)||!e.data)throw new Error("Credential not found");return e.data})),(0,a.U)((e=>{if(!e.OtpUrl&&!e.OtpSecret)return{params:null,codeGenerator:null};const t=An(e);return this.withCodeGenerator(t)})),(0,s.w)((({params:e,codeGenerator:t})=>null===e||null===t?(0,u.of)((0,l.Rn)(new o.OtpCodeGenerationError)):(0,c.H)(0,1e3).pipe((0,bn.h)((t=>{if(0===t)return!0;return((e,t)=>e-Date.now()>=1e3*t-1e3)(this.otpGeneratorService.getNextOtpRefreshTimestamp(!0,e.period),e.period)})),(0,s.w)((()=>this.withGeneratedCodeAndValidity(e,t)))))))}};Fn=kn([(0,n.QueryHandler)(o.OtpCodeQuery),Ln("design:paramtypes",[En,Nn])],Fn);var qn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Vn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Gn=class extends Dn{constructor(e){super(e)}getStep(e,t){return e}};Gn=qn([(0,n.Injectable)(),Vn("design:paramtypes",[w.qn])],Gn);var Hn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Bn=class{};Bn=Hn([(0,n.Module)({sharedModuleName:"otp-generator",providers:[Nn,Gn],exports:[Nn,Gn],imports:[w.Dq]})],Bn);var Kn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Wn=class{};Wn=Kn([(0,n.Module)({api:o.otpApi,handlers:{commands:{},events:{},queries:{otpCode:Fn}},imports:[Bn],providers:[En]})],Wn);const zn=Ue.z.object({isMasterPasswordLeaked:Ue.z.boolean(),isMasterPasswordLeakedNotificationDismissed:Ue.z.boolean(),isMasterPasswordWeak:Ue.z.boolean(),lastCheckTimestamp:Ue.z.number()}),$n=e=>zn.safeParse(e).success;class Qn extends((0,n.defineStore)({persist:!0,storage:{initialValue:{isMasterPasswordWeak:!1,isMasterPasswordLeaked:!1,isMasterPasswordLeakedNotificationDismissed:!1,lastCheckTimestamp:0},typeGuard:$n,schemaVersion:1},scope:p.UseCaseScope.User,isCache:!0,storeName:"master-password-security",codec:f.Eu,capacity:n.StoreCapacity._001KB})){}var Yn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Xn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Jn=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,a.U)((e=>(0,l.Vp)(e.isMasterPasswordLeaked))))}};Jn=Yn([(0,n.QueryHandler)(o.IsMasterPasswordLeakedQuery),Xn("design:paramtypes",[Qn])],Jn);var Zn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},eo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let to=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,a.U)((e=>(0,l.Vp)(e.isMasterPasswordLeakedNotificationDismissed))))}};to=Zn([(0,n.QueryHandler)(o.IsMasterPasswordLeakedNotificationDismissedQuery),eo("design:paramtypes",[Qn])],to);var ro=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},no=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let oo=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,a.U)((e=>(0,l.Vp)(e.isMasterPasswordWeak))))}};oo=ro([(0,n.QueryHandler)(o.IsMasterPasswordWeakQuery),no("design:paramtypes",[Qn])],oo);var ao=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},io=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let so=class{constructor(e){this.masterPasswordSecurityStore=e}async execute(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordLeakedNotificationDismissed:!0}),Promise.resolve((0,l.Vp)(void 0))}};so=ao([(0,n.CommandHandler)(o.DismissMasterPasswordLeakedNotificationCommand),io("design:paramtypes",[Qn])],so);var co=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},uo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let lo=class{constructor(e){this.argon2dDeriver=e}async hash(e){return(0,T.k)(await this.argon2dDeriver.derive((0,I.u)(e),(0,I.u)("z8CXohryCcGAa7CESNHYnedqbDyp"),{tCost:3,mCost:32768,parallelism:2}))}};lo=co([(0,n.Injectable)(),uo("design:paramtypes",[w.yQ])],lo);var po=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},fo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ho=class{constructor(e,t,r){this.serverApiClient=e,this.masterPasswordSecurityStore=t,this.passwordHasher=r}shouldBeChecked(){return(0,G.z)(this.masterPasswordSecurityStore.state$.pipe((0,a.U)((e=>!e.isMasterPasswordLeaked&&e.lastCheckTimestamp+864e5<=Date.now()))))}async check(e){const t=await this.passwordHasher.hash(e),r=await(0,G.z)(this.serverApiClient.v1.pwleak.getHashes({hashPrefix:t.substring(0,6)}));if((0,l.hx)(r))throw new Error("Error while retrieving list of hashes for MP checking");const n=r.data.data.includes(t),o=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...o,isMasterPasswordLeaked:n,isMasterPasswordLeakedNotificationDismissed:!1,lastCheckTimestamp:Date.now()})}};ho=po([(0,n.Injectable)(),fo("design:paramtypes",[w.lX,Qn,lo])],ho);var yo=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},mo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let go=class{constructor(e){this.masterPasswordSecurityStore=e}async reset(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordLeakedNotificationDismissed:!1})}};go=yo([(0,n.Injectable)(),mo("design:paramtypes",[Qn])],go);var vo=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},bo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let wo=class{constructor(e){this.masterPasswordSecurityStore=e}async check(e){const t=(await mt(e)??5)<3,r=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...r,isMasterPasswordWeak:t})}};wo=vo([(0,n.Injectable)(),bo("design:paramtypes",[Qn])],wo);var Ro=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},So=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Eo=class{constructor(e,t){this.masterPasswordSecurityStore=e,this.cqrsClient=t}async send(){const{commands:{trackEvent:e}}=this.cqrsClient.getClient(w.Yu),t=await this.masterPasswordSecurityStore.getState();await e({event:new Pr.AnonymousMasterPasswordHealthReportEvent({isLeaked:t.isMasterPasswordLeaked})})}};Eo=Ro([(0,n.Injectable)(),So("design:paramtypes",[Qn,n.CqrsClient])],Eo);var Oo=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Co=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Po=class{constructor(e,t,r){this.checkMasterPasswordService=e,this.resetMasterPasswordLeakedNotification=t,this.anonymousMasterPasswordLeakedTrackingEventSender=r}async execute({body:e}){return this.resetMasterPasswordLeakedNotification.reset(),await this.checkMasterPasswordService.shouldBeChecked()?(await this.checkMasterPasswordService.check(e.password),this.anonymousMasterPasswordLeakedTrackingEventSender.send(),Promise.resolve((0,l.Vp)(void 0))):Promise.resolve((0,l.Vp)(void 0))}};Po=Oo([(0,n.CommandHandler)(o.TemporaryCheckMasterPasswordCommand),Co("design:paramtypes",[ho,go,Eo])],Po);var Ao=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},jo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let _o=class{constructor(e){this.masterPasswordSecurityStore=e}async execute(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,lastCheckTimestamp:0,isMasterPasswordLeaked:!1,isMasterPasswordLeakedNotificationDismissed:!1}),Promise.resolve((0,l.Vp)(void 0))}};_o=Ao([(0,n.CommandHandler)(o.TemporaryResetMasterPasswordLeakedCommand),jo("design:paramtypes",[Qn])],_o);var To=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Io=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let xo=class{constructor(e,t){this.masterPasswordSecurityStore=e,this.checkMasterPasswordWeakService=t}async execute({body:e}){return await this.checkMasterPasswordWeakService.check(e.password),Promise.resolve((0,l.Vp)(void 0))}};xo=To([(0,n.CommandHandler)(o.TemporaryCheckMasterPasswordWeakCommand),Io("design:paramtypes",[Qn,wo])],xo);var Do=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Uo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Mo=class{constructor(e){this.masterPasswordSecurityStore=e}async execute(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,lastCheckTimestamp:0,isMasterPasswordLeaked:!1,isMasterPasswordLeakedNotificationDismissed:!1}),Promise.resolve((0,l.Vp)(void 0))}};Mo=Do([(0,n.CommandHandler)(o.TemporaryResetMasterPasswordWeakCommand),Uo("design:paramtypes",[Qn])],Mo);var No=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let ko=class{};ko=No([(0,n.Module)({api:o.masterPasswordSecurityApi,handlers:{commands:{dismissMasterPasswordLeakedNotification:so,temporaryCheckMasterPassword:Po,temporaryResetMasterPasswordLeaked:_o,temporaryCheckMasterPasswordWeak:xo,temporaryResetMasterPasswordWeak:Mo},events:{},queries:{isMasterPasswordLeaked:Jn,isMasterPasswordWeak:oo,isMasterPasswordLeakedNotificationDismissed:to}},providers:[ho,lo,go,wo,Eo],imports:[w.Dq,w.nr],stores:[Qn]})],ko)},14258:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.auditLogsApi=void 0;const n=r(68224),o=r(12524);t.auditLogsApi=(0,n.defineModuleApi)({name:"auditLogs",commands:{storeAuditLogs:o.StoreAuditLogsCommand},events:{},queries:{}})},17033:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(12524),t)},12524:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoreAuditLogsCommand=t.StoreAuditLogsInvalidLogsError=void 0;const n=r(68224);!function(e){e.AUDIT_LOG_MISSING_JSON_SCHEMA="AUDIT_LOG_MISSING_JSON_SCHEMA",e.AUDIT_LOG_INVALID_JSON_FOR_JSON_SCHEMA="AUDIT_LOG_INVALID_JSON_FOR_JSON_SCHEMA",e.AUDIT_LOG_INVALID_LOG_SCHEMA_TYPE_OR_VERSION="AUDIT_LOG_INVALID_LOG_SCHEMA_TYPE_OR_VERSION",e.AUDIT_LOG_ERROR_READING_JSON_SCHEMA="AUDIT_LOG_ERROR_READING_JSON_SCHEMA",e.STORING_SENSITIVE_AUDIT_LOGS_NOT_ALLOWED="STORING_SENSITIVE_AUDIT_LOGS_NOT_ALLOWED"}(t.StoreAuditLogsInvalidLogsError||(t.StoreAuditLogsInvalidLogsError={}));class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.StoreAuditLogsCommand=o},61899:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(14258),t),o(r(17033),t),o(r(75711),t)},20676:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},28279:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuditLogCategory=t.AuditLogType=void 0,function(e){e.UserInvited="user_invited",e.UserReinvited="user_reinvited",e.UserRemoved="user_removed",e.TeamCaptainAdded="team_captain_added",e.TeamCaptainRemoved="team_captain_removed",e.GroupManagerAdded="group_manager_added",e.GroupManagerRemoved="group_manager_removed",e.MasterPasswordResetAccepted="master_password_reset_accepted",e.MasterPasswordResetRefused="master_password_reset_refused",e.BillingAdminAdded="billing_admin_added",e.BillingAdminRemoved="billing_admin_removed",e.UserGroupCreated="user_group_created",e.UserGroupRenamed="user_group_renamed",e.UserGroupDeleted="user_group_deleted",e.UserJoinedUserGroup="user_joined_user_group",e.UserLeftUserGroup="user_left_user_group",e.UserInvitedToUserGroup="user_invited_to_user_group",e.UserDeclinedInviteToUserGroup="user_declined_invite_to_user_group",e.UserRemovedFromUserGroup="user_removed_from_user_group",e.DomainRequested="domain_requested",e.DomainValidated="domain_validated",e.SensitiveLogsEnabled="collect_sensitive_data_audit_logs_enabled",e.SensitiveLogsDisabled="collect_sensitive_data_audit_logs_disabled",e.SsoIdpMetadataSet="sso_idp_metadata_set",e.SsoServiceProviderUrlSet="sso_service_provider_url_set",e.SsoEnabled="sso_enabled",e.SsoDisabled="sso_disabled",e.TeamNameChanged="team_name_changed",e.NewBillingPeriodCreated="new_billing_period_created",e.SeatsAdded="seats_added",e.ContactEmailChanged="contact_email_changed",e.MasterPasswordMobileResetEnabled="master_password_mobile_reset_enabled",e.MasterPasswordMobileResetDisabled="master_password_mobile_reset_disabled",e.MasterPasswordMobileReset="master_password_mobile_reset",e.MasterPasswordChanged="master_password_changed",e.MpToViewPasswordsEnabled="mp_to_view_passwords_enabled",e.MpToViewPasswordsDisabled="mp_to_view_passwords_disabled",e.TwoFactorAuthenticationLoginMethodAdded="two_factor_authentication_login_method_added",e.TwoFactorAuthenticationLoginMethodRemoved="two_factor_authentication_login_method_removed",e.BiometricSignInDisabled="biometric_sign_in_disabled",e.DWMEmailAdded="dwm_email_added",e.DWMEmailRemoved="dwm_email_removed",e.DWMAlertReceived="dwm_alert_received",e.UserDeviceAdded="user_device_added",e.UserDeviceRemoved="user_device_removed",e.UserDeviceLogin="user_device_login",e.MasterPasswordReset="master_password_reset",e.RequestedAccountRecovery="requested_account_recovery",e.CompletedAccountRecovery="completed_account_recovery",e.UserSharedCredentialWithGroup="user_shared_credential_with_group",e.UserSharedCredentialWithEmail="user_shared_credential_with_email",e.UserSharedCredentialWithExternal="user_shared_credential_with_external",e.UserSharedSecureNoteWithGroup="user_shared_secure_note_with_group",e.UserSharedSecureNoteWithEmail="user_shared_secure_note_with_email",e.UserSharedSecureNoteWithExternal="user_shared_secure_note_with_external",e.UserRevokedSharedCredentialGroup="user_revoked_shared_credential_group",e.UserRevokedSharedCredentialEmail="user_revoked_shared_credential_email",e.UserRevokedSharedCredentialExternal="user_revoked_shared_credential_external",e.UserRevokedSharedSecureNoteGroup="user_revoked_shared_secure_note_group",e.UserRevokedSharedSecureNoteEmail="user_revoked_shared_secure_note_email",e.UserRevokedSharedSecureNoteExternal="user_revoked_shared_secure_note_external",e.UserAcceptedSharingInviteSecureNote="user_accepted_sharing_invite_secure_note",e.UserRejectedSharingInviteSecureNote="user_rejected_sharing_invite_secure_note",e.UserAcceptedSharingInviteCredential="user_accepted_sharing_invite_credential",e.UserRejectedSharingInviteCredential="user_rejected_sharing_invite_credential",e.UserCreatedCredential="user_created_credential",e.UserModifiedCredential="user_modified_credential",e.UserDeletedCredential="user_deleted_credential",e.UserImportedCredentials="user_imported_credentials",e.UserCreatedSecureNote="user_created_secure_note",e.UserModifiedSecureNote="user_modified_secure_note",e.UserDeletedSecureNote="user_deleted_secure_note"}(t.AuditLogType||(t.AuditLogType={})),function(e){e.Account="account",e.Authentication="authentication",e.DarkWebMonitoring="dark_web_monitoring",e.Groups="groups",e.ImportExport="import_export",e.TeamSettings="team_settings",e.TeamSettingsActiveDirectory="team_settings_activedirectory",e.TeamSettingsPolicies="team_settings_policies",e.TeamSettingsSAMLProvisioning="team_settings_samlprovisioning",e.TeamSettingsSCIM="team_settings_scim",e.TeamSettingsSSO="team_settings_sso",e.Sharing="sharing",e.UserSettings="user_settings",e.UserSettingsAccountRecovery="user_settings_accountrecovery",e.Users="users",e.VaultIDs="vault_ids",e.VaultPasswords="vault_passwords",e.VaultPayments="vault_payments",e.VaultPersonalInfo="vault_personalinfo",e.VaultSecureNotes="vault_securenotes"}(t.AuditLogCategory||(t.AuditLogCategory={}))},8132:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},35484:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},95312:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},69767:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},75711:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(28279),t),o(r(20676),t),o(r(8132),t),o(r(95312),t),o(r(69767),t),o(r(17098),t),o(r(45665),t),o(r(45491),t),o(r(37564),t),o(r(66767),t),o(r(35484),t)},17098:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},45665:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},45491:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},37564:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},66767:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},50990:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(61899),t)},82210:(e,t,r)=>{"use strict";r.d(t,{g:()=>S});var n=r(32839),o=r(17530),a=r(50990),i=r(87279),s=r(60399),c=r(87065),u=r(48844),l=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let p=class{constructor(e){this.serverApiClient=e}async sendLogs(e){return await(0,s.z)(this.serverApiClient.v1.teams.storeAuditLogs({auditLogs:e}).pipe((0,u.DZ)((()=>{throw new Error("storeAuditLogs failed with an unknown HTTP error")})),(0,u.lk)((e=>e.data.invalidAuditLogs.length?(0,i.Vp)(this.serverToTechnicalSchemaErrorsMapper(e.data.invalidAuditLogs)):(0,i.Vp)(void 0)))))}serverToTechnicalSchemaErrorsMapper(e){return{invalidAuditLogs:e.map((e=>({uuid:e.uuid,error:a.StoreAuditLogsInvalidLogsError[e.error]})))}}};p=l([(0,n.Injectable)(),d("design:paramtypes",[o.lX])],p);var f=r(53576),h=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let m=class{constructor(e){this.client=e}get(){const{queries:{carbonState:e}}=this.client.getClient(f.carbonLegacyApi);return e({path:"state.userSession.spaceData.spaces"}).pipe((0,u.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t?.teamId&&"object"==typeof t?.details&&"string"==typeof t?.details.status}))))(e))throw new Error("Bad space item format");const t=e.find((e=>"accepted"===e.details.status)),r=t?.details.info.collectSensitiveDataAuditLogsEnabled;return Boolean(r)})))}};m=h([(0,n.Injectable)(),y("design:paramtypes",[n.CqrsClient])],m);var g=r(68224),v=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let w=class{constructor(e,t,r){this.client=e,this.auditLogsService=t,this.sensitiveLogsEnabledGetter=r}async execute({body:{auditLogs:e}}){const{queries:{userFeatureFlips:t}}=this.client.getClient(g.requestContextApi);if(!(await(0,s.z)(t({requiredFeatureFlips:["send_activity_log"]}).pipe((0,c.U)((e=>{if((0,i.d6)(e))return(0,i.db)(e);throw new Error("Failed to retrieve user featureFlips")}))))).send_activity_log)return(0,i.Vp)(void 0);const r=await(0,s.z)(this.sensitiveLogsEnabledGetter.get());if(!(0,i.d6)(r))throw new Error("Error while getting sensitive logs enabled data");const n=e.filter((e=>!e.is_sensitive||r.data));return n.length&&await this.auditLogsService.sendLogs(n),Promise.resolve((0,i.Vp)(void 0))}};w=v([(0,n.CommandHandler)(a.StoreAuditLogsCommand),b("design:paramtypes",[n.CqrsClient,p,m])],w);var R=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let S=class{};S=R([(0,n.Module)({api:a.auditLogsApi,imports:[o.nr],providers:[p,m],handlers:{commands:{storeAuditLogs:w},events:{},queries:{}},requiredFeatureFlips:["send_activity_log"]})],S)},26938:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(99314),t)},62884:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sessionApi=void 0;const n=r(68224),o=r(49741),a=r(11938);t.sessionApi=(0,n.defineModuleApi)({name:"session",commands:{FlushLocalDataCommand:o.FlushLocalDataCommand,PrepareLocalDataFlushCommand:a.PrepareLocalDataFlushCommand},queries:{},events:{}})},49741:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FlushLocalDataCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.FlushLocalDataCommand=o},25885:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(49741),t),o(r(11938),t)},11938:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PrepareLocalDataFlushCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.PrepareLocalDataFlushCommand=o},54148:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(8323),t)},8323:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SampleEvent=void 0;const n=r(68224);class o extends((0,n.defineEvent)({scope:n.UseCaseScope.User})){}t.SampleEvent=o},99314:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(62884),t),o(r(25885),t),o(r(54148),t),o(r(78049),t)},78049:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(83062),t)},83062:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SampleQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.SampleQuery=o},49321:(e,t,r)=>{"use strict";r.d(t,{C:()=>p});var n=r(60399),o=r(53576),a=r(32839),i=r(54066),s=r(43293),c=r(48844),u=r(17530),l=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let p=class{constructor(e,t){this.cqrsClients=e,this.flexibleDecryptor=t}async decrypt(e){const{carbonStateList:t}=this.cqrsClients.getClient(o.carbonLegacyApi).queries;return await(0,n.z)(t({paths:["userSession.session.localKey","userSession.session.masterPassword","userSession.session.serverKey"]}).pipe((0,c.nb)({success:([t,r,n])=>{if("string"==typeof t)return this.flexibleDecryptor.decrypt((0,i.u)(t),e);if("string"==typeof r&&"string"==typeof n){const t=n+r,o=(0,s.N)(t);return this.flexibleDecryptor.decrypt((0,i.u)(o),e)}throw new Error("Unable to decrypt local data")},failure:()=>{throw new Error("Failure getting state list")}})))}};p=l([(0,a.Injectable)(),d("design:paramtypes",[a.CqrsClient,u.ah])],p)},43785:(e,t,r)=>{"use strict";r.d(t,{H:()=>c});var n=r(32839),o=r(49321),a=r(90386),i=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},s=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let c=class{constructor(e,t){this.localDataDecryptor=e,this.localDataEncryptor=t}encode(e){return this.localDataEncryptor.encrypt(e)}decode(e){return this.localDataDecryptor.decrypt(e)}};c=i([(0,n.Injectable)(),s("design:paramtypes",[o.C,a.k])],c)},90386:(e,t,r)=>{"use strict";r.d(t,{k:()=>h});var n=r(60399),o=r(32839),a=r(53576),i=r(48844),s=r(44396),c=r(54066),u=r(43293),l=r(7502),d=r(17530),p=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let h=class{constructor(e,t,r){this.cqrsClients=e,this.flexibleEncryptor=t,this.randomValuesGetter=r}async encrypt(e){const{carbonStateList:t}=this.cqrsClients.getClient(a.carbonLegacyApi).queries;return await(0,n.z)(t({paths:["userSession.session.localKey","userSession.session.masterPassword","userSession.session.serverKey","userSession.personalSettings.CryptoFixedSalt","userSession.personalSettings.CryptoUserPayload"]}).pipe((0,i.nb)({success:([t,r,n,o,a])=>{if("string"==typeof t)return this.flexibleEncryptor.encrypt((0,c.u)(t),e,s.oo,s.gO);if("string"==typeof r&&"string"==typeof n){const t=n+r,i=(0,u.N)(t),d="string"==typeof a?this.makeDerivationConfig(a):s.mr,{saltLength:p}=d,f="string"===o?(0,l.R)(o):this.randomValuesGetter.get(p);return this.flexibleEncryptor.encrypt((0,c.u)(i),e,d,s.Nw,{salt:f})}throw new Error("Unable to encrypt local data")},failure:()=>{throw new Error("Failure getting state list")}})))}makeDerivationConfig(e){const[,,t]=e.split("$");return"pbkdf2"===t?s.E1:s.mr}};h=p([(0,o.Injectable)(),f("design:paramtypes",[o.CqrsClient,d._M,d.YX])],h)},2272:(e,t,r)=>{"use strict";r.d(t,{_:()=>F});var n=r(32839),o=r(26938),a=r(17530),i=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let s=class{execute(){throw new Error("Not yet implemented")}};s=i([(0,n.QueryHandler)(o.SampleQuery)],s);var c=r(68224);class u extends((0,n.defineStore)({initialValue:{},storeName:"session-key-store",scope:c.UseCaseScope.Device,capacity:n.StoreCapacity._010KB,persist:!1})){}var l=r(49321),d=r(90386),p=r(43785),f=r(53576),h=r(60399),y=r(87065),m=r(87279),g=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},v=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let b=class{constructor(e,t,r){this.cqrsClient=e,this.flexibleDecryptor=t,this.sessionKeyStore=r}async decrypt(e){const{carbonState:t}=this.cqrsClient.getClient(f.carbonLegacyApi).queries,r=await(0,h.z)(t({path:"state.userSession.account.login"}).pipe((0,y.U)((e=>{if((0,m.d6)(e)&&"string"==typeof e.data)return e.data;throw new Error("No active login")})))),n=await this.sessionKeyStore.getState();if(!(r in n))throw new Error("No session ciphering data found for active login");const{sessionKey:o}=n[r];return this.flexibleDecryptor.decrypt(o,e)}};b=g([(0,n.Injectable)(),v("design:paramtypes",[n.CqrsClient,a.ah,u])],b);var w=r(44396),R=r(54066),S=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},E=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const O={pbkdf2:w.E1,noderivation:w.oo,argon2d:w.mr};let C=class{constructor(e){this.carbonLegacy=e.getClient(f.carbonLegacyApi)}makeDerivationConfig(e){const[,,t]=e.split("$");return(0,w.b9)(t)?O[t]:w.mr}config(){return this.carbonLegacy.queries.carbonStateList({paths:["state.userSession.personalSettings.CryptoUserPayload","state.userSession.personalSettings.CryptoFixedSalt"]}).pipe((0,y.U)((e=>{if((0,m.d6)(e)){const[t,r]=e.data;return(0,m.Vp)({derivation:"string"==typeof t?this.makeDerivationConfig(t):w.mr,salt:"string"==typeof r?(0,R.u)(r):void 0})}return(0,m.Vp)({derivation:w.mr,salt:void 0})})))}};C=S([(0,n.Injectable)(),E("design:paramtypes",[n.CqrsClient])],C);var P=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},A=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let j=class{constructor(e,t,r,n){this.cqrsClient=e,this.sessionKeyStore=t,this.cipheringSettingsService=r,this.flexibleEncryptor=n}async encrypt(e){const{carbonState:t}=this.cqrsClient.getClient(f.carbonLegacyApi).queries,r=await(0,h.z)(t({path:"state.userSession.account.login"}).pipe((0,y.U)((e=>{if((0,m.d6)(e)&&"string"==typeof e.data)return e.data;throw new Error("No active login")})))),n=await this.sessionKeyStore.getState();if(!(r in n))throw new Error("No session ciphering data found for active login");const o=await(0,h.z)(this.cipheringSettingsService.config());if((0,m.d6)(o)){const{derivation:t,salt:a}=o.data;if(!a)throw new Error("No salt available in the user settings. Unsupported for now");const{algorithm:i}=t;if("noderivation"===i)throw new Error("Session key requires derivation");const{sessionKey:s}=n[r];return this.flexibleEncryptor.encrypt(s,e,t,w.Nw,{salt:a})}throw new Error("Unable to read user crypto settings / salt")}};j=P([(0,n.Injectable)(),A("design:paramtypes",[n.CqrsClient,u,C,a._M])],j);var _=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},T=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let I=class{constructor(e,t){this.sessionEncryptor=e,this.sessionDecryptor=t}async decode(e){return await this.sessionDecryptor.decrypt(e)}async encode(e){return await this.sessionEncryptor.encrypt(e)}};I=_([(0,n.Injectable)(),T("design:paramtypes",[j,b])],I);var x=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},D=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let U=class{constructor(e){this.storeFlusher=e}async execute(){return await this.storeFlusher.flush(),Promise.resolve((0,m.Vp)(void 0))}};U=x([(0,n.CommandHandler)(o.FlushLocalDataCommand),D("design:paramtypes",[n.StoreFlusher])],U);var M=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},N=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let k=class{constructor(e){this.storeFlusher=e}async execute(){return await this.storeFlusher.prepare(),Promise.resolve((0,m.Vp)(void 0))}};k=M([(0,n.CommandHandler)(o.PrepareLocalDataFlushCommand),N("design:paramtypes",[n.StoreFlusher])],k);var L=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let F=class{};F=L([(0,n.Module)({api:o.sessionApi,handlers:{commands:{flushLocalData:U,prepareLocalDataFlush:k},events:{},queries:{sample:s}},providers:[l.C,d.k,p.H,I,b,j,C],exports:[l.C,d.k,p.H],stores:[u],imports:[a.Dq]})],F)},43838:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(75696),t),o(r(20985),t),o(r(65408),t)},75676:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sharingCollectionsApi=void 0;const n=r(68224),o=r(32841),a=r(40177);t.sharingCollectionsApi=(0,n.defineModuleApi)({name:"sharingCollections",commands:{createSharedCollection:o.CreateSharedCollectionCommand},events:{},queries:{getSharedCollections:a.GetSharedCollectionsQuery}})},32841:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreateSharedCollectionCommand=t.getCreateSharedCollectionFunctionalError=t.CreateSharedCollectionUserMustSpecifyKeyError=t.CreateSharedCollectionSharingDisabledError=t.CreateSharedCollectionNonExistingGroupError=t.CreateSharedCollectionNonUserProposeSigError=t.CreateSharedCollectionNotAMemberError=t.CreateSharedCollectionExistsError=t.CreateSharedCollectionMissingAuthorError=t.CreateSharedCollectionAuthorNotAdminError=t.CreateSharedCollectionNoAuthorAcceptSigError=t.CreateSharedCollectionNoGroupAcceptSigError=t.CreateSharedCollectionInvalidPlatformError=t.CreateSharedCollectionCommandErrorCode=void 0;const n=r(68224),o=r(61475);var a;!function(e){e.INVALID_PLATFORM="INVALID_PLATFORM",e.NO_USER_GROUP_ACCEPT_SIGNATURE="NO_USER_GROUP_ACCEPT_SIGNATURE",e.AUTHOR_ACCEPT_SIGNATURE_IS_MISSING="AUTHOR_ACCEPT_SIGNATURE_IS_MISSING",e.AUTHOR_MUST_BE_ADMIN="AUTHOR_MUST_BE_ADMIN",e.AUTHOR_IS_MISSING="AUTHOR_IS_MISSING",e.COLLECTION_ALREADY_EXISTS="COLLECTION_ALREADY_EXISTS",e.NOT_A_MEMBER_CANNOT_SHARE_WITH_USER_GROUP="NOT_A_MEMBER_CANNOT_SHARE_WITH_USER_GROUP",e.NON_EXISTING_USER_MUST_SPECIFY_PROPOSE_SIGNATURE_USING_ALIAS="NON_EXISTING_USER_MUST_SPECIFY_PROPOSE_SIGNATURE_USING_ALIAS",e.PROVIDED_USERGROUP_ID_DOES_NOT_EXIST="PROVIDED_USERGROUP_ID_DOES_NOT_EXIST",e.SHARING_DISABLED_BY_TEAM="SHARING_DISABLED_BY_TEAM",e.EXISTING_USER_MUST_SPECIFY_COLLECTION_KEY="EXISTING_USER_MUST_SPECIFY_COLLECTION_KEY"}(a=t.CreateSharedCollectionCommandErrorCode||(t.CreateSharedCollectionCommandErrorCode={}));class i extends((0,o.FunctionalError)(a.INVALID_PLATFORM,"Invalid platform")){}t.CreateSharedCollectionInvalidPlatformError=i;class s extends((0,o.FunctionalError)(a.NO_USER_GROUP_ACCEPT_SIGNATURE,"User group was missing accept signature")){}t.CreateSharedCollectionNoGroupAcceptSigError=s;class c extends((0,o.FunctionalError)(a.AUTHOR_ACCEPT_SIGNATURE_IS_MISSING,"The collection author did not have an accept signature")){}t.CreateSharedCollectionNoAuthorAcceptSigError=c;class u extends((0,o.FunctionalError)(a.AUTHOR_MUST_BE_ADMIN,"The collection author was not an admin")){}t.CreateSharedCollectionAuthorNotAdminError=u;class l extends((0,o.FunctionalError)(a.AUTHOR_IS_MISSING,"The collection author information unavailable")){}t.CreateSharedCollectionMissingAuthorError=l;class d extends((0,o.FunctionalError)(a.COLLECTION_ALREADY_EXISTS,"This collection already exists")){}t.CreateSharedCollectionExistsError=d;class p extends((0,o.FunctionalError)(a.NOT_A_MEMBER_CANNOT_SHARE_WITH_USER_GROUP,"Users cannot share with user groups that they are not a member of")){}t.CreateSharedCollectionNotAMemberError=p;class f extends((0,o.FunctionalError)(a.NON_EXISTING_USER_MUST_SPECIFY_PROPOSE_SIGNATURE_USING_ALIAS,"Non existing users must use alias for propose signature")){}t.CreateSharedCollectionNonUserProposeSigError=f;class h extends((0,o.FunctionalError)(a.PROVIDED_USERGROUP_ID_DOES_NOT_EXIST,"No user group exists with an ID provided to this collection")){}t.CreateSharedCollectionNonExistingGroupError=h;class y extends((0,o.FunctionalError)(a.SHARING_DISABLED_BY_TEAM,"Cannot share a collection while sharing is disabled")){}t.CreateSharedCollectionSharingDisabledError=y;class m extends((0,o.FunctionalError)(a.EXISTING_USER_MUST_SPECIFY_COLLECTION_KEY,"Existing user must specify collection key")){}t.CreateSharedCollectionUserMustSpecifyKeyError=m,t.getCreateSharedCollectionFunctionalError=function(e){switch(e){case"INVALID_PLATFORM":return new i;case"NO_USER_GROUP_ACCEPT_SIGNATURE":return new s;case"AUTHOR_ACCEPT_SIGNATURE_IS_MISSING":return new c;case"AUTHOR_MUST_BE_ADMIN":return new u;case"AUTHOR_IS_MISSING":return new l;case"COLLECTION_ALREADY_EXISTS":return new d;case"NOT_A_MEMBER_CANNOT_SHARE_WITH_USER_GROUP":return new p;case"NON_EXISTING_USER_MUST_SPECIFY_PROPOSE_SIGNATURE_USING_ALIAS":return new f;case"PROVIDED_USERGROUP_ID_DOES_NOT_EXIST":return new h;case"SHARING_DISABLED_BY_TEAM":return new y;case"EXISTING_USER_MUST_SPECIFY_COLLECTION_KEY":return new m;default:throw new Error("Unknown server error")}};class g extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.CreateSharedCollectionCommand=g},59769:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(32841),t)},65408:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(75676),t),o(r(40177),t),o(r(59769),t)},60915:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetSharedCollectionsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.GetSharedCollectionsQuery=o},40177:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(60915),t)},30438:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sharingInvitesApi=void 0;const n=r(68224),o=r(2042),a=r(78044);t.sharingInvitesApi=(0,n.defineModuleApi)({name:"sharingInvites",commands:{RefuseItemGroupInviteCommand:o.RefuseItemGroupInviteCommand,RefuseUserGroupInviteCommand:o.RefuseUserGroupInviteCommand},events:{},queries:{GetInvitesQuery:a.GetInvitesQuery}})},2042:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(89494),t),o(r(42166),t)},89494:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RefuseItemGroupInviteCommand=t.getRefuseItemGroupInviteFunctionalError=t.RefuseItemGroupInviteUserIsNotInPendingStatusError=t.RefuseItemGroupInviteNotEnoughAdminsError=t.RefuseItemGroupInviteInvalidItemGroupRevisionError=t.RefuseItemGroupInviteUserGroupIsNotInItemGroupError=t.RefuseItemGroupInviteUserIsNotInItemGroupError=t.RefuseItemGroupInviteGroupHasInvalidStatusError=t.RefuseItemGroupInviteAuthorHasInvalidStatusError=t.RefuseItemGroupInviteNotFoundError=t.RefuseItemGroupInviteResultErrorCode=void 0;const n=r(68224),o=r(61475);var a;!function(e){e.ItemGroupNotFound="ItemGroupNotFound",e.AuthorHasInvalidStatus="AuthorHasInvalidStatus",e.GroupHasInvalidStatus="GroupHasInvalidStatus",e.UserIsNotInItemGroup="UserIsNotInItemGroup",e.UserGroupIsNotInItemGroup="UserGroupIsNotInItemGroup",e.InvalidItemGroupRevision="InvalidItemGroupRevision",e.NotEnoughAdmins="NotEnoughAdmins",e.UserIsNotInPendingStatus="UserIsNotInPendingStatus"}(a=t.RefuseItemGroupInviteResultErrorCode||(t.RefuseItemGroupInviteResultErrorCode={}));class i extends((0,o.FunctionalError)(a.ItemGroupNotFound,"Item Group not found")){}t.RefuseItemGroupInviteNotFoundError=i;class s extends((0,o.FunctionalError)(a.AuthorHasInvalidStatus,"User is not in accepted/pending status (already refused or revoked)")){}t.RefuseItemGroupInviteAuthorHasInvalidStatusError=s;class c extends((0,o.FunctionalError)(a.GroupHasInvalidStatus,"UserGroup is not in accepted/pending status (already refused or revoked)")){}t.RefuseItemGroupInviteGroupHasInvalidStatusError=c;class u extends((0,o.FunctionalError)(a.UserIsNotInItemGroup,"User is not part of item group")){}t.RefuseItemGroupInviteUserIsNotInItemGroupError=u;class l extends((0,o.FunctionalError)(a.UserGroupIsNotInItemGroup,"User group is not part of item group")){}t.RefuseItemGroupInviteUserGroupIsNotInItemGroupError=l;class d extends((0,o.FunctionalError)(a.InvalidItemGroupRevision,"Item group revision is not valid")){}t.RefuseItemGroupInviteInvalidItemGroupRevisionError=d;class p extends((0,o.FunctionalError)(a.NotEnoughAdmins,"The operation would let the item group with no admin")){}t.RefuseItemGroupInviteNotEnoughAdminsError=p;class f extends((0,o.FunctionalError)(a.UserIsNotInPendingStatus,'User is not in "pending" status or not part of a group')){}t.RefuseItemGroupInviteUserIsNotInPendingStatusError=f,t.getRefuseItemGroupInviteFunctionalError=function(e){switch(e){case"AUTHOR_HAS_INVALID_STATUS":return new s;case"GROUP_HAS_INVALID_STATUS":return new c;case"USER_IS_NOT_IN_ITEM_GROUP":return new u;case"USER_GROUP_IS_NOT_IN_ITEM_GROUP":return new l;case"INVALID_ITEM_GROUP_REVISION":return new d;case"NOT_ENOUGH_ADMINS":return new p;case"USER_IS_NOT_IN_PENDING_STATUS":return new f;default:throw new Error("Unknown server error")}};class h extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.RefuseItemGroupInviteCommand=h},42166:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RefuseUserGroupInviteCommand=t.getRefuseUserGroupInviteFunctionalError=t.RefuseUserGroupInviteAuthorHasInvalidStatusError=t.RefuseUserGroupInviteGroupHasInvalidStatusError=t.RefuseUserGroupInviteUserIsNotInPendingStatusError=t.RefuseUserGroupInviteUserIsNotInUserGroupError=t.RefuseUserGroupInviteInsufficientPrivilegesError=t.RefuseUserGroupInviteUserGroupUpdateConflictError=t.RefuseUserGroupInviteInvalidItemGroupRevisionError=t.RefuseUserGroupInviteUserGroupIsNotFoundError=t.RefuseUserGroupInviteInvalidTeamIdError=t.RefuseUserGroupInviteNotFoundError=t.RefuseUserGroupInviteResultErrorCode=void 0;const n=r(68224),o=r(61475);var a;!function(e){e.UserGroupNotFound="UserGroupNotFound",e.InvalidTeamId="InvalidTeamId",e.UserGroupIsNotFound="UserGroupIsNotFound",e.InvalidItemGroupRevision="InvalidItemGroupRevision",e.UserGroupUpdateConflict="UserGroupUpdateConflict",e.InsufficientPrivileges="InsufficientPrivileges",e.UserIsNotInUserGroup="UserIsNotInUserGroup",e.UserIsNotInPendingStatus="UserIsNotInPendingStatus",e.GroupHasInvalidStatus="GroupHasInvalidStatus",e.AuthorHasInvalidStatus="AuthorHasInvalidStatus"}(a=t.RefuseUserGroupInviteResultErrorCode||(t.RefuseUserGroupInviteResultErrorCode={}));class i extends((0,o.FunctionalError)(a.UserGroupNotFound,"User Group not found")){}t.RefuseUserGroupInviteNotFoundError=i;class s extends((0,o.FunctionalError)(a.InvalidTeamId,"Provided Team ID is not a number")){}t.RefuseUserGroupInviteInvalidTeamIdError=s;class c extends((0,o.FunctionalError)(a.UserGroupIsNotFound,"User group for provided ID does not exist")){}t.RefuseUserGroupInviteUserGroupIsNotFoundError=c;class u extends((0,o.FunctionalError)(a.InvalidItemGroupRevision,"User group revision is not valid")){}t.RefuseUserGroupInviteInvalidItemGroupRevisionError=u;class l extends((0,o.FunctionalError)(a.UserGroupUpdateConflict,"Conflict between users attempting to update the same user group")){}t.RefuseUserGroupInviteUserGroupUpdateConflictError=l;class d extends((0,o.FunctionalError)(a.InsufficientPrivileges,"The user does not have User Group permission to refuse the invitation")){}t.RefuseUserGroupInviteInsufficientPrivilegesError=d;class p extends((0,o.FunctionalError)(a.UserIsNotInUserGroup,"User is not part of a group")){}t.RefuseUserGroupInviteUserIsNotInUserGroupError=p;class f extends((0,o.FunctionalError)(a.UserIsNotInPendingStatus,'User is not in "pending" status or not part of a group')){}t.RefuseUserGroupInviteUserIsNotInPendingStatusError=f;class h extends((0,o.FunctionalError)(a.GroupHasInvalidStatus,'UserGroup is not in "accepted" or "pending" status (already refused or revoked)')){}t.RefuseUserGroupInviteGroupHasInvalidStatusError=h;class y extends((0,o.FunctionalError)(a.AuthorHasInvalidStatus,"User is not in accepted/pending status (already refused or revoked)")){}t.RefuseUserGroupInviteAuthorHasInvalidStatusError=y,t.getRefuseUserGroupInviteFunctionalError=function(e){switch(e){case"INVALID_TEAM_ID":return new s;case"USER_GROUP_IS_NOT_FOUND":return new c;case"INVALID_USER_GROUP_REVISION":return new u;case"USER_GROUP_UPDATE_CONFLICT":return new l;case"INSUFFICIENT_PRIVILEGES":return new d;case"USER_IS_NOT_IN_USER_GROUP":return new p;case"USER_IS_NOT_IN_PENDING_STATUS":return new f;case"GROUP_HAS_INVALID_STATUS":return new h;case"AUTHOR_HAS_INVALID_STATUS":return new y;default:throw new Error("Unknown server error")}};class m extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.RefuseUserGroupInviteCommand=m},20985:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(30438),t),o(r(2042),t),o(r(78044),t)},34173:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetInvitesQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.GetInvitesQuery=o},78044:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(34173),t)},76293:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sharingItemsApi=void 0;const n=r(68224),o=r(61735);t.sharingItemsApi=(0,n.defineModuleApi)({name:"sharingItems",commands:{},events:{},queries:{sharingEnabled:o.SharingEnabledQuery}})},75696:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(76293),t),o(r(61735),t)},61735:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(96732),t)},96732:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharingEnabledQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.SharingEnabledQuery=o},10320:(e,t,r)=>{"use strict";r.d(t,{a9:()=>he,p6:()=>D,FF:()=>f});var n=r(32839),o=r(43838),a=r(53576),i=r(48844);const s=e=>(e.spaces??[]).filter((e=>"accepted"===e.status));var c=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const l=e=>{if(!e)return!1;const t=e;if(!(r=t.spaces)||!Array.isArray(r)||0!==r.length&&!(e=>{if(!e)return!1;const t=e;return!!(t.associatedEmail&&t.billingAdmins&&t.color&&t.info&&t.letter&&t.planType&&t.status&&t.teamAdmins&&t.teamId&&t.teamName&&t.tier)})(r[0]))return!0;var r;const n=s(t)[0];return!n?.info?.sharingDisabled};let d=class{constructor(e){this.client=e}execute(){const{queries:{carbonState:e}}=this.client.getClient(a.carbonLegacyApi);return e({path:"userSession.localSettings.premiumStatus"}).pipe((0,i.Qn)((e=>l(e))))}};d=c([(0,n.QueryHandler)(o.SharingEnabledQuery),u("design:paramtypes",[n.CqrsClient])],d);var p=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let f=class{};f=p([(0,n.Module)({api:o.sharingItemsApi,handlers:{commands:{},events:{},queries:{sharingEnabled:d}}})],f);var h=r(17530);var y=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},m=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let g=class{constructor(e){this.client=e}execute(){const{queries:{carbonState:e}}=this.client.getClient(a.carbonLegacyApi);return e({path:"userSession.sharingSync"}).pipe((0,i.Qn)((e=>{if(!(e=>{if(!e)return!1;const t=e;return!!t.pendingItemGroups&&!!t.pendingUserGroups})(e))throw new Error("Bad SharingSync format");return e})))}};g=y([(0,n.QueryHandler)(o.GetInvitesQuery),m("design:paramtypes",[n.CqrsClient])],g);var v=r(60399),b=r(82567),w=r(87279),R=r(11494),S=r(17509);const E=e=>{if(!e||"object"!=typeof e)return!1;const t=e;return r=t.items,!!Array.isArray(r)&&(0===r.length||r.every((e=>{const t=e;return"string"==typeof t.content&&"string"==typeof t.itemId&&"number"==typeof t.timestamp})))&&(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.groupId&&"string"==typeof t.type&&"number"==typeof t.revision}))))(t.itemGroups)&&(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.groupId&&"string"==typeof t.name&&"string"==typeof t.publicKey&&"string"==typeof t.privateKey&&"number"==typeof t.revision}))))(t.userGroups);var r};var O=r(68224),C=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},P=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let A=class{constructor(e,t){this.client=e,this.serverApiClient=t}async execute(e){const{body:{itemGroupId:t}}=e,{queries:{carbonState:r},commands:{carbonLegacyLeeloo:n}}=this.client.getClient(a.carbonLegacyApi),{queries:{getInvites:c}}=this.client.getClient(o.sharingInvitesApi),u=c().pipe((0,i.Qn)((e=>{const r=e.pendingItemGroups.find((e=>e.itemGroupId===t));if(!r)throw new Error(`Pending item group not found for id ${t}`);if(r.items.length<1)throw new Error(`Missing item content for pending item group with id ${t}`);return r.items[0]}))),l=await(0,v.z)(u);if((0,w.hx)(l))throw new Error(`Failed to retrieve item content for pending item group with id ${t}`);const d=l.data,p=r({path:"userSession.sharingData"}).pipe((0,i.Qn)((e=>{if(!E(e))throw new Error("Bad sharingData");return e}))).pipe((0,i.lk)((e=>{const r=e.itemGroups.find((({groupId:e})=>e===t));return(0,w.Vp)(r)}))),f=await(0,v.z)(p);if((0,w.hx)(f))throw new Error(`Failed to retrieve item group for pending item group with id ${t}`);if(void 0===f.data)return(0,w.Rn)(new o.RefuseItemGroupInviteNotFoundError);const h=r({path:"userSession.localSettings.premiumStatus"}).pipe((0,i.Qn)((e=>s(e)[0]))),y=await(0,v.z)(h),{userFeatureFlips:m}=this.client.getClient(O.requestContextApi).queries,g=await(0,v.z)(m({requiredFeatureFlips:["audit_logs_sharing","send_activity_log"]}));if((0,w.hx)(g))throw new Error("Failed to retrieve user features");const C=g.data.audit_logs_sharing&&g.data.send_activity_log&&(0,w.d6)(y)?((e,t)=>{const r=(!!t?.SpaceId&&e?.info.collectSensitiveDataAuditLogsEnabled)??!1,n=t&&(0,a.isCredential)(t),o=n&&t.Url?(0,S.extractRootDomain)(t.Url):"";return r?{captureLog:r,domain:n?o||"":void 0,type:n?"AUTHENTIFIANT":"SECURENOTE"}:void 0})(y.data,d):void 0;return(0,v.z)(this.serverApiClient.v1.sharingUserdevice.refuseItemGroup({groupId:f.data.groupId,revision:f.data.revision,itemsForEmailing:[(P=d,{type:(0,a.isCredential)(P)?"password":"note",name:P.Title})],auditLogDetails:C}).pipe((0,i.DZ)((e=>{if("BusinessError"===e.tag)return(0,o.getRefuseItemGroupInviteFunctionalError)(e.code);throw new Error(e.message)})),(0,i.lk)((e=>{if(void 0===e.data.itemGroupErrors||0===e.data.itemGroupErrors.length)return(0,w.Vp)(void 0);if(e.data.itemGroupErrors.length>0)throw new Error(`Error for item group ${e.data.itemGroupErrors[0].groupId}: ${e.data.itemGroupErrors[0].message}`);throw new Error("Unknown server error")})),(0,b.b)((async e=>{(0,w.d6)(e)&&await n({name:"sessionForceSync",arg:[{trigger:R.Trigger.Sharing}]})}))));var P}};A=C([(0,n.CommandHandler)(o.RefuseItemGroupInviteCommand),P("design:paramtypes",[n.CqrsClient,h.lX])],A);var j=r(10350),_=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},T=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let I=class{constructor(e,t){this.client=e,this.serverApiClient=t}async execute(e){const{body:{userGroupId:t}}=e,{queries:{carbonState:r},commands:{carbonLegacyLeeloo:n}}=this.client.getClient(a.carbonLegacyApi),s=r({path:"userSession.sharingData"}).pipe((0,i.Qn)((e=>{if(!E(e))throw new Error("Bad sharingData");return e}))).pipe((0,i.Qn)((e=>{const r=e.userGroups.find((({groupId:e})=>e===t));if(!r)throw new Error("Could not find userGroup");return r}))),c=await(0,v.z)(s);if((0,w.hx)(c))throw new Error(`Failed to retrieve user group for pending user group with id ${t}`);return await(0,v.z)(this.serverApiClient.v1.sharingUserdevice.refuseUserGroup({groupId:c.data.groupId,revision:c.data.revision,provisioningMethod:j.ET.USER}).pipe((0,i.DZ)((e=>{if("BusinessError"===e.tag)return(0,o.getRefuseUserGroupInviteFunctionalError)(e.code);throw new Error(e.message)})),(0,i.lk)((e=>{if(void 0===e.data.userGroupErrors||0===e.data.userGroupErrors.length)return(0,w.Vp)(void 0);if(e.data.userGroupErrors.length>0)throw new Error(`Error for user group ${e.data.userGroupErrors[0].groupId}: ${e.data.userGroupErrors[0].message}`);throw new Error("Unknown server error")})),(0,b.b)((async e=>{(0,w.d6)(e)&&await n({name:"sessionForceSync",arg:[{trigger:R.Trigger.Sharing}]})}))))}};I=_([(0,n.CommandHandler)(o.RefuseUserGroupInviteCommand),T("design:paramtypes",[n.CqrsClient,h.lX])],I);var x=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let D=class{};D=x([(0,n.Module)({api:o.sharingInvitesApi,handlers:{commands:{refuseItemGroupInvite:A,refuseUserGroupInvite:I},events:{},queries:{getInvites:g}},imports:[h.nr],requiredFeatureFlips:["audit_logs_sharing","send_activity_log"]})],D);var U=r(69183),M=r(54066),N=r(3417),k=r.n(N);var L=r(10370),F=r(7165);const q=F.z.object({name:F.z.string(),privateKey:F.z.string(),publicKey:F.z.string(),revision:F.z.number(),uuid:F.z.string(),userGroups:F.z.array(F.z.object({acceptSignature:F.z.string().optional(),collectionKey:F.z.string().optional(),name:F.z.string(),permission:F.z.enum(["admin","limited"]),proposeSignature:F.z.string().optional(),referrer:F.z.string().optional(),status:F.z.enum(["pending","accepted","refused","revoked"]),uuid:F.z.string()})),users:F.z.array(F.z.object({acceptSignature:F.z.string().optional(),collectionKey:F.z.string().optional(),login:F.z.string(),permission:F.z.enum(["admin","limited"]),proposeSignature:F.z.string().optional(),proposeSignatureUsingAlias:F.z.boolean().optional(),referrer:F.z.string(),rsaStatus:F.z.string().optional(),status:F.z.enum(["pending","accepted","refused","revoked"])}))}),V=F.z.object({sharedCollections:F.z.array(q)}),G=e=>V.safeParse(e).success;class H extends((0,n.defineStore)({capacity:n.StoreCapacity._010KB,persist:!1,scope:O.UseCaseScope.User,storeName:"collections-store",storeTypeGuard:G,initialValue:{sharedCollections:[]}})){}var B=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},K=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let W=class{constructor(e,t,r,n,o,a,i,s){this.hmacSigner=e,this.keyGeneratorAes256=t,this.rsaKeyPairGenerator=r,this.kwc5Decryptor=n,this.kwc5Encryptor=o,this.rsaDecryptor=a,this.rsaEncryptor=i,this.rsaSigner=s}async createResourceKey(){return await this.keyGeneratorAes256.generate()}async encryptSecureData(e,t){return await this.kwc5Encryptor.encrypt(e,t)}async decryptSecureData(e,t){return await this.kwc5Decryptor.decrypt(e,t)}async createProposeSignature(e,t){return await this.hmacSigner.sign(e,t)}async createRecipientKeyPair(){return await this.rsaKeyPairGenerator.generate()}async createAcceptSignature(e,t,r){const n=`${t}-accepted-${(0,L.s)(r)}`,o=(0,M.u)(n);return await this.rsaSigner.sign(e,o)}async encryptResourceKey(e,t){return await this.rsaEncryptor.encrypt(e,t)}async decryptResourceKey(e,t){return await this.rsaDecryptor.decrypt(e,t)}};W=B([(0,n.Injectable)(),K("design:paramtypes",[h.qn,h.co,h.eP,h.$S,h.ox,h.gF,h.Hd,h.kM])],W);var z=r(7502);function $(e){const{asn1:t,pki:r}=k(),n=r.privateKeyFromPem(e),o=r.privateKeyToAsn1(n),a=r.wrapRsaPrivateKey(o),i=t.toDer(a).getBytes();return(0,M.u)(i)}var Q=r(89685);function Y(e){const{asn1:t,pki:r}=k(),n=r.publicKeyFromPem(e),o=r.publicKeyToAsn1(n),a=t.toDer(o).getBytes();return(0,M.u)(a)}var X=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},J=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const Z=F.z.array(F.z.object({groupId:F.z.string(),name:F.z.string(),externalId:F.z.string().nullable().optional(),teamId:F.z.number().optional(),type:F.z.enum(["users","teamAdmins"]),publicKey:F.z.string(),privateKey:F.z.string(),revision:F.z.number(),users:F.z.array(F.z.object({userId:F.z.string(),alias:F.z.string(),referrer:F.z.string(),groupKey:F.z.string().nullable().optional(),acceptSignature:F.z.string().nullable().optional(),permission:F.z.enum(["admin","limited"]),rsaStatus:F.z.enum(["noKey","publicKey","sharingKeys"]),status:F.z.enum(["pending","accepted","refused","revoked"]),proposeSignatureUsingAlias:F.z.boolean().optional(),proposeSignature:F.z.string().optional()}))}));let ee=class{constructor(e,t){this.client=e,this.sharingCrypto=t}async createSignedUserGroupInvites(e,t,r,n,o){const{queries:{carbonState:i}}=this.client.getClient(a.carbonLegacyApi),s=await(0,v.z)(i({path:"userSession.sharingData.userGroups"}));if((0,w.hx)(s))throw new Error("Unable to access sharing data.");const c=s.data,u=Z.safeParse(c);if(!u.success)throw new Error("Invalid format of user group state");const l=u.data.filter((t=>e.includes(t.groupId)));return await Promise.all(l.map((async e=>{const a=e.users.find((e=>e.userId===r.login)),i=a?.groupKey;if(!i)throw new Error("Unable to get user group key.");const s=await this.sharingCrypto.decryptResourceKey(r.privateKey,(0,z.R)(i)),c=await this.sharingCrypto.decryptSecureData(s,(0,z.R)(e.privateKey)),u=$((0,Q.v)(c)),l=await this.sharingCrypto.createProposeSignature(n.resourceKey,(0,M.u)(e.groupId)),d=await this.sharingCrypto.createAcceptSignature(u,n.uuid,n.resourceKey),p={permission:t,proposeSignature:(0,L.s)(l),acceptSignature:(0,L.s)(d)};if(o){const t=await this.sharingCrypto.encryptResourceKey(Y(e.publicKey),n.resourceKey);return{...p,groupUUID:e.groupId,collectionKey:(0,L.s)(t)}}return{...p,groupId:e.groupId,groupKey:""}})))}};ee=X([(0,n.Injectable)(),J("design:paramtypes",[n.CqrsClient,W])],ee);const te=/[<>]/g;var re=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ne=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const oe=F.z.array(F.z.object({email:F.z.string(),login:F.z.string().nullable(),publicKey:F.z.string().nullable()}));let ae=class{constructor(e,t,r){this.client=e,this.serverApiClient=t,this.sharingCrypto=r}async getCurrentUserWithKeys(){const{queries:{carbonStateList:e}}=this.client.getClient(a.carbonLegacyApi);return await(0,v.z)(e({paths:["userSession.account.login","userSession.session.keyPair.publicKey","userSession.session.keyPair.privateKey"]}).pipe((0,i.nb)({success:([e,t,r])=>{if("string"!=typeof e||"string"!=typeof t||"string"!=typeof r)throw new Error("Invalid format of current user keys");return{login:e,publicKey:Y(t),privateKey:$(r)}},failure:()=>{throw new Error("Failure getting current user and key pair")}})))}async createSignedUserInvites(e,t,r,n){const o=await(0,v.z)(this.serverApiClient.v1.sharingUserdevice.getUsersPublicKey({logins:e}).pipe((0,i.DZ)((()=>(0,w.Rn)("Cannot get public keys of requested users."))),(0,i.lk)((e=>(0,w.Vp)(e.data)))));if((0,w.hx)(o))throw new Error("Cannot get public keys of requested users.");const a=oe.safeParse(o.data.data);if(!a.success)throw new Error("Invalid format of user public keys response");const s=a.data.map((e=>{return{login:e.login?e.login:(t=e.email,t.trim().toLowerCase().replace(te,"")),publicKey:e.publicKey?Y(e.publicKey):null};var t})),c=[{login:r.login,publicKey:r.publicKey},...s];return await Promise.all(c.map((async e=>{const o=e.login===r.login,a=e.publicKey?await this.sharingCrypto.encryptResourceKey(e.publicKey,n.resourceKey):void 0,i=a?(0,L.s)(a):void 0,s=(0,M.u)(e.login),c=await this.sharingCrypto.createProposeSignature(n.resourceKey,s),u=(0,L.s)(c),l=o?await this.sharingCrypto.createAcceptSignature(r.privateKey,n.uuid,n.resourceKey):void 0,d=l?(0,L.s)(l):void 0;return{login:e.login,alias:e.login,permission:o?j.y3.Admin:t,proposeSignature:u,acceptSignature:d,collectionKey:i,proposeSignatureUsingAlias:!e.publicKey}})))}};ae=re([(0,n.Injectable)(),ne("design:paramtypes",[n.CqrsClient,h.lX,W])],ae);var ie=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},se=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ce=class{constructor(e,t,r,n,o){this.store=e,this.serverApiClient=t,this.sharingCrypto=r,this.sharingUserGroups=n,this.sharingUsers=o}async execute({body:e}){const{sharedCollections:t}=await this.store.getState(),r=`{${(0,U.Z)().toUpperCase()}}`,n=await this.sharingCrypto.createResourceKey(),{publicKey:a,privateKey:s}=await this.sharingCrypto.createRecipientKeyPair(),c=(0,M.u)(function(e){const{asn1:t,pki:r,util:n}=k(),o=n.createBuffer(e),a=t.fromDer(o),i=r.privateKeyFromAsn1(a),s=r.privateKeyToPem(i);return s.replace(/(?:\\[r]|[\r\n]+)+/g,"\n")}(s)),u=await this.sharingCrypto.encryptSecureData(n,c),l=await this.sharingUsers.getCurrentUserWithKeys(),d=await this.sharingUsers.createSignedUserInvites(e.users,e.permission,{login:l.login,privateKey:l.privateKey,publicKey:l.publicKey},{resourceKey:n,uuid:r}),p=await this.sharingUserGroups.createSignedUserGroupInvites(e.groups,e.permission,{login:l.login,privateKey:l.privateKey},{resourceKey:n,uuid:r},!0),f={collectionUUID:r,collectionName:e.collectionName,publicKey:(0,L.s)(a),privateKey:(0,L.s)(u),users:d,userGroups:p},h=await(0,v.z)(this.serverApiClient.v1.sharingUserdevice.createCollection(f).pipe((0,i.DZ)((e=>{if("BusinessError"===e.tag)return(0,w.Rn)((0,o.getCreateSharedCollectionFunctionalError)(e.code));throw new Error(e.message)})),(0,i.lk)((e=>(0,w.Vp)(e.data)))));if((0,w.hx)(h))return(0,w.Rn)((0,o.getCreateSharedCollectionFunctionalError)());const y=h.data.collections||[];return await this.store.set({sharedCollections:[...t,...y]}),await(0,w.Vp)(void 0)}};ce=ie([(0,n.CommandHandler)(o.CreateSharedCollectionCommand),se("design:paramtypes",[H,h.lX,W,ee,ae])],ce);var ue=r(87065),le=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},de=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let pe=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,ue.U)((e=>(0,w.Vp)(e.sharedCollections))))}};pe=le([(0,n.QueryHandler)(o.GetSharedCollectionsQuery),de("design:paramtypes",[H])],pe);var fe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let he=class{};he=fe([(0,n.Module)({api:o.sharingCollectionsApi,stores:[H],providers:[W,ee,ae],handlers:{commands:{createSharedCollection:ce},events:{},queries:{getSharedCollections:pe}},imports:[h.nr,h.Dq]})],he)},75324:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enclaveSdkApi=void 0;const n=r(68224),o=r(11180),a=r(36314);t.enclaveSdkApi=(0,n.defineModuleApi)({name:"enclaveSdkApi",commands:{CheckDNSValidationCommand:o.CheckDNSValidationCommand,ClearSettingsCommand:o.ClearSettingsCommand,CreateTeamCommand:o.CreateTeamCommand,DeleteDomainCommand:o.DeleteDomainCommand,EnableSsoCommand:o.EnableSsoCommand,InitSsoProvisioningCommand:o.InitSsoProvisioningCommand,LoginUserWithEnclaveSSOCommand:o.LoginUserWithEnclaveSSOCommand,ProvisionDomainCommand:o.ProvisionDomainCommand,TestLoginUserWithEnclaveSSOCommand:o.TestLoginUserWithEnclaveSSOCommand,UpdateMetadataCommand:o.UpdateMetadataCommand,ValidateMetadataCommand:o.ValidateMetadataCommand},events:{},queries:{SsoProvisioningQuery:a.SsoProvisioningQuery}})},32440:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CheckDNSValidationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.CheckDNSValidationCommand=o},29332:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClearSettingsCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.ClearSettingsCommand=o},95160:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreateTeamCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.CreateTeamCommand=o},66113:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteDomainCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DeleteDomainCommand=o},32346:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnableSsoCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.EnableSsoCommand=o},11180:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(32440),t),o(r(95160),t),o(r(96699),t),o(r(86696),t),o(r(81815),t),o(r(66113),t),o(r(79526),t),o(r(29463),t),o(r(91172),t),o(r(32346),t),o(r(29332),t)},79526:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InitSsoProvisioningCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.InitSsoProvisioningCommand=o},96699:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoginUserWithEnclaveSSOCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.LoginUserWithEnclaveSSOCommand=o},86696:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProvisionDomainCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.ProvisionDomainCommand=o},81815:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TestLoginUserWithEnclaveSSOCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.TestLoginUserWithEnclaveSSOCommand=o},29463:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateMetadataCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.UpdateMetadataCommand=o},91172:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ValidateMetadataCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.ValidateMetadataCommand=o},68057:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(75324),t),o(r(11180),t),o(r(36314),t),o(r(73587),t)},36314:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(53226),t)},53226:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SsoProvisioningQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.SsoProvisioningQuery=o},73587:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SsoProvisioning=t.InferredSsoState=t.Domain=t.DomainPendingReason=t.DomainVerificationStatus=void 0;const n=r(10295);t.DomainVerificationStatus=n.z.enum(["valid","pending","expired","invalid"]),t.DomainPendingReason=n.z.enum(["tokenNotFound","invalidToken"]),t.Domain=n.z.object({domainName:n.z.string(),status:t.DomainVerificationStatus.nullable(),verificationToken:n.z.string(),lastCheckDateUnix:n.z.number(),pendingReason:t.DomainPendingReason.nullable()}),t.InferredSsoState=n.z.enum(["NitroComplete","NitroIncomplete","SelfHostedComplete","SelfHostedIncomplete","SsoConnectorIncomplete","SsoConnectorComplete","None","Unknown"]),t.SsoProvisioning=n.z.object({global:n.z.object({adminProvisioningKey:n.z.string().nullable(),isTeamProvisionedInNitro:n.z.boolean().nullable(),inferredSsoState:t.InferredSsoState,teamUuid:n.z.string().nullable(),ssoCapable:n.z.boolean().nullable()}),idpApplication:n.z.object({entityId:n.z.string().nullable(),acsUrl:n.z.string().nullable(),signOnUrl:n.z.string().nullable()}),idpMetadata:n.z.object({metadataValue:n.z.string().nullable()}),domainSetup:n.z.array(n.z.object({domainName:n.z.string().url(),verificationStatus:t.DomainVerificationStatus})),domainVerificationInfo:n.z.record(n.z.string().url(),n.z.object({subdomainValue:n.z.string().nullable(),txtValue:n.z.string().nullable(),verificationStatus:t.DomainVerificationStatus.nullable(),tokenFound:n.z.string().nullable(),pendingReason:t.DomainPendingReason.nullable()})),enableSSO:n.z.object({ssoEnabled:n.z.boolean().nullable()})})},85669:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(68057),t)},74805:(e,t,r)=>{"use strict";r.d(t,{N6:()=>a,Em:()=>$e,xp:()=>o});const n=["local","staging","prod"];function o(e){return n.includes(e)}class a{constructor(e,t,r){this.cloudflareHeaders=e,this.enclaveUrl=t,this.environment=r}}var i=r(32839),s=r(17530),c=r(85669);class u{}var l=r(87279),d=r(7165),p=r(56695),f=r(60399);const h=e=>{const t=e.match(/[\da-f]{2}/gi);return t?new Uint8Array(t.map((e=>parseInt(e,16)))).buffer:(new Uint8Array).buffer},y=d.z.object({data:d.z.object({attestation:d.z.string()}),requestId:d.z.string()});class m{decode(e){const t=y.safeParse(e);if(!t.success)throw new Error("Invalid response format");return{attestation:h(t.data.data.attestation)}}}const g=async(e,t)=>{const{headers:r,httpClient:n,publicKey:o}=t,a=await(async e=>(await p.ready,{clientPublicKey:p.to_hex(e)}))(o),i=await(0,f.z)(n.post(e,a,{observe:"body",responseType:"json",responseBodyDecoder:new m,withCredentials:!0,headers:r}));if((0,l.hx)(i))throw new Error("string"==typeof i.error?i.error:"HTTP Error");return i.data},v=d.z.object({requestId:d.z.string(),errors:d.z.array(d.z.object({status:d.z.string(),code:d.z.string(),message:d.z.string()}))});class b{assertData(e){if(!e)throw new Error("toDecode expected to be truthy");if("[object Object]"!=`${e}`||Array.isArray(e))throw new Error("toDecode expected to be object");if(!Object.prototype.hasOwnProperty.call(e,"data"))throw new Error('toDecode expected to contain a "data" property');const t=e;if("string"!=typeof t.data)throw new Error("toDecode.data expected to be type string but was "+typeof t.data)}decode(e){return this.assertData(e),e.data}}var w=r(76465);function R(e){return(0,w.Jx)(new Uint8Array(e))}var S=r(89685),E=r(7502);const O=d.z.object({module_id:d.z.string(),timestamp:d.z.bigint(),digest:d.z.string(),pcrs:d.z.record(d.z.string(),d.z.instanceof(Uint8Array)),certificate:d.z.instanceof(Uint8Array),cabundle:d.z.array(d.z.instanceof(Uint8Array)),user_data:d.z.instanceof(Uint8Array),nonce:d.z.instanceof(Uint8Array).nullable()}),C=d.z.object({header:d.z.string(),publicKey:d.z.string()}),P=e=>{const t=R(new Uint8Array(e)),r=(n=t,Array.isArray(n)?n:n.value);var n;const[o,,a,i]=r;if(!o)throw new Error("parseSignedMessage: no protected header field");if(!a)throw new Error("parseSignedMessage: no payload field");if(!i)throw new Error("parseSignedMessage: no signature field");return{payload:new Uint8Array(a).buffer,protectedHeaders:new Uint8Array(o).buffer,signature:new Uint8Array(i).buffer}};var A=r(71833);var j=r(96303);const _=e=>(0,j.k)((e=>new Uint8Array(e).buffer)(e)),T=(e,t)=>{switch(t){case"local":return(e=>{if("9e33eca6497ec3b68ae13735cd28b1a9be1235d3440f10121327150495de4a4f854eb902a62991b366757f3d87ce57e4"!==_(e[0]))throw new Error("Enclave image invalid");return!0})(e);case"staging":return(e=>{if("90528150e0f0537fa9e96b067137f6494d525f2fcfd15b478ce28ab2cfaf38dd4e24ad73f9d9d6f238a7f39f2d1956b7"!==_(e[3]))throw new Error("Unexpected IAM role on parent instance");return!0})(e);case"prod":return(e=>{const t=_(e[3]),r=_(e[8]);if("dfb6428f132530b8c021bea8cbdba2c87c96308ba7e81c7aff0655ec71228122a9297fd31fe5db7927a7322e396e4c16"!==t||"4dbb92401207e019e132d86677857081d8e4d21f946f3561b264b7389c6982d3a86bcf9560cef4a2327eac5c5c6ab820"!==r)throw new Error("Unexpected IAM role on parent instance");return!0})(e)}};const I=async(e,t,r,n)=>{const o=A.KBB.fromBER(n),a=await o.getPublicKey(),i=["Signature1",t,new ArrayBuffer(0),r],s=(c=i,(0,w.cv)(c));var c;return await crypto.subtle.verify({name:"ECDSA",hash:"SHA-384"},a,e,s)},x=async e=>{const{attestation:t,environment:r}=e,{protectedHeaders:n,payload:o,signature:a}=P(t),i=(e=>{const t=R(e),r=O.safeParse(t);if(!r.success)throw new Error("failed to parse attestation document");const n=r.data,o=(0,S.v)(n.user_data),a=JSON.parse(o),i=C.safeParse(a);if(!i.success)throw new Error("failed to parse server crypto info");const s=i.data;return{moduleId:n.module_id,timestamp:n.timestamp,digest:n.digest,pcrs:n.pcrs,certificate:new Uint8Array(n.certificate).buffer,cabundle:(c=n.cabundle,c.map((e=>new Uint8Array(e).buffer))),serverHeader:(0,E.R)(s.header),serverPublicKey:(0,E.R)(s.publicKey),nonce:null!==n.nonce?new Uint8Array(n.nonce).buffer:null};var c})(o),s=await(async(e,t,r)=>{const n=(e=>"local"===e?"MIICqzCCAjKgAwIBAgIUGdKnU0kGWeXtXL7BK1VpIbnjXZkwCgYIKoZIzj0EAwMwgYQxCzAJBgNVBAYTAkZSMQ8wDQYDVQQIDAZGcmFuY2UxDjAMBgNVBAcMBVBhcmlzMQswCQYDVQQKDAJETDELMAkGA1UECwwCREwxFjAUBgNVBAMMDU5pdHJvIFRlc3QgQ0ExIjAgBgkqhkiG9w0BCQEWE3NlcnZlckBkYXNobGFuZS5jb20wHhcNMjIwNDI3MTI0NTQ5WhcNNDIwNDIyMTI0NTQ5WjCBhDELMAkGA1UEBhMCRlIxDzANBgNVBAgMBkZyYW5jZTEOMAwGA1UEBwwFUGFyaXMxCzAJBgNVBAoMAkRMMQswCQYDVQQLDAJETDEWMBQGA1UEAwwNTml0cm8gVGVzdCBDQTEiMCAGCSqGSIb3DQEJARYTc2VydmVyQGRhc2hsYW5lLmNvbTB2MBAGByqGSM49AgEGBSuBBAAiA2IABLeu4raurW6XA9/c13rzPwzbk1aYAR/fPj49YoaZI+K0PFfo75rKUr0m7LawW/jpwkAqWad44SXxj2fF+REDz4ii8tUjVl8Ijp1ohrQEAvDZLcxS98bQV+NFmoyx6QxbQKNjMGEwHQYDVR0OBBYEFM5p3QEkzjDGWRntWRdqC0aWiGiaMB8GA1UdIwQYMBaAFM5p3QEkzjDGWRntWRdqC0aWiGiaMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2cAMGQCMGdird9+5r9vw9vt2x4q86nMJwu2eGXbcOE6sVRSQ92nWYHk2VX2NZix1tBX3nMGiQIwRHALNGgnkUofNBOoxZ/Pntk14Djv5Kt3/fKd6NWFRhyFZ97jho4c+slS7u9LrttE":"MIICETCCAZagAwIBAgIRAPkxdWgbkK/hHUbMtOTn+FYwCgYIKoZIzj0EAwMwSTELMAkGA1UEBhMCVVMxDzANBgNVBAoMBkFtYXpvbjEMMAoGA1UECwwDQVdTMRswGQYDVQQDDBJhd3Mubml0cm8tZW5jbGF2ZXMwHhcNMTkxMDI4MTMyODA1WhcNNDkxMDI4MTQyODA1WjBJMQswCQYDVQQGEwJVUzEPMA0GA1UECgwGQW1hem9uMQwwCgYDVQQLDANBV1MxGzAZBgNVBAMMEmF3cy5uaXRyby1lbmNsYXZlczB2MBAGByqGSM49AgEGBSuBBAAiA2IABPwCVOumCMHzaHDimtqQvkY4MpJzbolL//Zy2YlES1BR5TSksfbb48C8WBoyt7F2Bw7eEtaaP+ohG2bnUs990d0JX28TcPQXCEPZ3BABIeTPYwEoCWZEh8l5YoQwTcU/9KNCMEAwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUkCW1DdkFR+eWw5b6cp3PmanfS5YwDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2kAMGYCMQCjfy+Rocm9Xue4YnwWmNJVA44fA0P5W2OpYow9OYCVRaEevL8uO1XYru5xtMPWrfMCMQCi85sWBbJwKKXdS6BptQFuZbT73o/gBh1qUxl/nNr12UO8Yfwr6wPLb+6NIwLz3/Y=")(r),o=A.KBB.fromBER(e),a=t.map((e=>A.KBB.fromBER(e)));a.push(o);const i=[A.KBB.fromBER((0,E.R)(n))],s=new A.DMg({trustedCerts:i,certs:a});return(await s.verify()).result})(i.certificate,i.cabundle,r);if(!s)throw new Error("Invalid cert chain!");if(!await I(a,n,o,i.certificate))throw new Error("Invalid signature!");return T(i.pcrs,r),{serverPublicKey:i.serverPublicKey,serverHeader:i.serverHeader}};var D,U;!function(e){e.CLIENT_HELLO="api/tunnel/ClientHello",e.TERMINATE_HELLO="api/tunnel/TerminateHello"}(D||(D={})),function(e){e.AUTH_CONFIRM_LOGIN="api/authentication/ConfirmLogin",e.AUTH_REQUEST_LOGIN="api/authentication/RequestLogin",e.AUTH_REQUEST_TEST_LOGIN="api/authentication/RequestTestLogin",e.AUTH_CONFIRM_TEST_LOGIN="api/authentication/ConfirmTestLogin",e.DOMAINS_CHECK_DNS_VALIDATION="api/domains/CheckDNSValidation",e.DOMAINS_DELETE_DOMAIN="api/domains/DeleteDomain",e.DOMAINS_PROVISION_DOMAIN="api/domains/ProvisionDomain",e.DOMAINS_UPDATE_DOMAIN="api/domains/UpdateDomain",e.TEAMS_CREATE_TEAM="api/teams/CreateTeam",e.TEAMS_GET_TEAM_STATUS="api/teams/GetTeamStatus",e.TEAMS_DELETE_TEAM="api/teams/DeleteTeam"}(U||(U={}));const M=async(e,t)=>{await p.ready;const{enclaveApiSettings:{cloudflareHeaders:r,enclaveUrl:n,environment:o},httpClient:a,platformInfo:s,data:c}=t,u={};u["dashlane-client-agent"]=JSON.stringify({platform:s.platformName,osversion:s.osVersion,version:s.appVersion}),r.accessKey&&r.secretKey&&(u["CF-Access-Client-Id"]=r.accessKey,u["CF-Access-Client-Secret"]=r.secretKey);const d=p.crypto_kx_keypair(),{clientHelloUrl:h,terminateHelloUrl:y,secureContentUrl:m}=((e,t)=>({clientHelloUrl:`${e}${D.CLIENT_HELLO}`,terminateHelloUrl:`${e}${D.TERMINATE_HELLO}`,secureContentUrl:`${e}${t}`}))(n,e),w=await g(h,{headers:u,httpClient:a,publicKey:d.publicKey}),{serverPublicKey:R,serverHeader:S}=await x({attestation:w.attestation,environment:o}),E=await(async(e,t)=>{const{headers:r,clientKeyPair:n,httpClient:o,serverPublicKey:a}=t;await p.ready;const i=p.crypto_kx_client_session_keys(n.publicKey,n.privateKey,new Uint8Array(a)),s=p.crypto_secretstream_xchacha20poly1305_init_push(i.sharedRx),c=s.state,u=s.header,d={clientHeader:p.to_hex(u)},h=await(0,f.z)(o.post(e,d,{observe:"response",responseType:"json",withCredentials:!0,headers:r}));if((0,l.hx)(h))throw new Error("HTTP error");return{clientStateOut:c,sessionKeys:i}})(y,{headers:u,httpClient:a,clientKeyPair:d,serverPublicKey:R});return await(async(e,t)=>{const{clientStateOut:r,serverHeader:n,sessionKeys:o,headers:a,httpClient:s}=t;await p.ready;const c=p.crypto_secretstream_xchacha20poly1305_push(r,p.from_string(t.data),null,p.crypto_secretstream_xchacha20poly1305_TAG_MESSAGE),u={data:p.to_hex(c)},d=await(0,f.z)(s.post(e,u,{observe:"body",responseType:"json",responseBodyDecoder:new b,withCredentials:!0,headers:a}));if((0,l.hx)(d)){if(d.error instanceof i.BadStatus){const e=await JSON.parse(await d.error.response.text()),t=v.safeParse(e);if(t.success){const e=t.data.errors[0];throw new Error(e.code)}}throw new Error("HTTP error")}const h=p.crypto_secretstream_xchacha20poly1305_init_pull(new Uint8Array(n),o.sharedTx),y=p.crypto_secretstream_xchacha20poly1305_pull(h,p.from_hex(d.data)).message;return{decryptedResponse:p.to_string(y)}})(m,{data:c,headers:u,httpClient:a,clientStateOut:E.clientStateOut,sessionKeys:E.sessionKeys,serverHeader:S})};var N=r(68224);const k=e=>c.SsoProvisioning.safeParse(e).success,L={global:{adminProvisioningKey:null,teamUuid:null,isTeamProvisionedInNitro:null,inferredSsoState:c.InferredSsoState.enum.Unknown,ssoCapable:null},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}};class F extends((0,i.defineStore)({persist:!1,capacity:i.StoreCapacity._010KB,initialValue:L,scope:N.UseCaseScope.User,storeName:"nitro-sso-provisioning-state",storeTypeGuard:k})){}var q=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},V=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const G="_dashlane-challenge";let H=class{constructor(e){this.store=e}async reset(){await this.store.init({global:{adminProvisioningKey:null,teamUuid:null,isTeamProvisionedInNitro:null,inferredSsoState:c.InferredSsoState.enum.Unknown,ssoCapable:null},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}})}async update(e,t){const r=await this.store.getState(),n=((e,t)=>({...e,...t}))(r,{[t]:{...r[t],...e}});await this.store.set(n)}set(e){return this.store.set(e)}};H=q([(0,i.Injectable)(),V("design:paramtypes",[F])],H);var B=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},K=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const W=d.z.object({previousStatus:d.z.string(),status:d.z.enum(["valid","pending","expired","invalid"]),verificationToken:d.z.string(),lastCheckDateUnix:d.z.number(),pendingReason:d.z.enum(["tokenNotFound","invalidToken"]).nullable(),tokenFound:d.z.ostring()});let z=class{constructor(e,t,r,n,o){this.httpClient=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=n,this.ssoProvisioningStore=o}async execute(e){const t=await this.ssoProvisioningStore.getState(),{global:{adminProvisioningKey:r},domainVerificationInfo:n}=t,o=e.body.domainName;if(!r)throw new Error("Admin Provisioning Key is not available. Is state initialized and has the team been provisioned in the enclave?");if(!o)throw new Error("Missing domain name. Is state initialized and has a domain been provisioned in the enclave?");const a={adminProvisioningKey:r,domainName:o},i=await this.platformInfoService.getPlatformInfo(),s=JSON.stringify(a),{decryptedResponse:c}=await M(U.DOMAINS_CHECK_DNS_VALIDATION,{data:s,httpClient:this.httpClient,enclaveApiSettings:this.enclaveApiSettings,platformInfo:i});try{const e=W.parse(JSON.parse(c)),t=n[o];t.txtValue=e.verificationToken,t.verificationStatus=e.status,t.tokenFound=e.tokenFound??null,await this.ssoProvisioningStoreUpdater.update(n,"domainVerificationInfo")}catch(e){return(0,l.Rn)({tag:"failed to parse response"})}return(0,l.Vp)(void 0)}};z=B([(0,i.CommandHandler)(c.CheckDNSValidationCommand),K("design:paramtypes",[i.HttpClient,a,s.tu,H,F])],z);var $=r(53576);const Q=d.z.object({data:d.z.object({deviceAccessKey:d.z.string(),deviceSecretKey:d.z.string()})}),Y=d.z.object({data:d.z.object({devicePrivateKey:d.z.string(),devicePublicKey:d.z.string()})}),X=async(e,t)=>{await e({name:"updateTeamSettings",args:[{...t}]})};var J=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Z=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ee=class{constructor(e,t,r,n,o,a){this.httpClient=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=n,this.ssoProvisioningStore=o,this.carbonLegacy=a.getClient($.carbonLegacyApi)}async execute(){const{commands:{carbon:e}}=this.carbonLegacy,t=(await this.ssoProvisioningStore.getState()).global.teamUuid;if(!t)throw new Error("Team UUID not available. Are you logged in?");const{deviceAccessKey:r,devicePublicKey:n,deviceSecretKey:o,devicePrivateKey:a}=await(async e=>{const t=await e({name:"registerTeamDevice",args:[{platform:"nitro_encryption_service",deviceName:"Nitro Encryption Service"}]});if("success"!==t.tag)throw new Error("Failed to register a team device during team provisioning");const{data:{deviceAccessKey:r,deviceSecretKey:n}}=Q.parse(t.data.carbonResult),o=await e({name:"registerTeamDeviceAccount",args:[{deviceAccessKey:r,shouldGenerateDeviceKeyPair:!0}]});if("success"!==o.tag)throw new Error("Failed to register a team device account during team provisioning");const{data:{devicePrivateKey:a,devicePublicKey:i}}=Y.parse(o.data.carbonResult);return{deviceAccessKey:r,deviceSecretKey:n,devicePrivateKey:a,devicePublicKey:i}})(e),i=new URL(this.enclaveApiSettings.enclaveUrl).origin;await X(e,{ssoServiceProviderUrl:i}),await this.ssoProvisioningStoreUpdater.update({inferredSsoState:c.InferredSsoState.enum.NitroIncomplete},"global");const s={teamDeviceCredentials:{teamUuid:t,accessKey:r,secretKey:o,sharingPublicKey:n,sharingPrivateKey:a}},u=JSON.stringify(s);let d;try{const e=await this.platformInfoService.getPlatformInfo();d=(await M(U.TEAMS_CREATE_TEAM,{data:u,httpClient:this.httpClient,enclaveApiSettings:this.enclaveApiSettings,platformInfo:e})).decryptedResponse}catch(t){return await X(e,{ssoServiceProviderUrl:null}),await e({name:"deactivateTeamDevice",args:[{teamDeviceAccessKey:r}]}),await this.ssoProvisioningStoreUpdater.update({inferredSsoState:c.InferredSsoState.enum.None},"global"),(0,l.Rn)({tag:t instanceof Error?t.message:"HTTP Error"})}let p=null;try{p=JSON.parse(d)?.adminProvisioningKey??null}catch{return(0,l.Rn)({tag:"Unable to parse response to get the provisioning key"})}return p?(await e({name:"persistAdminProvisioningKey",args:[{adminProvisioningKey:p}]}),await this.ssoProvisioningStoreUpdater.update({adminProvisioningKey:p,isTeamProvisionedInNitro:!0},"global"),(0,l.Vp)(void 0)):(0,l.Rn)({tag:"parsed result does not have a provisioning key"})}};ee=J([(0,i.CommandHandler)(c.CreateTeamCommand),Z("design:paramtypes",[i.HttpClient,a,s.tu,H,F,i.CqrsClient])],ee);const te=d.z.object({idpAuthorizeUrl:d.z.string()});var re=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ne=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let oe=class{constructor(e,t,r,n,o){this.httpClient=e,this.enclaveApiSettings=t,this.enclaveLoginContext=r,this.platformInfoService=n,this.cqrsClient=o}async execute(e){const t=e.body.userEmailAddress,r=t.slice(t.indexOf("@")+1);try{const t=await this.platformInfoService.getPlatformInfo(),n=await(async(e,t,r,n)=>{const o={enclaveApiSettings:t,httpClient:e,platformInfo:n,data:JSON.stringify({domainName:r})},a=await M(U.AUTH_REQUEST_LOGIN,o);return JSON.parse(a.decryptedResponse)})(this.httpClient,this.enclaveApiSettings,r,t),{samlToken:o}=await this.enclaveLoginContext.getSamlFromLogin(n.idpAuthorizeUrl,!0),a=await(async(e,t,r,n,o)=>{const a=btoa(atob(n).replace(/\n/g,"")),i={httpClient:e,enclaveApiSettings:t,platformInfo:o,data:JSON.stringify({domainName:r,samlResponse:a})},s=await M(U.AUTH_CONFIRM_LOGIN,i);return JSON.parse(s.decryptedResponse)})(this.httpClient,this.enclaveApiSettings,r,o,t),i={...a,login:e.body.userEmailAddress};return await this.enclaveLoginContext.redirectUserIntoLoginFlow(i),(0,l.Vp)(void 0)}catch{const{carbon:e}=this.cqrsClient.getClient($.carbonLegacyApi).commands;return e({name:"addLoginNotification",args:[{type:"UNKNOWN_ERROR",message:"Login failed."}]}),await this.enclaveLoginContext.redirectUserToLoginPage(),(0,l.Rn)({tag:"Failure",errorMessage:"Failed to login"})}}};oe=re([(0,i.CommandHandler)(c.LoginUserWithEnclaveSSOCommand),ne("design:paramtypes",[i.HttpClient,a,u,s.tu,i.CqrsClient])],oe);const ae=d.z.object({error:d.z.string()}),ie=d.z.object({data:d.z.object({samlIdpEntryPoint:d.z.string(),samlIdpCertificate:d.z.string()})}),se=async(e,t)=>{if(null===t)return{samlIdpEntryPoint:"",samlIdpCertificate:""};const r=await e({name:"parseMetadataFields",args:[{ssoIdpMetadata:t}]});if((0,l.d6)(r))return ie.parse(r.data.carbonResult).data;throw new Error("failed to parse metadata, please validate first.")},ce=d.z.object({dnsVerificationToken:d.z.string()});var ue=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},le=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let de=class{constructor(e,t,r,n,o,a){this.httpClient=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=n,this.ssoProvisioningStore=o,this.carbonLegacy=a.getClient($.carbonLegacyApi)}async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacy,r=await this.ssoProvisioningStore.getState();if(!r.global.teamUuid)return(0,l.Rn)({tag:"Missing team UUID. Are you logged in?"});if(!r.global.adminProvisioningKey)return(0,l.Rn)({tag:"Missing provisioning key. Has the team been provisioned in the enclave environment?"});if(!e.domainName)return(0,l.Rn)({tag:"Domain name was not provided."});const n=r.idpMetadata.metadataValue?await se(t,r.idpMetadata.metadataValue):null,o={domainName:e.domainName,adminProvisioningKey:r.global.adminProvisioningKey,idpMetadata:n?{certificate:n.samlIdpCertificate,entrypoint:n.samlIdpEntryPoint}:void 0,teamUuid:r.global.teamUuid};try{const{dnsVerificationToken:t}=await(async(e,t,r,n)=>{const o=JSON.stringify(n),a=await e.getPlatformInfo(),{decryptedResponse:i}=await M(U.DOMAINS_PROVISION_DOMAIN,{data:o,httpClient:t,enclaveApiSettings:r,platformInfo:a});return ce.parse(JSON.parse(i))})(this.platformInfoService,this.httpClient,this.enclaveApiSettings,o);return r.domainSetup.push({domainName:e.domainName,verificationStatus:c.DomainVerificationStatus.enum.pending}),r.domainVerificationInfo[e.domainName]={txtValue:t,verificationStatus:c.DomainVerificationStatus.enum.pending,subdomainValue:G,pendingReason:null,tokenFound:null},await this.ssoProvisioningStoreUpdater.set(r),(0,l.Vp)(void 0)}catch(e){return Promise.resolve((0,l.Rn)({tag:e instanceof Error?e.message:"Unable to provision domain"}))}}};de=ue([(0,i.CommandHandler)(c.ProvisionDomainCommand),le("design:paramtypes",[i.HttpClient,a,s.tu,H,F,i.CqrsClient])],de);var pe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},fe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let he=class{constructor(e,t,r,n,o){this.httpClient=e,this.enclaveLoginContext=t,this.enclaveApiSettings=r,this.platformInfoService=n,this.ssoProvisioningStore=o}async execute(e){const t=await this.ssoProvisioningStore.getState(),{global:{adminProvisioningKey:r}}=t,n=e.body.domainName;if(!r||!n)return(0,l.Rn)({tag:"error",errorMessage:""});try{const e=await this.platformInfoService.getPlatformInfo(),t=await(async(e,t,r,n,o)=>{const a={httpClient:e,enclaveApiSettings:t,platformInfo:o,data:JSON.stringify({domainName:r,adminProvisioningKey:n})},i=await M(U.AUTH_REQUEST_TEST_LOGIN,a);return te.parse(JSON.parse(i.decryptedResponse))})(this.httpClient,this.enclaveApiSettings,n,r,e),{samlToken:o}=await this.enclaveLoginContext.getSamlFromLogin(t.idpAuthorizeUrl,!1);return await(async(e,t,r,n,o,a)=>{const i={httpClient:e,enclaveApiSettings:t,platformInfo:a,data:JSON.stringify({domainName:r,samlResponse:n,adminProvisioningKey:o})};return await M(U.AUTH_CONFIRM_TEST_LOGIN,i),{successful:!0}})(this.httpClient,this.enclaveApiSettings,n,o,r,e),await this.enclaveLoginContext.cleanupTestLogin(),(0,l.Vp)(void 0)}catch{return(0,l.Rn)({tag:"Failure",errorMessage:"Failed to login"})}}};he=pe([(0,i.CommandHandler)(c.TestLoginUserWithEnclaveSSOCommand),fe("design:paramtypes",[i.HttpClient,u,a,s.tu,F])],he);d.z.object({domainName:d.z.string(),teamUuid:d.z.string(),adminProvisioningKey:d.z.string()});var ye=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},me=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ge=class{constructor(e,t,r,n,o){this.httpClient=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=n,this.ssoProvisioningStore=o}async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.teamUuid)return(0,l.Rn)({tag:"Missing team UUID. Are you logged in?"});if(!t.global.adminProvisioningKey)return(0,l.Rn)({tag:"Missing provisioning key. Has the team been provisioned in the enclave environment?"});if(!e.domainName)return(0,l.Rn)({tag:"Missing domain name. Nothing to delete."});const r={domainName:e.domainName,teamUuid:t.global.teamUuid,adminProvisioningKey:t.global.adminProvisioningKey};try{return await(async(e,t,r,n)=>{const o=JSON.stringify(n),a=await e.getPlatformInfo();await M(U.DOMAINS_DELETE_DOMAIN,{data:o,httpClient:t,enclaveApiSettings:r,platformInfo:a})})(this.platformInfoService,this.httpClient,this.enclaveApiSettings,r),t.domainSetup=t.domainSetup.filter((t=>t.domainName!==e.domainName)),delete t.domainVerificationInfo[e.domainName],await this.ssoProvisioningStoreUpdater.set(t),(0,l.Vp)(void 0)}catch(e){const t=e instanceof Error?e.message:"Unable to delete domain.";return Promise.resolve((0,l.Rn)({tag:t}))}}};ge=ye([(0,i.CommandHandler)(c.DeleteDomainCommand),me("design:paramtypes",[i.HttpClient,a,s.tu,H,F])],ge);var ve=r(48844);const be=d.z.object({adminProvisioningKey:d.z.object({adminProvisioningKey:d.z.ostring().nullable(),itemId:d.z.ostring().nullable()}).optional().nullable()}),we=async(e,t)=>{const r=t({path:`userSession.teamAdminData.teams.${e}`}).pipe((0,ve.nb)({success:e=>{const t=be.safeParse(e);return t.success?{success:!0,value:t.data.adminProvisioningKey?.adminProvisioningKey??null}:{success:!1}},failure:()=>({success:!1})}));return await(0,f.z)(r)},Re=d.z.object({enabled:d.z.boolean()}).optional(),Se=d.z.object({data:d.z.object({teamInfo:d.z.object({uuid:d.z.ostring().nullable(),ssoServiceProviderUrl:d.z.ostring().nullable(),ssoIdpMetadata:d.z.ostring().nullable(),ssoIdpEntrypoint:d.z.ostring().nullable(),ssoEnabled:d.z.oboolean().nullable()}),capabilities:d.z.object({sso:Re})})}),Ee=async e=>{const t=await e({name:"getTeamInfo",args:[]});if("success"!==t.tag)throw new Error("failed to get team info");const{data:{teamInfo:r,capabilities:n}}=Se.parse(t.data.carbonResult);return{teamInfo:r,capabilities:n}},Oe=d.z.object({domains:d.z.array(c.Domain),updateDateUnix:d.z.number()});var Ce;!function(e){e.SsoConnector="SsoConnector",e.EncryptionService="EncryptionService"}(Ce||(Ce={}));var Pe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ae=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const je=(e,t,r,n)=>{if(null===e)return c.InferredSsoState.enum.Unknown;if(e){if(t)return c.InferredSsoState.enum.NitroComplete;if(n===Ce.EncryptionService)return c.InferredSsoState.enum.SelfHostedComplete;if(n===Ce.SsoConnector)return c.InferredSsoState.enum.SsoConnectorComplete}if(r){if(t)return c.InferredSsoState.enum.NitroIncomplete;if(n===Ce.EncryptionService)return c.InferredSsoState.enum.SelfHostedIncomplete;if(n===Ce.SsoConnector)return c.InferredSsoState.enum.SsoConnectorIncomplete}return c.InferredSsoState.enum.None};let _e=class{constructor(e,t,r,n,o){this.httpClient=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=n,this.carbonLegacy=o.getClient($.carbonLegacyApi)}getGlobalState(e,t,r,n,o,a){const i=!!t;return{adminProvisioningKey:t,isTeamProvisionedInNitro:i,inferredSsoState:je(r,i,o,e),ssoCapable:a.sso.enabled,teamUuid:n}}getIdPApplicationState(){return{acsUrl:(e=this.enclaveApiSettings.enclaveUrl,e?`${new URL(e).origin}/saml/callback`:""),entityId:"dashlane-nitro-sso",signOnUrl:"https://app.dashlane.com"};var e}getIdPMetadataState(e){return{metadataValue:e??null}}getDomainSetupState(e){return e.map((e=>({domainName:e.domainName,verificationStatus:e.status??"pending"})))}getDomainVerificationInfo(e){return e.reduce(((e,t)=>(e[t.domainName]={txtValue:t.verificationToken,verificationStatus:c.DomainVerificationStatus.parse(t.status),subdomainValue:G,pendingReason:t.pendingReason,tokenFound:null},e)),{})}getEnableSSOState(e){return{ssoEnabled:e??null}}async fetchInitialStateInfo(e){const{queries:{carbonState:t},commands:{carbon:r}}=this.carbonLegacy,n=[we(e,t),Ee(r)],[o,{teamInfo:a,capabilities:i}]=await Promise.all(n);let s={domains:[],updateDateUnix:0},c=null;o.success&&o.value&&a.uuid&&(c=o.value,s=await(async(e,t,r,n)=>{if(!n.teamUuid||!n.adminProvisioningKey)return{domains:[],updateDateUnix:0};const o=JSON.stringify(n),a=await e.getPlatformInfo(),{decryptedResponse:i}=await M(U.TEAMS_GET_TEAM_STATUS,{data:o,httpClient:t,enclaveApiSettings:r,platformInfo:a});return Oe.parse(JSON.parse(i))})(this.platformInfoService,this.httpClient,this.enclaveApiSettings,{adminProvisioningKey:c,teamUuid:a.uuid}));const u=c?null:await(async e=>{const t=await e({name:"getEncryptionServiceConfig",args:[]});return(0,l.d6)(t)?Ce.EncryptionService:Ce.SsoConnector})(r);return{inferredLegacySsoType:u,provisioningKey:c,teamInfo:a,teamStatus:s,capabilities:i}}async execute({body:{teamId:e}}){if(!e)return(0,l.Rn)({tag:"No teamId provided. Are you logged in?"});try{await this.ssoProvisioningStoreUpdater.reset();const{inferredLegacySsoType:t,teamStatus:r,teamInfo:n,provisioningKey:o,capabilities:a}=await this.fetchInitialStateInfo(e);return n.uuid?(await this.ssoProvisioningStoreUpdater.set({global:this.getGlobalState(t,o,n.ssoEnabled??null,n.uuid,n.ssoServiceProviderUrl??"",a),idpApplication:this.getIdPApplicationState(),idpMetadata:this.getIdPMetadataState(n.ssoIdpMetadata),domainSetup:this.getDomainSetupState(r.domains),domainVerificationInfo:this.getDomainVerificationInfo(r.domains),enableSSO:this.getEnableSSOState(n.ssoEnabled)}),(0,l.Vp)(void 0)):(0,l.Rn)({tag:"No teamUUID. Are you logged in?"})}catch(e){return(0,l.Rn)({tag:e instanceof Error?e.message:"Error initializing SSO Provisioning state."})}}};_e=Pe([(0,i.CommandHandler)(c.InitSsoProvisioningCommand),Ae("design:paramtypes",[i.HttpClient,a,s.tu,H,i.CqrsClient])],_e);d.z.object({domainName:d.z.string(),teamUuid:d.z.string(),adminProvisioningKey:d.z.string(),idpMetadata:d.z.object({certificate:d.z.string().optional(),entrypoint:d.z.string().optional()})});var Te=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ie=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let xe=class{constructor(e,t,r,n,o,a){this.httpClient=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=n,this.ssoProvisioningStore=o,this.carbonLegacy=a.getClient($.carbonLegacyApi)}async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.adminProvisioningKey||!t.global.teamUuid)return(0,l.Rn)({tag:"State not yet initialized"});const{commands:{carbon:r}}=this.carbonLegacy;let n="",o="";try{const t=await se(r,e.metadata);o=t.samlIdpEntryPoint,n=t.samlIdpCertificate}catch(e){return(0,l.Rn)({tag:`Error parsing metadata. ${e instanceof Error?e.message:""}`})}try{await(async(e,{metadata:t,entrypoint:r})=>{const n={ssoIdpMetadata:t||null,ssoIdpEntrypoint:t?r:""};await e({name:"updateTeamSettings",args:[n]})})(r,{metadata:e.metadata,entrypoint:o})}catch(e){return(0,l.Rn)({tag:`Error saving metadata. ${e instanceof Error?e.message:""}`})}try{const e=t.domainSetup.map((e=>{const r=e.domainName,a={adminProvisioningKey:t.global.adminProvisioningKey??"",domainName:r,teamUuid:t.global.teamUuid??"",idpMetadata:{certificate:n,entrypoint:o}};return(async(e,t,r,n)=>{const o=JSON.stringify(n),a=await e.getPlatformInfo();await M(U.DOMAINS_UPDATE_DOMAIN,{data:o,httpClient:t,enclaveApiSettings:r,platformInfo:a})})(this.platformInfoService,this.httpClient,this.enclaveApiSettings,a)}));await Promise.all(e)}catch(e){return(0,l.Rn)({tag:`failed updating team domain in Enclave environment. ${e instanceof Error?e.message:""}`})}return await this.ssoProvisioningStoreUpdater.update({metadataValue:e.metadata},"idpMetadata"),(0,l.Vp)(void 0)}};xe=Te([(0,i.CommandHandler)(c.UpdateMetadataCommand),Ie("design:paramtypes",[i.HttpClient,a,s.tu,H,F,i.CqrsClient])],xe);var De=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ue=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Me=class{constructor(e){this.carbonLegacy=e.getClient($.carbonLegacyApi)}async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacy,r=await(async(e,t)=>{if(null===t)return;const r=await e({name:"parseMetadataFields",args:[{ssoIdpMetadata:t}]});return(0,l.d6)(r)?void 0:ae.parse(r.error).error})(t,e.metadata);return r?(0,l.Rn)({tag:r}):(0,l.Vp)(void 0)}};Me=De([(0,i.CommandHandler)(c.ValidateMetadataCommand),Ue("design:paramtypes",[i.CqrsClient])],Me);var Ne=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ke=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Le=class{constructor(e,t,r){this.ssoProvisioningStoreUpdater=e,this.ssoProvisioningStore=t,this.carbonLegacy=r.getClient($.carbonLegacyApi)}async execute(){if((await this.ssoProvisioningStore.getState()).enableSSO.ssoEnabled)return(0,l.Rn)({tag:"SSO is already enabled"});try{const{commands:{carbon:e}}=this.carbonLegacy,t=await(async(e,{ssoEnabled:t})=>{const r=await e({name:"updateTeamSettings",args:[{ssoEnabled:t}]});return!(0,l.hx)(r)})(e,{ssoEnabled:!0});if(!t)return(0,l.Rn)({tag:"Something went wrong. Please contact our Customer Support."});await this.ssoProvisioningStoreUpdater.update({inferredSsoState:c.InferredSsoState.enum.NitroComplete},"global"),await this.ssoProvisioningStoreUpdater.update({ssoEnabled:!0},"enableSSO")}catch(e){return(0,l.Rn)({tag:"Unknown error"+(e instanceof Error?`: ${e.message}`:".")})}return(0,l.Vp)(void 0)}};Le=Ne([(0,i.CommandHandler)(c.EnableSsoCommand),ke("design:paramtypes",[H,F,i.CqrsClient])],Le);const Fe=d.z.object({});var qe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ve=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ge=class{constructor(e,t,r,n,o,a){this.httpClient=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=n,this.ssoProvisioningStore=o,this.carbonLegacy=a.getClient($.carbonLegacyApi)}async execute(){const{global:e,enableSSO:t}=await this.ssoProvisioningStore.getState(),{carbon:r}=this.carbonLegacy.commands;if(t.ssoEnabled)return(0,l.Rn)({tag:"SSO Already enabled"});if(!e.teamUuid)return(0,l.Rn)({tag:"Missing team UUID. Are you logged in?"});if(!e.adminProvisioningKey)return(0,l.Rn)({tag:"Missing provisioning key. Has the team been provisioned in the enclave environment?"});if(e.isTeamProvisionedInNitro){const t={teamUuid:e.teamUuid,adminProvisioningKey:e.adminProvisioningKey};try{await(async(e,t,r,n)=>{const o=JSON.stringify(n),a=await e.getPlatformInfo(),{decryptedResponse:i}=await M(U.TEAMS_DELETE_TEAM,{data:o,httpClient:t,enclaveApiSettings:r,platformInfo:a});return Fe.parse(JSON.parse(i))})(this.platformInfoService,this.httpClient,this.enclaveApiSettings,t)}catch(e){return(0,l.Rn)({tag:e instanceof Error?e.message:"Error deleting team in Nitro."})}try{await X(r,{ssoServiceProviderUrl:null,ssoIdpMetadata:null,ssoIdpEntrypoint:null})}catch(e){return(0,l.Rn)({tag:e instanceof Error?e.message:"Error updating team settings."})}}if(e.adminProvisioningKey)try{await r({name:"removeAdminProvisioningKey",args:[]})}catch(e){return(0,l.Rn)({tag:e instanceof Error?e.message:"Error removing provisioning key."})}return await this.ssoProvisioningStoreUpdater.reset(),(0,l.Vp)(void 0)}};Ge=qe([(0,i.CommandHandler)(c.ClearSettingsCommand),Ve("design:paramtypes",[i.HttpClient,a,s.tu,H,F,i.CqrsClient])],Ge);var He=r(87065),Be=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ke=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let We=class{constructor(e,t,r){this.httpClient=e,this.enclaveApiSettings=t,this.ssoProvisioningStore=r}execute(){return this.ssoProvisioningStore.state$.pipe((0,He.U)((e=>(0,l.Vp)(e))))}};We=Be([(0,i.QueryHandler)(c.SsoProvisioningQuery),Ke("design:paramtypes",[i.HttpClient,a,F])],We);var ze=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let $e=class{};$e=ze([(0,i.Module)({api:c.enclaveSdkApi,handlers:{commands:{loginUserWithEnclaveSSO:oe,provisionDomain:de,createTeam:ee,deleteDomain:ge,testLoginUserWithEnclaveSSO:he,initSsoProvisioning:_e,validateMetadata:Me,updateMetadata:xe,checkDNSValidation:z,enableSso:Le,clearSettings:Ge},events:{},queries:{ssoProvisioning:We}},configurations:{enclaveApiSettings:{token:a},enclaveLoginContextInfrastructure:{token:u}},imports:[i.HttpModule,s.iT],stores:[F],providers:[H]})],$e)},52886:(e,t,r)=>{"use strict";r.d(t,{X:()=>y});var n=r(7165),o=r(21763),a=r(839);const i={addListener:function(e){if(!(0,a.Ez)("tabs.onUpdated.addListener"))throw new Error("No tabs.onUpdated.addListener support");const t=(t,r,n)=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`tabs/onUpdated: ${e}`)}return e(t,r,n)};return chrome.tabs.onUpdated.addListener(t),t},removeListener:function(e){if(!(0,a.Ez)("tabs.onUpdated.removeListener"))throw new Error("No tabs.onUpdated.removeListener support");chrome.tabs.onUpdated.removeListener(e)}};const s={addListener:function(e){if(!(0,a.Ez)("tabs.onRemoved.addListener"))throw new Error("No tabs.onRemoved.addListener support");const t=(t,r)=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`tabs/onRemoved: ${e}`)}return e(t,r)};return chrome.tabs.onRemoved.addListener(t),t},removeListener:function(e){if(!(0,a.Ez)("tabs.onRemoved.removeListener"))throw new Error("No tabs.onRemoved.removeListener support");chrome.tabs.onRemoved.removeListener(e)}};const c={addListener:function(e){const t=(t,r,n)=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`runtime/onMessage: ${e}`)}return e(t,r,n)};if(!(0,a.Ez)("runtime.onMessage.addListener"))throw new Error("No runtime.onMessage.addListener support");return chrome.runtime.onMessage.addListener(t),t},removeListener:function(e){chrome.runtime.onMessage.removeListener(e)}};var u=r(31460),l=r(72733),d=r(24715),p=r(61222),f=r(92204),h=r(49259);class y{constructor(){this.interceptedTabId=void 0,this.originalTabId=void 0,this.samlReceived=!1}interceptSamlFromTab(e,t,r){const a=n.z.object({type:n.z.string(),saml:n.z.string()}),u=i.addListener(((t,r)=>{t===e.id&&r.url&&e.id&&(0,o.k)({target:{tabId:e.id,allFrames:!0},files:["content/contentScripts/dashlane-saml-intercept-script.js"],injectImmediately:!0})})),l=s.addListener((t=>{t===e.id&&(i.removeListener(u),s.removeListener(l),c.removeListener(d),r("Intercepting SAML - tab closed unexpectedly"))})),d=c.addListener((e=>{if(this.samlReceived)return!1;const r=a.safeParse(e);return!(!r.success||"SamlAssertionIntercepted"!==r.data.type)&&(this.samlReceived=!0,i.removeListener(u),s.removeListener(l),c.removeListener(d),t({samlToken:r.data.saml}),!0)}))}async redirectTabToUrl(e){if(this.interceptedTabId)return await(0,u.V)(this.interceptedTabId,{url:e});{const t=(await(0,l.T)({windowTypes:["normal"]})).id;return await(0,d.U)({windowId:t,url:e})}}async getActiveExtensionTabId(){const e=await(0,p.I)({currentWindow:!0,active:!0}),t=e.length>0?e[0]:null,r=(0,f.A)("");if(t?.id&&t.url?.includes(r))return t.id}getSamlFromLogin(e,t){return this.samlReceived=!1,this.originalTabId=void 0,new Promise(((r,n)=>{const o=()=>{(0,d.U)({url:e}).then((e=>{this.interceptedTabId=e.id,this.interceptSamlFromTab(e,r,n)}))},a=t=>{(0,u.V)(t,{url:e}).then((e=>{if(!e)throw new Error("Tab disappeared during nitro login");this.interceptedTabId=e.id,this.interceptSamlFromTab(e,r,n)}))};t?this.getActiveExtensionTabId().then((e=>{e?a(e):o()})):this.getActiveExtensionTabId().then((e=>{this.originalTabId=e,o()}))}))}async redirectUserIntoLoginFlow(e){const t={ssoToken:e.ssoToken,exists:e.exists,currentAuths:e.currentAuthenticationMethods,expectedAuths:e.expectedAuthenticationMethods,key:e.userServiceProviderKey,login:e.login},r=Object.entries(t).map((e=>`${e[0]}=${encodeURIComponent(e[1].toString())}`)).join("&"),n=(0,f.A)(`index.html#/sso?${r}`);await this.redirectTabToUrl(n)}async redirectUserToLoginPage(){const e=(0,f.A)("index.html#/login");await this.redirectTabToUrl(e)}async cleanupTestLogin(){this.interceptedTabId&&await(0,h.O)([this.interceptedTabId]),this.originalTabId&&(0,u.V)(this.originalTabId,{active:!0})}}},66179:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(41228),t),o(r(55775),t),o(r(85155),t),o(r(76045),t)},41228:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncApi=void 0;const n=r(68224),o=r(55775),a=r(85155);t.syncApi=(0,n.defineModuleApi)({name:"sync",commands:{SyncCommand:o.SyncCommand},queries:{SyncProgressQuery:a.SyncProgressQuery},events:{}})},55775:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SyncCommand=o},85155:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncProgressQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.Device})){}t.SyncProgressQuery=o},76045:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncStatuses=void 0,function(e){e.READY="ready",e.IN_PROGRESS="in_progress",e.SUCCESS="success",e.FAILURE="failure"}(t.SyncStatuses||(t.SyncStatuses={}))},83329:(e,t,r)=>{"use strict";r.d(t,{R:()=>E});var n=r(32839),o=r(68224),a=r(66179),i=r(87279),s=r(53576),c=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let l=class{constructor(e,t){this.carbonLegacy=e.getClient(s.carbonLegacyApi),this.logger=t}async sessionSync(e){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"sessionForceSync",arg:[{trigger:e}]})}getSyncState(){return this.carbonLegacy.queries.carbonState({path:"userSession.sync"})}};l=c([(0,n.Injectable)(),u("design:paramtypes",[n.CqrsClient,n.AppLogger])],l);var d=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},p=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let f=class{constructor(e){this.syncService=e}execute(e){const{trigger:t}=e.body;return this.syncService.sessionSync(t),Promise.resolve((0,i.Vp)(void 0))}};f=d([(0,n.CommandHandler)(a.SyncCommand),p("design:paramtypes",[l])],f);var h=r(48844);var y=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},m=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let g=class{constructor(e){this.syncService=e}execute(){return this.syncService.getSyncState().pipe((0,h.Qn)((e=>{if("object"!=typeof(t=e)||null===t||!("status"in t)||!Object.values(a.SyncStatuses).includes(t.status))throw new Error("Bad sync state format");var t;return{status:e.status}})))}};g=y([(0,n.QueryHandler)(a.SyncProgressQuery),m("design:paramtypes",[l])],g);var v=r(11494),b=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},w=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let R=class{constructor(e){this.syncService=e}async run(){return await this.syncService.sessionSync(v.Trigger.Periodic),Promise.resolve()}};R=b([(0,n.Injectable)(),w("design:paramtypes",[l])],R);var S=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let E=class{};E=S([(0,n.Module)({api:a.syncApi,handlers:{commands:{sync:f},events:{},queries:{syncProgress:g}},crons:[{handler:R,periodInMinutes:5,name:"periodic-sync-cron",scope:o.UseCaseScope.User}],providers:[l]})],E)},2639:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(53784),t)},18232:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.teamMembersApi=void 0;const n=r(68224),o=r(28539);t.teamMembersApi=(0,n.defineModuleApi)({name:"teamMembers",commands:{ProposeMembersCommand:o.ProposeMembersCommand},events:{},queries:{}})},28539:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(46316),t)},46316:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProposeMembersCommand=t.getProposeMembersFunctionalError=t.ProposeMembersCannotAddSeatDuringGracePeriod=t.ProposeMembersNotBillingAdmin=t.ProposeMembersPaymentFailed=t.ProposeMembersUserTeamInviteTokenNotFound=t.ProposeMembersNoFreeSloFreePlan=t.ProposeMembersNoFreeSlot=t.ProposeMembersInvalidOriginError=t.ProposeMembersErrorType=void 0;const n=r(68224),o=r(61475);var a;!function(e){e.InvalidOrigin="InvalidOrigin",e.NoFreeSlot="NoFreeSlot",e.NoFreeSlotFreePlan="NoFreeSlotFreePlan",e.UserTeamInviteTokenNotFound="UserTeamInviteTokenNotFound",e.PaymentFailed="PaymentFailed",e.NotBillingAdmin="NotBillingAdmin",e.CannotAddSeatDuringGracePeriod="CannotAddSeatDuringGracePeriod"}(a=t.ProposeMembersErrorType||(t.ProposeMembersErrorType={}));class i extends((0,o.FunctionalError)(a.InvalidOrigin,"Invalid origin")){}t.ProposeMembersInvalidOriginError=i;class s extends((0,o.FunctionalError)(a.NoFreeSlot,"No free slot")){}t.ProposeMembersNoFreeSlot=s;class c extends((0,o.FunctionalError)(a.NoFreeSlotFreePlan,"No free slot in free plan")){}t.ProposeMembersNoFreeSloFreePlan=c;class u extends((0,o.FunctionalError)(a.UserTeamInviteTokenNotFound,"No invite token to a team available for user")){}t.ProposeMembersUserTeamInviteTokenNotFound=u;class l extends((0,o.FunctionalError)(a.PaymentFailed,"Payment failed")){}t.ProposeMembersPaymentFailed=l;class d extends((0,o.FunctionalError)(a.NotBillingAdmin,"User is not the billing admin")){}t.ProposeMembersNotBillingAdmin=d;class p extends((0,o.FunctionalError)(a.CannotAddSeatDuringGracePeriod,"Seats cannot be added during grace period")){}t.ProposeMembersCannotAddSeatDuringGracePeriod=p,t.getProposeMembersFunctionalError=function(e){switch(e){case"invalid_origin":return new i;case"no_free_slot":return new s;case"no_free_slot_free_plan":return new c;case"USER_TEAM_INVITE_TOKEN_NOT_FOUND":return new u;case"payment_failed":return new l;case"not_billing_admin":return new d;case"cannot_add_seat_during_grace_period":return new p;default:throw new Error("Unknown server error")}};class f extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.ProposeMembersCommand=f},14054:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(24699),t)},24699:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SampleEvent=void 0;const n=r(68224);class o extends((0,n.defineEvent)({scope:n.UseCaseScope.User})){}t.SampleEvent=o},53784:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(18232),t),o(r(28539),t),o(r(14054),t),o(r(8346),t)},8346:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(47438),t)},47438:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SampleQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.SampleQuery=o},92447:(e,t,r)=>{"use strict";r.d(t,{X:()=>m});var n=r(32839),o=r(17530),a=r(2639),i=r(60399),s=r(48844),c=r(87279),u=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let d=class{constructor(e){this.serverApiClient=e}async callProposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:n}){try{return await(0,i.z)(this.serverApiClient.v1.teams.proposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:n}).pipe((0,s.DZ)((e=>{if("BusinessError"===e.tag)return(0,a.getProposeMembersFunctionalError)(e.code);throw new Error(e.message)})),(0,s.lk)((e=>(0,c.Vp)(e.data)))))}catch(e){return(0,c.Rn)({tag:"failure",error:`Propose Members failed - ${e}`})}}};d=u([(0,n.Injectable)(),l("design:paramtypes",[o.lX])],d);var p=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let h=class{constructor(e){this.proposeMembersService=e}execute({body:{proposedMemberLogins:e,force:t,origin:r,notificationOptions:n}}){return this.proposeMembersService.callProposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:n})}};h=p([(0,n.CommandHandler)(a.ProposeMembersCommand),f("design:paramtypes",[d])],h);var y=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let m=class{};m=y([(0,n.Module)({api:a.teamMembersApi,imports:[o.nr],providers:[d],handlers:{commands:{proposeMembers:h},events:{},queries:{}}})],m)},16530:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(77704),t),o(r(21028),t)},43541:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vaultItemsCrudApi=void 0;const n=r(68224),o=r(51836),a=r(50154),i=r(24094);t.vaultItemsCrudApi=(0,n.defineModuleApi)({name:"vaultItemsCrud",commands:{createVaultItem:o.CreateVaultItemCommand,deleteVaultItems:o.DeleteVaultItemsCommand,updateVaultItem:o.UpdateVaultItemCommand,emitTemporaryVaultItemEvent:o.EmitTemporaryVaultItemEventCommand},events:{createdEvent:a.CreatedEvent,deletedEvent:a.DeletedEvent,updatedEvent:a.UpdatedEvent},queries:{query:i.VaultItemsQuery}})},8892:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreateVaultItemCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.CreateVaultItemCommand=o},1704:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteVaultItemsCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DeleteVaultItemsCommand=o},29160:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmitTemporaryVaultItemEventCommand=t.EventType=void 0;const n=r(68224);!function(e){e.Deleted="deleted",e.Updated="updated",e.Created="created"}(t.EventType||(t.EventType={}));class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.EmitTemporaryVaultItemEventCommand=o},51836:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(8892),t),o(r(1704),t),o(r(17863),t),o(r(29160),t)},17863:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateVaultItemCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.UpdateVaultItemCommand=o},77911:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseEvent=void 0;const n=r(68224);class o extends((0,n.defineEvent)({scope:n.UseCaseScope.User})){}t.BaseEvent=o},9656:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreatedEvent=void 0;const n=r(77911);class o extends n.BaseEvent{}t.CreatedEvent=o},76962:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeletedEvent=void 0;const n=r(77911);class o extends n.BaseEvent{}t.DeletedEvent=o},50154:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(9656),t),o(r(76962),t),o(r(35713),t)},35713:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdatedEvent=void 0;const n=r(77911);class o extends n.BaseEvent{}t.UpdatedEvent=o},77704:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(43541),t),o(r(51836),t),o(r(50154),t),o(r(24094),t),o(r(33475),t)},24094:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(95859),t)},95859:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VaultItemsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.VaultItemsQuery=o},76666:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Country=void 0,function(e){e.AD="AD",e.AE="AE",e.AF="AF",e.AG="AG",e.AI="AI",e.AL="AL",e.AM="AM",e.AO="AO",e.AQ="AQ",e.AR="AR",e.AS="AS",e.AT="AT",e.AU="AU",e.AW="AW",e.AX="AX",e.AZ="AZ",e.BA="BA",e.BB="BB",e.BD="BD",e.BE="BE",e.BF="BF",e.BG="BG",e.BH="BH",e.BI="BI",e.BJ="BJ",e.BL="BL",e.BM="BM",e.BN="BN",e.BO="BO",e.BR="BR",e.BS="BS",e.BT="BT",e.BV="BV",e.BW="BW",e.BY="BY",e.BZ="BZ",e.CA="CA",e.CC="CC",e.CD="CD",e.CF="CF",e.CG="CG",e.CH="CH",e.CI="CI",e.CK="CK",e.CL="CL",e.CM="CM",e.CN="CN",e.CO="CO",e.CR="CR",e.CU="CU",e.CV="CV",e.CX="CX",e.CY="CY",e.CZ="CZ",e.DE="DE",e.DJ="DJ",e.DK="DK",e.DM="DM",e.DO="DO",e.DZ="DZ",e.EC="EC",e.EE="EE",e.EG="EG",e.EH="EH",e.ER="ER",e.ES="ES",e.ET="ET",e.FI="FI",e.FJ="FJ",e.FK="FK",e.FM="FM",e.FO="FO",e.FR="FR",e.GA="GA",e.GB="GB",e.GD="GD",e.GE="GE",e.GF="GF",e.GG="GG",e.GH="GH",e.GI="GI",e.GL="GL",e.GM="GM",e.GN="GN",e.GP="GP",e.GQ="GQ",e.GR="GR",e.GS="GS",e.GT="GT",e.GU="GU",e.GW="GW",e.GY="GY",e.HK="HK",e.HM="HM",e.HN="HN",e.HR="HR",e.HT="HT",e.HU="HU",e.ID="ID",e.IE="IE",e.IL="IL",e.IM="IM",e.IN="IN",e.IO="IO",e.IQ="IQ",e.IR="IR",e.IS="IS",e.IT="IT",e.JE="JE",e.JM="JM",e.JO="JO",e.JP="JP",e.KE="KE",e.KG="KG",e.KH="KH",e.KI="KI",e.KM="KM",e.KN="KN",e.KP="KP",e.KR="KR",e.KW="KW",e.KY="KY",e.KZ="KZ",e.LA="LA",e.LB="LB",e.LC="LC",e.LI="LI",e.LK="LK",e.LR="LR",e.LS="LS",e.LT="LT",e.LU="LU",e.LV="LV",e.LY="LY",e.MA="MA",e.MC="MC",e.MD="MD",e.ME="ME",e.MF="MF",e.MG="MG",e.MH="MH",e.MK="MK",e.ML="ML",e.MM="MM",e.MN="MN",e.MO="MO",e.MP="MP",e.MQ="MQ",e.MR="MR",e.MS="MS",e.MT="MT",e.MU="MU",e.MV="MV",e.MW="MW",e.MX="MX",e.MY="MY",e.MZ="MZ",e.NA="NA",e.NC="NC",e.NE="NE",e.NF="NF",e.NG="NG",e.NI="NI",e.NL="NL",e.NO="NO",e.NO_TYPE="NO_TYPE",e.NP="NP",e.NR="NR",e.NU="NU",e.NZ="NZ",e.OM="OM",e.PA="PA",e.PE="PE",e.PF="PF",e.PG="PG",e.PH="PH",e.PK="PK",e.PL="PL",e.PM="PM",e.PN="PN",e.PR="PR",e.PS="PS",e.PT="PT",e.PW="PW",e.PY="PY",e.QA="QA",e.RE="RE",e.RO="RO",e.RS="RS",e.RU="RU",e.RW="RW",e.SA="SA",e.SB="SB",e.SC="SC",e.SD="SD",e.SE="SE",e.SG="SG",e.SH="SH",e.SI="SI",e.SJ="SJ",e.SK="SK",e.SL="SL",e.SM="SM",e.SN="SN",e.SO="SO",e.SR="SR",e.ST="ST",e.SV="SV",e.SY="SY",e.SZ="SZ",e.TC="TC",e.TD="TD",e.TF="TF",e.TG="TG",e.TH="TH",e.TJ="TJ",e.TK="TK",e.TL="TL",e.TM="TM",e.TN="TN",e.TO="TO",e.TR="TR",e.TT="TT",e.TV="TV",e.TW="TW",e.TZ="TZ",e.UA="UA",e.UG="UG",e.UM="UM",e.UNIVERSAL="UNIVERSAL",e.US="US",e.UY="UY",e.UZ="UZ",e.VA="VA",e.VC="VC",e.VE="VE",e.VG="VG",e.VI="VI",e.VN="VN",e.VU="VU",e.WF="WF",e.WS="WS",e.XK="XK",e.YE="YE",e.YT="YT",e.ZA="ZA",e.ZM="ZM",e.ZW="ZW"}(t.Country||(t.Country={}))},32545:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Country=void 0;var n=r(76666);Object.defineProperty(t,"Country",{enumerable:!0,get:function(){return n.Country}})},17484:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},72713:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},98548:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},24603:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},43484:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(72713),t),o(r(98548),t),o(r(24603),t),o(r(42983),t),o(r(89205),t)},42983:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},89205:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},33475:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.Country=void 0;var a=r(32545);Object.defineProperty(t,"Country",{enumerable:!0,get:function(){return a.Country}}),o(r(17484),t),o(r(43484),t),o(r(96394),t),o(r(16988),t),o(r(41126),t),o(r(4720),t)},35018:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},96394:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(35018),t),o(r(93617),t)},93617:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentCardType=t.PaymentCardColorType=void 0,function(e){e.BLACK="BLACK",e.BLUE_1="BLUE_1",e.BLUE_2="BLUE_2",e.GOLD="GOLD",e.GREEN_1="GREEN_1",e.GREEN_2="GREEN_2",e.ORANGE="ORANGE",e.RED="RED",e.SILVER="SILVER",e.WHITE="WHITE"}(t.PaymentCardColorType||(t.PaymentCardColorType={})),function(e){e.PAYMENT_TYPE_AMEX="PAYMENT_TYPE_AMEX",e.PAYMENT_TYPE_DINERSCLUB="PAYMENT_TYPE_DINERSCLUB",e.PAYMENT_TYPE_DISCOVER="PAYMENT_TYPE_DISCOVER",e.PAYMENT_TYPE_JCB="PAYMENT_TYPE_JCB",e.PAYMENT_TYPE_MASTERCARD="PAYMENT_TYPE_MASTERCARD",e.PAYMENT_TYPE_VISA="PAYMENT_TYPE_VISA"}(t.PaymentCardType||(t.PaymentCardType={}))},74590:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},67871:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},95278:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},62647:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},16988:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(74590),t),o(r(67871),t),o(r(95278),t),o(r(62647),t),o(r(20056),t),o(r(64826),t)},20056:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneType=void 0,function(e){e.PHONE_TYPE_ANY="PHONE_TYPE_ANY",e.PHONE_TYPE_FAX="PHONE_TYPE_FAX",e.PHONE_TYPE_LANDLINE="PHONE_TYPE_LANDLINE",e.PHONE_TYPE_MOBILE="PHONE_TYPE_MOBILE",e.PHONE_TYPE_WORK_FAX="PHONE_TYPE_WORK_FAX",e.PHONE_TYPE_WORK_LANDLINE="PHONE_TYPE_WORK_LANDLINE",e.PHONE_TYPE_WORK_MOBILE="PHONE_TYPE_WORK_MOBILE"}(t.PhoneType||(t.PhoneType={}))},64826:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},41126:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoteColors=void 0,function(e){e.BLUE="BLUE",e.BROWN="BROWN",e.GRAY="GRAY",e.GREEN="GREEN",e.ORANGE="ORANGE",e.PINK="PINK",e.PURPLE="PURPLE",e.RED="RED",e.YELLOW="YELLOW"}(t.NoteColors||(t.NoteColors={}))},4720:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VaultItemType=void 0,function(e){e.Address="KWAddress",e.BankAccount="KWBankStatement",e.Company="KWCompany",e.Credential="KWAuthentifiant",e.DriversLicense="KWDriverLicence",e.Email="KWEmail",e.FiscalId="KWFiscalStatement",e.IdCard="KWIDCard",e.Identity="KWIdentity",e.Passport="KWPassport",e.PaymentCard="KWPaymentMean_creditCard",e.Phone="KWPhone",e.SecureNote="KWSecureNote",e.SocialSecurityId="KWSocialSecurityStatement",e.Website="KWPersonalWebsite"}(t.VaultItemType||(t.VaultItemType={}))},24494:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vaultOrganizationApi=void 0;const n=r(68224),o=r(77834),a=r(82824);t.vaultOrganizationApi=(0,n.defineModuleApi)({name:"vaultOrganization",commands:{deleteCollection:o.DeleteCollectionCommand,createCollection:o.CreateCollectionCommand,migrateCategories:o.MigrateCategoriesCommand,updateCollection:o.UpdateCollectionCommand},events:{},queries:{queryCollections:a.CollectionsQuery}})},26424:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreateCollectionCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.CreateCollectionCommand=o},95795:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteCollectionCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DeleteCollectionCommand=o},77834:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(95795),t),o(r(26424),t),o(r(57547),t),o(r(84608),t)},84608:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MigrateCategoriesCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.MigrateCategoriesCommand=o},57547:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateCollectionCommand=t.OperationType=void 0;const n=r(68224);!function(e){e.SUBSTRACT="subtract",e.APPEND="append",e.OVERRIDE="override"}(t.OperationType||(t.OperationType={}));class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.UpdateCollectionCommand=o},21028:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(24494),t),o(r(77834),t),o(r(82824),t),o(r(51515),t)},36217:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CollectionsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.CollectionsQuery=o},82824:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(36217),t)},51515:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},18265:(e,t,r)=>{"use strict";r.d(t,{z:()=>B,H:()=>ge});var n=r(32839),o=r(16530),a=r(87279),i=r(53576),s=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let c=class extends n.BaseEventEmitter{};c=s([(0,n.Injectable)()],c);var u=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let d=class{constructor(e,t){this.client=e,this.eventEmitter=t}async execute({body:e}){const{vaultItemType:t,content:r}=e,{commands:n}=this.client.getClient(i.carbonLegacyApi),o=await n.carbonLegacyLeeloo({name:"savePersonalDataItem",arg:[{kwType:t,origin:"MANUAL",content:{...r,id:void 0}}]});if((0,a.hx)(o))throw new Error(`Failed to create ${t}`);return this.eventEmitter.sendEvent("created",{ids:[],vaultItemType:t}),Promise.resolve((0,a.Vp)(void 0))}};d=u([(0,n.CommandHandler)(o.CreateVaultItemCommand),l("design:paramtypes",[n.CqrsClient,c])],d);var p=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let h=class{constructor(e,t){this.client=e,this.eventEmitter=t}async execute({body:e}){const{vaultItemType:t,ids:r}=e,{commands:n}=this.client.getClient(i.carbonLegacyApi),o=[],s=r.map((e=>n.carbonLegacyLeeloo({name:"removePersonalDataItem",arg:[{id:e}]}).then((t=>{(0,a.d6)(t)&&o.push(e)}))));return await Promise.allSettled(s),o.length>0&&this.eventEmitter.sendEvent("deleted",{ids:o,vaultItemType:t}),o.length!==r.length?Promise.resolve((0,a.Rn)({tag:"error",errorMessage:`Error: Failed to delete all ${t}s`,failedDeletionIds:Array.from(new Set(...r,...o))})):Promise.resolve((0,a.Vp)(void 0))}};h=p([(0,n.CommandHandler)(o.DeleteVaultItemsCommand),f("design:paramtypes",[n.CqrsClient,c])],h);var y=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},m=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let g=class{constructor(e,t){this.client=e,this.eventEmitter=t}async execute({body:e}){const{content:t,id:r,vaultItemType:n}=e,{commands:o}=this.client.getClient(i.carbonLegacyApi),s=await o.carbonLegacyLeeloo({name:"savePersonalDataItem",arg:[{kwType:n,origin:"MANUAL",content:{...t,id:r}}]});if((0,a.hx)(s))throw new Error(`Failed to update ${n}`);return this.eventEmitter.sendEvent("updated",{ids:[r],vaultItemType:n}),Promise.resolve((0,a.Vp)(void 0))}};g=y([(0,n.CommandHandler)(o.UpdateVaultItemCommand),m("design:paramtypes",[n.CqrsClient,c])],g);var v=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let w=class{constructor(e){this.eventEmitter=e}execute({body:e}){const{ids:t,eventType:r}=e;return this.eventEmitter.sendEvent(r,{ids:t,vaultItemType:o.VaultItemType.Credential}),Promise.resolve((0,a.Vp)(void 0))}};w=v([(0,n.CommandHandler)(o.EmitTemporaryVaultItemEventCommand),b("design:paramtypes",[c])],w);var R=r(85390),S=r(87065),E=r(48844);function O(e,t){if(!Array.isArray(e))return!1;if(0===e.length)return!0;const r=e[0];for(let e=0;e<t.length;e++)if(!Object.prototype.hasOwnProperty.call(r,t[e]))return!1;return!0}const C=e=>O(e,["AddressName"]),P=e=>O(e,["Name"]),A=e=>O(e,["Email"]),j=e=>O(e,["FirstName","LastName"]),_=e=>O(e,["Number"]),T=e=>O(e,["Website"]),I=e=>O(e,["BankAccountIBAN","BankAccountBIC","BankAccountName"]),x=e=>O(e,["Id","Email","Login"]),D=e=>O(e,["State"]),U=e=>O(e,["FiscalNumber"]),M=e=>O(e,[]),N=e=>O(e,["DeliveryPlace"]),k=e=>O(e,["SocialSecurityNumber"]),L=e=>O(e,["CardNumber"]),F=e=>O(e,["Content","Title"]);var q=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},V=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let G=class{constructor(e){this.client=e,this.getVaultItemsTypeDictionary={[o.VaultItemType.Address]:this.getVaultItems("addresses",C),[o.VaultItemType.BankAccount]:this.getVaultItems("bankAccounts",I),[o.VaultItemType.Company]:this.getVaultItems("companies",P),[o.VaultItemType.Credential]:this.getVaultItems("credentials",x),[o.VaultItemType.DriversLicense]:this.getVaultItems("driversLicenses",D,"driverLicenses"),[o.VaultItemType.Email]:this.getVaultItems("emails",A),[o.VaultItemType.FiscalId]:this.getVaultItems("fiscalIds",U),[o.VaultItemType.IdCard]:this.getVaultItems("idCards",M),[o.VaultItemType.Identity]:this.getVaultItems("identities",j),[o.VaultItemType.Passport]:this.getVaultItems("passports",N),[o.VaultItemType.PaymentCard]:this.getVaultItems("paymentCards",L),[o.VaultItemType.Phone]:this.getVaultItems("phones",_),[o.VaultItemType.SecureNote]:this.getVaultItems("secureNotes",F,"notes"),[o.VaultItemType.SocialSecurityId]:this.getVaultItems("socialSecurityIds",k),[o.VaultItemType.Website]:this.getVaultItems("websites",T,"personalWebsites")}}execute({body:e}){const{vaultItemTypes:t}=e;return(0,R.a)(t.map((e=>this.getVaultItemsTypeDictionary[e]))).pipe((0,S.U)((e=>{const t={};return e.forEach((e=>{if("failure"===e.tag)throw new Error("Error while fetching vault items");Object.assign(t,e.data)})),(0,a.Vp)(t)})))}getVaultItems(e,t,r){r=r??e;const{queries:{carbonState:n}}=this.client.getClient(i.carbonLegacyApi);return n({path:`userSession.personalData.${r}`}).pipe((0,E.Qn)((r=>{if(!t(r))throw new Error(`Bad ${e} format`);return{[e]:r}})))}};G=q([(0,n.QueryHandler)(o.VaultItemsQuery),V("design:paramtypes",[n.CqrsClient])],G);var H=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let B=class{};B=H([(0,n.Module)({api:o.vaultItemsCrudApi,handlers:{commands:{createVaultItem:d,deleteVaultItems:h,updateVaultItem:g,emitTemporaryVaultItemEvent:w},events:{},queries:{query:G}},providers:[c]})],B);var K=r(11494);async function W(e,t,r,n){const o=new K.UserUpdateCollectionEvent({collectionId:r,action:t,itemCount:n,isShared:!1});await e.commands.carbon({name:"logEvent",args:[{event:o}]})}var z=r(28489);var $=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Y=class{constructor(e){this.carbonLegacy=e.getClient(i.carbonLegacyApi)}async execute({body:e}){const{content:{name:t,spaceId:r="",vaultItems:n=[]}}=e,o=await this.carbonLegacy.commands.carbon({name:"addCollection",args:[{name:t,spaceId:r,vaultItems:n}]});if((0,a.hx)(o))throw new Error(`Failed to create collection: ${o.error}`);if("object"!=typeof(i=o.data.carbonResult)||null===i||!(0,z.l$)(i,"id")||"string"!=typeof i.id||!(0,z.l$)(i,"success")||"boolean"!=typeof i.success)throw new Error("Failed to find created collection id");var i;return await W(this.carbonLegacy,K.CollectionAction.Add,o.data.carbonResult.id,1),await W(this.carbonLegacy,K.CollectionAction.AddCredential,o.data.carbonResult.id,1),(0,a.Vp)({id:o.data.id})}};Y=$([(0,n.CommandHandler)(o.CreateCollectionCommand),Q("design:paramtypes",[n.CqrsClient])],Y);var X=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},J=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Z=class{constructor(e){this.client=e}async execute({body:e}){const{id:t}=e,r=await this.client.getClient(i.carbonLegacyApi).commands.carbon({name:"deleteCollection",args:[{id:t}]});if((0,a.hx)(r))throw new Error(`Failed to delete collection: ${r.error}`);return await W(this.client.getClient(i.carbonLegacyApi),K.CollectionAction.DeleteCredential,t,1),Promise.resolve((0,a.Vp)(void 0))}};Z=X([(0,n.CommandHandler)(o.DeleteCollectionCommand),J("design:paramtypes",[n.CqrsClient])],Z);var ee=r(60399);const te=e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&"string"==typeof t.Name&&Array.isArray(t.VaultItems)})));function re(e,t){const{queries:{carbonState:r}}=e.getClient(i.carbonLegacyApi);return r({path:"userSession.personalData.collections"}).pipe((0,E.Qn)((e=>{if(!te(e))throw new Error("Collection array has a wrong format");return{collections:(t&&t.length>0?e.filter((e=>t.includes(e.Id))):e).map((e=>({id:e.Id,name:e.Name,spaceId:e.SpaceId,vaultItems:e.VaultItems.map((e=>({id:e.Id,type:e.Type})))})))}})))}var ne=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ae=class{constructor(e){this.client=e}async execute({body:e}){const{id:t,collection:r,operationType:n=o.OperationType.APPEND}=e,s=await(0,ee.z)(re(this.client,[t]));if((0,a.hx)(s))throw new Error(`Failed to fetch additional collection info: ${s.error}`);const c=s.data.collections[0];r.vaultItems&&(c.vaultItems=this.mutateCollectionVaultItems(c,n,r.vaultItems));const u=await this.client.getClient(i.carbonLegacyApi).commands.carbon({name:"updateCollection",args:[{id:c.id,name:r.name??c.name,spaceId:r.spaceId??c.spaceId,vaultItems:c.vaultItems}]});if((0,a.hx)(u))throw new Error(`Failed to update collection: ${u.error}`);return n!==o.OperationType.OVERRIDE&&await W(this.client.getClient(i.carbonLegacyApi),n===o.OperationType.APPEND?K.CollectionAction.AddCredential:K.CollectionAction.DeleteCredential,t,r.vaultItems?.length??1),Promise.resolve((0,a.Vp)(void 0))}getDeduplicatedList(e){return[...new Map(e.map((e=>[e.id,e]))).values()]}mutateCollectionVaultItems(e,t,r){return t===o.OperationType.OVERRIDE?this.getDeduplicatedList(r):t===o.OperationType.SUBSTRACT?e.vaultItems.filter((e=>!r.some((t=>t.id===e.id)))):this.getDeduplicatedList([...e.vaultItems,...r])}};ae=ne([(0,n.CommandHandler)(o.UpdateCollectionCommand),oe("design:paramtypes",[n.CqrsClient])],ae);var ie=r(68224),se=r(44396);const ce=e=>!0;class ue extends((0,n.defineStore)({persist:!0,scope:ie.UseCaseScope.Device,storeName:"collections-store",storeTypeGuard:ce,capacity:n.StoreCapacity._001KB,codec:se.Eu,storage:{schemaVersion:3,initialValue:{isCredentialCategoriesMigrated:{}},typeGuard:ce,migrateStorageSchema:()=>({isCredentialCategoriesMigrated:{}})}})){}var le=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},de=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let pe=class{constructor(e,t){this.client=e,this.store=t}updateCollection(e,t){const{commands:r}=this.client.getClient(o.vaultOrganizationApi);return r.updateCollection({id:e,collection:t})}createCollection(e){const{commands:t}=this.client.getClient(o.vaultOrganizationApi);return t.createCollection({content:e})}fetchCategories(){const{queries:{carbonState:e}}=this.client.getClient(i.carbonLegacyApi);return e({path:"userSession.personalData.credentialCategories"}).pipe((0,E.Qn)((e=>e)))}async fetchCredentials(){const{queries:{carbonState:e}}=this.client.getClient(i.carbonLegacyApi),t=await(0,ee.z)(this.fetchCategories());if((0,a.hx)(t))throw new Error("Failed to fetch categories");const r=t.data;return e({path:"userSession.personalData.credentials"}).pipe((0,E.Qn)((e=>{if(t=e,!Array.isArray(t))throw new Error("Bad credential format");var t;return e.map((e=>{const t=r.find((t=>t.Id===e.Category))?.CategoryName;return{...e,CategoryName:t}}))})))}async finalizeMigration(e,t){return t.isCredentialCategoriesMigrated[e]=!0,await this.store.set(t),Promise.resolve((0,a.Vp)(void 0))}async execute({body:e}){const t=e;if(!t)throw new Error("Failed to fetch username");const r=await this.store.getState();if(r.isCredentialCategoriesMigrated[t])return Promise.resolve((0,a.Vp)(void 0));const n=await(0,ee.z)(await this.fetchCredentials());if((0,a.hx)(n))throw new Error("Failed to fetch credentials");const o=n.data;if(0===o.length)return this.finalizeMigration(t,r);const i=await(0,ee.z)(re(this.client));if((0,a.hx)(i))throw new Error("Failed to fetch collections");const s=i.data.collections;s.forEach((e=>{"string"!=typeof e.spaceId&&(e.spaceId="")}));const c=[];for(let e=0;e<o.length;e++){const t=o[e];if(!t.CategoryName)continue;const r=t.CategoryName,n=t.SpaceId??"",a=s.find((e=>e.name===r&&e.spaceId===n));if(a){a.vaultItems.push({id:t.Id,type:"KWAuthentifiant"});continue}const i=c.find((e=>e.name===r&&e.spaceId===n));i?i.vaultItems.push({id:t.Id,type:"KWAuthentifiant"}):c.push({name:r,spaceId:n,vaultItems:[{id:t.Id,type:"KWAuthentifiant"}]})}for(const e of s)await this.updateCollection(e.id,e);for(const e of c)await this.createCollection(e);return this.finalizeMigration(t,r)}};pe=le([(0,n.CommandHandler)(o.MigrateCategoriesCommand),de("design:paramtypes",[n.CqrsClient,ue])],pe);var fe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},he=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ye=class{constructor(e){this.client=e}execute({body:e}){const{ids:t}=e;return re(this.client,t)}};ye=fe([(0,n.QueryHandler)(o.CollectionsQuery),he("design:paramtypes",[n.CqrsClient])],ye);var me=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let ge=class{};ge=me([(0,n.Module)({api:o.vaultOrganizationApi,stores:[ue],handlers:{commands:{deleteCollection:Z,createCollection:Y,migrateCategories:pe,updateCollection:ae},events:{},queries:{queryCollections:ye}}})],ge)},32839:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AcknowledgedChannel:()=>J,AllowedToFail:()=>Dt,AppLifeCycle:()=>ue,AppLogger:()=>le,AppTimers:()=>Se,BadStatus:()=>o.RV,BaseEventEmitter:()=>sn,ChannelMessageBroker:()=>T,ChannelState:()=>S,CommandHandler:()=>$r,CommandRefresherFactory:()=>je,ContextLessCqrsClient:()=>B,ContextlessBaseEventEmitter:()=>cn,CqrsBroker:()=>x,CqrsClient:()=>H,CqrsCommandRefresher:()=>Ae,CronLowLevelSource:()=>Zt,DefaultEncryptionCodecForDeviceData:()=>Te,DefaultEncryptionCodecForUserData:()=>Ie,EXCEPTION_LOGGING_FEATURE_FLIP:()=>Ot,EventHandler:()=>Sn,ExceptionCriticality:()=>wt,ExceptionLogger:()=>_t,ExceptionLoggingSink:()=>Pt,FeatureFlipsServiceAbstract:()=>qr,FetchFailedError:()=>o.a7,FrameworkInit:()=>k,Global:()=>M,HttpClient:()=>Kr,HttpHeaders:()=>o.WM,HttpModule:()=>zr,HttpParams:()=>o.LE,HttpRequest:()=>o.aW,HttpResponse:()=>o.Zn,HttpStatusCode:()=>o.WE,Injectable:()=>N,JsonApplicationResourceFetcher:()=>ht,JsonApplicationResourceLoader:()=>bt,KeyValueStorageFactory:()=>ke,KeyValueStorageInfrastructure:()=>Me,LoadingState:()=>Fe,ManualTriggeredTimers:()=>Ee,MemoryChannel:()=>_,MemoryKeyValueStorageInfrastructure:()=>Le,MemoryStoreInfrastructureFactory:()=>ce,MockFeatureFlipsService:()=>Gr,MockJsonApplicationResourceFetcher:()=>yt,MockedFeatureFlipsEnum:()=>Vr,Module:()=>Rr,NoDynamicChannels:()=>W,NodeConfiguration:()=>L,NodeEventBroker:()=>ae,NodeToModuleEventBroker:()=>rn,NullLogger:()=>de,ParameterProviderType:()=>tr,QueryHandler:()=>Rn,RequestContext:()=>D,RequestContextModule:()=>Fn,SingleNodeAppBuilder:()=>Fr,StoreCapacity:()=>Xe,StoreFlusher:()=>ft,StoreInfrastructureFactory:()=>se,TaskTrackingModule:()=>wn,TimerBasedCronSource:()=>er,createApplicationClient:()=>ln,createClientFactory:()=>un,createCqrsClient:()=>F,createCqrsClients:()=>q,defineApplication:()=>Lr,defineBatchExecutor:()=>Hn,defineStore:()=>Ye,deviceScopedSingletonProvider:()=>tt,getQueryValue:()=>pn,getStoresProviders:()=>ct,isExceptionLogEntry:()=>Rt,isLazyState:()=>qe,isSendMessageRequest:()=>ee,isVersionedData:()=>Ue,mockStore:()=>He,provideClass:()=>Dr,provideValue:()=>xr,refresherCreationToken:()=>Pe,scopedSingleton:()=>nt,sendMessageRequest:()=>Z,startApplicationNode:()=>Nr,startSingleApplicationNode:()=>kr,useEventsOfModule:()=>br,userScopedSingletonProvider:()=>rt});var n=r(69183),o=r(44396),a=r(30523),i=r(60399),s=r(6220),c=r(70695),u=r(28489);var l=r(73201),d=r(162),p=r(87065),f=r(17350),h=r(95087);const y=e=>"response"===e.type,m=(e,t,r,n)=>Object.keys(e).reduce(((o,a)=>{const{commandMailbox:i,queryMailbox:s}=(o=>{const{main:a,queryOnly:i}=e[o],s={type:"local",onMessage:n};if(a===t)return{commandMailbox:s,queryMailbox:s};const c={type:"remote",channel:r[a]};return{commandMailbox:c,queryMailbox:t&&i.includes(t)?s:c}})(a);return o[`command-${a}`]=i,o[`query-${a}`]=s,o}),(0,u.Ay)({}));var g=r(24966),v=r(2049),b=r(59891);const w=e=>{if(!e||"object"!=typeof e)return!1;return"unSubscription"===e.type},R=(e,t,r)=>{const n=new Set(r),o=new Map,i=t.receivedMessages$.pipe((0,a.h)(w)).subscribe((e=>{const t=o.get(e.id);t?.unsubscribe(),o.delete(e.id)})),c=t.receivedMessages$.pipe((0,a.h)((e=>{return!(!(t=e)||"object"!=typeof t)&&"start"===t.type&&n.has(e.definition.destination)&&!o.has(e.definition.id);var t})),(0,s.z)((e=>(0,d.D)((async e=>(o.set(e.definition.id,{unsubscribe:()=>{}}),await t.send({type:"initial-acknowledgement",id:e.definition.id}),e))(e))))).subscribe((r=>{const n=r.definition.destination,a=e(n,r.definition.content,r.metadata),i={type:"end",id:r.definition.id},c=a.pipe((0,p.U)((e=>({id:r.definition.id,data:e,type:"data"}))),(0,b.l)(i),(0,s.z)((e=>(0,d.D)(t.send(e))))).subscribe();o.set(r.definition.id,{unsubscribe:()=>{c.unsubscribe()}})}));return{unsubscribe:()=>{c.unsubscribe(),i.unsubscribe();for(const e of o.values())e.unsubscribe()}}};var S,E=r(58376),O=r(85390),C=r(15023),P=r(6136),A=r(42946),j=r(98187);!function(e){e.Connected="Connected",e.Disconnected="Disconnected"}(S||(S={}));class _{constructor(){this.autoConnects=!1,this.sentMessages$=new j.x,this.receivedMessagesSubject$=new j.x,this.channelStateSubject$=new g.X(S.Disconnected)}send(e){if(this.channelStateSubject$.value!==S.Connected)throw new Error("Channel is not connected");return this.sentMessages$.next(e),Promise.resolve()}get receivedMessages$(){return this.receivedMessagesSubject$}get channelState$(){return this.channelStateSubject$}stop(){this.receivedMessages$.complete()}connect(e){if(this.channelStateSubject$.value===S.Connected)return{disconnect:()=>{}};const t=this.sentMessages$.subscribe((t=>{e.receivedMessages$.next(t)}));return this.channelState$.next(S.Connected),{disconnect:()=>{this.channelState$.next(S.Disconnected),t.unsubscribe()}}}}class T{constructor(e){this.stopped$=new g.X(!1);const t={routes:(0,u.Ay)({})};this.routes=(()=>{const{routes:r}=Object.keys(e).reduce(((t,r)=>{const o=e[r];if("local"===o.type&&(t.routes[r]={send:o.onMessage,trySend:async(...e)=>(await(0,v.n)(o.onMessage(...e)),!0)}),"remote"===o.type){const e=((e,t)=>{const r=(r,o,i)=>{const s={content:o,destination:String(r),id:(0,n.Z)()};return new E.y((r=>{let n={type:"start",definition:s,metadata:i};const o=(0,O.a)({message:e.receivedMessages$,stopped:t}).pipe((0,C.o)((({stopped:e})=>!e)),(0,p.U)((({message:e})=>e))).subscribe((e=>{var t;(t=e)&&"object"==typeof t&&"initial-acknowledgement"===t.type&&e.id===s.id?n={...n,metadata:{...n.metadata,isReminder:!0}}:(e=>!(!e||"object"!=typeof e)&&"data"===e.type)(e)&&e.id===s.id?r.next(e.data):(e=>!(!e||"object"!=typeof e)&&"end"===e.type)(e)&&e.id===s.id&&r.complete()})),c=(0,O.a)({sendTimes:e.channelState$.pipe((0,P.x)(),(0,a.h)((t=>t===S.Connected||e.autoConnects))),stopped:t}).pipe((0,C.o)((({stopped:e})=>!e)),(0,A.z)((()=>(0,d.D)(e.send(n))))).subscribe();return()=>{e.send({type:"unSubscription",id:s.id}),c.unsubscribe(),o.unsubscribe()}}))};return{send:r,trySend:async(t,n,o)=>!(!e.autoConnects&&await(0,i.z)(e.channelState$)!==S.Connected)&&(await(0,v.n)(r(t,n,o)),!0)}})(o.channel,this.stopped$);t.routes[r]=e}return t}),t);return r})()}connect(e,t){let r=!1;return{start:()=>{if(r)throw new Error("Already started");r=!0;const n=e=>R(((e,t,r)=>this.routes[e].send(e,t,r)),e,Object.keys(this.routes)),o=e.map(n),a=new Map,i=t.connectedChannels$.subscribe((e=>{const t=[...a.entries()].filter((([t])=>!(t in e))),r=Object.keys(e).filter((e=>!a.has(e)));t.forEach((([e,t])=>{a.delete(e),t.unsubscribe()})),r.forEach((t=>{const r=e[t],o=n(r);a.set(t,o)}))}));return Promise.resolve({stop:()=>([...o,i,...a.values()].forEach((e=>e.unsubscribe())),this.stopped$.next(!0),Promise.resolve())})}}}sendMessage(e,t){return this.routes[e].send(e,t,{isReminder:!1})}trySendMessage(e,t){return this.routes[e].trySend(e,t,{isReminder:!1})}}const I=()=>(0,d.D)([]);class x{constructor(e){this.config=e}async sendCommand(e,t,r,n){if(!this.broker)throw new Error("call connect() first");return await(0,i.z)(this.broker.sendMessage(`command-${e}`,{type:"command",module:e,commandName:String(t),command:r,context:n}).pipe((0,a.h)(y),(0,p.U)((e=>e.response))))}sendQuery(e,t,r,n){if(!this.broker)throw new Error("call connect() first");return this.broker.sendMessage(`query-${e}`,{type:"query",module:e,queryName:String(t),query:r,context:n}).pipe((0,a.h)(y),(0,p.U)((e=>e.response)))}connect(e){const t=e?(t,r,n)=>{switch(r.type){case"response":return f.E;case"command":return(0,d.D)(e.onCommand(r.module,r.commandName,r.command,r.context,{isReminder:n.isReminder})).pipe((0,p.U)((e=>({type:"response",response:e}))));case"query":return(0,d.D)(e.onQuery(r.module,r.queryName,r.query,r.context)).pipe((0,p.U)((e=>({type:"response",response:e}))))}(0,h.U)(r)}:I,r=m(this.config.appDefinition,this.config.currentNode,this.config.channels,t);return this.broker=new T(r),this.broker.connect(Object.values(this.config.channels),this.config.channelsListener)}}class D{constructor(e){this.useCaseId=e.useCaseId,this.userName=e.userName,this.featureFlips=e.featureFlips,this.requiredFeatureFlips=e.requiredFeatureFlips}}var U=r(32875);function M(){return(0,U.Global)()}function N(e){return(0,U.Injectable)({scope:e?.neverReuseInstance?U.Scope.TRANSIENT:U.Scope.DEFAULT})}const k=()=>N();class L{constructor(e){this.appDefinition=e.appDefinition,this.currentNode=e.currentNode,this.channels=e.channels,this.subscriptions=e.subscriptions,this.channelsListener=e.channelsListener}getNodeList(){return this.currentNode?[...this.getRemoteNodeList(),this.currentNode]:this.getRemoteNodeList()}getRemoteNodeList(){return Object.keys(this.channels)}getModuleNames(){return Object.keys(this.appDefinition)}}const F=(e,t,r,o)=>({commands:Object.keys(e[r].api.commands).reduce(((e,a)=>(e[a]=e=>{const i=o??new D({useCaseId:(0,n.Z)()});return t.sendCommand(r,a,e,i)},e)),(0,u.Ay)({})),queries:Object.keys(e[r].api.queries).reduce(((e,a)=>(e[a]=e=>{const i=o??new D({useCaseId:(0,n.Z)()});return t.sendQuery(r,a,e,i)},e)),(0,u.Ay)({}))}),q=(e,t,r)=>{const o=o=>Object.keys(e[o].api.commands).reduce(((e,a)=>(e[a]=e=>{const i=r??new D({useCaseId:(0,n.Z)()});return t.sendCommand(o,a,e,i)},e)),(0,u.Ay)({})),a=o=>Object.keys(e[o].api.queries).reduce(((e,a)=>(e[a]=e=>{const i=r??new D({useCaseId:(0,n.Z)()});return t.sendQuery(o,a,e,i)},e)),(0,u.Ay)({}));return Object.keys(e).map((e=>e)).reduce(((e,t)=>(e[t]={commands:o(t),queries:a(t)},e)),{})};var V=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},G=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let H=class{constructor(e,t,r){this.broker=e,this.configuration=t,this.context=r}getClient(e){return F(this.configuration.appDefinition,this.broker,e.name,this.context)}};H=V([N(),G("design:paramtypes",[x,L,D])],H);let B=class{constructor(e,t){this.configuration=e,this.broker=t}getClient(e){return F(this.configuration.appDefinition,this.broker,e.name)}};B=V([N(),G("design:paramtypes",[L,x])],B);var K=r(69885);const W={connectedChannels$:new g.X({})};var z=r(16433),$=r(89618),Q=r(37182),Y=r(97280),X=r(7074);class J{constructor(e,t=3e4){this.autoConnects=e.autoConnects;const r=e.status$.pipe((0,P.x)());let o=!1;const i=new j.x,c=i.pipe((0,s.z)((async i=>{const s=(0,n.Z)();let c=!1;const u=e.messages$.pipe((0,C.o)((()=>!o)),(0,a.h)((e=>"acknowledgement"===e.type&&e.id===s)),(0,z.q)(1),(0,$.V)(t),(0,Q.K)((()=>f.E)),(0,Y.d)(1)),l=u.subscribe((()=>{c=!0,l.unsubscribe()})),p=r.pipe((0,C.o)((()=>!c&&!o)),(0,A.z)((()=>(0,d.D)(e.sendMessage({type:"send",id:s,message:i.message}))))).subscribe();try{await(0,v.n)(u),p.unsubscribe(),i.resolve()}catch(e){p.unsubscribe(),i.reject(e)}}))).subscribe();this.stop=()=>(o=!0,c.unsubscribe(),e.stop()),this.send=e=>new Promise(((t,r)=>{const n={message:e,resolve:t,reject:r};i.next(n)})),this.channelState$=e.status$,this.receivedMessages$=e.messages$.pipe((0,a.h)((e=>"send"===e.type)),(0,s.z)((async t=>{if("send"===t.type)return await e.sendMessage({type:"acknowledgement",id:t.id}),t.message})),(0,X.B)())}}const Z=({channelName:e,message:t})=>({channelName:e,message:t,type:"graphene-message"}),ee=e=>{if(!e||"object"!=typeof e)return!1;return"graphene-message"===e.type},te={type:"ask"},re={type:"eventResponse"};var ne=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ae=class{constructor(e){this.regenerateReverseSubscriptionMap=()=>{const{configuration:e,subscriberToEvent:t}=this,r=e.getModuleNames().reduce(((e,t)=>({...e,[t]:new Map})),{});return e.getNodeList().reduce(((e,r)=>{const n=t[r];return Object.entries(n).forEach((([t,n])=>{const o=e[t];n.forEach((e=>{const t=[...o.get(e)??[],r];o.set(e,t)}))})),e}),r)},this.configuration=e;const t=Object.entries(e.appDefinition).reduce(((e,[t,r])=>(e[t]=Object.keys(r.api.events),e)),{});this.subscriberToEvent=this.configuration.getNodeList().reduce(((e,r)=>(e[r]={...t},e)),{}),this.eventToSubscriber=this.regenerateReverseSubscriptionMap()}async publishEvent(e,t,r,n){const{broker:o,eventToSubscriber:a}=this;if(!o)throw new Error("Not started");const i=(a[e].get(t)??[]).map((o=>({type:"event",context:n,event:r,eventName:t,moduleSource:e,nodeDestination:o})));await Promise.all(i.map((async e=>{await o.trySendMessage(`event-${e.nodeDestination}`,e)})))}connect(e){const{configuration:t}=this,r=Object.keys(t.subscriptions).reduce(((e,r)=>({...e,...t.subscriptions[r]})),(0,u.Ay)({})),n={type:"subscriptions",nodeName:t.currentNode,subscribesTo:r},o=((e,t)=>e.getNodeList().reduce(((r,n)=>(n===e.currentNode?r[`event-${n}`]={type:"local",onMessage:t}:r[`event-${n}`]={type:"remote",channel:e.channels[n]},r)),(0,u.Ay)({})))(this.configuration,((t,r,o)=>{switch(r.type){case"event":return(0,d.D)(e.onLocalEvent(r.moduleSource,r.nodeDestination,r.eventName,r.event,r.context,o)).pipe((0,p.U)((()=>re)));case"eventResponse":return f.E;case"subscriptions":return this.subscriberToEvent[r.nodeName]=r.subscribesTo,this.eventToSubscriber=this.regenerateReverseSubscriptionMap(),(0,K.of)(re);case"ask":return(0,K.of)(n)}})),a=new T(o);return t.getNodeList().map((async e=>{await a.trySendMessage(`event-${e}`,n),await a.trySendMessage(`event-${e}`,te)})),this.broker=a,a.connect(Object.values(t.channels),t.channelsListener)}};ae=ne([N(),oe("design:paramtypes",[L])],ae);class ie{constructor(e){this.state$=new g.X(e)}get(){return Promise.resolve(this.state$.getValue())}set(e){return this.state$.next(e),Promise.resolve()}init(e){return this.state$.next(e),Promise.resolve()}stop(){this.state$.complete()}}class se{}class ce extends se{createUserScopedInfrastructure(){return new ie({timestamp:void 0})}createDeviceScopedInfrastructure(){return new ie({timestamp:void 0})}}class ue{constructor(){this.shutdownHooks=[],this.externalComponentReadyConditions=[],this.appReadyHooks=[]}addExternalComponentReadyCondition(e){this.externalComponentReadyConditions.push(e)}addAppReadyHook(e){this.appReadyHooks.push(e)}addShutdownHook(e){this.shutdownHooks.push(e)}startup(){const e=this.waitAndTriggerAppReady();if(!this.externalComponentReadyConditions.length)return e;this.addShutdownHook((async()=>await e))}async shutDown(){for(;this.shutdownHooks.length>0;){const e=this.shutdownHooks.pop();e&&await e()}}async waitAndTriggerAppReady(){await Promise.all(this.externalComponentReadyConditions.map((e=>e()))),await this.executeStartupHooks(this.appReadyHooks)}async executeStartupHooks(e){for(;e.length>0;){const t=e.shift();if(t){const e=await t();e&&this.addShutdownHook(e)}}}}class le{}class de extends le{log(){}error(){}warn(){}trace(){}}var pe,fe=r(5373);!function(e){e.Command="command",e.Query="query",e.Event="event",e.Init="init",e.Cron="cron"}(pe||(pe={}));var he=r(68224),ye=r(87279);async function me(e){const t=await(0,i.z)(e.getClient(he.requestContextApi).queries.activeUser());if((0,ye.d6)(t)&&t.data.userName)return t.data.userName}var ge=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},ve=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},be=function(e,t){return function(r,n){t(r,n,e)}};class we{constructor(e){this.supportedEventHandlers=e}}let Re=class{constructor(e,t,r,n){this.conf=e,this.config=t,this.moduleRef=r,this.clients=n}async execute(e){const t=c.ContextIdFactory.getByRequest(e),{type:r}=e,n=async()=>e.context.userName??await me(this.clients),{appDefinition:o}=this.config;if(!(e.module in o))throw new Error("Unknown module "+e.module);const a=o[e.module].api;switch(r){case pe.Query:{const{queries:r}=a;if(e.name in r){const o=r[e.name],a=new o(e.body),i=Reflect.getMetadata("dl-handler",o);o.metadata.scope===he.UseCaseScope.User&&(e.context.userName=await n());return{result:(await this.moduleRef.resolve(i,t,{strict:!1})).execute(a)}}throw new Error("Unknown query "+e.name)}case pe.Command:{const{commands:r}=a;if(e.name in r){const o=r[e.name],a=new o(e.body),i=Reflect.getMetadata("dl-handler",o);o.metadata.scope===he.UseCaseScope.User&&(e.context.userName=await n());const s=await this.moduleRef.resolve(i,t,{strict:!1});return{result:await s.execute(a)}}throw new Error("Unknown command "+e.name)}case pe.Event:{const{events:r}=a;if(e.name in r){const o=r[e.name],a=new o(e.body),i=Reflect.getMetadata("dl-handlers",o);if(!i)return;o.metadata.scope===he.UseCaseScope.User&&(e.context.userName=await n());const s=await Promise.all(i.filter((e=>this.conf.supportedEventHandlers.has(e))).map((async e=>await this.moduleRef.resolve(e,t,{strict:!1}))));return void await Promise.all(s.map((e=>e.handle(a))))}throw new Error("Unknown event "+e.name)}}(0,h.U)(r)}};ge([(0,U.All)(),be(0,(0,U.Req)()),ve("design:type",Function),ve("design:paramtypes",[Object]),ve("design:returntype",Promise)],Re.prototype,"execute",null),Re=ge([(0,U.Controller)({scope:U.Scope.REQUEST,durable:!1}),ve("design:paramtypes",[we,L,c.ModuleRef,B])],Re);class Se{async waitTimeout(e){await(0,i.z)(this.createObservableTimer(e,e))}}class Ee extends Se{constructor(){super(...arguments),this.subscribers$=new g.X(new Set),this.time=0,this.pendingTimerCount$=this.subscribers$.pipe((0,p.U)((e=>e.size)))}fireTimer(e=1){this.time+=e,[...this.subscribers$.value].forEach((e=>{e.next(this.time)}))}async allSubscribersDisconnected(){await(0,i.z)(this.pendingTimerCount$.pipe((0,a.h)((e=>!e))))}createObservableTimer(){return new E.y((e=>(this.subscribers$.next(new Set([...this.subscribers$.value,e])),()=>{this.subscribers$.next(new Set([...this.subscribers$.value].filter((t=>t!==e))))})))}}var Oe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ce=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};function Pe(e){return e}class Ae{constructor(e,t,{args:r,commandName:n}){const o=t.commands[n];this.refreshObservable$=e.pipe((0,s.z)((async()=>{await o(r)})),(0,X.B)({}))}withRefresh(){return e=>new E.y((t=>{const r=this.refreshObservable$.subscribe();return r.add(e.subscribe(t)),r}))}}let je=class{constructor(e,t){this.timers=e,this.cqrsClient=t,this.map=new WeakMap}getRefresher(e){const t=this.map.get(e);if(t)return t;return new Ae(this.timers.createObservableTimer(e.period,e.period),this.cqrsClient.getClient(e.api),e)}};je=Oe([N(),Ce("design:paramtypes",[Se,B])],je);var _e=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Te=class{};Te=_e([(0,U.Injectable)()],Te);let Ie=class{};async function xe(e,t){const r=await(0,i.z)(e.getClient(he.requestContextApi).queries.userFeatureFlips({requiredFeatureFlips:t}));if(!(0,ye.d6)(r))throw new Error("Couldn't fetch userFeatureFlips from requestContextApi");return(0,ye.db)(r)}Ie=_e([(0,U.Injectable)()],Ie);const De=(e,t)=>({provide:D,scope:U.Scope.REQUEST,inject:[B,c.REQUEST],useFactory:async(r,n)=>{let o=String(c.ContextIdFactory.getByRequest(n).id);if(n.type===pe.Init)return new D({useCaseId:o,requiredFeatureFlips:t});if(n.type===pe.Cron){if(n.scope===he.UseCaseScope.Device)return new D({useCaseId:o,requiredFeatureFlips:t});const e=await me(r);return new D(e?{useCaseId:o,userName:e,featureFlips:await xe(r,t),requiredFeatureFlips:t}:{useCaseId:o,requiredFeatureFlips:t})}o=n.context.useCaseId||String(c.ContextIdFactory.getByRequest(n).id);const a=function(e,t){const{type:r}=e;switch(r){case pe.Query:{const r=t[e.module].api,{queries:n}=r;if(e.name in n)return n[e.name].metadata.scope;throw new Error("unknown query "+e.name)}case pe.Command:{const r=t[e.module].api,{commands:n}=r;if(e.name in n)return n[e.name].metadata.scope;throw new Error("unknown command "+e.name)}case pe.Event:{const r=t[e.module].api,{events:n}=r;if(e.name in n)return n[e.name].metadata.scope;throw new Error("unknown event "+e.name)}case pe.Init:return he.UseCaseScope.Device;case pe.Cron:return e.scope;default:(0,h.U)(r)}}(n,e);if(a===he.UseCaseScope.Device)return new D({useCaseId:o,requiredFeatureFlips:t});const i=n.context.userName??await me(r),s=await(async()=>n.context.featureFlips??await xe(r,t))();return new D({useCaseId:o,requiredFeatureFlips:t,userName:i,featureFlips:s})}});function Ue(e,t){return null!==e&&"object"==typeof e&&(0,u.l$)(e,"version")&&(0,u.l$)(e,"content")&&t(e.content)}class Me{}class Ne{constructor(e,t,r){this.storage=e,this.baseKey=t,this.initialValueFactory=r}async read(){const e=await this.storage.get(this.baseKey);return!e&&this.initialValueFactory?await this.initialValueFactory():e}async write(e){await this.storage.set(this.baseKey,e)}}class ke{constructor(e){this.storage=e}createBackend(e,t,r,n){const o=r?`${e}.${t}.${r}`:`${e}.${t}`;return new Ne(this.storage,o,n)}}class Le{constructor(){this.memory=new Map}set(e,t){return this.memory.set(e,t),Promise.resolve()}getAllKeys(){return Promise.resolve([...this.memory.keys()])}remove(e){return this.memory.get(e)?(this.memory.delete(e),Promise.resolve()):Promise.resolve()}get(e){return Promise.resolve(this.memory.get(e))}}var Fe;!function(e){e.NotLoaded="not_loaded",e.Requested="requested",e.Loaded="loaded"}(Fe||(Fe={}));const qe=e=>{if(!e||"object"!=typeof e)return!1;return"boolean"==typeof e.loaded},Ve=e=>e.loaded,Ge=new ce;async function He(e,t){const r=new e("mockedModuleName",e.Definition,Ge,"user");return t&&await r.set(t),r}class Be{constructor(e){this.subscribersCount$=new g.X(0),this.stopped$=new g.X(!1),this.store=e,this.state$=new E.y((t=>{this.subscribersCount$.next(this.subscribersCount$.value+1);const r=e.state$.pipe((e=>e.pipe((0,a.h)(Ve),(0,p.U)((e=>e.value))))).subscribe(t);return r.add((()=>this.subscribersCount$.next(this.subscribersCount$.value-1))),r.add(this.stopped$.pipe((0,a.h)((e=>!!e))).subscribe((()=>{t.complete()}))),r})),this.loadingState$=(0,O.a)({stopped:this.stopped$,hasSubscribers:this.subscribersCount$.pipe((0,p.U)((e=>e>0))),isLoaded:this.store.state$.pipe((0,p.U)((e=>e.loaded)))}).pipe((0,C.o)((({stopped:e})=>!e)),(0,p.U)((({hasSubscribers:e,isLoaded:t})=>t?Fe.Loaded:e?Fe.Requested:Fe.NotLoaded)))}set(e){return this.store.set({loaded:!0,value:e})}init(e){return this.store.init({loaded:!0,value:e})}clear(){return this.store.set({loaded:!1})}stop(){this.store.stop(),this.stopped$.next(!0)}getState(){return(0,i.z)(this.state$)}}class Ke{constructor(e){const{infrastructure:t,defaultValue:r}=e;this.infrastructure=t,this.timeGetter=e.timeGetter??(()=>Date.now()),this.localState$=new g.X({timestamp:void 0}),this.mergedState$=(0,O.a)({infra:t.state$,current:this.localState$}).pipe((0,p.U)((({current:e,infra:t})=>t.timestamp&&(!e.timestamp||t.timestamp>e.timestamp)?t:e))),this.state$=this.mergedState$.pipe((0,p.U)((e=>e.data??r)))}async set(e){const t={data:e,timestamp:this.timeGetter()};this.localState$.next(t),await this.infrastructure.set(t)}init(e){const t={data:e,timestamp:0};return this.localState$.next(t),Promise.resolve()}get(){return(0,i.z)(this.state$)}stop(){this.localState$.complete()}}const We=e=>{var t;return t=class{constructor(e,t,r,n){this.encryptionCodec=e,this.serializationCodec=t,this.transportStorageCodec=r,this.backend=n}async read(){const t=await this.backend.read();if(!t)return;const r=await this.transportStorageCodec.decode(t),n=await this.encryptionCodec.decode(r),o=await this.serializationCodec.decode(n);if(!Ue(o,e.typeGuard)){if(!e.typeGuard(o))throw new Error("deserializedObject is not type of TStorage");return await this.write(o),o}if(o.version<e.schemaVersion){if(!e.migrateStorageSchema)throw new Error("migrateStorage is undefined");const t=e.migrateStorageSchema(o);return await this.write(t),t}const a=o.content;if(!e.typeGuard(a))throw new Error("Type guard failed");return a}async write(t){const r={version:e.schemaVersion,content:t},n=await this.serializationCodec.encode(r),o=await this.encryptionCodec.encode(n),a=await this.transportStorageCodec.encode(o);await this.backend.write(a)}},t.Definition=e,t},ze={loaded:!1};class $e extends Be{constructor(e,t,r,n,o,a){super(function(e,t,r,n){const o=(()=>{switch(t.scope){case he.UseCaseScope.Device:return r.createDeviceScopedInfrastructure(e,t.storeName,t.storeTypeGuard);case he.UseCaseScope.User:if(!n)throw new Error;return r.createUserScopedInfrastructure(e,t.storeName,n,t.storeTypeGuard)}(0,h.U)(t.scope)})();return new Ke({infrastructure:o,defaultValue:ze})}(e,t,r,n)),this.storage=o,this.codec=a,t.persist||this.init(t.initialValue)}async update(e){const t=await this.getState();await this.set(e(t))}async persist(){if(!this.codec||!this.storage)return;const e=await this.getState(),t=await this.codec.encode(e);await this.storage.write(t)}}const Qe=e=>e.persist?{persist:!0,codec:e.codec,scope:e.scope,storeName:e.storeName,storeTypeGuard:e.storeTypeGuard,isCache:e.isCache,persistPeriod:e.persistPeriod,storage:We(e.storage)}:{persist:!1,initialValue:e.initialValue,scope:e.scope,storeName:e.storeName};function Ye(e){var t;const r=Qe(e),n=((t=class extends $e{constructor(e,t,r,n,o,a){super(e,t,r,n,o,a)}}).Definition=r,t);return N()(n),n}var Xe;!function(e){e._001KB="1KB",e._010KB="10KB",e._100KB="100KB",e.Unlimited="Unlimited"}(Xe||(Xe={}));var Je=r(52273),Ze=r(43978),et=r(64987);const tt=(e,t)=>{const r=t.token??(0,n.Z)();class o{constructor(){this.mutex=new et.WU}getOrCreate(e){return this.mutex.runExclusive((async()=>(this.instance||(this.instance=await e()),this.instance)))}}N()(o);const a=o,i={token:e,inject:[o,c.ModuleRef,c.REQUEST],asyncFactory:(e,t,n)=>{const o=c.ContextIdFactory.getByRequest(n);return e.getOrCreate((()=>t.resolve(r,o)))}};return[{...t,token:r},a,i]},rt=(e,t)=>{const r=t.token??(0,n.Z)();class o{constructor(){this.instances=new Map,this.mutex=new et.WU}getOrCreate(e,t){return this.mutex.runExclusive((async()=>{const r=this.instances.get(e);if(r)return r;const n=await t();return this.instances.set(e,n),n}))}}const a=o,i={token:e,inject:[o,D,c.ModuleRef,c.REQUEST],asyncFactory:(t,{userName:n},o,a)=>{const i=c.ContextIdFactory.getByRequest(a);if(!n)throw new Error(`Provider ${e} is a user-scoped singleton but there is no user`);return t.getOrCreate(n,(()=>o.resolve(r,i)))}};return[{token:r,asyncFactory:t.asyncFactory,inject:[...t.inject??[],D]},a,i]},nt=(e,t,r)=>{switch(e){case he.UseCaseScope.Device:return tt(t,r);case he.UseCaseScope.User:return rt(t,r);default:(0,h.U)(e)}},ot="frameworkModuleName",at={[he.UseCaseScope.Device]:Te,[he.UseCaseScope.User]:Ie};const it=1e3;function st(e){const t=e.Definition.persist?function(e,t,r){const{EncryptionCodec:a=at[t],SerializationCodec:i=o.bL,TransportStorageCodec:s=o.z,initialValue:c,schemaVersion:u}=r.Definition;class l{constructor(e,t,r,n){this.encryptionCodec=e,this.serializationCodec=t,this.transportStorageCodec=r,this.backend=n}}class d extends r{constructor(e){super(e.encryptionCodec,e.serializationCodec,e.transportStorageCodec,e.backend)}}const p={token:(0,n.Z)(),inject:[l],asyncFactory:e=>Promise.resolve(new d(e))},f={token:l,inject:[ot,a,i,s,ke,...t===he.UseCaseScope.User?[D]:[]],asyncFactory:async(r,n,o,a,i,s)=>{const d=await i.createBackend(r,e,(t===he.UseCaseScope.User?s?.userName:"")??"",(async()=>{const e={version:u,content:c},t=await o.encode(e),r=await n.encode(t);return await a.encode(r)}));return new l(n,o,a,d)}};return[f,...nt(t,r,p)]}(e.Definition.storeName,e.Definition.scope,e.Definition.storage):[],r={token:(0,n.Z)(),inject:[ot,ue,le,se,e.Definition.scope===he.UseCaseScope.User?D:c.REQUEST,...e.Definition.persist?[e.Definition.storage,e.Definition.codec]:[]],asyncFactory:async(t,r,n,o,a,i,s)=>await(async()=>{const c=new e(t,e.Definition,o,(e.Definition.scope===he.UseCaseScope.User?a.userName:"")??"",i,s);r.addShutdownHook((()=>c.stop()));const{Definition:u}=e;return u.persist&&await async function(e){const t=e.isCache?await async function(e){try{return await s.decode(await i.read())}catch(t){const r=["Data corrupted on disk. Using initial value for the store",t];return n.warn(...r),await s.decode(e.storage.Definition.initialValue)}}(e):await s.decode(await i.read());await c.set(t);const o=e.persistPeriod??it,a=(0===e.persistPeriod?c.state$:c.state$.pipe((0,Je.b)(o))).pipe((0,Ze.w)((async e=>{await i.write(await s.encode(e))}))).subscribe();r.addShutdownHook((()=>a.unsubscribe()))}(u),c})()};return[...t,...nt(e.Definition.scope,e,r)]}function ct(...e){return e.flatMap((e=>st(e)))}class ut{constructor(){this.registeredClasses=[],this.preparedInstances=[]}get classes(){return this.registeredClasses}get instances(){return this.preparedInstances}set instances(e){this.preparedInstances=e}registerClass(e){this.registeredClasses.push(e)}}var lt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},dt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},pt=function(e,t){return function(r,n){t(r,n,e)}};let ft=class{constructor(e,t,r){this.moduleRef=e,this.request=t,this.storeList=r}async prepare(){const e=c.ContextIdFactory.getByRequest(this.request);this.storeList.instances=await Promise.all(this.storeList.classes.map((t=>this.moduleRef.resolve(t,e,{strict:!1}))))}async flush(){const{instances:e}=this.storeList;if(!e.length)throw new Error("Stores not instantiated");const t=e.map((e=>e.persist()));await Promise.all(t)}};ft=lt([(0,U.Injectable)(),pt(1,(0,U.Inject)(c.REQUEST)),dt("design:paramtypes",[c.ModuleRef,Object,ut])],ft);class ht{}class yt extends ht{constructor(e){super(),this.files=e}fetch(e){return e in this.files?Promise.resolve(this.files[e]):Promise.reject(new Error("404 not found :"+e))}}var mt=r(25859),gt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},vt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let bt=class{constructor(e,t){this.url=e,this.fetcher=t,this.value$=(0,d.D)((0,mt.P)((()=>this.get())))}async load(){await this.get()}async get(){const{value:e}=this;if(e)return e;const t=await this.fetcher.fetch(this.url),r=await this.loadResource(t);return this.value=r,r}};var wt;function Rt(e){return!(!e||"object"!=typeof e)&&("criticality"in e&&"timestamp"in e&&"message"in e&&"callStack"in e&&((e.criticality===wt.CRITICAL||e.criticality===wt.WARNING)&&"string"==typeof e.message&&"string"==typeof e.callStack))}bt=gt([N(),vt("design:paramtypes",[String,ht])],bt),function(e){e.WARNING="warning",e.CRITICAL="critical"}(wt||(wt={}));var St=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Et=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const Ot="webproduct_extension_grapheneExceptionLogs";let Ct=class{constructor(e){this.requestContext=e}isExceptionLoggingFeatureEnabled(){return Promise.resolve(!!this.requestContext.featureFlips?.[Ot])}};Ct=St([(0,U.Injectable)(),Et("design:paramtypes",[D])],Ct);class Pt{}var At=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},jt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let _t=class{constructor(e,t,r){this.sink=e,this.ff=t,this.logger=r}async captureException(e,t,r=wt.CRITICAL){try{if(!await this.ff.isExceptionLoggingFeatureEnabled())return;const n=e instanceof Error?e:new Error("Invalid exception type"),o=this.createExceptionLogEntry(t,n,r);return this.sink.logException(o)}catch(r){this.logger.error("Failed to capture exception",r,e,t)}}createExceptionLogEntry(e,t,r){return{criticality:r,message:t.message,callStack:t.stack??"",moduleName:e.moduleName,useCaseId:e.useCaseId,useCaseName:e.useCaseName,timestamp:Date.now()}}};_t=At([(0,U.Injectable)(),jt("design:paramtypes",[Pt,Ct,le])],_t);var Tt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},It=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},xt=function(e,t){return function(r,n){t(r,n,e)}};let Dt=class{constructor(e,t){this.request=e,this.logger=t}async do(...e){return(await Promise.all(e.map((e=>this.doOne(e))))).every((e=>!!e))}async doOne(e){try{const t=await e();if((0,ye.AZ)(t)&&(0,ye.hx)(t))throw new Error("Allowed to fail method has failed");return!0}catch(e){const{request:t}=this;return this.logger.captureException(e,{moduleName:t.module,useCaseId:t.context.useCaseId,useCaseName:t.name},wt.WARNING),!1}}};Dt=Tt([xt(0,(0,U.Inject)(c.REQUEST)),It("design:paramtypes",[Object,_t])],Dt);var Ut=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Mt=class{catch(e,t){t.switchToHttp().getResponse().fail(e)}};Mt=Ut([(0,U.Catch)(Error)],Mt);var Nt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},kt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Lt=function(e,t){return function(r,n){t(r,n,e)}};let Ft=class{constructor(e,t,r){this.request=e,this.clients=t,this.config=r}intercept(e,t){const{request:r}=this,{appDefinition:n}=this.config;if(!(r.module in n))return t.handle();const o=n[r.module].api;switch(r.type){case pe.Query:return this.checkQueryActiveUser(t,r,o);case pe.Command:return this.checkCommandActiveUser(t,r,o);case pe.Event:return this.checkEventActiveUser(t,r,o);default:(0,h.U)(r)}}checkQueryActiveUser(e,t,r){const{queries:n}=r;if(t.name in n){const r=n[t.name],{metadata:o}=r;return this.checkActiveUser(e,t,o)}return e.handle()}checkCommandActiveUser(e,t,r){const{commands:n}=r;if(t.name in n){const r=n[t.name],{metadata:o}=r;return this.checkActiveUser(e,t,o)}return e.handle()}checkEventActiveUser(e,t,r){const{events:n}=r;if(t.name in n){const r=n[t.name],{metadata:o}=r;return this.checkActiveUser(e,t,o)}return e.handle()}checkActiveUser(e,t,r){if(r.scope!==he.UseCaseScope.User)return e.handle();const{noUserError:n}=r;return(0,d.D)(this.getActiveUserName(t)).pipe((0,s.z)((r=>{if(r)return e.handle();if(n)return(0,K.of)({result:(0,ye.Rn)(n)});const o=t.type[0].toUpperCase()+t.type.substring(1);throw new Error(`${o} ${t.module}.${t.name} is user-scoped but there is no active user`)})))}async getActiveUserName(e){return e.context.userName??await me(this.clients)}};Ft=Nt([(0,U.Injectable)({scope:U.Scope.REQUEST}),Lt(0,(0,U.Inject)(c.REQUEST)),kt("design:paramtypes",[Object,B,L])],Ft);class qt{static create({brokers:{cqrs:e,event:t},configProviders:r,keyValueStorageInfrastructure:n,lifeCycle:a,logger:i,modules:s,nodeConfiguration:u,requiredFeatureFlips:d,storeInfrastructureFactory:p,timers:f,jsonFetcher:h,eventHandlers:y,defaultDeviceStorageEncryptionCodecProvider:m,defaultUserStorageEncryptionCodecProvider:g,storeList:v}){return{module:qt,providers:[l.ExplorerService,{provide:Me,useValue:n},{provide:ue,useValue:a},{provide:L,useValue:u},{provide:x,useValue:e},{provide:ae,useValue:t},{provide:ht,useValue:h},H,B,...r,{provide:le,useValue:i},De(u.appDefinition,d),{provide:se,useValue:p},{provide:Se,useValue:f},je,{provide:ke,useValue:new ke(n)},o.z,m,g,o.bL,o.Eu,{provide:we,useValue:new we(new Set(y))},{provide:ut,useValue:v},ft,Dt,{provide:c.APP_FILTER,useClass:Mt},{provide:c.APP_INTERCEPTOR,useClass:Ft}],imports:[...s],exports:[ue,L,x,ae,H,B,...r.map((({provide:e})=>e)),le,D,se,Se,je,o.z,Te,Ie,o.bL,o.Eu,ke,Me,ht,ft,Dt],controllers:[Re],global:!0}}}var Vt=r(74081);const Gt=()=>{},Ht=()=>{throw new Error("Not supported")};class Bt{constructor(e,t){this.cqrsBroker=e,this.eventsBroker=t,this.isListening$=new g.X(!1),this.use=Ht,this.get=Ht,this.post=Ht,this.head=Ht,this.delete=Ht,this.put=Ht,this.options=Ht,this.patch=Ht,this.end=Ht,this.applyVersionFilter=Ht,this.disconnect=Gt,this.close=Gt,this.status=Ht,this.render=Ht,this.redirect=Ht,this.setHeader=Ht,this.enableCors=Ht,this.initHttpServer=Ht,this.registerParserMiddleware=Ht,this.createMiddlewareFactory=Ht}isHeadersSent(){return!1}bindHandler(e){if(this.cqrsCallbacks||this.eventCallbacks)throw new Error("Handler already registered");this.cqrsCallbacks={onCommand:(t,r,n,o)=>new Promise(((a,i)=>{e({type:pe.Command,module:t,name:r,body:n,context:o},{type:pe.Command,value:{result:(0,ye.Vp)(void 0)},reply:e=>a(e),fail:e=>i(e)})})),onQuery:(t,r,n,o)=>{const a=new Promise(((a,i)=>{e({type:pe.Query,module:t,name:r,body:n,context:o},{type:pe.Query,value:{result:f.E},reply:e=>a(e),fail:e=>i(e)})}));return(0,d.D)(a).pipe((0,Vt.J)())}},this.eventCallbacks={onLocalEvent:(t,r,n,o,a)=>new Promise(((r,i)=>{e({type:pe.Event,body:o,context:a,name:n,module:t},{type:pe.Event,reply:()=>r(),fail:e=>i(e)})}))}}all(e,t){if(!t)throw new Error("Provide a handler");return this.bindHandler(t)}async listen(){if(!this.cqrsCallbacks||!this.eventCallbacks)throw new Error("Please call `all(path, handler)` first");const e=await this.cqrsBroker.connect(this.cqrsCallbacks).start(),t=await this.eventsBroker.connect(this.eventCallbacks).start(),{isListening$:r}=this;this.disconnect=()=>{e.stop(),t.stop(),r.complete()},this.close=this.disconnect,this.isListening$.next(!0)}reply(e,t){switch(e.type){case pe.Query:case pe.Command:e.reply(t.result);break;case pe.Event:e.reply();break;default:(0,h.U)(e)}}getInstance(){return this}getHttpServer(){return{once:Gt,address:()=>"",removeListener:Gt}}getType(){return"AppCoreNode"}}const Kt=()=>{};class Wt extends c.AbstractHttpAdapter{constructor(e,t){super(new Bt(e,t)),this.createMiddlewareFactory=this.instance.createMiddlewareFactory,this.close=this.instance.close,this.reply=this.instance.reply,this.useStaticAssets=Kt,this.setViewEngine=Kt,this.getRequestHostname=Kt,this.status=Kt,this.render=Kt,this.redirect=Kt,this.setNotFoundHandler=Kt,this.setHeader=Kt,this.registerParserMiddleware=Kt,this.enableCors=Kt,this.setErrorHandler=Kt,this.end=Kt,this.isListening$=this.instance.isListening$}initHttpServer(){this.setHttpServer({once:Kt,address:()=>"",removeListener:Kt})}getRequestMethod(){return U.RequestMethod.ALL}getRequestUrl(){return"/"}getType(){return"CoreApp"}isHeadersSent(){return!1}applyVersionFilter(){throw new Error("Versioning not supported")}}var zt=r(90171);class $t extends le{log(){}warn(e,...t){return console.warn(e,t)}error(e,...t){return console.error(e,t)}trace(e,...t){return console.trace(e,t)}}class Qt extends Se{get time(){return Date.now()}createObservableTimer(e,t){return(0,zt.H)(e,t)}}class Yt extends ht{fetch(){return Promise.reject(new Error("Please add a jsonFetcher to the application. Probably you are seing that in unit tests.\nIf this is the case, please mock whatever service is requiring to fetch the data"))}}const Xt="dl-module";const Jt=(e,t)=>t.reduce(((t,r)=>{const n=Reflect.getMetadata(Xt,r.module);if(!(o=n)||"object"!=typeof o||o.api&&!(o.api.commands&&o.api.events&&o.api.name&&o.api.queries&&o.handlers)||o.exports&&!Array.isArray(o.exports)||o.handlers&&!o.api||o.imports&&!Array.isArray(o.imports)||o.providers&&!Array.isArray(o.providers))return t;var o;n.onFrameworkInit&&(n.onFrameworkInit instanceof Array?t.onFrameworkInits=t.onFrameworkInits.concat(n.onFrameworkInit):t.onFrameworkInits.push(n.onFrameworkInit));const a=n.api?.name??n.sharedModuleName??"unnamed";t.configProviders.push(...function(e,t,r,n){if(!r.configurations)return[];const{configurations:o}=r,a=[];return Object.keys(o).forEach((e=>{const r=o[e].token,i=n.configurations?.[e];if(!i)throw new Error(`Missing '${e}' configuration for '${t}' module`);a.push({...i,provide:r})})),Object.keys(n.configurations??{}).forEach((n=>{r.configurations?.[n]||e.error(`Unknown '${n}' configuration for '${t}' module will be unused`)})),a}(e,a,n,r)),n.api?.name&&t.modulesMetadata.set(n.api.name,n),t.modules.push(r.module);const i=n.requiredFeatureFlips;return t.requiredFeatureFlips.push(...i?i.filter((e=>!t.requiredFeatureFlips.includes(e))):[]),n.crons&&t.crons.push(...n.crons.map((e=>({...e,moduleName:a})))),n.handlers?.events&&t.eventHandlers.push(...Object.values(n.handlers.events).flatMap((e=>Object.values(e.events)))),n.stores&&t.stores.push(...n.stores),t}),{configProviders:new Array,modules:new Array,modulesMetadata:new Map,requiredFeatureFlips:(0,u.Ay)([]),onFrameworkInits:new Array,crons:new Array,eventHandlers:new Array,stores:new Array});class Zt{}class er extends Zt{constructor(e){super(),this.alarm$=e.createObservableTimer(6e4,6e4)}}var tr;!function(e){e.VALUE_PROVIDER="value_provider",e.CLASS_PROVIDER="class_provider"}(tr||(tr={}));class rr{constructor(e,t,r,n){this.handler=e,this.logger=t,this.requestContext=r,this.definition=n}static async create(e,t,r,n){const o=await e.resolve(_t,t,{strict:!1}),a=await e.resolve(D,t,{strict:!1});return new rr(r,o,a,n)}run(){try{return this.handler.run()}catch(e){this.captureException(e)}}isRunnable(){try{return this.handler.isRunnable?.()??!0}catch(e){return this.captureException(e),!1}}captureException(e){const{definition:t,requestContext:r}=this;this.logger.captureException(e,{moduleName:t.moduleName,useCaseName:t.name,useCaseId:r.useCaseId})}}function nr(e){return!!e&&"object"==typeof e&&(0,u.l$)(e,"entries")&&Array.isArray(e.entries)&&e.entries.every((e=>function(e){return!!e&&"object"==typeof e&&(0,u.l$)(e,"dueTimestamp")&&(0,u.l$)(e,"moduleName")&&(0,u.l$)(e,"name")&&"string"==typeof e.name&&"string"==typeof e.moduleName&&"number"==typeof e.dueTimestamp}(e)))}class or{constructor(e,t){this.storage=e,this.storageKey=`crons.${t}`}async setState(e){await this.storage.set(this.storageKey,JSON.stringify(e))}async getState(){const e=await this.storage.get(this.storageKey);if(!e)return{entries:[]};const t=JSON.parse(e);return nr(t)?t:{entries:[]}}}const ar=6e4;function ir(e){return Math.ceil(e/ar)*ar}function sr(e){return Math.floor(e/ar)*ar}class cr{constructor(e,t){this.infra=e,this.identifiers=t}async init(){const e=ir(this.infra.timers.time),t=await this.infra.repository.getState(),r=this.identifiers.filter((e=>!t.entries.find((t=>t.name===e.name&&t.moduleName===e.moduleName)))).map((e=>this.infra.getCron(e))),n={entries:[...t.entries.filter((e=>this.identifiers.find((t=>t.name===e.name&&t.moduleName===e.moduleName)))),...r.map((t=>({...t.identifier,dueTimestamp:e+t.periodInMs})))]};await this.infra.repository.setState(n)}async runAllCrons(){const e=await this.infra.repository.getState(),t=ir(this.infra.timers.time),r=sr(this.infra.timers.time),n=e.entries.filter((e=>e.dueTimestamp<=t));await Promise.allSettled(n.map((t=>this.runCron(r,e,t))))}async runCron(e,t,r){const n=this.infra.getCron(r);await n.mutex.runExclusive((async()=>{await n.isRunnable()&&(await n.run(),r.dueTimestamp=sr(e+n.periodInMs),await this.infra.repository.setState(t))}))}}const ur={run:()=>{throw new Error("Should not run")},isRunnable:()=>!1};async function lr(e,t,r,n,o){const a=new cr({timers:t,repository:new or(n,o),getCron:t=>{const n=(({moduleName:t,name:r})=>{const n=e.find((e=>e.name===r&&e.moduleName===t));if(!n)throw new Error(`No such cron ${r} in ${t}`);return n})(t);let o;const a=async()=>{if(o)return o;const e=await async function(e,t){const r=c.ContextIdFactory.create(),n={type:pe.Cron,scope:e.scope,[fe.REQUEST_CONTEXT_ID]:r};t.registerRequestByContextId(n,r);const o=async()=>{const n=await t.resolve(e.handler,r,{strict:!1});return rr.create(t,r,n,e)};return e.scope===he.UseCaseScope.Device||(await t.resolve(D,r,{strict:!1})).userName?o():ur}(n,r);return o=e,e};return{identifier:t,isRunnable:async()=>{const e=await a();return!e.isRunnable||await e.isRunnable()},mutex:n.mutex??new et.WU,periodInMs:60*n.periodInMinutes*1e3,run:async()=>(await a()).run()}}},e);return await a.init(),a}function dr(e){const{parameterProvider:t,token:r}=e;switch(t.type){case tr.CLASS_PROVIDER:return{provide:r,useClass:t.useClass};case tr.VALUE_PROVIDER:return{provide:r,useValue:t.useValue};default:(0,h.U)(t)}}r(60171);var pr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},fr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},hr=function(e,t){return function(r,n){t(r,n,e)}};const yr=new o.bL,mr=new o.z;let gr=class{constructor(e,t,r){this.kv=e,this.prefix=`batch-storage.${r}.${t.userName}`}async getBatchState(e){const t=await this.kv.get(`${this.prefix}.${e}`);return t?this.stringToState(t):{queue:[]}}async setBatchState(e,t){const r=this.stateToString(t);return await this.kv.set(`${this.prefix}.${e}`,r)}stateToString(e){const t=yr.encode(e);return mr.encode(t)}stringToState(e){const t=mr.decode(e);return yr.decode(t)}};gr=pr([hr(2,(0,U.Inject)(ot)),fr("design:paramtypes",[Me,D,String])],gr);class vr{getProviders(e){if(!e.length)return[];return[...e.map((e=>({provide:e,inject:[gr,e.Definition.chunkProcessor],useFactory:(t,r)=>new e(t,r)}))),...e.map((({Definition:{chunkProcessor:e}})=>e)),gr]}}const br=(e,t)=>({[e.name]:{name:e.name,events:t}}),wr=(e,t)=>{const{exports:r=[],imports:n=[],providers:o=[],onFrameworkInit:a=[],stores:i=[],crons:s=[]}=e,c=[a,t.onFrameworkInit??[]].flat();return{...e,exports:r.concat(t.exports??[]),imports:n.concat(t.imports??[]),providers:o.concat(t.providers??[]),onFrameworkInit:c,stores:i.concat(t.stores??[]),crons:s.concat(t.crons??[])}};function Rr(e){const{composes:t=[]}=e;e=t.reduce(((e,t)=>wr(e,t)),e);const{exports:r=[],imports:n=[],handlers:o={commands:{},events:{},queries:{}},providers:a=[],onFrameworkInit:i=[],stores:s,batchExecutors:c,crons:u}=e,l=e.api?.name??e.sharedModuleName,d=l?ct(...s??[]):[],p=l?(new vr).getProviders(c??[]):[],f=[...a,...(u??[]).map((e=>e.handler)),...d,...p,...Object.values(o.commands),...Object.values(o.queries),...Object.values(o.events).map((e=>Object.values(e.events))).reduce(((e,t)=>[...e,...t]),new Array),...i instanceof Array?i:[i],{provide:ot,useValue:l}],{asyncProviders:h,basicClassProviders:y}=f.reduce(((e,t)=>{return"object"==typeof(r=t)&&"token"in r&&"asyncFactory"in r&&"function"==typeof r.asyncFactory?{asyncProviders:[...e.asyncProviders,t],basicClassProviders:e.basicClassProviders}:{asyncProviders:e.asyncProviders,basicClassProviders:[...e.basicClassProviders,t]};var r}),{asyncProviders:new Array,basicClassProviders:new Array}),m=[...y,...h.map((e=>({provide:e.token,useFactory:e.asyncFactory,inject:e.inject})))],g=(0,U.Module)({exports:r,imports:n,providers:m});return t=>(Reflect.defineMetadata(Xt,e,t),g(t))}var Sr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Er=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Or=class{constructor(e,t){this.infra=e,this.lifeCycle=t}onFrameworkInit(){this.lifeCycle.addAppReadyHook((async()=>{const{stop:e}=await this.infra.start();return()=>{e()}}))}};Or=Sr([k(),Er("design:paramtypes",[Pt,ue])],Or);var Cr=r(25313),Pr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ar=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let jr=class{constructor(e){this.logger=e}intercept(e,t){return t.handle().pipe((0,Q.K)(this.captureException(e)))}captureException(e){return t=>{const r=e.getArgByIndex(0);return this.logger.captureException(t,{moduleName:r.module,useCaseName:r.name,useCaseId:r.context.useCaseId}),(0,Cr._)((()=>t))}}};jr=Pr([(0,U.Injectable)({scope:U.Scope.REQUEST}),Ar("design:paramtypes",[_t])],jr);var _r,Tr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Ir=_r=class{static configure(e){return{module:_r,configurations:{sink:e.sink}}}};function xr(e){return{type:tr.VALUE_PROVIDER,useValue:e}}function Dr(e){return{type:tr.CLASS_PROVIDER,useClass:e}}Ir=_r=Tr([Rr({sharedModuleName:"exception-logging",providers:[_t,{provide:c.APP_INTERCEPTOR,useClass:jr},Ct],configurations:{sink:{token:Pt}},exports:[_t],onFrameworkInit:Or,requiredFeatureFlips:[Ot]})],Ir);const Ur={sink:xr(new class{logException(){return Promise.resolve()}start(){return Promise.resolve({stop:()=>Promise.resolve()})}})};var Mr=r(73656);const Nr=async({appDefinition:e,channels:t,currentNode:r,implementations:l,otherModules:d=[],logger:p=new $t,storeInfrastructureFactory:f=new ce,channelsListener:h=W,timers:y=new Qt,keyValueStorageInfrastructure:m=new Le,jsonFetcher:g=new Yt,cronSource:v=new er(y),defaultDeviceStorageEncryptionCodec:b={type:tr.CLASS_PROVIDER,useClass:o.Eu},defaultUserStorageEncryptionCodec:w={type:tr.CLASS_PROVIDER,useClass:o.Eu},exceptionLogging:R=Ur})=>{const S=()=>{throw new Error("Aborted")};Mr.abort=S,Mr.exit=S;const E=[...[Ir.configure(R)],...d,...Object.keys(l).map((e=>e)).map((e=>l[e]))],{configProviders:O,modules:C,modulesMetadata:P,requiredFeatureFlips:A,onFrameworkInits:j,crons:_,eventHandlers:T,stores:I}=Jt(p,E),U=new ut;I.forEach((e=>{U.registerClass(e)})),((e,t,r)=>{const n=new Set([...r.keys()]),o=new Set(Object.values(e).filter((e=>e.main===t||e.queryOnly.includes(t))).map((e=>e.api.name))),a=[...o].filter((e=>!n.has(e))),i=[...n].filter((e=>!o.has(e)));if(a.length>0)throw new Error("These APIs are not implemented "+JSON.stringify(a));if(i.length>0)throw new Error("Some implementations do not have APIS "+JSON.stringify(i))})(e,r,P);const M=(e=>[...e.entries()].reduce(((e,[t,r])=>{const n=r.handlers?.events??{};return e[t]=Object.values(n).reduce(((e,t)=>t.name?(e[t.name]=Object.keys(t.events),e):e),(0,u.Ay)({})),e}),(0,u.Ay)({})))(P),N=new L({appDefinition:e,channels:t,channelsListener:h,currentNode:r,subscriptions:M}),k=new x(N),F=new ae(N),V=new Wt(k,F),G=dr({token:Te,parameterProvider:b}),H=dr({token:Ie,parameterProvider:w}),B=new ue,K=qt.create({nodeConfiguration:N,brokers:{cqrs:k,event:F},modules:C,configProviders:O,logger:p,lifeCycle:B,storeInfrastructureFactory:f,timers:y,requiredFeatureFlips:A,keyValueStorageInfrastructure:m,jsonFetcher:g,eventHandlers:T,defaultDeviceStorageEncryptionCodecProvider:G,defaultUserStorageEncryptionCodecProvider:H,storeList:U}),z=await c.NestFactory.create(K,V,{logger:p}),$=await z.init();await async function(e,t){const r=Object.freeze({id:-1}),n=e.map((async e=>{const n={type:pe.Init,[fe.REQUEST_CONTEXT_ID]:r};t.registerRequestByContextId(n,r);const o=await t.resolve(e,r,{strict:!1});await o.onFrameworkInit()}));await Promise.all(n)}(j,$),z.listen("");const Q=V.isListening$.pipe((0,a.h)((e=>!!e)));return await(0,i.z)(Q),B.addAppReadyHook((async()=>{const e=await lr(_,y,$,m,r),t=v.alarm$.pipe((0,s.z)((async()=>{await e.runAllCrons()}))).subscribe();return()=>{t.unsubscribe()}})),B.addShutdownHook((()=>z.close())),await B.startup(),{stop:()=>B.shutDown(),createClient:()=>q(e,k),sendEvent:(e,t,r,o)=>F.publishEvent(e,t,r,o??new D({useCaseId:(0,n.Z)()}))}},kr=e=>Nr({...e,appDefinition:e.appDefinition,channels:{},currentNode:"node"}),Lr=(e,t)=>(()=>{const e=t=>({define:()=>t,with:r=>{const n={api:r.module,main:r.on,queryOnly:r.queryOnly??[]},o={[r.module.name]:n};return e({...t,...o})}});return e({})})().with({module:he.requestContextApi,on:e}).with({module:he.taskTrackingApi,on:e}),Fr=Lr("node",[]);class qr{}var Vr;!function(e){e.DummyFeatureFlip0="dummyFeatureFlip0",e.DummyFeatureFlip1="dummyFeatureFlip1",e.DummyFeatureFlip2="dummyFeatureFlip2",e.DummyFeatureFlip3="dummyFeatureFlip3",e.DummyFeatureFlip4="dummyFeatureFlip4",e.DummyFeatureFlip5="dummyFeatureFlip5"}(Vr||(Vr={}));class Gr extends qr{constructor(e={}){super(),this.fixture=e}async getFeatureFlipsForActiveUser(e){const t=e.reduce(((e,t)=>t in this.fixture?{...e,[t]:this.fixture[t]}:{...e}),{});return await Promise.resolve(t)}}var Hr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Br=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Kr=class extends o.eN{constructor(e){super(e)}};Kr=Hr([N(),Br("design:paramtypes",[o.jN])],Kr);var Wr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let zr=class{};function $r(e){const t=N();return r=>{Reflect.defineMetadata("dl-handler",r,e),t(r)}}zr=Wr([Rr({providers:[Kr],configurations:{infrastructure:{token:o.jN}},exports:[Kr],sharedModuleName:"http"})],zr);const Qr=e=>"object"==typeof e&&null!==e&&(0,u.l$)(e,"swStartTime")&&(0,u.l$)(e,"taskTrackingList")&&"string"==typeof e.swStartTime&&"object"==typeof e.taskTrackingList;class Yr extends(Ye({persist:!1,initialValue:{swStartTime:"",taskTrackingList:{}},scope:he.UseCaseScope.Device,storeName:"task-tracking",storeTypeGuard:Qr,capacity:Xe._001KB})){}var Xr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Jr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Zr=class{constructor(e){this.store=e}async execute({body:e}){const t=(new Date).toISOString(),{taskName:r,feature:n,businessDomain:o}=e,a={taskName:r,feature:n,businessDomain:o,startTime:t,serviceWorkerInterruptionCount:0},i=await this.store.getState();return await this.store.set({...i,taskTrackingList:{...i.taskTrackingList,[t]:a}}),Promise.resolve((0,ye.Vp)({id:t}))}};Zr=Xr([$r(he.StartTaskTrackingCommand),Jr("design:paramtypes",[Yr])],Zr);var en=r(53576),tn=r(11494);class rn{constructor(e){this.publishEvent=(e,t,r,n)=>this.broker.publishEvent(e,t,r,n),this.broker=new ae(e);const t=e.getModuleNames().reduce(((t,r)=>({...t,[r]:Object.keys(e.appDefinition[r].api.events).reduce(((e,t)=>(e[t]=[],e)),(0,u.Ay)({}))})),(0,u.Ay)({}));this.localSubscribersMap=Object.keys(e.subscriptions).map((e=>e)).reduce(((t,r)=>{const n=e.subscriptions[r];return Object.keys(n).map((e=>e)).forEach((e=>{const o=n[e]??[],a=t[e];o.forEach((e=>{a[e].push(r)}))})),t}),t)}connect(e){const{localSubscribersMap:t,broker:r}=this;return r.connect({onLocalEvent:async(r,n,o,a,i,s)=>{const c=t[r][o];await Promise.all(c.map((async t=>{await e.onEvent(r,t,o,a,i,s)})))}})}}var nn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},on=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},an=function(e,t){return function(r,n){t(r,n,e)}};let sn=class{constructor(e,t,r){this.apiName=e,this.broker=t,this.context=r}sendEvent(e,t){return this.broker.publishEvent(this.apiName,e,t,this.context)}};sn=nn([N(),an(0,(0,U.Inject)(ot)),on("design:paramtypes",[Object,ae,D])],sn);let cn=class{constructor(e,t){this.apiName=e,this.broker=t}sendEvent(e,t,r){return this.broker.publishEvent(this.apiName,e,t,r??new D({useCaseId:(0,n.Z)()}))}};cn=nn([N(),an(0,(0,U.Inject)(ot)),on("design:paramtypes",[Object,ae])],cn);const un=()=>{const e=(t,r)=>{const o=new L({appDefinition:t,channels:{},channelsListener:W,currentNode:"",subscriptions:{}}),a=new x(o);let i;const s=()=>{if(i)return i;const e=a.connect({onCommand:(e,t,n)=>{if(!(e in r))throw new Error(`${e} is not mocked`);return r[e].commands[t](n)},onQuery:(e,t,n)=>{if(!(e in r))throw new Error(`${e} is not mocked`);return r[e].queries[t](n)}});return i=e.start(),i};return{buildClient:async e=>{const t=new H(a,o,e??new D({useCaseId:(0,n.Z)()}));return await s(),t},buildContextlessClient:async()=>{const e=new B(o,a);return await s(),e},withMock:(n,o)=>{const a={...t,...(0,u.Ay)({[n.name]:{api:n,main:"",queryOnly:[]}})};return e(a,{...r,[n.name]:o})}}};return e({},{})};function ln({appDefinition:e,channels:t,channelsListener:r}){const n=new L({appDefinition:e,channels:t,channelsListener:r,currentNode:null,subscriptions:{}}),o=new x(n),a=()=>{throw new Error("Unexpected request received by detached application client")};return o.connect({onCommand:a,onQuery:a}).start(),q(e,o)}var dn=r(27149);async function pn(e,t=1e4){if(!(0,dn.b)(e))throw new Error("Error in getQueryValue: the argument is not an observable");try{return await(0,i.z)(e.pipe((0,$.V)({first:t})))}catch(e){throw new Error("Error in getQueryValue: "+e)}}var fn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},hn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let yn=class{constructor(e,t,r){this.store=e,this.cqrsClient=t,this.appLifecycle=r}onFrameworkInit(){this.appLifecycle.addAppReadyHook((async()=>{const e=await this.store.getState(),t={...e.taskTrackingList},r=Object.keys(e.taskTrackingList).map((async r=>{const{taskName:n,feature:o,businessDomain:a,startTime:i}=e.taskTrackingList[r],s=new tn.UserMv3ExtensionTaskInterruptionEvent({businessDomain:a,feature:o,taskName:n,taskStartDateTime:i,serviceWorkerStartDateTime:e.swStartTime}),c=this.cqrsClient.getClient(en.carbonLegacyApi);await c.commands.carbon({name:"logEvent",args:[{event:s}]}),delete t[r]}));await Promise.all(r),await this.store.set({swStartTime:(new Date).toISOString(),taskTrackingList:t})}))}};yn=fn([k(),hn("design:paramtypes",[Yr,H,ue])],yn);var mn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},gn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let vn=class{constructor(e,t,r){this.store=e,this.cqrsClient=t,this.logger=r}async execute({body:e}){const{taskTrackingId:t}=e,r=await this.store.getState(),n=r.taskTrackingList[t];if(!n)return this.logger.trace("Trying to track a task that does not exist"),(0,ye.Vp)(void 0);const{taskName:o,feature:a,businessDomain:i,startTime:s,serviceWorkerInterruptionCount:c}=n,u=new tn.UserMv3ExtensionTaskReportEvent({businessDomain:i,feature:a,serviceWorkerInterruptionCount:c,serviceWorkerStartDateTime:r.swStartTime,taskName:o,taskStartDateTime:s,taskEndDateTime:(new Date).toISOString()}),l=this.cqrsClient.getClient(en.carbonLegacyApi);await l.commands.carbon({name:"logEvent",args:[{event:u}]});const d={...r.taskTrackingList};return delete d[t],await this.store.set({swStartTime:r.swStartTime,taskTrackingList:d}),(0,ye.Vp)(void 0)}};vn=mn([$r(he.TerminateTaskTrackingCommand),gn("design:paramtypes",[Yr,H,le])],vn);var bn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let wn=class{};function Rn(e){const t=N();return r=>{Reflect.defineMetadata("dl-handler",r,e),t(r)}}function Sn(e){const t=N();return r=>{if(Reflect.hasMetadata("dl-handlers",e)){const t=Reflect.getMetadata("dl-handlers",e);Reflect.defineMetadata("dl-handlers",[...t,r],e)}else Reflect.defineMetadata("dl-handlers",[r],e);t(r)}}wn=bn([Rr({api:he.taskTrackingApi,handlers:{commands:{startTaskTracking:Zr,terminateTaskTracking:vn},events:{},queries:{}},stores:[Yr],onFrameworkInit:yn,providers:[]})],wn);var En=r(34987);const On=e=>!(!e||"object"!=typeof e)&&"userName"in e,Cn=e=>!(!e||"object"!=typeof e)&&"featureFlips"in e;class Pn extends(Ye({initialValue:{userName:void 0},persist:!1,scope:he.UseCaseScope.Device,storeName:"active-user-store",storeTypeGuard:On,capacity:Xe._001KB})){}class An extends(Ye({persist:!0,scope:he.UseCaseScope.Device,storeName:"feature-flip-store",capacity:Xe._001KB,codec:o.Eu,storage:{initialValue:{featureFlips:{}},schemaVersion:1,typeGuard:Cn}})){}var jn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let _n=class extends sn{};_n=jn([N()],_n);var Tn=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},In=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let xn=class{constructor(e){this.activeUserStore=e}execute(){return this.activeUserStore.state$.pipe((0,p.U)((e=>e.userName)),(0,P.x)(),(0,p.U)((e=>(0,ye.Vp)({userName:e}))))}};xn=Tn([Rn(he.ActiveUserQuery),In("design:paramtypes",[Pn])],xn);const Dn=new et.WU;let Un=class{constructor(e,t,r,n){this.featureFlipsStore=e,this.config=t,this.activeUserStore=r,this.allowedToFail=n,this.retrieveAndSetFeatureFlips=async e=>0===e.length?Promise.resolve({}):await Dn.runExclusive((async()=>{if(!(await(0,i.z)(this.activeUserStore.state$)).userName)return{};const t=await this.featureFlipsStore.getState(),r=e.reduce(((e,r)=>{if(r in t.featureFlips){const n={};return n[r]=t.featureFlips[r],{...e,...n}}return e}),{}),n=e.filter((e=>!(e in r)));if(0===n.length)return r;const o=await(async e=>{let t={};return await this.allowedToFail.doOne((async()=>{t=await this.config.getFeatureFlipsForActiveUser(e)})),t})(n);return await this.featureFlipsStore.set({...t,featureFlips:{...t.featureFlips,...o}}),{...r,...o}}))}execute(e){return this.featureFlipsStore.state$.pipe((0,En.b)((()=>this.retrieveAndSetFeatureFlips(e.body.requiredFeatureFlips))),(0,p.U)((e=>(0,ye.Vp)(e))))}};Un=Tn([Rn(he.UserFeatureFlipsQuery),In("design:paramtypes",[An,qr,Pn,Dt])],Un);let Mn=class{constructor(e){this.featureFlipsStore=e}execute(){return(0,d.D)(this.featureFlipsStore.state$.pipe((0,p.U)((e=>(0,ye.Vp)({cachedFeatureFlips:Object.keys(e.featureFlips)})))))}};Mn=Tn([Rn(he.GetCachedFeatureFlipsListQuery),In("design:paramtypes",[An])],Mn);let Nn=class{constructor(e){this.featureFlipsStore=e}async execute({body:{featureFlips:e}}){return await this.featureFlipsStore.set({featureFlips:e}),(0,ye.Vp)(void 0)}};Nn=Tn([$r(he.SetFeatureFlipsInStoreCommand),In("design:paramtypes",[An])],Nn);let kn=class{constructor(e,t){this.activeUserStore=e,this.eventEmitter=t}async execute({body:{userName:e}}){return await this.activeUserStore.set({userName:e}),this.eventEmitter.sendEvent("activeUserChanged",{userName:e}),(0,ye.Vp)(void 0)}};kn=Tn([$r(he.SetActiveUserCommand),In("design:paramtypes",[Pn,_n])],kn);var Ln=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Fn=class{};Fn=Ln([Rr({api:he.requestContextApi,handlers:{commands:{setActiveUser:kn,setFeatureFlipsInStore:Nn},events:{},queries:{activeUser:xn,userFeatureFlips:Un,getCachedFeatureFlipsList:Mn}},stores:[Pn,An],configurations:{featureFlipsConf:{token:qr}},providers:[_n]})],Fn);const qn=16,Vn=.5,Gn=1.3;function Hn(e){var t;const{chunkControl:{decrement:r=Vn,increment:n=Gn,initialSize:o=qn}={decrement:Vn,increment:Gn,initialSize:qn}}=e;const a=new et.WU;return(t=class{constructor(e,t){this.repository=e,this.processor=t}async dispatchBatch(e){await a.runExclusive((async()=>{const t=await this.pushItemsInQueue(e);for(;t.queue.length>0;)await this.processOneChunkFromQueue(t)}))}async pushItemsInQueue(t){const r=await this.repository.getBatchState(e.name),n=t.filter((e=>!r.queue.find((t=>t===e))));return n.length&&(r.queue.push(...n),await this.repository.setBatchState(e.name,r)),r}async processOneChunkFromQueue(t){const a=function(e){const{lastStartedChunkFirstId:t,lastStartedChunkSize:a=o}=e;if(!t)return o;const i=!e.queue.find((e=>e===t));return Math.max(1,i?Math.ceil(a*n):Math.floor(a*r))}(t),i=Math.min(a,t.queue.length);if(!i)throw new Error("Should have something to process");await this.repository.setBatchState(e.name,{...t,lastStartedChunkSize:i,lastStartedChunkFirstId:t.queue[0]});const s=t.queue.splice(0,i);await this.processor.processChunk(s),await this.repository.setBatchState(e.name,t)}}).Definition=e,t}},68224:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ActiveUserChangedEvent:()=>S,ActiveUserQuery:()=>g,CommandMessage:()=>i,EMPTY_QUERY_RESULT:()=>u,EventMessage:()=>y,FilterOperationName:()=>a,GetCachedFeatureFlipsListQuery:()=>b,PAGINATION_START_PAGE_INDEX:()=>c,QueryMessage:()=>s,SetActiveUserCommand:()=>w,SetFeatureFlipsInStoreCommand:()=>R,StartTaskTrackingCommand:()=>C,TerminateTaskTrackingCommand:()=>P,UseCaseScope:()=>o,UserFeatureFlipsQuery:()=>v,appClientMockBuilder:()=>j,defineCarbonCommand:()=>p,defineCommand:()=>d,defineEvent:()=>m,defineModuleApi:()=>h,defineQuery:()=>l,featureFlipsApi:()=>O,requestContextApi:()=>E,taskTrackingApi:()=>A});class n{}var o,a;!function(e){e.User="user",e.Device="device"}(o||(o={}));class i extends n{constructor(e){super(),this.body=e}}class s extends n{constructor(e){super(),this.body=e}}!function(e){e.Equals="equals",e.Differs="differs",e.Matches="matches",e.In="in",e.Contains="contains"}(a||(a={}));const c=1,u={items:[],itemCount:0,page:c,pageCount:1},l=(e={scope:o.User})=>{var t;return(t=class extends s{}).metadata=e,t},d=(...[e={scope:o.User}])=>{var t;return(t=class extends i{}).metadata=e,t},p=(e={scope:o.User})=>{var t;return(t=class extends i{}).metadata=e,t},f=(e,t)=>Object.entries(e).reduce(((e,[r,n])=>(e[((e,t)=>e.endsWith(t)?e.charAt(0).toLowerCase()+e.substring(1,e.length-t.length):e)(r,t)]=n,e)),{}),h=e=>({name:e.name,commands:f(e.commands,"Command"),queries:f(e.queries,"Query"),events:f(e.events,"Event"),requiredFeatureFlips:e.requiredFeatureFlips||[]});class y{constructor(e){this.body=e}}const m=(e={scope:o.User})=>{var t;return(t=class extends y{}).metadata=e,t};class g extends(l({scope:o.Device})){}class v extends(l({scope:o.Device})){}class b extends(l({scope:o.Device})){}class w extends(d({scope:o.Device})){}class R extends(d({scope:o.Device})){}class S extends(m({scope:o.Device})){}const E=h({commands:{SetActiveUserCommand:w,SetFeatureFlipsInStoreCommand:R},events:{activeUserChanged:S},name:"requestContext",queries:{ActiveUserQuery:g,UserFeatureFlipsQuery:v,GetCachedFeatureFlipsListQuery:b}}),O=h({commands:{},events:{},name:"featureFlips",queries:{}});class C extends(d({scope:o.Device})){}class P extends(d({scope:o.Device})){}const A=h({name:"taskTracking",commands:{startTaskTracking:C,terminateTaskTracking:P},events:{},queries:{}}),j=()=>{const e=new Map,t={withModule:(r,n)=>{const o="string"==typeof r?r:r.name;return e.set(o,n),t},build:()=>Array.from(e.keys()).reduce(((t,r)=>({...t,[r]:e.get(r)})),{})};return t}},17530:(e,t,r)=>{"use strict";r.d(t,{Ip:()=>v,yQ:()=>O,i3:()=>R,Dq:()=>je,kC:()=>Qt,SW:()=>Bt,ah:()=>T,_M:()=>D,qn:()=>N,co:()=>G,$S:()=>K,ox:()=>$,nY:()=>ae,iT:()=>Fe,tu:()=>ke,wB:()=>or,YX:()=>Pe,cQ:()=>Rr,PM:()=>hr,QS:()=>Ar,Uy:()=>Cr,gF:()=>ce,Hd:()=>de,eP:()=>he,kM:()=>ge,lX:()=>Mt,$y:()=>Rt,u8:()=>zr,Fi:()=>Qr,LY:()=>kr,ft:()=>Ee,nr:()=>qt,Yu:()=>i,QI:()=>Dr});var n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}class a extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}const i=(0,n.defineModuleApi)({commands:{TrackEventCommand:o,TrackPageViewCommand:a},events:{},name:"analytics",queries:{}});var s=r(32839),c=r(87279),u=r(53576),l=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let p=class{constructor(e){this.cqrsClient=e}async trackEvent(e){const{carbon:t}=this.cqrsClient.getClient(u.carbonLegacyApi).commands,r=await t({name:"logEvent",args:[{event:e}]});if((0,c.hx)(r))throw new Error("TrackEvent from carbon failed")}async trackPageView(e,t){const{carbon:r}=this.cqrsClient.getClient(u.carbonLegacyApi).commands,n=await r({name:"logPageView",args:[{pageView:e,browseComponent:t}]});if((0,c.hx)(n))throw new Error("TrackPageView from carbon failed")}};p=l([(0,s.Injectable)(),d("design:paramtypes",[s.CqrsClient])],p);var f=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},h=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let y=class{constructor(e){this.analyticsService=e}async execute({body:{event:e}}){return await this.analyticsService.trackEvent(e),(0,c.Vp)(void 0)}};y=f([(0,s.CommandHandler)(o),h("design:paramtypes",[p])],y);let m=class{constructor(e){this.analyticsService=e}async execute({body:{pageView:e,browseComponent:t}}){return await this.analyticsService.trackPageView(e,t),(0,c.Vp)(void 0)}};m=f([(0,s.CommandHandler)(a),h("design:paramtypes",[p])],m);var g=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let v=class{};v=g([(0,s.Module)({api:i,providers:[p],handlers:{commands:{trackEvent:y,trackPageView:m},events:{},queries:{}}})],v);var b=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},w=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let R=class{constructor(e){this.crypto=e}};R=b([(0,s.Injectable)(),w("design:paramtypes",[Object])],R);var S=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},E=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let O=class{constructor(e){this.config=e}async derive(e,t,r){const{deriveKeyArgon2d:n}=this.config.crypto;return await n(e,t,r)}};O=S([(0,s.Injectable)(),E("design:paramtypes",[R])],O);var C=r(44396),P=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let A=class extends C.SD{};A=P([(0,s.Injectable)()],A);var j=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},_=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let T=class{constructor(e,t){this.config=e,this.derivationCache=t}decrypt(e,t){return(0,C.FO)(e,this.config.crypto,this.derivationCache,t)}};T=j([(0,s.Injectable)(),_("design:paramtypes",[R,A])],T);var I=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},x=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let D=class{constructor(e,t){this.config=e,this.derivationCache=t}async encrypt(e,t,r,n,o){return await(0,C.gi)(e,this.config.crypto,r,this.derivationCache,n,t,o)}};D=I([(0,s.Injectable)(),x("design:paramtypes",[R,A])],D);var U=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},M=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let N=class{constructor(e){this.config=e}async sign(e,t,r=C.x4){const{signHmacSha:n}=this.config.crypto;return await n(e,t,r)}};N=U([(0,s.Injectable)(),M("design:paramtypes",[R])],N);var k=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},L=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let F=class{constructor(e){this.config=e}async verify(e,t,r,n=C.x4){const{verifyHmacSha:o}=this.config.crypto;return await o(e,t,r,n)}};F=k([(0,s.Injectable)(),L("design:paramtypes",[R])],F);var q=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},V=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let G=class{constructor(e){this.config=e}generate(){const{generateKeyAes256:e}=this.config.crypto;return e()}};G=q([(0,s.Injectable)(),V("design:paramtypes",[R])],G);var H=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},B=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let K=class{constructor(e){this.config=e}decrypt(e,t){return(0,C.Ic)(e,this.config.crypto,t)}};K=H([(0,s.Injectable)(),B("design:paramtypes",[R])],K);var W=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},z=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let $=class{constructor(e){this.config=e}encrypt(e,t){const{getRandomValues:r}=this.config.crypto,n={padding:r(C.BU.padding)};return(0,C.yL)(e,this.config.crypto,C.oo,C.BU,t,n)}};function Q(){return new Uint32Array([57920321,977424202,1999259334,3390546403,3917439743,16505144,3027631148,3235565160,2643335823,1420105356,998514539,2704347781,1011257802,823882961,790991339,3929284516]).buffer}$=W([(0,s.Injectable)(),z("design:paramtypes",[R])],$);var Y=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},X=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let J=class{constructor(e){this.flexibleDecryptor=e}async decrypt(e){const t=Q();return await this.flexibleDecryptor.decrypt(t,e)}};J=Y([(0,s.Injectable)(),X("design:paramtypes",[T])],J);var Z=r(89685),ee=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},te=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let re=class{constructor(e){this.flexibleEncryptor=e}async encrypt(e){const t=Q();return await this.flexibleEncryptor.encrypt(t,e,C.oo,C.gO)}};re=ee([(0,s.Injectable)(),te("design:paramtypes",[D])],re);var ne=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ae=class{constructor(e,t){this.obfuscationKeyDecryptor=e,this.obfuscationKeyEncryptor=t}async encode(e){return await this.obfuscationKeyEncryptor.encrypt(e)}async decode(e){return(0,Z.v)(e).startsWith("$1$noderivation$aes256$cbchmac64$16$")?await this.obfuscationKeyDecryptor.decrypt(e):e}};ae=ne([(0,s.Injectable)(),oe("design:paramtypes",[J,re])],ae);var ie=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},se=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ce=class{constructor(e){this.config=e}decrypt(e,t,r="SHA-256"){const{decryptRsaOaep:n}=this.config.crypto;return n(e,t,r)}};ce=ie([(0,s.Injectable)(),se("design:paramtypes",[R])],ce);var ue=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},le=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let de=class{constructor(e){this.config=e}encrypt(e,t,r="SHA-256"){const{encryptRsaOaep:n}=this.config.crypto;return n(e,t,r)}};de=ue([(0,s.Injectable)(),le("design:paramtypes",[R])],de);var pe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},fe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let he=class{constructor(e){this.config=e}generate(e="SHA-256"){const{generateKeyPairRsaOaep:t}=this.config.crypto;return t(e)}};he=pe([(0,s.Injectable)(),fe("design:paramtypes",[R])],he);var ye=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},me=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ge=class{constructor(e){this.config=e}async sign(e,t,r="SHA-256"){const{signRsassaPkcs1:n}=this.config.crypto;return await n(e,t,r)}};ge=ye([(0,s.Injectable)(),me("design:paramtypes",[R])],ge);var ve=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},be=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let we=class{constructor(e){this.config=e}async compute(e,t){const{computeHash:r}=this.config.crypto;return await r(e,t)}};we=ve([(0,s.Injectable)(),be("design:paramtypes",[R])],we);var Re=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Se=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ee=class{constructor(e){this.config=e}compute(e){const{unsafeComputeMd5Hash:t}=this.config.crypto;return t(e)}};Ee=Re([(0,s.Injectable)(),Se("design:paramtypes",[R])],Ee);var Oe=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ce=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Pe=class{constructor(e){this.config=e}get(e){const{getRandomValues:t}=this.config.crypto;return t(e).buffer}};Pe=Oe([(0,s.Injectable)(),Ce("design:paramtypes",[R])],Pe);var Ae=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let je=class{};je=Ae([(0,s.Module)({sharedModuleName:"cryptography",configurations:{infrastructure:{token:R}},providers:[O,A,T,D,N,F,G,K,$,J,ae,re,Pe,ce,de,he,ge,we,Ee],exports:[O,A,T,D,N,F,G,K,$,J,ae,re,Pe,ce,de,he,ge,we,Ee]})],je);var _e=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Te=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ie=class{constructor(e,t){this.config=e,this.derivationCache=t}decrypt(e,t){return(0,C.Jo)(e,this.config.crypto,this.derivationCache,t)}};Ie=_e([(0,s.Injectable)(),Te("design:paramtypes",[R,A])],Ie);var xe=r(60399),De=r(48844),Ue=r(28489);var Me=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ne=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ke=class{constructor(e){this.cqrsClient=e}getPlatformInfo(){const{queries:{carbonState:e}}=this.cqrsClient.getClient(u.carbonLegacyApi);return(0,xe.z)(e({path:"device.platform.info"}).pipe((0,De.nb)({success:e=>{if(!function(e){return!(!(e&&"object"==typeof e&&(0,Ue.l$)(e,"platformName")&&(0,Ue.l$)(e,"appVersion")&&(0,Ue.l$)(e,"browser")&&(0,Ue.l$)(e,"browserVersion")&&(0,Ue.l$)(e,"country")&&(0,Ue.l$)(e,"osCountry")&&(0,Ue.l$)(e,"osVersion")&&(0,Ue.l$)(e,"os")&&(0,Ue.l$)(e,"lang"))||(0,Ue.l$)(e,"anonymousApplicationId")&&"string"!=typeof e.anonymousApplicationId||"string"!=typeof e.platformName||"string"!=typeof e.appVersion||"string"!=typeof e.browser||"string"!=typeof e.browserVersion||"string"!=typeof e.country||"string"!=typeof e.osCountry||"string"!=typeof e.osVersion||"string"!=typeof e.os||"string"!=typeof e.lang)}(e))throw new Error("Invalid platform info received from carbon");return e},failure:()=>{throw new Error("Unexpected error")}})))}};ke=Me([(0,s.Injectable)(),Ne("design:paramtypes",[s.CqrsClient])],ke);var Le=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Fe=class{};Fe=Le([(0,s.Module)({providers:[ke],exports:[ke],sharedModuleName:"platformInfo"})],Fe);var qe=r(34987),Ve=r(37182),Ge=r(69885),He=r(14888),Be=r(87065),Ke=r(18533),We=r(64839),ze=r(96168);const $e=(e,t)=>class extends((0,ze.Hu)(e,t)){constructor(e){super(),this.requestId=e}};class Qe extends($e("BusinessError","Service responded with a business error")){constructor(e,t,r){super(t),this.code=e,this.businessMessage=r}}class Ye extends($e("RateLimited","Request was throttled by Dashlane API rate limiting setup")){}class Xe extends($e("OutOfBoundsTimestamp","Client clock is not synced with server clock")){}var Je=r(17509),Ze=r(95087),et=r(43293),tt=r(54066),rt=r(96303);function nt(e){const t=(0,et.N)(e);return(0,tt.u)(t)}async function ot(e,t){const r=await e.compute(nt(t),"SHA-256");return(0,rt.k)(r)}function at(e){return e.replace(/[^A-Za-z0-9_.~\\-]/g,(e=>"%"+e.charCodeAt(0).toString(16).toUpperCase()))}function it(e,t){return e.localeCompare(t,"en",{numeric:!0})}function st(e){return e.map((e=>e.toLowerCase()))}class ct{constructor(e){this.secureHasher=e}async canonicalizeRequest(e,t){const{makeCanonicalBody:r,makeCanonicalURI:n,makeCanonicalQueryString:o,makeCanonicalHeadersString:a,makeSignedHeaderNamesString:i}=ct,{body:s,headers:c,method:u,url:l,params:d}=e,p=(0,Je.getParsedUrl)(l).fullDomain,f=l.indexOf(p),h=l.substring(f+p.length),y=r(s),m=await ot(this.secureHasher,y),g=t?st(t):void 0,v=g?(b=st(c.keys()),(w=g).length?b.filter((e=>!w.includes(e))):b):[];var b,w;const R=c.deleteMultiple(v),S=n(h),E=o(d),O=a(R),C=i(R);return{canonicalRequest:[u,S,E,O,C,m].join("\n"),signedHeaderNames:C}}static makeCanonicalURI(e){return function(e){return e.split("/").map((e=>at(e))).join("/")}(e)}static makeCanonicalQueryStringPair(e,t){const r=at(e),n=Array.isArray(t)?t:[t];return n.sort(it).map((e=>{return t=(e=>at(e))(e),[r,t];var t}))}static makeCanonicalQueryString(e){return e.keys().map((t=>`${(([e,t])=>ct.makeCanonicalQueryStringPair(e,t))([t,e.getAll(t)??[]]).map((e=>e.join("="))).join("&")}`)).sort(it).join("&")}static makeCanonicalHeadersString(e){return e.keys().map((t=>{return r=t,n=e.get(t),`${r.toLowerCase()}:${n.trim().replace(/\s+/g," ")}\n`;var r,n})).sort(it).join("")}static makeSignedHeaderNamesString(e){return e.keys().map((e=>e.toLowerCase())).sort(it).join(";")}static makeCanonicalBody(e){return e?JSON.stringify(e):""}}const ut="DL1-HMAC-SHA256";class lt{constructor(e,t){this.hmacSigner=e,this.secureHasher=t}async signRequest(e,t,r){const n=await ot(this.secureHasher,e),o=[ut,t,n].join("\n"),a=this.getFinalSecretKey(r),i=(0,tt.u)(a),s=nt(o),c=await this.hmacSigner.sign(i,s);return(0,rt.k)(c)}getFinalSecretKey(e){const{appSecretKey:t}=e;switch(e.type){case We.d.APP:return t;case We.d.USER_DEVICE:{const{deviceSecretKey:r}=e;return`${t}\n${r}`}case We.d.SESSION:{const{sessionSecretKey:r}=e;return`${t}\n${r}`}case We.d.TEAM_DEVICE:{const{teamDeviceSecretKey:r}=e;return`${t}\n${r}`}case We.d.EXTERNAL:{const{tokenSecretKey:r}=e;return`${t}\n${r}`}case We.d.BACK_OFFICE:return t;default:(0,Ze.U)(e)}}}class dt{constructor(e,t,r){this.signatureService=new lt(t,e),this.canonicalizationService=new ct(e),this.clockDriftService=r}async prepareRequestForAuthorization(e,t){if(t.type===We.d.CUSTOM)throw new Error("Unexpected credentials type provided to standard auth method");const r=this.addHostHeader(e),{canonicalRequest:n,signedHeaderNames:o}=await this.canonicalizationService.canonicalizeRequest(r),a=await this.clockDriftService.getDriftCorrectedTimestamp(),i=await this.signatureService.signRequest(n,a,t),s=this.buildAuthorizationHeader(t,a,o,i);return this.addAuthorizationHeader(e,s)}addHostHeader(e){const t=(0,Je.extractFullDomain)(e.url),r=e.headers.append("host",t);return e.clone({headers:r})}addAuthorizationHeader(e,t){const r=e.headers.append("authorization",t);return e.clone({headers:r})}buildAuthorizationHeader(e,t,r,n){const{appAccessKey:o}=e;switch(e.type){case We.d.APP:return ut+" "+[`AppAccessKey=${o}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${n}`].join(",");case We.d.USER_DEVICE:{const{login:a,deviceAccessKey:i}=e;return ut+" "+[`Login=${a}`,`AppAccessKey=${o}`,`DeviceAccessKey=${i}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${n}`].join(",")}case We.d.SESSION:{const{deviceAccessKey:a,login:i,sessionAccessKey:s}=e;return ut+" "+[`Login=${i}`,`AppAccessKey=${o}`,`SessionAccessKey=${s}`,`DeviceAccessKey=${a}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${n}`].join(",")}case We.d.TEAM_DEVICE:{const{teamDeviceAccessKey:a,teamUuid:i}=e;return ut+" "+[`TeamUuid=${i}`,`AppAccessKey=${o}`,`DeviceAccessKey=${a}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${n}`].join(",")}case We.d.BACK_OFFICE:return ut+" "+["Backoffice",`AppAccessKey=${o}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${n}`].join(",");case We.d.EXTERNAL:{const{tokenAccessKey:a}=e;return ut+" "+[`AppAccessKey=${o}`,`TokenAccessKey=${a}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${n}`].join(",")}default:(0,Ze.U)(e)}}}class pt{constructor(e){this.descriptor=e}decode(e){return e}}class ft{constructor(e){this.descriptor=e}decode(e){return e}}class ht{constructor(e,t,r,n,o,a){this.initHttpRequest=e=>{const{method:t,path:r,version:n}=this.descriptor,{baseUrl:o,platformInfo:a}=this.config,i=`${o.endsWith("/")?o:`${o}/`}${n}/${r}`,s=new C.WM({accept:this.descriptor.requestAcceptHeader??"application/json","content-type":"application/json; charset=UTF-8","dashlane-client-agent":JSON.stringify({platform:a.platformName,version:a.version,osversion:a.osversion,language:a.language})});return new C.aW(t,i,e,{headers:s})},this.prepareRequestForAuthorization=e=>async t=>{if(this.descriptor.authType===We.d.NONE)return t;let r;if(this.descriptor.authType===We.d.CUSTOM){r=new(this.getCustomAuthPreparationClass())}else r=this.standardAuthPreparationService;const n=this.getSigningCredentials(this.descriptor.authType,e);return await r.prepareRequestForAuthorization(t,n)},this.sendHttpRequest=e=>this.httpClient.request(e),this.handleSuccess=async e=>{if("arraybuffer"===this.descriptor.responseType)return(0,c.Vp)(await e.arrayBuffer());if("text"===this.descriptor.responseType)return(0,c.Vp)(await e.text());const t=await e.json(this.successBodyDecoder);return(0,c.Vp)(t)},this.handleFailure=async e=>await(0,Ke.EQ)(e,{BadStatus:this.handleBadStatus,FetchFailedError:e=>Promise.resolve((0,c.Rn)(e))}),this.handleBadStatus=async e=>{const{response:t}=e;if(t.status===C.WE.BadRequest){const{errors:[e],requestId:r}=await t.json(this.failureBodyDecoder);if("business_error"===e.type){const{code:t,message:n}=e;return(0,c.Rn)(new Qe(t,r,n))}if("invalid_request_error"===e.type&&"out_of_bounds_timestamp"===e.code)throw new Xe(r)}throw e},this.notifyWhenClockDriftErrorCompensated=e=>{if(!(e instanceof Xe))throw e;return this.clockDriftService.refresh().pipe((0,Ve.K)((()=>{throw e})))},this.httpClient=e,this.standardAuthPreparationService=new dt(t,r,n),this.clockDriftService=n,this.config=o,this.descriptor=a,this.successBodyDecoder=new pt(a),this.failureBodyDecoder=new ft(a)}executeRequest(e){const{body:t=null,credentials:r}=e;return(0,Ge.of)(this.initHttpRequest(t)).pipe((0,qe.b)(this.prepareRequestForAuthorization(r)),(0,qe.b)(this.sendHttpRequest),(0,De.RW)({success:this.handleSuccess,failure:this.handleFailure}),(0,Be.U)(this.assertReturnType),(0,He.X)({count:1,delay:this.notifyWhenClockDriftErrorCompensated}))}getCustomAuthPreparationClass(){throw new Error("Unsupported custom authorization level")}getSigningCredentials(e,t){if(e===We.d.APP||e===We.d.BACK_OFFICE){if(t)throw new Error("Superfluous credentials provided");return{type:e,...this.config.appKeys}}if(e===We.d.SESSION){if(!t||!function(e){return"object"==typeof e&&"login"in e&&"string"==typeof e.login&&"deviceAccessKey"in e&&"string"==typeof e.deviceAccessKey&&"sessionAccessKey"in e&&"string"==typeof e.sessionAccessKey&&"sessionSecretKey"in e&&"string"==typeof e.sessionSecretKey}(t))throw new Error("Invalid session credentials provided");return{type:e,...this.config.appKeys,...t}}if(e===We.d.TEAM_DEVICE){if(!t||!function(e){return"object"==typeof e&&"teamUuid"in e&&"string"==typeof e.teamUuid&&"teamDeviceAccessKey"in e&&"string"==typeof e.teamDeviceAccessKey&&"teamDeviceSecretKey"in e&&"string"==typeof e.teamDeviceSecretKey}(t))throw new Error("Invalid team device credentials provided");return{type:e,...this.config.appKeys,...t}}if(e===We.d.USER_DEVICE){if(!t||!function(e){return"object"==typeof e&&"login"in e&&"string"==typeof e.login&&"deviceAccessKey"in e&&"string"==typeof e.deviceAccessKey&&"deviceSecretKey"in e&&"string"==typeof e.deviceSecretKey}(t))throw new Error("Invalid user device credentials provided");return{type:e,...this.config.appKeys,...t}}if(e===We.d.EXTERNAL){if(!t||!function(e){return"object"==typeof e&&"tokenAccessKey"in e&&"string"==typeof e.tokenAccessKey&&"tokenSecretKey"in e&&"string"==typeof e.tokenSecretKey}(t))throw new Error("Invalid external credentials provided");return{type:e,...this.config.appKeys,...t}}return{type:e,...t??{},...this.config.appKeys}}assertReturnType(e){return e}}class yt{constructor(e,t,r,n,o){this.httpClient=e,this.clockDriftService=n,this.secureHasher=t,this.hmacSigner=r,this.config=o}createExecutor(e){return new ht(this.httpClient,this.secureHasher,this.hmacSigner,this.clockDriftService,this.config,e)}}class mt{constructor(e,t){this.timeSyncStore=e,this.serverClockService=t}async getDriftCorrectedTimestamp(){const e=await this.timeSyncStore.getServerToClientClockDrift()??0;return Math.round(this.getUnixTimestamp()-e)}refresh(){return this.serverClockService.getServerTime().pipe((0,Be.U)(this.mapServerTimestampToClockDrift.bind(this)),(0,qe.b)(this.storeUpdatedClockDrift.bind(this)))}mapServerTimestampToClockDrift(e){const{timestamp:t}=e;return this.getUnixTimestamp()-t}async storeUpdatedClockDrift(e){await this.timeSyncStore.storeServerToClientClockDrift(e)}getUnixTimestamp(){return Math.round(Date.now()/1e3)}}var gt=r(73873);class vt{getServerTime(){if(!this.executorFactory)throw new Error("No request executor factory");return new gt.q(this.executorFactory).getRemoteTime({}).pipe((0,De.nb)({success:e=>({timestamp:e.data.timestamp}),failure:e=>{throw e}}))}setExecutorFactory(e){this.executorFactory=e}}var bt=r(10350);class wt{constructor(e){this.store=e}async getServerToClientClockDrift(){const{drift:e}=await this.store.getState();return e}storeServerToClientClockDrift(e){return this.store.update((()=>({drift:e})))}}class Rt{constructor(e){this.baseUrl=e.baseUrl,this.appKeys=e.appKeys}}class St{}const Et={drift:null},Ot=e=>!(!e||"object"!=typeof e||!(0,Ue.l$)(e,"drift"))&&(!e.drift||"number"==typeof e.drift);class Ct extends((0,s.defineStore)({storeTypeGuard:Ot,storeName:"ClockSyncStore",scope:n.UseCaseScope.Device,initialValue:Et,isCache:!1,persist:!1,capacity:s.StoreCapacity._001KB})){}const Pt={v1:{accountrecovery:bt.uF,authentication:bt.Vy,darkwebmonitoring:bt.Dw,features:bt.AN,file:bt.$B,payments:bt.H4,pwleak:bt.JM,sharingUserdevice:bt.bo,teams:bt.pd,time:bt.qp,useractivity:bt.Vk}};var At=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},jt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let _t=class{constructor(e,t,r,n,o,a){this.serverApiConfig=e,this.httpClient=t,this.store=r,this.hmacSigner=n,this.secureHasher=o,this.platformInfoService=a}async init(){const{serverApiConfig:e,secureHasher:t,httpClient:r,hmacSigner:n,store:o}=this,a=new wt(o),i=await this.platformInfoService.getPlatformInfo(),{appKeys:s,baseUrl:c}=e;this.rawSdk=function(e){const{apis:t,config:r,secureHasher:n,httpClient:o,hmacSigner:a,timeSyncStore:i}=e,s=new vt,c=new mt(i,s),u=new yt(o,n,a,c,r);s.setExecutorFactory(u);const l=Object.keys(t.v1);return{refreshClockDrift:c.refresh,v1:l.reduce(((e,r)=>{const n=t.v1[r];return e[r]=new n(u),e}),{})}}({secureHasher:t,httpClient:r,timeSyncStore:a,hmacSigner:n,apis:Pt,config:{appKeys:s,baseUrl:c,platformInfo:{platformName:i.platformName,version:i.appVersion,osversion:i.osVersion,language:i.lang}}})}get sdk(){if(!this.rawSdk)throw new Error("ConfiguredServerSdk not initialized");return this.rawSdk}};_t=At([(0,s.Injectable)(),jt("design:paramtypes",[Rt,s.HttpClient,Ct,N,we,ke])],_t);var Tt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},It=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let xt=class{constructor(e,t){this.cqrsClient=e,this.infra=t}getActiveUserDeviceCredentials(){const{queries:{activeUser:e}}=this.cqrsClient.getClient(n.requestContextApi);return e().pipe((0,Be.U)((e=>{if((0,c.d6)(e))return(0,c.db)(e);throw new Error("Failed to get active user")})),(0,qe.b)((({userName:e})=>{if(!e)throw new Error("No active user available");return this.infra.getDeviceCredentialsForUser(e)})))}};xt=Tt([(0,s.Injectable)(),It("design:paramtypes",[s.CqrsClient,St])],xt);var Dt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ut=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Mt=class{constructor(e,t){this.appliedV1Services=this.buildInjectedServices("v1",e.sdk),this.credentialsService=t}get v1(){return this.appliedV1Services}buildInjectedServices(e,t){return Object.keys(t[e]).reduce(((r,n)=>({...r,[n]:this.buildInjectedApiServices(e,t,n)})),{})}buildInjectedApiServices(e,t,r){return Object.getOwnPropertyNames(Object.getPrototypeOf(t.v1[r])).filter((e=>"constructor"!==e)).reduce(((n,o)=>({...n,[o]:this.buildInjectedRouteService(t,e,r,o)})),{})}buildInjectedRouteService(e,t,r,n){const o=bt.tA[r][n];if(!o)throw new Error("Unable to find endpoint descriptor");const{authType:a}=o;return(...o)=>{const i=e[t][r],s=i[n].bind(i);if(a===We.d.USER_DEVICE)return this.credentialsService.getActiveUserDeviceCredentials().pipe((0,qe.b)((e=>s(e,...o))));if([We.d.NONE,We.d.APP].includes(a))return s(...o);throw new Error("Not supported")}}};Mt=Dt([(0,s.Injectable)(),Ut("design:paramtypes",[_t,xt])],Mt);var Nt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},kt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Lt=class{constructor(e){this.configuredServerSdk=e}get v1(){return this.configuredServerSdk.sdk.v1}};Lt=Nt([(0,s.Injectable)(),kt("design:paramtypes",[_t])],Lt);var Ft=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let qt=class{};qt=Ft([(0,s.Module)({providers:[Lt,Mt,xt,{token:_t,asyncFactory:async(e,t,r,n,o,a)=>{const i=new _t(e,t,r,n,o,a);return await i.init(),i},inject:[Rt,s.HttpClient,Ct,N,we,ke]}],exports:[Lt,Mt],configurations:{serverApi:{token:Rt},serverApiInfrastructure:{token:St}},stores:[Ct],sharedModuleName:"webServices",imports:[je,s.HttpModule,Fe]})],qt);var Vt=r(20195),Gt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ht=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Bt=class extends s.FeatureFlipsServiceAbstract{constructor(e){super(),this.serverApiClient=e}getFeatureFlipsForActiveUser(e){return(0,xe.z)(this.serverApiClient.v1.features.getAndEvaluateForUser({features:e}).pipe((0,De.nb)({success:t=>{const r=new Set(t.data.enabledFeatures);return e.reduce(((e,t)=>({...e,[t]:r.has(t)})),{})},failure:Vt.j})))}cleanOutDeletedFeatureFlips(e){return(0,xe.z)(this.serverApiClient.v1.features.listAvailableFeatureFlips({}).pipe((0,De.nb)({success:t=>{const r=Object.fromEntries(t.data.features.map((e=>[e.name,e.archived])));return Array.from(e.reduce(((e,t)=>(t in r&&e.add(t),e)),new Set))},failure:()=>e})))}};Bt=Gt([(0,s.Injectable)(),Ht("design:paramtypes",[Mt])],Bt);var Kt=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Wt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let zt=class{constructor(e,t,r,o){this.getCachedFeatureFlipsList=async()=>{const e=await(0,xe.z)(this.requestContextApi.queries.getCachedFeatureFlipsList());return(0,c.d6)(e)?e.data.cachedFeatureFlips:[]},this.featureFlipsService=e,this.requestContextApi=t.getClient(n.requestContextApi),this.requestContext=r,this.allowedToFail=o}async handle(e){await this.allowedToFail.doOne((()=>this.unsafeHandle(e)))}async unsafeHandle({body:e}){if(!e.userName)return await this.requestContextApi.commands.setFeatureFlipsInStore({featureFlips:{}}),Promise.resolve();const t=this.requestContext.requiredFeatureFlips??[],r=await this.getCachedFeatureFlipsList(),n=await this.featureFlipsService.cleanOutDeletedFeatureFlips([...t,...r]),o={...await this.featureFlipsService.getFeatureFlipsForActiveUser(n)};return await this.requestContextApi.commands.setFeatureFlipsInStore({featureFlips:o}),Promise.resolve()}};zt=Kt([(0,s.EventHandler)(n.ActiveUserChangedEvent),Wt("design:paramtypes",[Bt,s.ContextLessCqrsClient,s.RequestContext,s.AllowedToFail])],zt);var $t=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Qt=class{};Qt=$t([(0,s.Module)({api:n.featureFlipsApi,providers:[Bt],imports:[qt],exports:[Bt],handlers:{commands:{},queries:{},events:{...(0,s.useEventsOfModule)(n.requestContextApi,{activeUserChanged:zt})}}})],Qt);var Yt=r(25859),Xt=r(6220),Jt=r(30523),Zt=r(7537),er=r(58376),tr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},rr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let nr=class{constructor(){this.filesToCheck={},this.publishSubscriber=new Zt.t,this.updatedFileStream$=new er.y((e=>{this.publishSubscriber.next(e),this.publishSubscriber.complete()}))}publish(e){(0,xe.z)(this.publishSubscriber).then((t=>t.next(e)))}fileSubscription(e){return this.filesToCheck={...this.filesToCheck,...e},this.updatedFileStream$}getFilesToCheck(){return this.filesToCheck}};nr=tr([(0,s.Injectable)(),rr("design:paramtypes",[])],nr);class or{constructor(e,t,r,n){this.settings=e,this.store=t,this.appLogger=r,this.rfuDispatcher=n;const{fileName:o}=e;this.jsonSerializerCodec=new C.bL,this.newlyUpdatedFiles$=(0,Yt.P)((async()=>{const e=await this.store.getState();return{[o]:e.revision}})).pipe((0,Xt.z)((e=>this.rfuDispatcher.fileSubscription(e))))}initFileObservation(){this.newlyUpdatedFiles$.subscribe(this._handleRFUDownload.bind(this))}streamFileUpdate(){return this.store.state$.pipe((0,Be.U)((e=>e.data)),(0,Jt.h)((e=>this.settings.typeguard(e))))}async _handleRFUDownload(e){const{fileName:t}=this.settings;if(!(t in e))return;const r=e[t],n=this.jsonSerializerCodec.decode(r.buffer);this.settings.typeguard(n)&&(await this.store.set({filename:r.fileName,data:n,revision:r.revision,lastDownloadTimestamp:r.lastDownloadTimestamp}),this.rfuDispatcher.fileSubscription({[t]:r.revision}))}}var ar=r(11494);class ir{}class sr{}class cr{}const ur="update_available",lr=new Set([ur,"not_updated","not_found","error_server"]);var dr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},pr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const fr=e=>e[1].status===ur;let hr=class extends ir{constructor(e,t){super(),this.httpClient=e,this.serverApiClient=t}async downloadRemoteFileUpdate(e){const t=await this._getFileMeta(e);return(0,c.hx)(t)?[(0,Ge.of)(t)]:this._retrieveFilesFromServer((0,c.db)(t))}_getFileMeta(e){return(0,xe.z)(this.serverApiClient.v1.file.getFileMeta(e).pipe((0,Be.U)((e=>{if((0,c.hx)(e))return(0,c.Rn)(ar.RemoteFileUpdateError.ServerError);const t=(0,c.db)(e);return r=t.data,Object.values(r).every((e=>"object"==typeof e&&void 0!==e.status&&lr.has(e.status)))?(0,c.Vp)(t.data):(0,c.Rn)(ar.RemoteFileUpdateError.ServerError);var r}))))}_retrieveFilesFromServer(e){return Object.entries(e).filter(fr).map((([e,t])=>this._getBufferFromURL(e,t)))}_getBufferFromURL(e,t){return this.httpClient.get(t.url,{observe:"body",responseType:"arraybuffer"}).pipe((0,Be.U)((r=>(0,c.d6)(r)?(0,c.Vp)({fileName:e,buffer:(0,c.db)(r),updatedFile:t}):(0,c.Rn)(ar.RemoteFileUpdateError.DownloadError))))}};hr=dr([(0,s.Injectable)(),pr("design:paramtypes",[s.HttpClient,Mt])],hr);var yr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},mr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const gr="coreAnalysis_web_rfuInGraphene_prod";let vr=class{constructor(e,t,r,n){this.appLogger=e,this.cqrsClient=t,this.remoteFileUpdateService=r,this.dispatcherService=n}async run(){const{userFeatureFlips:e}=this.cqrsClient.getClient(n.requestContextApi).queries,t=await(0,xe.z)(e({requiredFeatureFlips:[gr]}));if((0,c.hx)(t))return;if(!t.data[gr])return;const r=this.dispatcherService.getFilesToCheck();this.remoteFileUpdateService.observeRemoteFileUpdates(r).subscribe((e=>{this.dispatcherService.publish(e)})),this.remoteFileUpdateService.downloadAndDecipherRemoteFiles()}};vr=yr([(0,s.Injectable)(),mr("design:paramtypes",[s.AppLogger,s.CqrsClient,cr,nr])],vr);var br=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},wr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Rr=class extends sr{constructor(e,t){super(),this.cqrsClient=e,this.appLogger=t}async decipher(e,t){const{carbon:r}=this.cqrsClient.getClient(u.carbonLegacyApi).commands,n=await r({name:"decipherRemoteFile",args:[{cipheredFileContent:e,fileMetaData:t}]});if((0,c.hx)(n))return(0,c.Rn)(ar.RemoteFileUpdateError.DecipherError);const{carbonResult:o}=(0,c.db)(n);return(e=>"object"==typeof e&&null!==e&&Object.entries(e).some((([e,t])=>"decipheredFile"===e&&t instanceof ArrayBuffer)))(o)?(0,c.Vp)(o.decipheredFile):(0,c.Rn)(ar.RemoteFileUpdateError.DecipherError)}};Rr=br([(0,s.Injectable)(),wr("design:paramtypes",[s.CqrsClient,s.AppLogger])],Rr);var Sr=r(91501),Er=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Or=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Cr=class extends cr{constructor(e,t,r,n){super(),this.appLogger=e,this.rfuDownloaderService=t,this.rfuDecipheringService=r,this.cqrsClient=n,this._filesToCheck={},this._emitDownloadedFilesUpdate$=new Zt.t,this._downloadedFileStream$=new er.y((e=>{this._emitDownloadedFilesUpdate$.next((t=>{e.next(t)})),this._emitDownloadedFilesUpdate$.complete()}))}observeRemoteFileUpdates(e){return this._filesToCheck={...this._filesToCheck,...e},this._downloadedFileStream$}async downloadAndDecipherRemoteFiles(){const e=(await this.rfuDownloaderService.downloadRemoteFileUpdate(this._filesToCheck)).map((e=>this._downloadAndDecipherSingleFile(e)));(0,Sr.D)(e).subscribe((e=>{const t=e.reduce(((e,t)=>{if((0,c.hx)(t))return this.sendRFUEvents(ar.FlowStep.Error,(0,c.Yv)(t)),e;const r=(0,c.db)(t);return this.sendRFUEvents(ar.FlowStep.Complete),{...e,[r.fileName]:r}}),{});this._callEmitDownloadedFilesUpdate(t)}))}async _applyDecipheringStep(e){const t=e.updatedFile.key?await this.rfuDecipheringService.decipher(e.buffer,e.updatedFile):(0,c.Vp)(e.buffer);return(0,c.d6)(t)?(0,c.Vp)({...e,buffer:(0,c.db)(t)}):t}_downloadAndDecipherSingleFile(e){return e.pipe((0,Xt.z)((e=>(0,c.d6)(e)?this._applyDecipheringStep((0,c.db)(e)):Promise.resolve(e))),(0,Be.U)((e=>{if((0,c.hx)(e))return e;const{fileName:t,updatedFile:r,buffer:n}=(0,c.db)(e);return(0,c.Vp)({fileName:t,revision:r.revision,buffer:n,lastDownloadTimestamp:Date.now()})})))}_callEmitDownloadedFilesUpdate(e){return(0,xe.z)(this._emitDownloadedFilesUpdate$).then((t=>{t(e)}))}sendRFUEvents(e,t=undefined){const{trackEvent:r}=this.cqrsClient.getClient(i).commands;r({event:new ar.UserReceiveRemoteFileUpdateEvent({flowStep:e,remoteFileUpdateError:t,packageSource:ar.PackageSource.Graphene})})}};Cr=Er([(0,s.Injectable)(),Or("design:paramtypes",[s.AppLogger,hr,Rr,s.CqrsClient])],Cr);var Pr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Ar=class{};Ar=Pr([(0,s.Module)({sharedModuleName:"RemoteFileUpdateModule",configurations:{remoteFileUpdateInfrastructure:{token:cr},remoteFileUpdateDownloaderInfrastructure:{token:ir},decipherInfrastructure:{token:sr}},crons:[{handler:vr,periodInMinutes:30,name:"cron",scope:n.UseCaseScope.User}],providers:[Cr,Rr,hr,nr],imports:[Qt,s.HttpModule,qt,v],exports:[Cr,Rr,hr,nr],requiredFeatureFlips:["coreAnalysis_web_rfuInGraphene_prod"]})],Ar);const jr=e=>!("object"!=typeof e||null===e)&&("filename"in e&&null!==e.filename&&void 0!==e.filename&&"string"==typeof e.filename&&"revision"in e&&null!==e.revision&&void 0!==e.revision&&"number"==typeof e.revision),_r=e=>({filename:e,revision:1,data:{},lastDownloadTimestamp:Date.now()});var Tr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Ir=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let xr=class{constructor(e){this.rfuClient=e}onFrameworkInit(){this.rfuClient.initFileObservation()}};xr=Tr([(0,s.FrameworkInit)(),Ir("design:paramtypes",[or])],xr);const Dr=(e,t)=>{const r=(e=>class extends((0,s.defineStore)({storeName:"RFUStore",persist:!0,storage:{schemaVersion:1,initialValue:_r(e),typeGuard:jr},codec:C.Eu,storeTypeGuard:jr,capacity:s.StoreCapacity._010KB,scope:n.UseCaseScope.Device,isCache:!0})){})(e);var o;return{providers:[{token:or,asyncFactory:(e,t,r)=>Promise.resolve(new or(o,e,t,r)),inject:[(o={fileName:e,storeClass:r,typeguard:t}).storeClass,s.AppLogger,nr]}],onFrameworkInit:[xr],imports:[Ar],stores:[r]}};var Ur,Mr=r(24966),Nr=r(6136);class kr{}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WARNING=1]="WARNING",e[e.ERROR=2]="ERROR"}(Ur||(Ur={}));const Lr=(e,t)=>({action:"logOnline",code:Ur.ERROR,type:e.platformName,version:e.appVersion,additionalInfo:JSON.stringify({manifestVersion:e.manifestVersion}),browser:e.browser,browserVersion:e.browserVersion,exceptiontype:t.domainName??"grapheneException",message:t.message,os:e.os,osVersion:e.osVersion,sessionId:t.sessionId,stack:t.callStack,initialUseCaseModule:t.moduleName,initialUseCaseName:t.useCaseName,errorCount:1});function Fr(e,t){return new C.LE("string"==typeof(r=Lr(e,t))?r:Object.keys(r).reduce(((e,t)=>{const n=r[t];return void 0===n||(e[t]="string"==typeof n?n:JSON.stringify(n)),e}),{}));var r}var qr=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},Vr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const Gr={"Content-Type":"application/x-www-form-urlencoded"},Hr=".graphene.exceptionLogs",Br=new C.bL,Kr=new C.dC((e=>!(!e||"object"!=typeof e)&&(0===Object.keys(e).length||Object.keys(e).every((e=>"string"==typeof e))&&Object.values(e).every((e=>{return!!((t=e)&&"object"==typeof t&&"entry"in t&&"id"in t&&"date"in t)&&"string"==typeof t.id&&"number"==typeof t.date&&(0,s.isExceptionLogEntry)(t.entry);var t}))))),Wr=new C.z;let zr=class{constructor(e,t,r,n,o){this.httpClient=e,this.kvStore=t,this.logger=r,this.settings=n,this.platformInfoService=o,this.queue$=new Mr.X({}),this.logExceptionsCount={},this.platformInfo=null,this.url=`${this.settings.serverEndpoint??"https://kck3hlb9.dashlane.com"}/1/softwarelog/create`,this.codec=(0,C.xw)(Wr,Br,Kr)}async logException(e){const t=this.settings.maxExceptionCountPerSession??10,r=e.message.length?e.message:"UNKNOWN_EXCEPTION";if(r in this.logExceptionsCount){const e=this.logExceptionsCount[r];if(e===t)return Promise.resolve();this.logExceptionsCount[r]=e+1}else this.logExceptionsCount[r]=1;const n=await this.enqueue(e);await(0,xe.z)(this.queue$.pipe((0,Jt.h)((e=>!(n in e)||!!e[n].error))))}async start(){this.platformInfo=await this.platformInfoService.getPlatformInfo(),await this.loadQueue();const e=this.settings.retryDelay??6e4,t=this.queue$.pipe((0,Be.U)((e=>Object.keys(e))),(0,Nr.x)(((e,t)=>t.every((t=>e.includes(t))))),(0,qe.b)((()=>this.processQueue())),(0,He.X)({delay:e})).subscribe();return{stop:async()=>{t.unsubscribe(),await this.saveQueue()}}}async ignoreError(e){try{return await e(),!0}catch(e){return this.logger.error("failed to send error log",e),!1}}async saveQueue(){await this.ignoreError((async()=>{const e=await this.codec.encode(this.queue$.value);await this.kvStore.set(Hr,e)}))}async loadQueue(){await this.ignoreError((async()=>{const e=await this.kvStore.get(Hr);if(!e||""===e)return void this.queue$.next({});const t=await this.codec.decode(e),r=Date.now()-(this.settings.durationInQueue??864e5);for(const e of Object.keys(t))t[e].date<r&&delete t[e];this.queue$.next(t)}))}async enqueue(e){const t={date:Date.now(),entry:e,id:`${Date.now()}-${Math.random()}`};return this.queue$.value[t.id]=t,await this.saveQueue(),this.queue$.next(this.queue$.value),t.id}async processQueue(){const e=this.platformInfo;if(!e)throw new Error("No platform info");for(;Object.keys(this.queue$.value).length>0;){const t=Object.keys(this.queue$.value)[0],r=this.queue$.value[t];if(!await this.ignoreError((async()=>{const t=await(0,xe.z)(this.httpClient.post(this.url,Fr(e,r.entry),{headers:{...Gr,"Client-Agent":(n=e,`version:${n.appVersion},platform:${n.platformName}}`)},observe:"response"}));var n;if(!(0,c.d6)(t))throw new Error("Failed to send log")})))throw this.queue$.value[t].error=!0,this.queue$.next(this.queue$.value),new Error("failed to send an item from the queue");delete this.queue$.value[t],await this.saveQueue()}this.queue$.next(this.queue$.value)}};zr=qr([(0,s.Injectable)(),Vr("design:paramtypes",[s.HttpClient,s.KeyValueStorageInfrastructure,s.AppLogger,kr,ke])],zr);var $r=function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};let Qr=class{};Qr=$r([(0,s.Module)({sharedModuleName:"software-exception-sink",imports:[s.HttpModule,Fe],providers:[zr],exports:[zr],configurations:{settings:{token:kr}}})],Qr)},10370:(e,t,r)=>{"use strict";r.d(t,{s:()=>a});var n=r(46041);function o(e){const t=e.length,r=[];for(let o=0;o<t;o+=3)r.push(n.U[e[o]>>2]),r.push(n.U[(3&e[o])<<4|e[o+1]>>4]),r.push(n.U[(15&e[o+1])<<2|e[o+2]>>6]),r.push(n.U[63&e[o+2]]);return r.join("")}function a(e,t=n.V){const r=new Uint8Array(e),a=r.length,i=t%3,s=0===i?t:t+(3-i),c=Math.ceil(a/s);let u="",l=-1;for(;l++<c;){const e=l*s,t=l===c-1?a:(l+1)*s,n=o(r.slice(e,t));u=u.concat(n)}return a%3==2?u.substring(0,u.length-1)+"=":a%3==1?u.substring(0,u.length-2)+"==":u}},89685:(e,t,r)=>{"use strict";r.d(t,{b:()=>o,v:()=>a});const n=Math.pow(2,14)-1;function o(e){const t=new Uint16Array(e),r=t.length;let o="",a=n;for(let e=0;e<r;e+=a){e+a>r&&(a=r-e);const n=t.subarray(e,e+a);o+=String.fromCharCode(...n)}return o}function a(e){return o(new Uint8Array(e))}},7502:(e,t,r)=>{"use strict";r.d(t,{R:()=>a});var n=r(46041);const o=new Uint8Array(256);for(let e=0;e<n.U.length;e++)o[n.U.charCodeAt(e)]=e;function a(e){let t=.75*e.length;const r=e.length;let n,a,i,s,c,u=0;e.endsWith("=")&&(t--,"="===e[e.length-2]&&t--);const l=new ArrayBuffer(t),d=new Uint8Array(l);for(n=0;n<r;n+=4)a=o[e.charCodeAt(n)],i=o[e.charCodeAt(n+1)],s=o[e.charCodeAt(n+2)],c=o[e.charCodeAt(n+3)],d[u++]=a<<2|i>>4,d[u++]=(15&i)<<4|s>>2,d[u++]=(3&s)<<6|63&c;return l}},96303:(e,t,r)=>{"use strict";function n(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}r.d(t,{k:()=>n})},46041:(e,t,r)=>{"use strict";r.d(t,{U:()=>o,V:()=>n});const n=Math.pow(10,6),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"},54066:(e,t,r)=>{"use strict";function n(e){const t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;++t)r[t]=e.charCodeAt(t);return t}r.d(t,{u:()=>n})},43293:(e,t,r)=>{"use strict";r.d(t,{N:()=>a});var n=r(30543);const o=Math.pow(10,6);function a(e,t=o){const r=e.length;if(0===r)return"";let a="",i=0,s=Math.min(i+t,r);for(;s<=r;){const o=e.charCodeAt(s-1);if(o>=55296&&o<=56319){if(s++,s>r)throw new Error("Invalid string provided to utf8ChunkEncode");continue}const c=e.slice(i,s),u=n.encode(c);if(a=a.concat(u),s===r)break;i=s,s=Math.min(i+t,r)}return a}},82991:(e,t,r)=>{"use strict";r.r(t),r.d(t,{BrowserCronSource:()=>nt,BrowserPortConnector:()=>wt,BrowserPortListener:()=>gt,BrowserPortListenerChannel:()=>Et,ExtensionCronSource:()=>lt,ExtensionLocalStorageInfrastructure:()=>et,HttpFetchBackend:()=>K,IndexDbKeyValueStorage:()=>rt,IndexDbStorage:()=>tt,JsonExtensionResourceFetcher:()=>i,JsonWebAppResourceFetcher:()=>o,PageToWorkerChannel:()=>ft,computeHash:()=>p,cookieRemoveByDomain:()=>de,decryptAes256:()=>y,decryptAesEcb256:()=>g,decryptRsaOaep:()=>v,deriveKeyArgon2d:()=>R,deriveKeyPbkdf2:()=>S,disableBrowserNativeAutofill:()=>re,enablePrivacyService:()=>te,encryptAes256:()=>E,encryptRsaOaep:()=>O,generateKeyAes256:()=>C,generateKeyPairRsaOaep:()=>A,getLanguage:()=>Y,getRandomValues:()=>j,getShortcutValues:()=>Se,isMv3Environment:()=>dt,makeStoreInfrastructure:()=>Xe,signHmacSha:()=>T,signRsassaPkcs1:()=>I,storageLocalItemExists:()=>Ce,unsafeComputeMd5Hash:()=>U,updateToolbarIcon:()=>se,verifyHmacSha:()=>M,verifyRsassaPkcs1:()=>N,webappClose:()=>ke,webappOpen:()=>Me});var n=r(32839);class o extends n.JsonApplicationResourceFetcher{constructor(e){super(),this.publicPath=e}async fetch(e){return(await fetch(new URL(e.replace(/^\/*/,""),this.publicPath).href)).json()}}var a=r(92204);class i extends n.JsonApplicationResourceFetcher{async fetch(e){const t=(0,a.A)(e);return(await fetch(t)).json()}}var s=r(34064),c=r.n(s),u=r(96785);function l(e){const t=new Uint8Array(e),r=[];for(let e=0;e<t.byteLength;e++)r[e>>>2]|=t[e]<<24-e%4*8;return u.lib.WordArray.create(r,t.byteLength)}function d(e){const{sigBytes:t,words:r}=e,n=new Uint8Array(t);let o=0,a=0;for(;o!==t;){const e=r[a++];if(n[o++]=(4278190080&e)>>>24,o===t)break;if(n[o++]=(16711680&e)>>>16,o===t)break;if(n[o++]=(65280&e)>>>8,o===t)break;n[o++]=255&e}return n.buffer}function p(e,t){if(self.crypto.subtle)return self.crypto.subtle.digest({name:t},e);if("SHA-1"===t){const t=l(e),r=d(c()(t));return Promise.resolve(r)}return Promise.reject(new Error("Unsupported hash method"))}var f=r(44396);function h(e){return self.crypto.subtle.importKey("raw",e,f.zW,!1,["encrypt","decrypt"])}async function y(e,t,r){const n=await h(e);return self.crypto.subtle.decrypt({name:f.zW,iv:t},n,r)}var m=r(89685);function g(e,t){const r=(0,m.v)(t),n=l(e);return d(CryptoJS.AES.decrypt(r,n,{mode:CryptoJS.mode.ECB}))}async function v(e,t,r){const n={name:f.$k,hash:{name:r}},o=await self.crypto.subtle.importKey("pkcs8",e,n,!1,["decrypt"]);return self.crypto.subtle.decrypt(n,o,t)}var b=r(35558),w=r.n(b);async function R(e,t,r){const{tCost:n,mCost:o,parallelism:a}=r,{hash:i}=await w().hash({pass:new Uint8Array(e),salt:new Uint8Array(t),time:n,mem:o,hashLen:32,parallelism:a,type:b.ArgonType.Argon2d});return i.buffer}async function S(e,t,r){const n=await self.crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveKey"]),o={name:f.zW,length:256},{iterations:a,hashType:i}=r,s={name:"PBKDF2",salt:t,iterations:a,hash:{name:i}},c=await self.crypto.subtle.deriveKey(s,n,o,!0,["encrypt","decrypt"]);return self.crypto.subtle.exportKey("raw",c)}async function E(e,t,r){const n=await h(e);return self.crypto.subtle.encrypt({name:f.zW,iv:t},n,r)}async function O(e,t,r){const n={name:f.$k,hash:{name:r}},o=await self.crypto.subtle.importKey("spki",e,n,!1,["encrypt"]);return self.crypto.subtle.encrypt(n,o,t)}async function C(){const e=await self.crypto.subtle.generateKey({name:f.zW,length:f.N2},!0,["encrypt","decrypt"]);return self.crypto.subtle.exportKey("raw",e)}const P=new Uint8Array([1,0,1]);async function A(e){const t=await self.crypto.subtle.generateKey({name:f.$k,modulusLength:2048,publicExponent:P,hash:{name:e}},!0,["encrypt","decrypt"]),{privateKey:r,publicKey:n}=t;return{privateKey:await self.crypto.subtle.exportKey("pkcs8",r),publicKey:await self.crypto.subtle.exportKey("spki",n)}}function j(e){const t=new Uint8Array(e);return self.crypto.getRandomValues(t)}function _(e,t){return self.crypto.subtle.importKey("raw",e,{name:"HMAC",hash:{name:t}},!0,["sign","verify"])}async function T(e,t,r=f.x4){const n=await _(e,r);return self.crypto.subtle.sign({name:"HMAC",hash:{name:r}},n,t)}async function I(e,t,r){const n={name:f.xJ,hash:{name:r}},o=await self.crypto.subtle.importKey("pkcs8",e,n,!1,["sign"]);return self.crypto.subtle.sign(n,o,t)}var x=r(81968),D=r.n(x);function U(e){const t=l(e);return d(D()(t))}async function M(e,t,r,n=f.x4){const o=await _(e,n);return self.crypto.subtle.verify({name:"HMAC",hash:{name:n}},o,t,r)}async function N(e,t,r,n){const o={name:f.xJ,hash:{name:n}},a=await self.crypto.subtle.importKey("spki",e,o,!1,["verify"]);return self.crypto.subtle.verify(o,a,t,r)}var k=r(87065),L=r(93192),F=r(90171),q=r(47968),V=r(37182),G=r(69885),H=r(51992),B=r(87279);class K{constructor(){this.toHttpResult=e=>e instanceof f.a7?(0,B.Rn)(e):e.ok?(0,B.Vp)(e):(0,B.Rn)(new f.RV(e)),this.toHttpResponse=e=>e instanceof f.a7?e:new f.Zn({body:e.body,url:e.url,status:e.status,statusText:e.statusText,headers:this.mapToHttpHeaders(e.headers)})}handle(e){const t=this.getTimeout$(e.timeout),r=this.doFetch(e).pipe((0,k.U)(this.toHttpResponse),(0,k.U)(this.toHttpResult));return(0,L.S)(t,r)}getTimeout$(e){return e?(0,F.H)(e).pipe((0,k.U)((()=>(0,B.Rn)(new f.a7)))):q.C}doFetch(e){return(0,H.U)(e.url,{method:e.method,body:e.serializeBody(),headers:this.getHeaders(e),credentials:e.withCredentials?"include":"omit",mode:e.mode}).pipe((0,V.K)((e=>{if(!(e instanceof TypeError))throw e;return(0,G.of)(new f.a7)})))}mapToHttpHeaders(e){const t=new f.WM;return e.forEach(((e,r)=>t.set(r,e))),t}getHeaders(e){return e.headers.keys().reduce(((t,r)=>({...t,[r]:e.headers.get(r)})),{})}}const W=new Set(["en","fr","es","ja","de","pt","it","ko","zh","nl","sv"]),z="en";function $(e){return e.substr(0,2)}function Q(e){const t=$(e);return W.has(t)}function Y(){const e=[navigator.language].concat(navigator.languages).find(Q);if(!e)return z;if(!e.includes("-"))return e;return $(e)}var X=r(30754),J=r(82324),Z=r(81805);const ee=" ";async function te(e,t){try{const{levelOfControl:t}=await(0,X.U)(e);if("controllable_by_this_extension"!==t&&"controlled_by_this_extension"!==t){const r=[`Impossible to change browser setting: ${e}.`,`Extension prevented from changing: ${t}`].join(ee);throw new Error(r)}}catch(t){if((0,J.b)(t)){throw new Error(`Browser setting not supported: ${e}`)}if((0,J.I)(t))throw t.runtimeError;throw t}try{await(0,Z.t)(e,t)}catch(e){throw(0,J.I)(e)?e.runtimeError:e}}async function re(){const e=["autofillAddressEnabled","autofillCreditCardEnabled","passwordSavingEnabled"].map((e=>te(e,!1)));await Promise.all(e)}var ne=r(84318),oe=r(16241);const ae={nightly:"icon_nightly_auth",mv2:"icon_auth",mv3:"icon_mv3_auth"},ie="icon_not_auth";async function se({isUserAuthenticated:e}){const t=`icons/action/${e?function(){const e=(0,ne.W)();return e.name.includes("Nightly")?ae.nightly:e.name.includes("Beta")||3===e.manifest_version?ae.mv3:ae.mv2}():ie}`,r={16:`${t}.png`,32:`${t}@2x.png`};await(0,oe.B)(r)}var ce=r(329),ue=r(98641);function le(e){return`${"http"+(e.secure?"s":"")}://${e.domain.startsWith(".")?e.domain.substring(1):e.domain}${e.path}`}async function de(e){const t=await(0,ce.g)({domain:e});return Promise.all(t.map((e=>(0,ue.O)({url:le(e),name:e.name}))))}var pe=r(57323),fe=r(839);const he=/^_execute(_browser){0,1}_action$/,ye="+";var me;function ge(e){return he.test(e.name??"")}function ve(e){const t=e.toUpperCase();switch(t){case"⌃":case"CTRL":return pe.os.isMacOS()?me.Command:me.Ctrl;case"SHIFT":case"⇧":return me.Shift;case"COMMAND":case"⌘":return me.Command;case"MACCTRL":return me.MacCtrl;default:return t}}function be(e){const t=Object.values(me),r=t.indexOf(e);return-1===r?t.length:r}function we(e,t){return be(e)-be(t)}function Re(e){switch(e){case me.Ctrl:case me.MacCtrl:return"Ctrl";case me.Shift:return"⇧";case me.Command:return"⌘";default:return e}}async function Se(){const e=await new Promise(((e,t)=>{(0,fe.Ez)("commands.getAll")?chrome.commands.getAll((r=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",r=new Error(`commands/getAll: ${e}`);t(r)}else e(r)})):t(new Error("No commands.getAll support"))})),t=e.find(ge)?.shortcut;if(!t)return;const r=function(e){return e.split(e.includes(ye)?ye:"")}(t);return r.map(ve).sort(we).map(Re)}!function(e){e.Command="Command",e.Ctrl="Ctrl",e.MacCtrl="MacCtrl",e.Shift="Shift"}(me||(me={}));var Ee=r(39680),Oe=r(41808);async function Ce(e){if((0,Ee.G)()){return await(0,Ee.y)(e)>0}const t=await(0,Oe.U)(e),r=void 0===t[e],n=null===t[e];return!r&&!n}var Pe=r(24715),Ae=r(72733),je=r(57306),_e=r(31460),Te=r(61222);async function Ie(){const e=await(0,Te.I)({}),t=(0,a.A)("");return e.filter((e=>"string"==typeof e.url&&e.url.startsWith(t))).filter((e=>""!==e.url))}const xe="index.html";function De(){return`${(0,a.A)("")}${xe}`}function Ue({identifier:e,queryInfo:t,name:r}){const n=De();if(!r)return n;const o=e?`#${r}/${e}`:`#${r}`,a=t?`?${function(e){return Object.keys(e).map((t=>`${t}=${e[t]}`)).join("&")}(t)}`:"";return encodeURI(`${n}${o}${a}`)}async function Me({id:e,query:t,route:r}){const n=Ue({identifier:e,queryInfo:t,name:r}),o=await Ie();o.length?await async function({path:e,tabs:t}){const r=await(0,Ae.T)(),n=function({existingTabs:e,focusedWindow:t}){const r=e.filter((e=>e.active)),n=r.find((e=>e.windowId===t.id)),o=r.pop(),a=e.pop();return n??o??a}({existingTabs:t,focusedWindow:r});if(!n)return;if(n.windowId!==r.id&&(0,je.V)(n.windowId,{focused:!0}),!n.id)return;const o={active:!0,...e===De()?{}:{url:e}};await(0,_e.V)(n.id,o)}({path:n,tabs:o}):await async function(e){const t={url:e};await(0,Pe.U)(t)}(n)}var Ne=r(49259);async function ke(){const e=await Ie();if(!e.length)return;const t=chrome.tabs.TAB_ID_NONE,r=e.map((e=>e.id)).filter((e=>"number"==typeof e&&e!==t));await(0,Ne.O)(r)}var Le=r(32012),Fe=r(24966),qe=r(58376),Ve=r(85390),Ge=r(15023),He=r(28489);const Be={addListener:function(e){if(!(0,fe.qX)(["storage"]))throw new Error("No storage.session.onChanged.addListener support, permission is missing");if(!(0,fe.Ez)("storage.session.onChanged.addListener"))throw new Error("No storage.session.onChanged.addListener support");const t=t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`storage/session/onChanged: ${e}`)}return e(t)};return chrome.storage.session.onChanged.addListener(t),t},removeListener:function(e){if(!(0,fe.qX)(["storage"]))throw new Error("No storage.session.onChanged.removeListener support, permission is missing");if(!(0,fe.Ez)("storage.session.onChanged.removeListener"))throw new Error("No storage.session.onChanged.removeListener support");chrome.storage.session.onChanged.removeListener(e)}};var Ke=r(56847),We=r(52477),ze=r(15026);function $e(e){return JSON.parse(JSON.stringify(e))}class Qe{constructor(e,t){this.stopped$=new Fe.X(!1),this.key=e,this.typeGuard=t??(e=>!0);const r=new qe.y((t=>{this.get().then((e=>{t.next(e)}));const r=r=>{if(e in r){const{newValue:n}=r[e];return t.next(this.asDataWithTimestamp(n))}};return Be.addListener(r),()=>Be.removeListener(r)}));this.state$=(0,Ve.a)({state:r,isStopped:this.stopped$}).pipe((0,Ge.o)((({isStopped:e})=>!e),!1),(0,k.U)((({state:e})=>e)))}set(e){return(0,Ke.t)($e({[this.key]:e}))}init(e){return(0,Ke.t)($e({[this.key]:e}))}clear(){return(0,We.O)(this.key)}stop(){this.stopped$.next(!0)}async get(){const e=(await(0,ze.U)(this.key))[this.key];return this.asDataWithTimestamp(e)}asDataWithTimestamp(e){return e&&"object"==typeof e&&(0,He.l$)(e,"timestamp")&&"number"==typeof e.timestamp&&e.timestamp&&(0,He.l$)(e,"data")&&(0,n.isLazyState)(e.data)?e.data.loaded?this.typeGuard(e.data.value)?{timestamp:e.timestamp,data:{loaded:!0,value:e.data.value}}:{timestamp:void 0}:{timestamp:e.timestamp,data:{loaded:!1}}:{timestamp:void 0}}}class Ye extends n.StoreInfrastructureFactory{createUserScopedInfrastructure(e,t,r,n){return new Qe(`graphene.${e}.${t}.${r}`,n)}createDeviceScopedInfrastructure(e,t,r){return new Qe(`graphene.${e}.${t}`,r)}}function Xe(){return(0,Le.G)()?new Ye:new n.MemoryStoreInfrastructureFactory}var Je=r(9244),Ze=r(45441);class et{async getAllKeys(){return Object.keys(await(0,Oe.U)(null))}async get(e){const t=(await(0,Oe.U)([e]))[e];if(t){if("string"!=typeof t)throw new Error(`[ChromeLocalStorage] - cannot read content of ${e} properly. Type is\n        ${typeof t} but should be 'string'`);return t}}async set(e,t){await(0,Je.t)({[e]:t})}async remove(e){await(0,Ze.O)([e])}}class tt{constructor(e,t,r){this.DB_STORE_NAME=e,this.DB_VERSION=t,this.DB_OBJECT_STORE_NAME=r}getIndexedDB(){return new Promise(((e,t)=>{const r=self.indexedDB;if(!r)return t(new Error("indexedDB is not supported in this environment"));const n=r.open(this.DB_STORE_NAME,this.DB_VERSION);n.onerror=function(){t(n.error)},n.onupgradeneeded=()=>{n.result.objectStoreNames.contains(this.DB_OBJECT_STORE_NAME)||n.result.createObjectStore(this.DB_OBJECT_STORE_NAME)},n.onsuccess=function(){n.onsuccess=null,e(n.result)}}))}async getStore(e="readwrite"){return(await this.getIndexedDB()).transaction([this.DB_OBJECT_STORE_NAME],e).objectStore(this.DB_OBJECT_STORE_NAME)}async readItem(e){const t=await this.getStore("readonly");return new Promise((r=>{const n=t.get(e);n.onsuccess=()=>{n.onsuccess=null,r(n.result)}}))}async getAllKeys(){const e=await this.getStore("readonly");return new Promise((t=>{const r=e.getAllKeys();r.onsuccess=()=>{t(r.result.map((e=>String(e))))}}))}async removeItem(e){const t=await this.getStore("readwrite");return new Promise((r=>{const n=t.delete(e);n.onsuccess=()=>{n.onsuccess=null,r()}}))}async writeItem(e,t){const r=await this.getStore("readwrite");return new Promise((n=>{const o=r.put(t,e);o.onsuccess=()=>{o.onsuccess=null,n()}}))}async itemExists(e){const t=await this.readItem(e);return null!=t}}class rt{constructor(){this.storageLayer=new tt("dashlane-ng",1,"module-data")}getAllKeys(){return this.storageLayer.getAllKeys()}async set(e,t){return await this.storageLayer.writeItem(e,t)}remove(e){return this.storageLayer.removeItem(e)}async get(e){return await this.storageLayer.readItem(e)??void 0}}class nt extends n.CronLowLevelSource{constructor(){super(...arguments),this.alarm$=new qe.y((e=>{const t=self.setInterval((()=>{e.next()}),6e4);return()=>{self.clearInterval(t)}}))}}var ot=r(97280);const at=e=>{if(!(0,fe.qX)(["alarms"]))throw new Error("No alarms.onAlarm.addListener support, permission is missing");if(!(0,fe.Ez)("alarms.onAlarm.addListener"))throw new Error("No alarms.onAlarm.addListener support");chrome.alarms.onAlarm.addListener(e);const t=chrome.runtime.lastError?.message;if(t)throw new Error("alarms/onAlarm error:"+t)},it=e=>{if(!(0,fe.qX)(["alarms"]))throw new Error("No alarms.onAlarm.removeListener support, permission is missing");if(!(0,fe.Ez)("alarms.onAlarm.removeListener"))throw new Error("No alarms.onAlarm.removeListener support");chrome.alarms.onAlarm.removeListener(e);const t=chrome.runtime.lastError?.message;if(t)throw new Error("alarms/onAlarm error:"+t)};const st="cron-source",ct=()=>new qe.y((e=>{const t=t=>{t.name===st&&e.next()};return((e,t)=>{if(!(0,fe.qX)(["alarms"]))throw new Error("No alarms.create support, permission is missing");if(!(0,fe.Ez)("alarms.create"))throw new Error("No alarms.create support");chrome.alarms.create(e,t)})(st,{delayInMinutes:1,periodInMinutes:1}),at(t),()=>{it(t)}})),ut=()=>(0,fe.Ez)("alarms.clear")&&(0,fe.qX)(["alarms"])?ct():new qe.y((e=>{const t=self.setInterval((()=>{e.next()}),6e4);return()=>{self.clearInterval(t)}}));class lt extends n.CronLowLevelSource{constructor(){super(...arguments),this.alarm$=ut().pipe((0,ot.d)(1)),this.subscription=this.alarm$.subscribe()}stop(){this.subscription.unsubscribe()}}function dt(){return"undefined"!=typeof chrome&&void 0!==chrome.runtime&&void 0!==chrome.runtime.getManifest&&3===(0,ne.W)().manifest_version}var pt=r(7074);class ft{constructor(e,t){this.worker=e,this.channelName=t,this.autoConnects=!1,this.status$=(0,G.of)(n.ChannelState.Connected),this.messages$=new qe.y((t=>{const r=e=>{(0,n.isSendMessageRequest)(e.data)&&!e.origin&&t.next(e.data.message)};return e.addEventListener("message",r),()=>{e.removeEventListener("message",r)}})).pipe((0,pt.B)())}async sendMessage(e){this.worker.postMessage((0,n.sendMessageRequest)({channelName:this.channelName,message:e}))}stop(){return Promise.resolve()}}var ht=r(69183),yt=r(20500);class mt{constructor(e,t){this.source=e,this.filter=t;let r=[];const n=new Set;this.listener=(e,t)=>{if(!this.filter(e,t))return!1;n.size?n.forEach((r=>r.next([e,t]))):r.push([e,t])},this.events$=new qe.y((e=>(n.size||(r.forEach((t=>e.next(t))),r=[]),n.add(e),()=>{n.delete(e)}))),this.source.addListener(this.listener)}stop(){this.source.removeListener(this.listener)}}class gt{constructor(e){this.connectedChannels$=new Fe.X({});const t=new qe.y((t=>{const r={},o=o=>{const a=(0,ht.Z)();if(o.name!==e)return;const i=new mt({addListener:e=>o.onMessage.addListener(e),removeListener:e=>o.onMessage.removeListener(e)},(t=>(0,n.isSendMessageRequest)(t)&&t.channelName===e)),s=new Promise((e=>{const t=()=>{o.onDisconnect.removeListener(t),e(null)};o.onDisconnect.addListener(t)})),c=new Fe.X(n.ChannelState.Connected);s.then((()=>{i.stop(),c.next(n.ChannelState.Disconnected),delete r[a],t.next(r)}));const u={autoConnects:!1,messages$:i.events$.pipe((0,k.U)((([e])=>e.message))),sendMessage:t=>(o.postMessage((0,n.sendMessageRequest)({channelName:e,message:t})),Promise.resolve()),stop:()=>(o.disconnect(),Promise.resolve()),status$:c},l=new n.AcknowledgedChannel(u);r[a]=l,t.next(r)};return yt.b.addListener(o),()=>{yt.b.removeListener(o)}}));this.subscription=t.subscribe((e=>this.connectedChannels$.next(e)))}stop(){this.subscription.unsubscribe()}}var vt=r(6220),bt=r(60399);class wt{constructor(e){this.autoConnects=!0,this.status$=new Fe.X(n.ChannelState.Connected),this.port$=new qe.y((t=>{let r;function n(){r?.onDisconnect.removeListener(n);const o=function(e){if(!(0,fe.Ez)("runtime.connect"))throw new Error("No runtime.connect support");return chrome.runtime.connect(e)}({name:e});o.onDisconnect.addListener(n),t.next(o),r=o}return n(),()=>{r?.onDisconnect.removeListener(n),r?.disconnect()}})).pipe((0,ot.d)(1)),this.portSubscription=this.port$.subscribe(),this.messages$=this.port$.pipe((0,vt.z)((t=>new qe.y((r=>{const o=t=>{(0,n.isSendMessageRequest)(t)&&t.channelName===e&&r.next(t.message)};return t.onMessage.addListener(o),()=>{t.onMessage.removeListener(o)}})))))}async sendMessage(e){const t=await(0,bt.z)(this.port$);t.postMessage((0,n.sendMessageRequest)({channelName:t.name,message:e}))}stop(){return this.portSubscription.unsubscribe(),this.status$.next(n.ChannelState.Disconnected),Promise.resolve()}}var Rt=r(43978),St=r(17350);class Et{constructor(e){this.autoConnects=!1,this.listener=new gt(e),this.channel$=this.listener.connectedChannels$.pipe((0,k.U)((e=>{const t=Object.values(e);if(t.length)return t[0]})),(0,ot.d)(1)),this.receivedMessages$=this.channel$.pipe((0,Rt.w)((e=>e?e.receivedMessages$:St.E))),this.channelState$=this.channel$.pipe((0,k.U)((e=>e?n.ChannelState.Connected:n.ChannelState.Disconnected)))}async send(e){const t=await(0,bt.z)(this.channel$);if(!t)throw new Error("Channel is not connected");await t.send(e)}stop(){this.listener.stop()}}},44396:(e,t,r)=>{"use strict";function n(...e){const t=[...e].reverse();return{decode:async t=>{for(const r of e)t=await r.decode(t);return t},encode:async e=>{for(const r of t)e=await r.encode(e);return e}}}r.d(t,{zW:()=>_e,N2:()=>Te,RV:()=>Xe,z:()=>p,gO:()=>h,Nw:()=>f,mr:()=>R,E1:()=>S,x4:()=>Ie,oo:()=>E,SD:()=>ce,a7:()=>Je,jN:()=>Ue,eN:()=>He,WM:()=>Fe,LE:()=>Ve,aW:()=>Ge,Zn:()=>Qe,WE:()=>Ke,bL:()=>i,BU:()=>y,Eu:()=>u,xJ:()=>De,$k:()=>xe,dC:()=>s,xw:()=>n,FO:()=>Re,Ic:()=>Ce,Jo:()=>Pe,gi:()=>Ae,yL:()=>je,b9:()=>C});var o=r(89685),a=r(54066);class i{decode(e){return JSON.parse((0,o.v)(e))}encode(e){return(0,a.u)(JSON.stringify(e))}}class s{constructor(e){this.typeGuard=e}decode(e){if(this.typeGuard(e))return e;throw new Error("Bad type")}encode(e){return e}}const c=e=>e;class u{constructor(){this.encode=c,this.decode=c}}var l=r(7502),d=r(10370);class p{decode(e){return(0,l.R)(e)}encode(e){return(0,d.s)(e)}}const f={algorithm:"aes256",mode:"cbchmac",ivLength:16},h={algorithm:"aes256",mode:"cbchmac64",ivLength:16},y={algorithm:"aes256",mode:"cbchmac",ivLength:16,padding:16,bytesToKey:0,reuseSalt:!1},m={algorithm:"aes256",mode:"cbc",ivLength:16,saltLength:32,padding:0,bytesToKey:{algorithm:"sha1",iterations:3,keyLength:32}};var g=r(7165);const v=g.z.object({algorithm:g.z.literal("aes256"),mode:g.z.literal("cbchmac"),ivLength:g.z.literal(16)}),b=g.z.object({algorithm:g.z.literal("aes256"),mode:g.z.literal("cbchmac64"),ivLength:g.z.literal(16)}),w=g.z.union([v,b]),R={algorithm:"argon2d",saltLength:16,tCost:3,mCost:32768,parallelism:2},S={algorithm:"pbkdf2",saltLength:16,iterations:2e5,hashAlgorithm:"sha256"},E={algorithm:"noderivation"},O={algorithm:"pbkdf2",saltLength:32,iterations:10204,hashAlgorithm:"sha1"};function C(e){return["argon2d","pbkdf2","noderivation"].some((t=>t===e))}const P=g.z.object({algorithm:g.z.literal("argon2d"),saltLength:g.z.literal(16),tCost:g.z.number(),mCost:g.z.number(),parallelism:g.z.number()}),A=g.z.object({algorithm:g.z.literal("pbkdf2"),saltLength:g.z.union([g.z.literal(16),g.z.literal(32)]),iterations:g.z.number(),hashAlgorithm:g.z.enum(["sha1","sha256"])}),j=g.z.object({algorithm:g.z.literal("noderivation")});var _=r(95087);function T({transportableData:e,marker:t,metadata:r}){const n=t.length+r.length;return e.substring(n)}function I({encipheredContents:e,marker:t,metadata:r}){const{derivation:n,cipher:o,type:i,version:s}=t,{iv:c,salt:u,signature:l}=r;return{type:i,version:s,derivationConfig:n,cipherConfig:o,salt:(0,a.u)(u),signature:(0,a.u)(l),iv:(0,a.u)(c),encipheredContents:(0,a.u)(e)}}function x({str:e,substr:t,occurrence:r}){if(r<1)return-1;let n=0,o=-1;for(;n<r;){if(o=e.indexOf(t,o+1),o<0)return o;n++}return o}const D="$",U=1;function M({transportableData:e,makeMarker:t,schema:r}){const n=r.count+1,o=x({str:e,substr:D,occurrence:n}),a=e.substring(1,o).split(D);if(a.length!==r.count)throw new Error("Marker and schema length mismatch");return t({bytes:o+1,markerSchema:r,values:a})}const N=g.z.literal("flexible"),k=g.z.object({version:g.z.literal(1),type:N,length:g.z.number(),derivation:P,cipher:v});function L({bytes:e,markerSchema:t,values:r}){const{version:n,derivation:o,saltLength:a,tCost:i,mCost:s,parallelism:c,cipher:u,mode:l,ivLength:d}=t.index,p=k.safeParse({version:Number(r[n]),type:"flexible",length:e,derivation:{algorithm:r[o],saltLength:Number(r[a]),tCost:Number(r[i]),mCost:Number(r[s]),parallelism:Number(r[c])},cipher:{algorithm:r[u],mode:r[l],ivLength:Number(r[d])}});if(!p.success)throw new Error(p.error.message);return p.data}const F={count:9,index:{version:0,derivation:1,saltLength:2,tCost:3,mCost:4,parallelism:5,cipher:6,mode:7,ivLength:8}},q={count:8,index:{version:0,derivation:1,saltLength:2,iterations:3,hashAlgorithm:4,cipher:5,mode:6,ivLength:7}},V={count:5,index:{version:0,derivation:1,cipher:2,mode:3,ivLength:4}},G=32;function H({transportableData:e,marker:t}){const{length:r,derivation:n,cipher:o}=t,a=n.saltLength,{ivLength:i}=o,s=r+0,c=s+a,u=c+i;return{iv:e.substring(c,c+i),length:a+i+G,salt:e.substring(s,s+a),signature:e.substring(u,u+G)}}const B=g.z.object({version:g.z.literal(1),type:N,length:g.z.number(),derivation:j,cipher:w});function K({bytes:e,markerSchema:t,values:r}){const{version:n,cipher:o,mode:a,ivLength:i}=t.index,s=B.safeParse({version:Number(r[n]),type:"flexible",length:e,derivation:{algorithm:"noderivation"},cipher:{algorithm:r[o],mode:r[a],ivLength:Number(r[i])}});if(!s.success)throw new Error(s.error.message);return s.data}function W(){return e=>{const t=M({transportableData:e,makeMarker:K,schema:V}),r=function({transportableData:e,marker:t}){const{length:r,cipher:n}=t,{ivLength:o}=n,a=r+0,i=a+o;return{iv:e.substring(a,a+o),length:o+G,signature:e.substring(i,i+G)}}({transportableData:e,marker:t});return function({encipheredContents:e,marker:t,metadata:r}){const{derivation:n,cipher:o,type:i,version:s}=t,{iv:c,signature:u}=r;return{type:i,version:s,derivationConfig:n,cipherConfig:o,signature:(0,a.u)(u),iv:(0,a.u)(c),encipheredContents:(0,a.u)(e)}}({encipheredContents:T({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})}}const z=g.z.object({version:g.z.literal(1),type:N,length:g.z.number(),derivation:A,cipher:v});function $({bytes:e,markerSchema:t,values:r}){const{version:n,derivation:o,saltLength:a,iterations:i,hashAlgorithm:s,cipher:c,mode:u,ivLength:l}=t.index,d=z.safeParse({version:Number(r[n]),type:"flexible",length:e,derivation:{algorithm:r[o],saltLength:Number(r[a]),iterations:Number(r[i]),hashAlgorithm:r[s]},cipher:{algorithm:r[c],mode:r[u],ivLength:Number(r[l])}});if(!d.success)throw new Error(d.error.message);return d.data}function Q({transportableData:e,index:t}){const r=t+1,n=x({str:e,substr:D,occurrence:r}),o=x({str:e,substr:D,occurrence:r+1});if(-1===n||-1===o)throw new Error("Marker info indices not found");return e.substring(n+1,o)}const Y=0,X=1;function J(e){switch(e){case"argon2d":return e=>{const t=M({transportableData:e,makeMarker:L,schema:F}),r=H({transportableData:e,marker:t});return I({encipheredContents:T({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})};case"pbkdf2":return e=>{const t=M({transportableData:e,makeMarker:$,schema:q}),r=H({transportableData:e,marker:t});return I({encipheredContents:T({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})};case"noderivation":return W();default:(0,_.U)(e)}}function Z(...e){const t=e.reduce(((e,t)=>e+t.byteLength),0),r=new Uint8Array(t);return e.reduce(((e,t)=>(r.set(new Uint8Array(t),e),e+t.byteLength)),0),r.buffer}function ee(e){const t=D+e.join(D)+D;return(0,a.u)(t)}function te({cipher:e,derivation:t}){const{algorithm:r}=t;switch(r){case"argon2d":return function({cipher:e,derivation:t}){const{count:r,index:n}=F,o=new Array(r);return o[n.version]=U,o[n.derivation]=t.algorithm,o[n.saltLength]=t.saltLength,o[n.tCost]=t.tCost,o[n.mCost]=t.mCost,o[n.parallelism]=t.parallelism,o[n.cipher]=e.algorithm,o[n.mode]=e.mode,o[n.ivLength]=e.ivLength,ee(o)}({cipher:e,derivation:t});case"pbkdf2":return function({cipher:e,derivation:t}){const{count:r,index:n}=q,o=new Array(r);return o[n.version]=U,o[n.derivation]=t.algorithm,o[n.saltLength]=t.saltLength,o[n.iterations]=t.iterations,o[n.hashAlgorithm]=t.hashAlgorithm,o[n.cipher]=e.algorithm,o[n.mode]=e.mode,o[n.ivLength]=e.ivLength,ee(o)}({cipher:e,derivation:t});case"noderivation":return function({cipher:e,derivation:t}){const{count:r,index:n}=V,o=new Array(r);return o[n.version]=U,o[n.derivation]=t.algorithm,o[n.cipher]=e.algorithm,o[n.mode]=e.mode,o[n.ivLength]=e.ivLength,ee(o)}({cipher:e,derivation:t});default:(0,_.U)(r)}}const re="KWC5",ne=16,oe=32,ae=0,ie={type:"KWC5",derivation:E,cipher:y};function se(e){const t=function({transportableData:e,marker:t}){const{cipher:r,type:n}=t,{ivLength:o}=r,a=ae+o+ne+n.length,i=a+oe;return{iv:e.slice(ae,ae+o),signature:e.slice(a,a+oe),encipheredContents:e.slice(i)}}({transportableData:e,marker:ie});return{iv:t.iv,type:re,signature:t.signature,encipheredContents:t.encipheredContents,derivationConfig:E,cipherConfig:y}}class ce{constructor(){this.derivateKeyCache=new Map}getCacheKey(...e){const t=e.reduce(((e,t)=>Z(e,t)),new ArrayBuffer(0));return(0,d.s)(t)}getCachedDerivation(e){return this.derivateKeyCache.get(e)}setCachedDerivation({cacheKey:e,data:t}){this.getCachedDerivation(e)||this.derivateKeyCache.set(e,t)}}const ue="flexible",le="KWC3",de=0,pe=32,fe=4;function he(e){const t=e.slice(pe,pe+fe),r=(0,o.v)(t);if([le,re].includes(r))return r}function ye(e){const t=he(e);return t||(function(e){const t=new Uint8Array(e).slice(0,1);return(0,o.v)(t.buffer)===D}(e)?ue:void 0)}const me="SHA-512";async function ge(e,t){const r=await t(e,me),n=new Uint8Array(r),o=r.byteLength/2,a=n.slice(0,o),i=n.slice(o,r.byteLength);return{encryptionKey:a.buffer,signatureKey:i.buffer}}function ve(e){const t=new Uint8Array(e),r=e.byteLength/2,n=t.slice(0,r),o=t.slice(r);return Promise.resolve({encryptionKey:n.buffer,signatureKey:o.buffer})}async function be(e,t,r,n,o){const i=(0,a.u)(Object.values(r).join("")),s=t.getCacheKey(n,o,i),c=t.getCachedDerivation(s);if(c)return c;const u=function(e){switch(e){case"sha1":return"SHA-1";case"sha256":return"SHA-256";case"sha384":return"SHA-384";case"sha512":return"SHA-512";default:(0,_.U)(e)}}(r.hashAlgorithm),l=await e(n,o,{iterations:r.iterations,hashType:u});return t.setCachedDerivation({cacheKey:s,data:l}),l}function we(e,t,r,n,o,i){return"pbkdf2"===o.algorithm?be(r,i,o,e,t):async function(e,t,r,n,o){const{tCost:i,mCost:s,parallelism:c}=r,u=(0,a.u)(Object.values(r).join("")),l=t.getCacheKey(n,o,u),d=t.getCachedDerivation(l);if(d)return d;const p={tCost:i,mCost:s,parallelism:c},f=await e(n,o,p);return t.setCachedDerivation({cacheKey:l,data:f}),f}(n,i,o,e,t)}async function Re(e,t,r,n){const a=function(e){const t=(0,o.v)(e),r=Q({transportableData:t,index:Y});if(Number(r)!==U)throw new Error("Marker version not supported");const n=Q({transportableData:t,index:X});if(!C(n))throw new Error("Derivation algorithm not supported");return J(n)(t)}(n),{deriveKeyArgon2d:i,deriveKeyPbkdf2:s}=t,{derivationConfig:c,salt:u}=a,{algorithm:l}=c,d="pbkdf2"===l||"argon2d"===l;if(d&&!u)throw new Error("Need salt for derivation");const p=d&&u?await we(e,u,s,i,c,r):e,{mode:f}=a.cipherConfig,{computeHash:h}=t,{encryptionKey:y,signatureKey:m}="cbchmac64"===f?await ve(p):await ge(p,h),{iv:g,encipheredContents:v}=a,b=Z(g,v),{verifyHmacSha:w}=t,{signature:R}=a;if(!await w(m,R,b))throw new Error("Signature cannot be verified");const{decryptAes256:S}=t;return S(y,g,v)}const Se={type:le,derivation:O,cipher:m};function Ee(e){const t=function({transportableData:e,marker:t}){const{derivation:r,type:n}=t,{saltLength:o}=r,a=de+o+n.length;return{salt:e.slice(de,de+o),encipheredContents:e.slice(a)}}({transportableData:e,marker:Se});return{salt:t.salt,type:le,encipheredContents:t.encipheredContents,derivationConfig:O,cipherConfig:m}}async function Oe(e,t,r,n){const o=Ee(n),{deriveKeyPbkdf2:a}=t,{derivationConfig:i,salt:s}=o,c=await be(a,r,i,e,s),{computeHash:u}=t,{cipherConfig:{ivLength:l,bytesToKey:{iterations:d,keyLength:p}}}=o,f=await async function(e,t,r,n,o,a){const i=Z(t,a.slice(0,8));let s=i,c=new ArrayBuffer(0);for(let t=0;t<r;t++){const t=await e(s,"SHA-1");c=Z(c,t),s=Z(t,i)}const u=o+n;return Promise.resolve(c.slice(o,u))}(u,c,d,l,p,s),{decryptAes256:h}=t,{encipheredContents:y}=o;return h(c,f,y)}async function Ce(e,t,r){const n=se(r),{computeHash:o}=t,{encryptionKey:a,signatureKey:i}=await ge(e,o),{iv:s,encipheredContents:c}=n,u=Z(s,c),{verifyHmacSha:l}=t,{signature:d}=n;if(!await l(i,d,u))throw new Error("Signature cannot be verified");const{decryptAes256:p}=t;return p(a,s,c)}async function Pe(e,t,r,n){const o=ye(n);if(!o)throw new Error("Cannot find marker type");switch(o){case le:return await Oe(e,t,r,n);case re:return await Ce(e,t,n);case ue:return Re(e,t,r,n);default:(0,_.U)(o)}}async function Ae(e,t,r,n,o,a,i){const{algorithm:s}=r,c="pbkdf2"===s||"argon2d"===s;if(c&&!i?.salt)throw new Error("Need salt for derivation");const{deriveKeyArgon2d:u,deriveKeyPbkdf2:l}=t,d=c&&i?.salt?await we(e,i.salt,l,u,r,n):e,{mode:p}=o,{computeHash:f}=t,{encryptionKey:h,signatureKey:y}="cbchmac64"===p?await ve(d):await ge(d,f),{getRandomValues:m}=t,g=m(o.ivLength),{encryptAes256:v}=t,b=await v(h,g,a),{signHmacSha:w}=t,R=Z(g,b),S=await w(y,R);return function(e){const{encipheredContents:t,cipherConfig:r,derivationConfig:n,salt:o,signature:a,iv:i}=e,s=te({cipher:r,derivation:n});return o&&"noderivation"!==n.algorithm?Z(s,o,i,a,t):Z(s,i,a,t)}({type:"flexible",version:1,derivationConfig:r,cipherConfig:o,salt:i?.salt,iv:g,signature:S,encipheredContents:b})}async function je(e,t,r,n,o,i){const{computeHash:s}=t,{encryptionKey:c,signatureKey:u}=await ge(e,s),{getRandomValues:l}=t,{ivLength:d}=n,p=l(d),{encryptAes256:f}=t,h=await f(c,p,o),{signHmacSha:y}=t,m=Z(p,h),g={type:"KWC5",derivationConfig:r,cipherConfig:n,iv:p,signature:await y(u,m),encipheredContents:h},{padding:v}=i;return function({secureData:e,randomValues:t}){if(t.byteLength!==ne)throw new Error("Encoding kwc5 requires 16 random bytes");const{encipheredContents:r,iv:n,type:o,signature:i}=e;return Z(n,t,(0,a.u)(o),i,r)}({secureData:g,randomValues:v})}const _e="AES-CBC",Te=256,Ie="SHA-256",xe="RSA-OAEP",De="RSASSA-PKCS1-v1_5";class Ue{}var Me=r(69885),Ne=r(34987),ke=r(48844);class Le{constructor(e){this.chain=null,this.backend=e}handle(e){return this.backend.handle(e)}}class Fe{constructor(e){this.headers=new Map,this.normalizedNames=new Map,"string"==typeof e?this.initFromString(e):e&&this.initFromObject(e)}has(e){return this.headers.has(e.toLowerCase())}get(e){const t=this.headers.get(e.toLowerCase());return t?.[0]??null}keys(){return Array.from(this.normalizedNames.values())}getAll(e){return this.headers.get(e.toLowerCase())??null}append(e,t){return this.clone({name:e,value:t,op:0})}set(e,t){return this.clone({name:e,value:t,op:1})}delete(e,t){return this.clone({name:e,value:t,op:2})}deleteMultiple(e){return this.clone({names:e,op:3})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}clone(e){const t=new Fe;return t.initFromOther(this),t.applyUpdate(e),t}applyUpdate(e){switch(e.op){case 0:case 1:{const t=e.name.toLowerCase();let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,t);const n=(0===e.op?this.headers.get(t):void 0)??[];n.push(...r),this.headers.set(t,n)}break;case 2:{const t=e.name.toLowerCase(),r=e.value;if(r){let e=this.headers.get(t);if(!e)return;const n=Array.isArray(r)?r:[r];e=e.filter((e=>!n.includes(e))),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}break;case 3:e.names.forEach((e=>{const t=e.toLowerCase();this.headers.delete(t),this.normalizedNames.delete(t)}))}}initFromOther(e){Array.from(e.headers.keys()).forEach((t=>{this.headers.set(t,[...e.headers.get(t)]),this.normalizedNames.set(t,e.normalizedNames.get(t))}))}initFromObject(e){Object.keys(e).forEach((t=>{let r=e[t];const n=t.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(n,r),this.maybeSetNormalizedName(t,n))}))}initFromString(e){e.split("\n").forEach((e=>{const t=e.indexOf(":");if(t>0){const r=e.slice(0,t),n=r.toLowerCase(),o=e.slice(t+1).trim();this.maybeSetNormalizedName(r,n),this.headers.has(n)?this.headers.get(n).push(o):this.headers.set(n,[o])}}))}}class qe{encodeKey(e){return this.standardEncoding(e)}encodeValue(e){return this.standardEncoding(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}standardEncoding(e){return encodeURIComponent(e).replace(qe.STANDARD_ENCODING_REGEX,((e,t)=>qe.STANDARD_ENCODING_REPLACEMENTS[t]??e))}}qe.STANDARD_ENCODING_REGEX=/%(\d[a-f0-9])/gi,qe.STANDARD_ENCODING_REPLACEMENTS={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};class Ve{constructor(e={},t={}){this.map=new Map,this.encoder=t.encoder??new qe,"string"==typeof e?this.initFromString(e):this.initFromObject(e)}has(e){return this.map.has(e)}get(e){const t=this.map.get(e);return t?.[0]??null}getAll(e){return this.map.get(e)??null}keys(){return Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:0})}appendAll(e){const t=[];return Object.keys(e).forEach((r=>{const n=e[r];Array.isArray(n)?n.forEach((e=>{t.push({param:r,value:e,op:0})})):t.push({param:r,value:n,op:0})})),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:1})}delete(e,t){return this.clone({param:e,value:t,op:2})}toString(){return this.keys().map((e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map((e=>t+"="+this.encoder.encodeValue(e))).join("&")})).filter((e=>""!==e)).join("&")}clone(e){const t=new Ve({},{encoder:this.encoder});return t.initFromOther(this),t.applyUpdates(Array.isArray(e)?e:[e]),t}initFromOther(e){e.keys().forEach((t=>this.map.set(t,[...e.map.get(t)])))}initFromObject(e){Object.keys(e).forEach((t=>{const r=e[t],n=Ve.isValueArray(r)?r.map(Ve.valueToString):[Ve.valueToString(r)];this.map.set(t,n)}))}initFromString(e){const{encoder:t}=this;if(e.length>0){e.replace(/^\?/,"").split("&").forEach((e=>{const r=e.indexOf("="),[n,o]=-1===r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],a=this.map.get(n)??[];a.push(o),this.map.set(n,a)}))}}applyUpdates(e){e.forEach((e=>{switch(e.op){case 0:case 1:{const t=(0===e.op?this.map.get(e.param):void 0)??[];t.push(Ve.valueToString(e.value)),this.map.set(e.param,t);break}case 2:if(void 0===e.value){this.map.delete(e.param);break}{const t=this.map.get(e.param)??[],r=t.indexOf(Ve.valueToString(e.value));-1!==r&&t.splice(r,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}))}static valueToString(e){return`${e}`}static isValueArray(e){return Array.isArray(e)}}class Ge{constructor(e,t,r,n){this.body=null,this.headers=new Fe,this.withCredentials=!1,this.timeout=void 0,this.responseType="json",this.params=new Ve({}),this.url=t,this.method=e,Ge.mightHaveBody(this.method)&&(this.body=r??null),n&&(this.withCredentials=Boolean(n.withCredentials),n.responseType&&(this.responseType=n.responseType),n.headers&&(this.headers=this.getHeadersFromOptions(n.headers)),n.params&&(this.params=this.getParamsFromOptions(n.params)),n.timeout&&n.timeout>0&&(this.timeout=n.timeout),n.mode&&(this.mode=n.mode)),this.urlWithParams=this.initUrlWithParams()}serializeBody(){return null===this.body?null:Ge.isArrayBuffer(this.body)||"string"==typeof this.body?this.body:this.body instanceof Ve?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Ge.isArrayBuffer(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Ve?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){const t=e.method??this.method,r=e.url??this.url,n=e.responseType??this.responseType,o=void 0!==e.body?e.body:this.body,a=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,i=void 0!==e.timeout?e.timeout:this.timeout,s=e.mode??this.mode;let c=e.headers?this.getHeadersFromOptions(e.headers):this.headers,u=e.params?this.getParamsFromOptions(e.params):this.params;const l=e.setHeaders;l&&(c=Object.keys(l).reduce(((e,t)=>e.set(t,l[t])),c));const d=e.setParams;return d&&(u=Object.keys(d).reduce(((e,t)=>e.set(t,d[t])),u)),new Ge(t,r,o,{params:u,headers:c,responseType:n,withCredentials:a,timeout:i,mode:s})}getHeadersFromOptions(e){return e instanceof Fe?e:new Fe(e)}getParamsFromOptions(e){return e instanceof Ve?e:new Ve(e)}initUrlWithParams(){const e=this.params.toString();if(0===e.length)return this.url;const t=this.url.indexOf("?"),r=-1===t?"?":t<this.url.length-1?"&":"";return this.url+r+e}static mightHaveBody(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":return!1;default:return!0}}static isArrayBuffer(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}}class He{constructor(e){this.handler=new Le(e)}request(...e){return this.makeRequest(...e)}delete(e,t){return this.makeRequest("DELETE",e,t)}get(e,t){return this.makeRequest("GET",e,t)}head(e,t){return this.makeRequest("HEAD",e,t)}options(e,t){return this.makeRequest("OPTIONS",e,t)}patch(e,t,r){return this.makeRequest("PATCH",e,{body:t,...r})}post(e,t,r){return this.makeRequest("POST",e,{body:t,...r})}put(e,t,r){return this.makeRequest("PUT",e,{body:t,...r})}makeRequest(...e){let t,r,n;if(1===e.length)t=e[0],r="response";else{const[o,a,i]=e;t=new Ge(o,a,void 0!==i.body?i.body:null,{headers:i.headers,params:i.params,responseType:i.responseType??"json",withCredentials:i.withCredentials}),r=i.observe??"body","json"===i.responseType&&"body"===i.observe&&(n=i.responseBodyDecoder)}const o=(0,Me.of)(this.addContentTypeRequestHeader(t)).pipe((0,Ne.b)((e=>this.handler.handle(e))));switch(r){case"body":switch(t.responseType){case"arraybuffer":return o.pipe((0,ke.Gx)((e=>e.arrayBuffer())));case"text":return o.pipe((0,ke.Gx)((e=>e.text())));case"json":return o.pipe((0,ke.Gx)((e=>e.json(n))));default:(0,_.U)(t.responseType)}break;case"response":return o;default:(0,_.U)(r)}}addContentTypeRequestHeader(e){if(!e.headers.has("content-type")){const t=e.detectContentTypeHeader();if(t)return e.clone({headers:e.headers.set("content-type",t)})}return e}}class Be{constructor(e){this.values=e}matches(e){return(!this.values?.method||this.values.method===e.method)&&((void 0===this.values?.url||this.values.url===e.url)&&((void 0===this.values?.body||JSON.stringify(this.values.body)===JSON.stringify(e.body))&&(!(void 0!==this.values?.headers&&!Object.keys(this.values.headers).reduce(((t,r)=>{const n=this.values.headers[r],o=Array.isArray(n)?n:[n],a=e.headers.getAll(r).every((e=>o.includes(e)));return t&&a}),!0))&&(void 0===this.values?.params&&((void 0===this.values?.responseType||this.values.responseType===e.responseType)&&((void 0===this.values?.withCredentials||this.values.withCredentials===e.withCredentials)&&((void 0===this.values?.timeout||this.values.timeout===e.timeout)&&(void 0===this.values?.mode||this.values.mode===e.mode))))))))}}"undefined"!=typeof expect&&expect.extend({toMatchHttpRequest(e,t){const r=new Be(t).matches(e);return{message:()=>r?"Passed":"Failed",pass:r}}});var Ke,We=r(225);async function ze(e){const t=e.getReader();let r=new Uint8Array(0),n=await t.read();for(;!n.done;){const e=new Uint8Array(r.byteLength+n.value.byteLength);e.set(r,0),e.set(n.value,r.byteLength),r=e,n=await t.read()}return r}!function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(Ke||(Ke={}));class $e{constructor(e){this.bytesRead=0,this.data=e}pull(e){const{bytesRead:t,data:r}=this;if(t>=r.byteLength)return void e.close();const n=Math.min(r.byteLength-t,e.desiredSize??1/0);if(n>0){const o=new Uint8Array(r,t,n);e.enqueue(o),this.bytesRead+=n}t>=r.byteLength&&e.close()}}class Qe{constructor(e={},t=Ke.Ok,r="OK"){this.headers=e.headers??new Fe,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText??r,this.url=e.url??null,this.ok=this.status>=200&&this.status<300,this.body=void 0!==e.body?e.body:null}clone(e={}){return new Qe({body:void 0!==e.body?e.body:null===this.body?null:this.body instanceof We.Pz?this.body.tee()[0]:this.body,headers:e.headers??this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText??this.statusText,url:e.url??this.url??void 0})}async arrayBuffer(){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name){return(await ze(this.body)).buffer}if(!(this.body instanceof ArrayBuffer))throw new Error("Unexpected body type, not an ArrayBuffer");return this.body}async text(){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name){const e=await ze(this.body);return(0,o.b)(e)}if("string"!=typeof this.body)throw new Error("Unexpected body type, not a string");return this.body}async json(e){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name){const t=await ze(this.body),r=(0,o.b)(t);try{const t=JSON.parse(r);return e.decode(t)}catch(e){throw new Error("Failed to parse response body JSON")}}if(this.body instanceof ArrayBuffer||"string"==typeof this.body)throw new Error("Unexpected body type");return e.decode(this.body)}bodyStream(){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name)return this.body;if("string"==typeof this.body)return new We.Pz(new $e((0,a.u)(this.body)));if(this.body instanceof ArrayBuffer)return new We.Pz(new $e(this.body));const e=JSON.stringify(this.body);return new We.Pz(new $e((0,a.u)(e)))}}var Ye=r(96168);class Xe extends((0,Ye.Hu)("BadStatus","The HTTP response has a non-successful status code (not 2XX)")){constructor(e){super(),this.response=e}}class Je extends((0,Ye.Hu)("FetchFailedError","Something happened while communicating to the server")){}},96168:(e,t,r)=>{"use strict";r.d(t,{As:()=>o,BU:()=>a,Hu:()=>n});const n=(e,t)=>class extends Error{constructor(){super(t),this.tag=e}};function o(e,t){return t.includes(e.tag)}const a=e=>e.tag},20195:(e,t,r)=>{"use strict";function n(e){if(e instanceof Error)throw e;if("string"==typeof e)throw new Error(e);throw new Error(e.tag)}r.d(t,{j:()=>n})},61475:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FunctionalError:()=>n.Hu,assertUnreachable:()=>a.U,concatMapFailure:()=>c.Tc,concatMapSuccess:()=>c.Gx,concatMatchResult:()=>c.RW,createMatchable:()=>i.H6,failure:()=>s.Rn,getBrander:()=>u.zq,getFailure:()=>s.Yv,getSuccess:()=>s.db,hasProperty:()=>u.l$,isFailure:()=>s.hx,isFunctionalErrorOfType:()=>n.As,isMatchable:()=>i.cw,isResult:()=>s.AZ,isSuccess:()=>s.d6,mapFailure:()=>s.SN,mapFailureObservable:()=>c.DZ,mapResultObservable:()=>c.vg,mapSuccess:()=>s.ty,mapSuccessObservable:()=>c.Qn,mapSuccessResultObservable:()=>c.lk,match:()=>i.EQ,matchResultObservable:()=>c.nb,panic:()=>o.j,safeCast:()=>u.Ay,success:()=>s.Vp,switchMapFailure:()=>c.pr,switchMapSuccess:()=>c.CP,switchMatchResult:()=>c.bM,toFunctionalErrorCode:()=>n.BU});var n=r(96168),o=r(20195),a=r(95087),i=r(18533),s=r(87279),c=r(48844),u=r(28489)},95087:(e,t,r)=>{"use strict";function n(e,t){throw new Error(t??`Unreachable code detected (${e})`)}r.d(t,{U:()=>n})},18533:(e,t,r)=>{"use strict";r.d(t,{EQ:()=>a,H6:()=>o,cw:()=>i});var n=r(28489);const o=(e,t)=>({tag:e,...t}),a=(e,t)=>{const r=e.tag,n=r in t?t[r]:null;if(!n)throw new Error("Unmatchable case");return n(e)},i=(e,...t)=>{if("object"!=typeof e||!e)return!1;return(0,n.l$)(e,"tag")&&t.includes(e.tag)}},48844:(e,t,r)=>{"use strict";r.d(t,{CP:()=>m,DZ:()=>l,Gx:()=>f,Qn:()=>u,RW:()=>y,Tc:()=>h,bM:()=>v,lk:()=>p,nb:()=>c,pr:()=>g,vg:()=>d});var n=r(87065),o=r(34987),a=r(43978),i=r(87279),s=r(18533);function c(e){return t=>t.pipe((0,n.U)((t=>(0,s.EQ)(t,{success:({data:t})=>e.success(t),failure:({error:t})=>e.failure(t)}))))}function u(e){return t=>t.pipe((0,n.U)((t=>(0,i.hx)(t)?t:(0,i.Vp)(e(t.data)))))}function l(e){return t=>t.pipe((0,n.U)((t=>(0,i.d6)(t)?t:(0,i.Rn)(e(t.error)))))}function d(e,t){return r=>r.pipe((0,n.U)((r=>(0,i.hx)(r)?t?t(r.error):r:e(r.data))))}function p(e){return t=>t.pipe((0,n.U)((t=>(0,i.hx)(t)?t:e(t.data))))}function f(e){return t=>t.pipe((0,o.b)((async t=>(0,i.hx)(t)?t:(0,i.Vp)(await e(t.data)))))}function h(e){return t=>t.pipe((0,o.b)((async t=>(0,i.d6)(t)?t:(0,i.Rn)(await e(t.error)))))}function y(e){return t=>t.pipe((0,o.b)((t=>(0,i.f2)(t,e))))}function m(e){return t=>t.pipe((0,a.w)((async t=>(0,i.hx)(t)?t:(0,i.Vp)(await e(t.data)))))}function g(e){return t=>t.pipe((0,a.w)((async t=>(0,i.d6)(t)?t:(0,i.Rn)(await e(t.error)))))}function v(e){return t=>t.pipe((0,a.w)((t=>(0,i.f2)(t,e))))}},87279:(e,t,r)=>{"use strict";r.d(t,{Rn:()=>s,Yv:()=>f,db:()=>p,hx:()=>l,AZ:()=>d,d6:()=>u,SN:()=>y,ty:()=>h,f2:()=>c,Vp:()=>i});var n=r(18533);const o="success",a="failure",i=e=>(0,n.H6)("success",{data:e}),s=e=>(0,n.H6)("failure",{error:e}),c=(e,t)=>(0,n.EQ)(e,{success:({data:e})=>t.success(e),failure:({error:e})=>t.failure(e)}),u=e=>e.tag===o,l=e=>e.tag===a,d=e=>(0,n.cw)(e,o,a),p=e=>e.data,f=e=>e.error,h=(e,t)=>l(e)?e:i(t(e.data)),y=(e,t)=>u(e)?e:s(t(e.error))},28489:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>o,l$:()=>a,zq:()=>n});const n=e=>t=>Object.assign(t,{brand:e}),o=e=>e;function a(e,t){return t in e}},73873:(e,t,r)=>{"use strict";r.d(t,{i:()=>a,q:()=>i});var n=r(64839),o=r(24982);const a={getRemoteTimeList:{method:"GET",path:"time/GetRemoteTime",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.NONE,version:o.W.V1},getRemoteTime:{method:"POST",path:"time/GetRemoteTime",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.NONE,version:o.W.V1}};class i{constructor(e){this.executorFactory=e}getRemoteTimeList(e){return this.executorFactory.createExecutor(a.getRemoteTimeList).executeRequest({body:e})}getRemoteTime(e){return this.executorFactory.createExecutor(a.getRemoteTime).executeRequest({body:e})}}},10350:(e,t,r)=>{"use strict";r.d(t,{tA:()=>A,uF:()=>i,Vy:()=>c,Dw:()=>l,AN:()=>p,$B:()=>h,H4:()=>m,y3:()=>j,ET:()=>_,JM:()=>v,bo:()=>R,pd:()=>E,qp:()=>O.q,Vk:()=>P});var n=r(64839),o=r(24982);const a={confirmActivation:{method:"POST",path:"accountrecovery/ConfirmActivation",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivate:{method:"POST",path:"accountrecovery/Deactivate",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getEncryptedVaultKey:{method:"POST",path:"accountrecovery/GetEncryptedVaultKey",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getStatus:{method:"POST",path:"accountrecovery/GetStatus",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},requestActivation:{method:"POST",path:"accountrecovery/RequestActivation",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};class i{constructor(e){this.executorFactory=e}confirmActivation(e,t){return this.executorFactory.createExecutor(a.confirmActivation).executeRequest({credentials:e,body:t})}deactivate(e,t){return this.executorFactory.createExecutor(a.deactivate).executeRequest({credentials:e,body:t})}getEncryptedVaultKey(e){return this.executorFactory.createExecutor(a.getEncryptedVaultKey).executeRequest({body:e})}getStatus(e){return this.executorFactory.createExecutor(a.getStatus).executeRequest({body:e})}requestActivation(e,t){return this.executorFactory.createExecutor(a.requestActivation).executeRequest({credentials:e,body:t})}}const s={completeDeviceRegistrationWithAuthTicket:{method:"POST",path:"authentication/CompleteDeviceRegistrationWithAuthTicket",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},completeDeviceRegistrationWithToken:{method:"POST",path:"authentication/CompleteDeviceRegistrationWithToken",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},completeDeviceRegistrationWithTotp:{method:"POST",path:"authentication/CompleteDeviceRegistrationWithTOTP",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},completeExtraDeviceRegistrationWithToken:{method:"POST",path:"authentication/CompleteExtraDeviceRegistrationWithToken",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},completeLoginWithAuthTicket:{method:"POST",path:"authentication/CompleteLoginWithAuthTicket",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},completeLoginWithTotp:{method:"POST",path:"authentication/CompleteLoginWithTOTP",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},completeRememberMeOpenSession:{method:"POST",path:"authentication/CompleteRememberMeOpenSession",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.SESSION,version:o.W.V1},completeRememberMeRegistration:{method:"POST",path:"authentication/CompleteRememberMeRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},completeTotpActivation:{method:"POST",path:"authentication/CompleteTOTPActivation",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},completeWebAuthnAuthenticatorRegistration:{method:"POST",path:"authentication/CompleteWebAuthnAuthenticatorRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createSamlSession:{method:"POST",path:"authentication/CreateSAMLSession",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},createTokenExtAuth:{method:"POST",path:"authentication/CreateTokenExtAuth",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivateRememberMe:{method:"POST",path:"authentication/DeactivateRememberMe",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivateTotp:{method:"POST",path:"authentication/DeactivateTOTP",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivateU2FDevice:{method:"POST",path:"authentication/DeactivateU2FDevice",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivateWebAuthnAuthenticator:{method:"POST",path:"authentication/DeactivateWebAuthnAuthenticator",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},destroySamlSession:{method:"POST",path:"authentication/DestroySAMLSession",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.BACK_OFFICE,version:o.W.V1},get2FaStatus:{method:"POST",path:"authentication/Get2FAStatus",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},get2FaStatusUnauthenticated:{method:"POST",path:"authentication/Get2FAStatusUnauthenticated",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getAuthenticationMethodsForDevice:{method:"POST",path:"authentication/GetAuthenticationMethodsForDevice",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getAuthenticationMethodsForLogin:{method:"POST",path:"authentication/GetAuthenticationMethodsForLogin",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getAvailableWebAuthnAuthenticators:{method:"POST",path:"authentication/GetAvailableWebAuthnAuthenticators",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.SESSION,version:o.W.V1},getMasterPasswordCipheringKey:{method:"POST",path:"authentication/GetMasterPasswordCipheringKey",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.SESSION,version:o.W.V1},getRecoveryPhoneNumber:{method:"POST",path:"authentication/GetRecoveryPhoneNumber",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTokensList:{method:"GET",path:"authentication/GetTokens",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getTokens:{method:"POST",path:"authentication/GetTokens",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getU2FDevices:{method:"POST",path:"authentication/GetU2FDevices",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getUnauthorizedProfiles:{method:"POST",path:"authentication/GetUnauthorizedProfiles",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getUserSsoInfo:{method:"POST",path:"authentication/GetUserSSOInfo",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.TEAM_DEVICE,version:o.W.V1},getWebAuthnAuthenticators:{method:"POST",path:"authentication/GetWebAuthnAuthenticators",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},initRememberMasterPassword:{method:"POST",path:"authentication/InitRememberMasterPassword",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},performDashlaneAuthenticatorVerification:{method:"POST",path:"authentication/PerformDashlaneAuthenticatorVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},performDuoPushVerification:{method:"POST",path:"authentication/PerformDuoPushVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},performEmailTokenVerification:{method:"POST",path:"authentication/PerformEmailTokenVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},performExtraDeviceVerification:{method:"POST",path:"authentication/PerformExtraDeviceVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},performSsoVerification:{method:"POST",path:"authentication/PerformSsoVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},performTotpVerification:{method:"POST",path:"authentication/PerformTotpVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},performU2FVerification:{method:"POST",path:"authentication/PerformU2FVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},renameWebAuthnAuthenticator:{method:"POST",path:"authentication/RenameWebAuthnAuthenticator",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},requestDeviceRegistration:{method:"POST",path:"authentication/RequestDeviceRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},requestEmailTokenVerification:{method:"POST",path:"authentication/RequestEmailTokenVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},requestExtraDeviceRegistration:{method:"POST",path:"authentication/RequestExtraDeviceRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},requestLogin:{method:"POST",path:"authentication/RequestLogin",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},requestPushNotificationToken:{method:"POST",path:"authentication/RequestPushNotificationToken",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},requestTotpActivation:{method:"POST",path:"authentication/RequestTOTPActivation",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},requestWebauthnOpenSession:{method:"POST",path:"authentication/RequestWebauthnOpenSession",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.SESSION,version:o.W.V1},requestWebauthnRegistration:{method:"POST",path:"authentication/RequestWebauthnRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},resetBlockedToken:{method:"POST",path:"authentication/ResetBlockedToken",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},updateRecoveryPhoneNumber:{method:"POST",path:"authentication/UpdateRecoveryPhoneNumber",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};class c{constructor(e){this.executorFactory=e}completeDeviceRegistrationWithAuthTicket(e){return this.executorFactory.createExecutor(s.completeDeviceRegistrationWithAuthTicket).executeRequest({body:e})}completeDeviceRegistrationWithToken(e){return this.executorFactory.createExecutor(s.completeDeviceRegistrationWithToken).executeRequest({body:e})}completeDeviceRegistrationWithTotp(e){return this.executorFactory.createExecutor(s.completeDeviceRegistrationWithTotp).executeRequest({body:e})}completeExtraDeviceRegistrationWithToken(e){return this.executorFactory.createExecutor(s.completeExtraDeviceRegistrationWithToken).executeRequest({body:e})}completeLoginWithAuthTicket(e){return this.executorFactory.createExecutor(s.completeLoginWithAuthTicket).executeRequest({body:e})}completeLoginWithTotp(e){return this.executorFactory.createExecutor(s.completeLoginWithTotp).executeRequest({body:e})}completeRememberMeOpenSession(e,t){return this.executorFactory.createExecutor(s.completeRememberMeOpenSession).executeRequest({credentials:e,body:t})}completeRememberMeRegistration(e,t){return this.executorFactory.createExecutor(s.completeRememberMeRegistration).executeRequest({credentials:e,body:t})}completeTotpActivation(e,t){return this.executorFactory.createExecutor(s.completeTotpActivation).executeRequest({credentials:e,body:t})}completeWebAuthnAuthenticatorRegistration(e,t){return this.executorFactory.createExecutor(s.completeWebAuthnAuthenticatorRegistration).executeRequest({credentials:e,body:t})}createSamlSession(e){return this.executorFactory.createExecutor(s.createSamlSession).executeRequest({body:e})}createTokenExtAuth(e){return this.executorFactory.createExecutor(s.createTokenExtAuth).executeRequest({credentials:e})}deactivateRememberMe(e,t){return this.executorFactory.createExecutor(s.deactivateRememberMe).executeRequest({credentials:e,body:t})}deactivateTotp(e,t){return this.executorFactory.createExecutor(s.deactivateTotp).executeRequest({credentials:e,body:t})}deactivateU2FDevice(e,t){return this.executorFactory.createExecutor(s.deactivateU2FDevice).executeRequest({credentials:e,body:t})}deactivateWebAuthnAuthenticator(e,t){return this.executorFactory.createExecutor(s.deactivateWebAuthnAuthenticator).executeRequest({credentials:e,body:t})}destroySamlSession(){return this.executorFactory.createExecutor(s.destroySamlSession).executeRequest({})}get2FaStatus(e){return this.executorFactory.createExecutor(s.get2FaStatus).executeRequest({credentials:e})}get2FaStatusUnauthenticated(e){return this.executorFactory.createExecutor(s.get2FaStatusUnauthenticated).executeRequest({body:e})}getAuthenticationMethodsForDevice(e){return this.executorFactory.createExecutor(s.getAuthenticationMethodsForDevice).executeRequest({body:e})}getAuthenticationMethodsForLogin(e){return this.executorFactory.createExecutor(s.getAuthenticationMethodsForLogin).executeRequest({body:e})}getAvailableWebAuthnAuthenticators(e){return this.executorFactory.createExecutor(s.getAvailableWebAuthnAuthenticators).executeRequest({credentials:e})}getMasterPasswordCipheringKey(e){return this.executorFactory.createExecutor(s.getMasterPasswordCipheringKey).executeRequest({credentials:e})}getRecoveryPhoneNumber(e){return this.executorFactory.createExecutor(s.getRecoveryPhoneNumber).executeRequest({credentials:e})}getTokensList(){return this.executorFactory.createExecutor(s.getTokensList).executeRequest({})}getTokens(){return this.executorFactory.createExecutor(s.getTokens).executeRequest({})}getU2FDevices(e){return this.executorFactory.createExecutor(s.getU2FDevices).executeRequest({credentials:e})}getUnauthorizedProfiles(e){return this.executorFactory.createExecutor(s.getUnauthorizedProfiles).executeRequest({body:e})}getUserSsoInfo(e,t){return this.executorFactory.createExecutor(s.getUserSsoInfo).executeRequest({credentials:e,body:t})}getWebAuthnAuthenticators(e){return this.executorFactory.createExecutor(s.getWebAuthnAuthenticators).executeRequest({credentials:e})}initRememberMasterPassword(e,t){return this.executorFactory.createExecutor(s.initRememberMasterPassword).executeRequest({credentials:e,body:t})}performDashlaneAuthenticatorVerification(e){return this.executorFactory.createExecutor(s.performDashlaneAuthenticatorVerification).executeRequest({body:e})}performDuoPushVerification(e){return this.executorFactory.createExecutor(s.performDuoPushVerification).executeRequest({body:e})}performEmailTokenVerification(e){return this.executorFactory.createExecutor(s.performEmailTokenVerification).executeRequest({body:e})}performExtraDeviceVerification(e){return this.executorFactory.createExecutor(s.performExtraDeviceVerification).executeRequest({body:e})}performSsoVerification(e){return this.executorFactory.createExecutor(s.performSsoVerification).executeRequest({body:e})}performTotpVerification(e){return this.executorFactory.createExecutor(s.performTotpVerification).executeRequest({body:e})}performU2FVerification(e){return this.executorFactory.createExecutor(s.performU2FVerification).executeRequest({body:e})}renameWebAuthnAuthenticator(e,t){return this.executorFactory.createExecutor(s.renameWebAuthnAuthenticator).executeRequest({credentials:e,body:t})}requestDeviceRegistration(e){return this.executorFactory.createExecutor(s.requestDeviceRegistration).executeRequest({body:e})}requestEmailTokenVerification(e){return this.executorFactory.createExecutor(s.requestEmailTokenVerification).executeRequest({body:e})}requestExtraDeviceRegistration(e,t){return this.executorFactory.createExecutor(s.requestExtraDeviceRegistration).executeRequest({credentials:e,body:t})}requestLogin(e){return this.executorFactory.createExecutor(s.requestLogin).executeRequest({body:e})}requestPushNotificationToken(e){return this.executorFactory.createExecutor(s.requestPushNotificationToken).executeRequest({credentials:e})}requestTotpActivation(e,t){return this.executorFactory.createExecutor(s.requestTotpActivation).executeRequest({credentials:e,body:t})}requestWebauthnOpenSession(e){return this.executorFactory.createExecutor(s.requestWebauthnOpenSession).executeRequest({credentials:e})}requestWebauthnRegistration(e){return this.executorFactory.createExecutor(s.requestWebauthnRegistration).executeRequest({credentials:e})}resetBlockedToken(e){return this.executorFactory.createExecutor(s.resetBlockedToken).executeRequest({body:e})}updateRecoveryPhoneNumber(e,t){return this.executorFactory.createExecutor(s.updateRecoveryPhoneNumber).executeRequest({credentials:e,body:t})}}const u={confirmRegistration:{method:"POST",path:"darkwebmonitoring/ConfirmRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},deregisterEmail:{method:"POST",path:"darkwebmonitoring/DeregisterEmail",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},listLeaks:{method:"POST",path:"darkwebmonitoring/ListLeaks",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},listRegistrations:{method:"POST",path:"darkwebmonitoring/ListRegistrations",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},registerEmail:{method:"POST",path:"darkwebmonitoring/RegisterEmail",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};class l{constructor(e){this.executorFactory=e}confirmRegistration(e){return this.executorFactory.createExecutor(u.confirmRegistration).executeRequest({body:e})}deregisterEmail(e,t){return this.executorFactory.createExecutor(u.deregisterEmail).executeRequest({credentials:e,body:t})}listLeaks(e,t){return this.executorFactory.createExecutor(u.listLeaks).executeRequest({credentials:e,body:t})}listRegistrations(e){return this.executorFactory.createExecutor(u.listRegistrations).executeRequest({credentials:e})}registerEmail(e,t){return this.executorFactory.createExecutor(u.registerEmail).executeRequest({credentials:e,body:t})}}const d={getAndEvaluateForUser:{method:"POST",path:"features/GetAndEvaluateForUser",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},listAvailableFeatureFlips:{method:"POST",path:"features/ListAvailableFeatureFlips",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1}};class p{constructor(e){this.executorFactory=e}getAndEvaluateForUser(e,t){return this.executorFactory.createExecutor(d.getAndEvaluateForUser).executeRequest({credentials:e,body:t})}listAvailableFeatureFlips(){return this.executorFactory.createExecutor(d.listAvailableFeatureFlips).executeRequest({})}}const f={getFileMeta:{method:"POST",path:"file/GetFileMeta",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},updatedFile:{method:"POST",path:"file/UpdatedFile",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1}};class h{constructor(e){this.executorFactory=e}getFileMeta(e,t){return this.executorFactory.createExecutor(f.getFileMeta).executeRequest({credentials:e,body:t})}updatedFile(e){return this.executorFactory.createExecutor(f.updatedFile).executeRequest({body:e})}}const y={accessibleMobileOffers:{method:"POST",path:"payments/AccessibleMobileOffers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getAccessibleStoreOffers:{method:"POST",path:"payments/GetAccessibleStoreOffers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getAccessibleWebOffers:{method:"POST",path:"payments/GetAccessibleWebOffers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getCustomerInvoice:{method:"POST",path:"payments/GetCustomerInvoice",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getDefaultWebOffers:{method:"POST",path:"payments/GetDefaultWebOffers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getExpectedTaxInformation:{method:"POST",path:"payments/GetExpectedTaxInformation",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getProcessOutKeys:{method:"POST",path:"payments/GetProcessOutKeys",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.NONE,version:o.W.V1},grantFullRefundAndCancelSubscription:{method:"POST",path:"payments/GrantFullRefundAndCancelSubscription",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},listInvoices:{method:"POST",path:"payments/ListInvoices",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};class m{constructor(e){this.executorFactory=e}accessibleMobileOffers(e,t){return this.executorFactory.createExecutor(y.accessibleMobileOffers).executeRequest({credentials:e,body:t})}getAccessibleStoreOffers(e,t){return this.executorFactory.createExecutor(y.getAccessibleStoreOffers).executeRequest({credentials:e,body:t})}getAccessibleWebOffers(e){return this.executorFactory.createExecutor(y.getAccessibleWebOffers).executeRequest({body:e})}getCustomerInvoice(e,t){return this.executorFactory.createExecutor(y.getCustomerInvoice).executeRequest({credentials:e,body:t})}getDefaultWebOffers(e){return this.executorFactory.createExecutor(y.getDefaultWebOffers).executeRequest({body:e})}getExpectedTaxInformation(e){return this.executorFactory.createExecutor(y.getExpectedTaxInformation).executeRequest({body:e})}getProcessOutKeys(){return this.executorFactory.createExecutor(y.getProcessOutKeys).executeRequest({})}grantFullRefundAndCancelSubscription(e,t){return this.executorFactory.createExecutor(y.grantFullRefundAndCancelSubscription).executeRequest({credentials:e,body:t})}listInvoices(e){return this.executorFactory.createExecutor(y.listInvoices).executeRequest({credentials:e})}}const g={getHashes:{method:"POST",path:"pwleak/GetHashes",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getLastUpdate:{method:"POST",path:"pwleak/GetLastUpdate",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1}};class v{constructor(e){this.executorFactory=e}getHashes(e){return this.executorFactory.createExecutor(g.getHashes).executeRequest({body:e})}getLastUpdate(){return this.executorFactory.createExecutor(g.getLastUpdate).executeRequest({})}}const b={deleteSecureFile:{method:"POST",path:"securefile/DeleteSecureFile",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};const w={acceptCollection:{method:"POST",path:"sharing-userdevice/AcceptCollection",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},acceptItemGroup:{method:"POST",path:"sharing-userdevice/AcceptItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},acceptUserGroup:{method:"POST",path:"sharing-userdevice/AcceptUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},addItemGroupsToCollection:{method:"POST",path:"sharing-userdevice/AddItemGroupsToCollection",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},addItems:{method:"POST",path:"sharing-userdevice/AddItems",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createCollection:{method:"POST",path:"sharing-userdevice/CreateCollection",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createItemGroup:{method:"POST",path:"sharing-userdevice/CreateItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createTeamAdminsUserGroup:{method:"POST",path:"sharing-userdevice/CreateTeamAdminsUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createUserGroup:{method:"POST",path:"sharing-userdevice/CreateUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createUserGroupsItemGroup:{method:"POST",path:"sharing-userdevice/CreateUserGroupsItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deleteItemGroup:{method:"POST",path:"sharing-userdevice/DeleteItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deleteUserGroup:{method:"POST",path:"sharing-userdevice/DeleteUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},postSharingUserdevice:{method:"POST",path:"sharing-userdevice/Get",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getUsersPublicKey:{method:"POST",path:"sharing-userdevice/GetUsersPublicKey",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},inviteCollectionMembers:{method:"POST",path:"sharing-userdevice/InviteCollectionMembers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},inviteItemGroupMembers:{method:"POST",path:"sharing-userdevice/InviteItemGroupMembers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},inviteUserGroupUsers:{method:"POST",path:"sharing-userdevice/InviteUserGroupUsers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},refuseCollection:{method:"POST",path:"sharing-userdevice/RefuseCollection",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},refuseItemGroup:{method:"POST",path:"sharing-userdevice/RefuseItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},refuseUserGroup:{method:"POST",path:"sharing-userdevice/RefuseUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},removeItemGroupsFromCollection:{method:"POST",path:"sharing-userdevice/RemoveItemGroupsFromCollection",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},removeItems:{method:"POST",path:"sharing-userdevice/RemoveItems",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},renameUserGroup:{method:"POST",path:"sharing-userdevice/RenameUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},resendItemGroupInvites:{method:"POST",path:"sharing-userdevice/ResendItemGroupInvites",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},revokeCollectionMembers:{method:"POST",path:"sharing-userdevice/RevokeCollectionMembers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},revokeItemGroupMembers:{method:"POST",path:"sharing-userdevice/RevokeItemGroupMembers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},revokeUserGroupUsers:{method:"POST",path:"sharing-userdevice/RevokeUserGroupUsers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},updateItem:{method:"POST",path:"sharing-userdevice/UpdateItem",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},updateItemGroupMembers:{method:"POST",path:"sharing-userdevice/UpdateItemGroupMembers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},updateUserGroupUsers:{method:"POST",path:"sharing-userdevice/UpdateUserGroupUsers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};class R{constructor(e){this.executorFactory=e}acceptCollection(e,t){return this.executorFactory.createExecutor(w.acceptCollection).executeRequest({credentials:e,body:t})}acceptItemGroup(e,t){return this.executorFactory.createExecutor(w.acceptItemGroup).executeRequest({credentials:e,body:t})}acceptUserGroup(e,t){return this.executorFactory.createExecutor(w.acceptUserGroup).executeRequest({credentials:e,body:t})}addItemGroupsToCollection(e,t){return this.executorFactory.createExecutor(w.addItemGroupsToCollection).executeRequest({credentials:e,body:t})}addItems(e,t){return this.executorFactory.createExecutor(w.addItems).executeRequest({credentials:e,body:t})}createCollection(e,t){return this.executorFactory.createExecutor(w.createCollection).executeRequest({credentials:e,body:t})}createItemGroup(e,t){return this.executorFactory.createExecutor(w.createItemGroup).executeRequest({credentials:e,body:t})}createTeamAdminsUserGroup(e,t){return this.executorFactory.createExecutor(w.createTeamAdminsUserGroup).executeRequest({credentials:e,body:t})}createUserGroup(e,t){return this.executorFactory.createExecutor(w.createUserGroup).executeRequest({credentials:e,body:t})}createUserGroupsItemGroup(e,t){return this.executorFactory.createExecutor(w.createUserGroupsItemGroup).executeRequest({credentials:e,body:t})}deleteItemGroup(e,t){return this.executorFactory.createExecutor(w.deleteItemGroup).executeRequest({credentials:e,body:t})}deleteUserGroup(e,t){return this.executorFactory.createExecutor(w.deleteUserGroup).executeRequest({credentials:e,body:t})}postSharingUserdevice(e,t){return this.executorFactory.createExecutor(w.postSharingUserdevice).executeRequest({credentials:e,body:t})}getUsersPublicKey(e,t){return this.executorFactory.createExecutor(w.getUsersPublicKey).executeRequest({credentials:e,body:t})}inviteCollectionMembers(e,t){return this.executorFactory.createExecutor(w.inviteCollectionMembers).executeRequest({credentials:e,body:t})}inviteItemGroupMembers(e,t){return this.executorFactory.createExecutor(w.inviteItemGroupMembers).executeRequest({credentials:e,body:t})}inviteUserGroupUsers(e,t){return this.executorFactory.createExecutor(w.inviteUserGroupUsers).executeRequest({credentials:e,body:t})}refuseCollection(e,t){return this.executorFactory.createExecutor(w.refuseCollection).executeRequest({credentials:e,body:t})}refuseItemGroup(e,t){return this.executorFactory.createExecutor(w.refuseItemGroup).executeRequest({credentials:e,body:t})}refuseUserGroup(e,t){return this.executorFactory.createExecutor(w.refuseUserGroup).executeRequest({credentials:e,body:t})}removeItemGroupsFromCollection(e,t){return this.executorFactory.createExecutor(w.removeItemGroupsFromCollection).executeRequest({credentials:e,body:t})}removeItems(e,t){return this.executorFactory.createExecutor(w.removeItems).executeRequest({credentials:e,body:t})}renameUserGroup(e,t){return this.executorFactory.createExecutor(w.renameUserGroup).executeRequest({credentials:e,body:t})}resendItemGroupInvites(e,t){return this.executorFactory.createExecutor(w.resendItemGroupInvites).executeRequest({credentials:e,body:t})}revokeCollectionMembers(e,t){return this.executorFactory.createExecutor(w.revokeCollectionMembers).executeRequest({credentials:e,body:t})}revokeItemGroupMembers(e,t){return this.executorFactory.createExecutor(w.revokeItemGroupMembers).executeRequest({credentials:e,body:t})}revokeUserGroupUsers(e,t){return this.executorFactory.createExecutor(w.revokeUserGroupUsers).executeRequest({credentials:e,body:t})}updateItem(e,t){return this.executorFactory.createExecutor(w.updateItem).executeRequest({credentials:e,body:t})}updateItemGroupMembers(e,t){return this.executorFactory.createExecutor(w.updateItemGroupMembers).executeRequest({credentials:e,body:t})}updateUserGroupUsers(e,t){return this.executorFactory.createExecutor(w.updateUserGroupUsers).executeRequest({credentials:e,body:t})}}const S={accessibleTeamOffers:{method:"POST",path:"teams/AccessibleTeamOffers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},activateSsoForUsers:{method:"POST",path:"teams/ActivateSsoForUsers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},addGroupManager:{method:"POST",path:"teams/AddGroupManager",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},addSeats:{method:"POST",path:"teams/AddSeats",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},addTeamCaptain:{method:"POST",path:"teams/AddTeamCaptain",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},changeTeamKeyTeamSignUpPage:{method:"POST",path:"teams/ChangeTeamKeyTeamSignUpPage",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},changeTierMidCycle:{method:"POST",path:"teams/ChangeTierMidCycle",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},completeDomainsRegistration:{method:"POST",path:"teams/CompleteDomainsRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},computePlanPricing:{method:"POST",path:"teams/ComputePlanPricing",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createTeamDeviceAccount:{method:"POST",path:"teams/CreateTeamDeviceAccount",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createTeamSignUpPage:{method:"POST",path:"teams/CreateTeamSignUpPage",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivateDomain:{method:"POST",path:"teams/DeactivateDomain",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivateSsoForUsers:{method:"POST",path:"teams/DeactivateSsoForUsers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivateTeamDevice:{method:"POST",path:"teams/DeactivateTeamDevice",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getAllMemberDeviceInformation:{method:"POST",path:"teams/GetAllMemberDeviceInformation",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getAuditLogQueryResults:{method:"POST",path:"teams/GetAuditLogQueryResults",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getAuditLogs:{method:"POST",path:"teams/GetAuditLogs",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getDarkWebInsightsReportDetails:{method:"POST",path:"teams/GetDarkWebInsightsReportDetails",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getDarkWebInsightsSummary:{method:"POST",path:"teams/GetDarkWebInsightsSummary",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getExpectedTaxInformation:{method:"POST",path:"teams/GetExpectedTaxInformation",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getExpectedTaxInformationApp:{method:"POST",path:"teams/GetExpectedTaxInformationApp",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getMidCycleTierUpgradePrice:{method:"POST",path:"teams/GetMidCycleTierUpgradePrice",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getRecoveryCodesAsTeamCaptain:{method:"POST",path:"teams/GetRecoveryCodesAsTeamCaptain",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTeamDevice:{method:"POST",path:"teams/GetTeamDevice",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTeamDeviceEncryptedConfiguration:{method:"POST",path:"teams/GetTeamDeviceEncryptedConfiguration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTeamLastUpdateTs:{method:"POST",path:"teams/GetTeamLastUpdateTs",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTeamMembers:{method:"POST",path:"teams/GetTeamMembers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTeamOffers:{method:"POST",path:"teams/GetTeamOffers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTeamReceipts:{method:"POST",path:"teams/GetTeamReceipts",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTeamSignUpPage:{method:"POST",path:"teams/GetTeamSignUpPage",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getTeamSignUpPageForAdmin:{method:"POST",path:"teams/GetTeamSignUpPageForAdmin",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getUserPermissions:{method:"POST",path:"teams/GetUserPermissions",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},invoiceTeamCreate:{method:"POST",path:"teams/InvoiceTeamCreate",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},invoiceTeamUpgrade:{method:"POST",path:"teams/InvoiceTeamUpgrade",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},lastAdSyncDate:{method:"POST",path:"teams/LastADSyncDate",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},listDomains:{method:"POST",path:"teams/ListDomains",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},listTeamDevices:{method:"POST",path:"teams/ListTeamDevices",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},proposeMembers:{method:"POST",path:"teams/ProposeMembers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},registerFreeTrial:{method:"POST",path:"teams/RegisterFreeTrial",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},registerFreeTrialOptionalFields:{method:"POST",path:"teams/RegisterFreeTrialOptionalFields",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},registerTeamDevice:{method:"POST",path:"teams/RegisterTeamDevice",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},removeGroupManager:{method:"POST",path:"teams/RemoveGroupManager",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},report:{method:"POST",path:"teams/Report",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},reportTeamDeviceError:{method:"POST",path:"teams/ReportTeamDeviceError",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.TEAM_DEVICE,version:o.W.V1},requestDomainRegistration:{method:"POST",path:"teams/RequestDomainRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},requestTeamInviteToken:{method:"POST",path:"teams/RequestTeamInviteToken",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},startAuditLogsQuery:{method:"POST",path:"teams/StartAuditLogsQuery",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},storeActivityLogs:{method:"POST",path:"teams/StoreActivityLogs",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},storeAuditLogs:{method:"POST",path:"teams/StoreAuditLogs",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},teamStatus:{method:"POST",path:"teams/TeamStatus",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},toggleTeamSignUpPage:{method:"POST",path:"teams/ToggleTeamSignUpPage",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},updateTeamDeviceEncryptedConfiguration:{method:"POST",path:"teams/UpdateTeamDeviceEncryptedConfiguration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};class E{constructor(e){this.executorFactory=e}accessibleTeamOffers(e){return this.executorFactory.createExecutor(S.accessibleTeamOffers).executeRequest({body:e})}activateSsoForUsers(e,t){return this.executorFactory.createExecutor(S.activateSsoForUsers).executeRequest({credentials:e,body:t})}addGroupManager(e,t){return this.executorFactory.createExecutor(S.addGroupManager).executeRequest({credentials:e,body:t})}addSeats(e,t){return this.executorFactory.createExecutor(S.addSeats).executeRequest({credentials:e,body:t})}addTeamCaptain(e,t){return this.executorFactory.createExecutor(S.addTeamCaptain).executeRequest({credentials:e,body:t})}changeTeamKeyTeamSignUpPage(e){return this.executorFactory.createExecutor(S.changeTeamKeyTeamSignUpPage).executeRequest({credentials:e})}changeTierMidCycle(e,t){return this.executorFactory.createExecutor(S.changeTierMidCycle).executeRequest({credentials:e,body:t})}completeDomainsRegistration(e){return this.executorFactory.createExecutor(S.completeDomainsRegistration).executeRequest({credentials:e})}computePlanPricing(e,t){return this.executorFactory.createExecutor(S.computePlanPricing).executeRequest({credentials:e,body:t})}createTeamDeviceAccount(e,t){return this.executorFactory.createExecutor(S.createTeamDeviceAccount).executeRequest({credentials:e,body:t})}createTeamSignUpPage(e,t){return this.executorFactory.createExecutor(S.createTeamSignUpPage).executeRequest({credentials:e,body:t})}deactivateDomain(e,t){return this.executorFactory.createExecutor(S.deactivateDomain).executeRequest({credentials:e,body:t})}deactivateSsoForUsers(e,t){return this.executorFactory.createExecutor(S.deactivateSsoForUsers).executeRequest({credentials:e,body:t})}deactivateTeamDevice(e,t){return this.executorFactory.createExecutor(S.deactivateTeamDevice).executeRequest({credentials:e,body:t})}getAllMemberDeviceInformation(e){return this.executorFactory.createExecutor(S.getAllMemberDeviceInformation).executeRequest({credentials:e})}getAuditLogQueryResults(e,t){return this.executorFactory.createExecutor(S.getAuditLogQueryResults).executeRequest({credentials:e,body:t})}getAuditLogs(e,t){return this.executorFactory.createExecutor(S.getAuditLogs).executeRequest({credentials:e,body:t})}getDarkWebInsightsReportDetails(e,t){return this.executorFactory.createExecutor(S.getDarkWebInsightsReportDetails).executeRequest({credentials:e,body:t})}getDarkWebInsightsSummary(e,t){return this.executorFactory.createExecutor(S.getDarkWebInsightsSummary).executeRequest({credentials:e,body:t})}getExpectedTaxInformation(e,t){return this.executorFactory.createExecutor(S.getExpectedTaxInformation).executeRequest({credentials:e,body:t})}getExpectedTaxInformationApp(e){return this.executorFactory.createExecutor(S.getExpectedTaxInformationApp).executeRequest({body:e})}getMidCycleTierUpgradePrice(e,t){return this.executorFactory.createExecutor(S.getMidCycleTierUpgradePrice).executeRequest({credentials:e,body:t})}getRecoveryCodesAsTeamCaptain(e,t){return this.executorFactory.createExecutor(S.getRecoveryCodesAsTeamCaptain).executeRequest({credentials:e,body:t})}getTeamDevice(e,t){return this.executorFactory.createExecutor(S.getTeamDevice).executeRequest({credentials:e,body:t})}getTeamDeviceEncryptedConfiguration(e,t){return this.executorFactory.createExecutor(S.getTeamDeviceEncryptedConfiguration).executeRequest({credentials:e,body:t})}getTeamLastUpdateTs(e,t){return this.executorFactory.createExecutor(S.getTeamLastUpdateTs).executeRequest({credentials:e,body:t})}getTeamMembers(e,t){return this.executorFactory.createExecutor(S.getTeamMembers).executeRequest({credentials:e,body:t})}getTeamOffers(e,t){return this.executorFactory.createExecutor(S.getTeamOffers).executeRequest({credentials:e,body:t})}getTeamReceipts(e,t){return this.executorFactory.createExecutor(S.getTeamReceipts).executeRequest({credentials:e,body:t})}getTeamSignUpPage(e){return this.executorFactory.createExecutor(S.getTeamSignUpPage).executeRequest({body:e})}getTeamSignUpPageForAdmin(e){return this.executorFactory.createExecutor(S.getTeamSignUpPageForAdmin).executeRequest({credentials:e})}getUserPermissions(e){return this.executorFactory.createExecutor(S.getUserPermissions).executeRequest({credentials:e})}invoiceTeamCreate(e){return this.executorFactory.createExecutor(S.invoiceTeamCreate).executeRequest({body:e})}invoiceTeamUpgrade(e){return this.executorFactory.createExecutor(S.invoiceTeamUpgrade).executeRequest({body:e})}lastAdSyncDate(e){return this.executorFactory.createExecutor(S.lastAdSyncDate).executeRequest({credentials:e})}listDomains(e){return this.executorFactory.createExecutor(S.listDomains).executeRequest({credentials:e})}listTeamDevices(e){return this.executorFactory.createExecutor(S.listTeamDevices).executeRequest({credentials:e})}proposeMembers(e,t){return this.executorFactory.createExecutor(S.proposeMembers).executeRequest({credentials:e,body:t})}registerFreeTrial(e){return this.executorFactory.createExecutor(S.registerFreeTrial).executeRequest({body:e})}registerFreeTrialOptionalFields(e){return this.executorFactory.createExecutor(S.registerFreeTrialOptionalFields).executeRequest({body:e})}registerTeamDevice(e,t){return this.executorFactory.createExecutor(S.registerTeamDevice).executeRequest({credentials:e,body:t})}removeGroupManager(e,t){return this.executorFactory.createExecutor(S.removeGroupManager).executeRequest({credentials:e,body:t})}report(e,t){return this.executorFactory.createExecutor(S.report).executeRequest({credentials:e,body:t})}reportTeamDeviceError(e,t){return this.executorFactory.createExecutor(S.reportTeamDeviceError).executeRequest({credentials:e,body:t})}requestDomainRegistration(e,t){return this.executorFactory.createExecutor(S.requestDomainRegistration).executeRequest({credentials:e,body:t})}requestTeamInviteToken(e){return this.executorFactory.createExecutor(S.requestTeamInviteToken).executeRequest({body:e})}startAuditLogsQuery(e,t){return this.executorFactory.createExecutor(S.startAuditLogsQuery).executeRequest({credentials:e,body:t})}storeActivityLogs(e,t){return this.executorFactory.createExecutor(S.storeActivityLogs).executeRequest({credentials:e,body:t})}storeAuditLogs(e,t){return this.executorFactory.createExecutor(S.storeAuditLogs).executeRequest({credentials:e,body:t})}teamStatus(e){return this.executorFactory.createExecutor(S.teamStatus).executeRequest({credentials:e})}toggleTeamSignUpPage(e,t){return this.executorFactory.createExecutor(S.toggleTeamSignUpPage).executeRequest({credentials:e,body:t})}updateTeamDeviceEncryptedConfiguration(e,t){return this.executorFactory.createExecutor(S.updateTeamDeviceEncryptedConfiguration).executeRequest({credentials:e,body:t})}}var O=r(73873);const C={create:{method:"POST",path:"useractivity/Create",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};class P{constructor(e){this.executorFactory=e}create(e,t){return this.executorFactory.createExecutor(C.create).executeRequest({credentials:e,body:t})}}const A={accountrecovery:a,authentication:s,darkwebmonitoring:u,features:d,file:f,payments:y,pwleak:g,securefile:b,sharingUserdevice:w,teams:S,time:O.i,useractivity:C};O.q;var j,_,T;!function(e){e.Admin="admin",e.Limited="limited"}(j||(j={})),function(e){e.USER="USER",e.TAC="TAC",e.AD="AD",e.SCIM="SCIM"}(_||(_={})),function(e){e.Pending="pending",e.Accepted="accepted",e.Refused="refused",e.Revoked="revoked"}(T||(T={}))},64839:(e,t,r)=>{"use strict";var n;r.d(t,{d:()=>n}),function(e){e.NONE="NONE",e.APP="App",e.USER_DEVICE="UserDevice",e.SESSION="Session",e.TEAM_DEVICE="TeamDevice",e.BACK_OFFICE="Backoffice",e.EXTERNAL="External",e.CUSTOM="Custom"}(n||(n={}))},24982:(e,t,r)=>{"use strict";var n;r.d(t,{W:()=>n}),function(e){e.V1="v1"}(n||(n={}))},96873:(e,t,r)=>{"use strict";r.d(t,{_:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{if(!(0,n.Ez)("action.setBadgeBackgroundColor")&&!(0,n.Ez)("browserAction.setBadgeBackgroundColor"))return void r(new Error("No setBadgeBackgroundColor support"));(chrome.action?.setBadgeBackgroundColor??chrome.browserAction.setBadgeBackgroundColor)(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`action/setBadgeBackgroundColor: ${e}`);r(t)}else t()}))}))}},86554:(e,t,r)=>{"use strict";r.d(t,{d:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{if(!(0,n.Ez)("action.setBadgeText")&&!(0,n.Ez)("browserAction.setBadgeText"))return void r(new Error("No setBadgeText support"));(chrome.action?.setBadgeText??chrome.browserAction.setBadgeText)(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`action/setBadgeText: ${e}`);r(t)}else t()}))}))}},16241:(e,t,r)=>{"use strict";r.d(t,{B:()=>o});var n=r(839);function o(e,t){return new Promise(((r,o)=>{if(!(0,n.Ez)("action.setIcon")&&!(0,n.Ez)("browserAction.setIcon"))return void o(new Error("No action.setIcon support"));(chrome.action?.setIcon??chrome.browserAction.setIcon)({path:e,tabId:t},(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`action/setIcon: ${e}`);o(t)}else r()}))}))}},329:(e,t,r)=>{"use strict";r.d(t,{g:()=>o});var n=r(839);function o(e={}){return new Promise(((t,r)=>{(0,n.qX)(["cookies"])?(0,n.Ez)("cookies.getAll")?chrome.cookies.getAll(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`cookies/getAll: ${e}`);r(t)}else t(e)})):r(new Error("No cookies.getAll support")):r(new Error("No cookies.getAll support, permission is missing"))}))}},98641:(e,t,r)=>{"use strict";r.d(t,{O:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["cookies"])?(0,n.Ez)("cookies.remove")?chrome.cookies.remove(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`cookies/remove: ${e}`);r(t)}else t(e)})):r(new Error("No cookies.remove support")):r(new Error("No cookies.remove support, permission is missing"))}))}},6212:(e,t,r)=>{"use strict";r.d(t,{z:()=>o});var n=r(839);function o(){return new Promise(((e,t)=>{(0,n.qX)(["declarativeNetRequest"])?(0,n.Ez)("declarativeNetRequest.getDynamicRules")?chrome.declarativeNetRequest.getDynamicRules((r=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",r=new Error(`declarativeNetRequest/getDynamicRules: ${e}`);t(r)}else e(r)})):t(new Error("No declarativeNetRequest.getDynamicRules support")):t(new Error("No declarativeNetRequest.getDynamicRules support, permission is missing"))}))}},25417:(e,t,r)=>{"use strict";r.d(t,{G:()=>o});var n=r(839);function o(){return(0,n.Ez)("declarativeNetRequest")&&(0,n.qX)(["declarativeNetRequest"])}},84867:(e,t,r)=>{"use strict";r.d(t,{O:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["declarativeNetRequest"])?(0,n.Ez)("declarativeNetRequest.updateDynamicRules")?chrome.declarativeNetRequest.updateDynamicRules(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`declarativeNetRequest/updateDynamicRules: ${e}`);r(t)}else t()})):r(new Error("No declarativeNetRequest.updateDynamicRules support")):r(new Error("No declarativeNetRequest.updateDynamicRules support, permission is missing"))}))}},839:(e,t,r)=>{"use strict";r.d(t,{Ez:()=>a,qX:()=>o});var n=r(84318);function o(e){const t=(0,n.W)().permissions??[];return e.every((e=>t.includes(e)))}function a(e){if("undefined"==typeof chrome)return!1;const t=e.split(".").reduce(((e,t)=>e?.[t]),chrome);return Boolean(t)}},13090:(e,t,r)=>{"use strict";r.d(t,{e:()=>o});var n=r(839);const o={addListener:function(e){if(!(0,n.qX)(["idle"]))throw new Error("No idle.onStateChanged.addListener support, permission is missing");if(!(0,n.Ez)("idle.onStateChanged.addListener"))throw new Error("No idle.onStateChanged.addListener support");const t=t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`idle/onStateChanged: ${e}`)}return e(t)};return chrome.idle.onStateChanged.addListener(t),t},removeListener:function(e){if(!(0,n.qX)(["idle"]))throw new Error("No idle.onStateChanged.removeListener support, permission is missing");if(!(0,n.Ez)("idle.onStateChanged.removeListener"))throw new Error("No idle.onStateChanged.removeListener support");chrome.idle.onStateChanged.removeListener(e)}}},54422:(e,t,r)=>{"use strict";r.d(t,{X:()=>o});var n=r(839);function o(e){if(!(0,n.qX)(["idle"]))throw new Error("No idle.setDetectionInterval support, permission is missing");if(!(0,n.Ez)("idle.setDetectionInterval"))throw new Error("No idle.setDetectionInterval support");chrome.idle.setDetectionInterval(e)}},82324:(e,t,r)=>{"use strict";r.d(t,{I:()=>a,b:()=>i});var n=r(28489),o=r(74972);function a(e){if("object"!=typeof e||!e)return!1;return!!(0,n.l$)(e,"reason")&&e.reason===o.$.RuntimeError}function i(e){if("object"!=typeof e||!e)return!1;return!!(0,n.l$)(e,"reason")&&e.reason===o.$.SettingNotSupported}},30754:(e,t,r)=>{"use strict";r.d(t,{U:()=>i});var n=r(839),o=r(74972);const a={reason:o.$.SettingNotSupported};function i(e){return new Promise(((t,r)=>{(0,n.qX)(["privacy"])&&(0,n.Ez)(`privacy.services.${e}.get`)?chrome.privacy.services[e].get({},(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t={reason:o.$.RuntimeError,runtimeError:new Error(e)};r(t)}else t(e)})):r(a)}))}},74972:(e,t,r)=>{"use strict";var n;r.d(t,{$:()=>n}),function(e){e.RuntimeError="runtimeError",e.SettingNotSupported="settingNotSupported"}(n||(n={}))},81805:(e,t,r)=>{"use strict";r.d(t,{t:()=>i});var n=r(839),o=r(74972);const a={reason:o.$.SettingNotSupported};function i(e,t){return new Promise(((r,i)=>{(0,n.qX)(["privacy"])&&(0,n.Ez)(`privacy.services.${e}.set`)?chrome.privacy.services[e].set({value:t},(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t={reason:o.$.RuntimeError,runtimeError:new Error(e)};i(t)}else r()})):i(a)}))}},84318:(e,t,r)=>{"use strict";r.d(t,{W:()=>o});var n=r(839);function o(){if(!(0,n.Ez)("runtime.getManifest"))throw new Error("No runtime.getManifest support");return chrome.runtime.getManifest()}},92204:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(839);function o(e){if(!(0,n.Ez)("runtime.getURL"))throw new Error("No runtime.getURL support");return chrome.runtime.getURL(e)}},20500:(e,t,r)=>{"use strict";r.d(t,{b:()=>o});var n=r(839);const o={addListener:function(e){if(!(0,n.Ez)("runtime.onConnect.addListener"))throw new Error("No runtime.onConnect.addListener support");const t=t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`runtime/onConnect: ${e}`)}return e(t)};return chrome.runtime.onConnect.addListener(t),t},removeListener:function(e){if(!(0,n.Ez)("runtime.onConnect.removeListener"))throw new Error("No runtime.onConnect.removeListener support");chrome.runtime.onConnect.removeListener(e)}}},23386:(e,t,r)=>{"use strict";r.d(t,{Y:()=>o});var n=r(839);const o={addListener:function(e){if(!(0,n.Ez)("runtime.onInstalled.addListener"))throw new Error("No runtime.onInstalled.addListener support");chrome.runtime.onInstalled.addListener((t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`runtime/onInstalled: ${e}`)}return e(t)}))}}},56386:(e,t,r)=>{"use strict";r.d(t,{H:()=>o});var n=r(839);function o(){if(!(0,n.Ez)("runtime.reload"))throw new Error("No runtime.reload support");chrome.runtime.reload()}},2927:(e,t,r)=>{"use strict";r.d(t,{S:()=>o});var n=r(839);function o(e){if(!(0,n.Ez)("runtime.setUninstallURL"))throw new Error("No runtime.setUninstallURL support");chrome.runtime.setUninstallURL(e)}},21763:(e,t,r)=>{"use strict";r.d(t,{k:()=>a});var n=r(839);const o=(e,t)=>()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",r=new Error(`scripting/executeScript: ${e}`);t(r)}else e()};function a(e,t){return(0,n.Ez)("scripting.executeScript")?function(e,t){return new Promise(((r,n)=>{const a=t??o(r,n);chrome.scripting.executeScript(e,a)}))}(e,t):(0,n.Ez)("tabs.executeScript")?function(e,t){return new Promise(((r,n)=>{const a=t??o(r,n),i={allFrames:e.target.allFrames,file:void 0,frameId:e.target.frameIds?.[0],runAt:"document_start"};"func"in e?i.code=e.func.toString():i.file=e.files[0],chrome.tabs.executeScript(e.target.tabId,i,a)}))}(e,t):Promise.reject(new Error("No scripting.executeScript support"))}},39680:(e,t,r)=>{"use strict";r.d(t,{G:()=>o,y:()=>a});var n=r(839);function o(){return!!chrome.storage?.local.getBytesInUse}function a(e){return new Promise(((t,r)=>{(0,n.qX)(["storage"])?(0,n.Ez)("storage.local.getBytesInUse")?chrome.storage.local.getBytesInUse(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/local/getBytesInUse: ${e}`);r(t)}else t(e)})):r(new Error("No storage.local.getBytesInUse support")):r(new Error("No storage.local.getBytesInUse support, permission is missing"))}))}},41808:(e,t,r)=>{"use strict";r.d(t,{U:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["storage"])?(0,n.Ez)("storage.local.get")?chrome.storage.local.get(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/local/get: ${e}`);r(t)}else t(e)})):r(new Error("No storage.local.get support")):r(new Error("No storage.local.get support, permission is missing"))}))}},45441:(e,t,r)=>{"use strict";r.d(t,{O:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["storage"])?(0,n.Ez)("storage.local.remove")?chrome.storage.local.remove(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/local/remove: ${e}`);r(t)}else t()})):r(new Error("No storage.local.remove support")):r(new Error("No storage.local.remove support, permission is missing"))}))}},9244:(e,t,r)=>{"use strict";r.d(t,{t:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["storage"])?(0,n.Ez)("storage.local.set")?chrome.storage.local.set(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/local/set: ${e}`);r(t)}else t()})):r(new Error("No storage.local.set support")):r(new Error("No storage.local.set support, permission is missing"))}))}},15026:(e,t,r)=>{"use strict";r.d(t,{U:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["storage"])?(0,n.Ez)("storage.session.get")?chrome.storage.session.get(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/session/get: ${e}`);r(t)}t(e)})):r(new Error("No storage.session.get support")):r(new Error("No storage.session.get support, permission is missing"))}))}},32012:(e,t,r)=>{"use strict";r.d(t,{G:()=>o});var n=r(839);function o(){return(0,n.Ez)("storage.session")&&(0,n.qX)(["storage"])}},52477:(e,t,r)=>{"use strict";r.d(t,{O:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["storage"])?(0,n.Ez)("storage.session.remove")?chrome.storage.session.remove(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/session/remove: ${e}`);r(t)}t()})):r(new Error("No storage.session.remove support")):r(new Error("No storage.session.remove support, permission is missing"))}))}},56847:(e,t,r)=>{"use strict";r.d(t,{t:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["storage"])?(0,n.Ez)("storage.session.set")?chrome.storage.session.set(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/session/set: ${e}`);r(t)}t()})):r(new Error("No storage.session.set support")):r(new Error("No storage.session.set support, permission is missing"))}))}},24715:(e,t,r)=>{"use strict";r.d(t,{U:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.Ez)("tabs.create")?chrome.tabs.create(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`tabs/create: ${e}`);r(t)}else t(e)})):r(new Error("No tabs.create support"))}))}},61222:(e,t,r)=>{"use strict";r.d(t,{I:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["tabs"])?(0,n.Ez)("tabs.query")?chrome.tabs.query(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`tabs/query: ${e}`);r(t)}else t(e)})):r(new Error("No tabs.query support")):r(new Error("No tabs.query support, permission is missing"))}))}},49259:(e,t,r)=>{"use strict";r.d(t,{O:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.Ez)("tabs.remove")?chrome.tabs.remove(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`tabs/remove: ${e}`);r(t)}else t()})):r(new Error("No tabs.remove support"))}))}},31460:(e,t,r)=>{"use strict";r.d(t,{V:()=>o});var n=r(839);function o(e,t){return new Promise(((r,o)=>{(0,n.Ez)("tabs.update")?chrome.tabs.update(e,t,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`tabs/update: ${e}`);o(t)}else r(e)})):o(new Error("No tabs.update support"))}))}},48291:(e,t,r)=>{"use strict";r.d(t,{a:()=>a});var n=r(65881),o=r(839);const a={addListener:function(e,t,r){const a=r?.includes(n.X.Blocking)?["webRequest","webRequestBlocking"]:["webRequest"];if(!(0,o.qX)(a))throw new Error("No webRequest.onBeforeRequest.addListener support, permission is missing");if(!(0,o.Ez)("webRequest.onBeforeRequest.addListener"))throw new Error("No webRequest.onBeforeRequest.addListener support");const i=t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`webRequest/onBeforeRequest: ${e}`)}return e(t)};return chrome.webRequest.onBeforeRequest.addListener(i,t,r),i},hasListener:function(e){if(!(0,o.qX)(["webRequest","webRequestBlocking"]))throw new Error("No webRequest.onBeforeRequest.hasListener support, permission is missing");if(!(0,o.Ez)("webRequest.onBeforeRequest.hasListener"))throw new Error("No webRequest.onBeforeRequest support");return chrome.webRequest.onBeforeRequest.hasListener(e)},removeListener:function(e){if(!(0,o.qX)(["webRequest"]))throw new Error("No webRequest.onBeforeRequest.removeListener support, permission is missing");if(!(0,o.Ez)("webRequest.onBeforeRequest.removeListener"))throw new Error("No webRequest.onBeforeRequest support");chrome.webRequest.onBeforeRequest.removeListener(e)}}},65881:(e,t,r)=>{"use strict";var n;r.d(t,{X:()=>n}),function(e){e.Blocking="blocking",e.RequestBody="requestBody"}(n||(n={}))},72733:(e,t,r)=>{"use strict";r.d(t,{T:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{if(!(0,n.Ez)("windows.getCurrent"))return void r(new Error("No windows.getCurrent support"));const o=e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`windows/getCurrent: ${e}`);r(t)}else t(e)};e?chrome.windows.getCurrent(e,o):chrome.windows.getCurrent(o)}))}},57306:(e,t,r)=>{"use strict";r.d(t,{V:()=>o});var n=r(839);function o(e,t){return new Promise(((r,o)=>{(0,n.Ez)("windows.update")?chrome.windows.update(e,t,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`windows/update: ${e}`);o(t)}else r(e)})):o(new Error("No windows.update support"))}))}},34573:()=>{},19381:()=>{},86585:()=>{},1342:()=>{},22324:()=>{},17978:()=>{},98814:()=>{},97961:()=>{},3275:()=>{},63619:()=>{},25387:()=>{},46332:()=>{},48263:()=>{},1973:()=>{},43350:()=>{}}]);